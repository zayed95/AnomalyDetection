"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[8154],{4947:function(e,t,n){n.d(t,{$W:function(){return v},A5:function(){return M},Al:function(){return N},FW:function(){return f},Gq:function(){return A},LV:function(){return y},My:function(){return _},Pn:function(){return h},Rb:function(){return E},Rl:function(){return u},Te:function(){return p},VC:function(){return T},XQ:function(){return m},XS:function(){return D},YO:function(){return I},d6:function(){return b},im:function(){return S},k0:function(){return C},li:function(){return w},rc:function(){return x},tP:function(){return d},tj:function(){return g},yX:function(){return c}});var s=n(76118),o=n(46709),a=n(33481),i=n(64667),r=n(93241),l=n(71540);const d="user",c="session",u="response",m="trace_id",p="request_time",g="execution_duration",v="state",f="source",h="tags",y="trace_name",b="request",w="run_name",S="logged_model",I="tokens",x="custom_metadata",A="span.name",E="span.type",C="span.content",T="prompt",_=[g,p,c],N=[g,p],R=[a._1.CHUNK_RELEVANCE,a._1.TOTAL_INPUT_TOKEN_COUNT,a._1.TOTAL_OUTPUT_TOKEN_COUNT,a._1.TOTAL_TOKEN_COUNT,a._1.DOCUMENT_RECALL,a._1.DOCUMENT_RATINGS],Y="_assessment_column";function M(e){return e+Y}function k(e){return e+"_expectation_column"}const D=(e,t,n,a,x,A)=>(0,o.useMemo)((()=>{const o=null!==A&&void 0!==A?A:(0,l.ZS)(t);let E=[];if(o)E=[{id:b,label:e.formatMessage({id:"Ey+oLI",defaultMessage:"Request"}),type:i.$6.INPUT,group:i.w8.INFO}];else{let e=new Set,n=new Set;t.forEach((t=>{const{inputs:s}=t;e=new Set([...e,...Object.keys(s||{})]),n=new Set([...n,...Object.keys(t.traceInfo||{})])})),E=[...e].map((e=>({id:e,label:e,type:i.$6.INPUT})))}const C=n.map((e=>({id:M(e.name),label:e.displayName,type:i.$6.ASSESSMENT,assessmentInfo:e,group:i.w8.ASSESSMENT}))).filter((e=>!e.assessmentInfo.isRetrievalAssessment&&!R.includes(e.assessmentInfo.name)));let _;const N={};if(o){_=[{id:m,label:e.formatMessage({id:"cv/bGM",defaultMessage:"Trace ID"}),type:i.$6.TRACE_INFO,group:i.w8.INFO},{id:y,label:e.formatMessage({id:"fq8v6G",defaultMessage:"Trace name"}),type:i.$6.TRACE_INFO,group:i.w8.INFO},{id:u,label:e.formatMessage({id:"BU8Jni",defaultMessage:"Response"}),type:i.$6.TRACE_INFO,group:i.w8.INFO},{id:d,label:e.formatMessage({id:"JcRo6a",defaultMessage:"User"}),type:i.$6.TRACE_INFO,group:i.w8.INFO},{id:c,label:e.formatMessage({id:"womPSY",defaultMessage:"Session"}),type:i.$6.TRACE_INFO,group:i.w8.INFO},{id:g,label:e.formatMessage({id:"FnG9dP",defaultMessage:"Execution time"}),filterLabel:e.formatMessage({id:"rRhMQt",defaultMessage:"Execution time (ms)"}),type:i.$6.TRACE_INFO,group:i.w8.INFO},{id:p,label:e.formatMessage({id:"/Aup8Q",defaultMessage:"Request time"}),type:i.$6.TRACE_INFO,group:i.w8.INFO},{id:v,label:e.formatMessage({id:"ySuIn+",defaultMessage:"State"}),type:i.$6.TRACE_INFO,group:i.w8.INFO},{id:f,label:e.formatMessage({id:"vM/qUz",defaultMessage:"Source"}),type:i.$6.TRACE_INFO,group:i.w8.INFO},{id:S,label:e.formatMessage({id:"ofr72S",defaultMessage:"Version"}),type:i.$6.TRACE_INFO,group:i.w8.INFO},{id:T,label:e.formatMessage({id:"LOJumx",defaultMessage:"Prompt"}),type:i.$6.TRACE_INFO,group:i.w8.INFO},{id:I,label:e.formatMessage({id:"q/zoT3",defaultMessage:"Tokens"}),type:i.$6.TRACE_INFO,group:i.w8.INFO},(0,s.isNil)(a)&&{id:w,label:e.formatMessage({id:"dVh69l",defaultMessage:"Run name"}),type:i.$6.TRACE_INFO,group:i.w8.INFO},!(0,r.ij)()&&{id:h,label:e.formatMessage({id:"M3c7bs",defaultMessage:"Tags"}),type:i.$6.TRACE_INFO,group:i.w8.TAG}];const n=[...t,...x||[]],o={};if(n.forEach((e=>{var t;const n=null===(t=e.traceInfo)||void 0===t?void 0:t.trace_metadata;n&&Object.keys(n).forEach((e=>{e.startsWith(l.nt)||o[e]||(o[e]={id:(0,l.c7)(e),label:e,type:i.$6.TRACE_INFO,group:i.w8.INFO})}));const s=e.targets;s&&Object.keys(s).forEach((e=>{N[e]||(N[e]={id:k(e),label:e,type:i.$6.EXPECTATION,group:i.w8.EXPECTATION,expectationName:e})}))})),_=[..._,...Object.values(o)],(0,r.ij)()){const e={};n.map((e=>{var t;return null===(t=e.traceInfo)||void 0===t?void 0:t.tags})).forEach((t=>{Object.keys(t||{}).forEach((t=>{t.startsWith(l.nt)||e[t]||(e[t]={id:(0,l.kZ)(t),label:t,type:i.$6.TRACE_INFO,group:i.w8.TAG})}))}));const t=Object.values(e);_=[..._,...t]}}else _=t.some((e=>!(0,s.isNil)(e.requestTime)))?[{id:p,label:e.formatMessage({id:"/Aup8Q",defaultMessage:"Request time"}),type:i.$6.INTERNAL_MONITOR_REQUEST_TIME}]:[];return[...E,..._,...C,...Object.values(N)].filter((e=>Boolean(e)))}),[t,e,n,a,x,A])},9546:function(e,t,n){n.d(t,{_:function(){return r}});var s=n(49708),o=n(69986),a=n(34599),i=n(76118);const r=({traceIds:e})=>(0,s.I)({queryKey:[a.lA,e],queryFn:async({queryKey:[,e]})=>{const t=(0,i.chunk)(e,20),n=[];for(const s of t){const e=await Promise.all(s.map((e=>(0,o.Uv)(e))));n.push(...e)}return n}})},9858:function(e,t,n){n.d(t,{CY:function(){return g},G8:function(){return i},IX:function(){return r},OV:function(){return l},QO:function(){return h},YH:function(){return a},wG:function(){return f},x2:function(){return v}});var s=n(76118),o=n(90448);const a={up:"#02B30214",down:"#F000400F"},i="#64172B",r="#077A9D",l="#FFAB00",d="#99DDB4",c="#FCA4A1",u="#02B30214",m={user_frustration:{name:"user_frustration",valueColors:{none:{bar:d,tag:u,icon:e=>e.isDarkMode?e.colors.green400:e.colors.green600,text:e=>e.isDarkMode?e.colors.green400:e.colors.green600},resolved:{bar:e=>e.colors.yellow400,tag:e=>e.isDarkMode?(0,o.fu)(e.colors.yellow800,.6):e.colors.yellow200,icon:e=>e.isDarkMode?e.colors.yellow400:e.colors.yellow600,text:e=>e.isDarkMode?e.colors.yellow400:e.colors.yellow600},unresolved:{bar:c,tag:e=>e.isDarkMode?(0,o.fu)(e.colors.red800,.6):e.colors.red200,icon:e=>e.isDarkMode?e.colors.red400:e.colors.red600,text:e=>e.isDarkMode?e.colors.red400:e.colors.red600}}}},p=(e,t,n)=>{const s=m[e.name];if(!s)return;const o=String(null!==t&&void 0!==t?t:""),a=s.valueColors[o];return a?{bar:"function"===typeof a.bar?a.bar(n):a.bar,tag:"function"===typeof a.tag?a.tag(n):a.tag,icon:"function"===typeof a.icon?a.icon(n):a.icon,text:"function"===typeof a.text?a.text(n):a.text}:void 0},g=(e,t,n)=>{const s=p(t,null===n||void 0===n?void 0:n.stringValue,e);if(null!==s&&void 0!==s&&s.icon)return s.icon;if("pass-fail"===t.dtype){if((null===n||void 0===n?void 0:n.stringValue)===o.gZ.YES)return e.isDarkMode?e.colors.green400:e.colors.green600;if((null===n||void 0===n?void 0:n.stringValue)===o.gZ.NO)return e.isDarkMode?e.colors.red400:e.colors.red600}return null!==n&&void 0!==n&&n.errorMessage?e.colors.textValidationWarning:e.colors.grey400},v=(e,t,n,a=!1)=>{const i=p(t,null===n||void 0===n?void 0:n.stringValue,e);if(null!==i&&void 0!==i&&i.tag)return i.tag;if("pass-fail"===t.dtype){if((null===n||void 0===n?void 0:n.stringValue)===o.gZ.YES)return u;if((null===n||void 0===n?void 0:n.stringValue)===o.gZ.NO)return e.isDarkMode?(0,o.fu)(e.colors.red800,.6):e.colors.red200;if(!a&&null!==n&&void 0!==n&&n.errorMessage)return""}else if("boolean"===t.dtype)return(0,s.isNil)(null===n||void 0===n?void 0:n.booleanValue)?"":n.booleanValue?u:e.isDarkMode?e.colors.red800:e.colors.red200;return""},f=(e,t,n)=>{if(null!==n&&void 0!==n&&n.errorMessage)return e.colors.textValidationWarning;const a=p(t,null===n||void 0===n?void 0:n.stringValue,e);return null!==a&&void 0!==a&&a.text?a.text:"pass-fail"===t.dtype?(null===n||void 0===n?void 0:n.stringValue)===o.gZ.YES?e.isDarkMode?e.colors.green400:e.colors.green600:(null===n||void 0===n?void 0:n.stringValue)===o.gZ.NO?e.isDarkMode?e.colors.red400:e.colors.red600:e.colors.textSecondary:"boolean"===t.dtype?(0,s.isNil)(null===n||void 0===n?void 0:n.booleanValue)?e.colors.textSecondary:e.colors.textPrimary:"unknown"===t.dtype?e.colors.textSecondary:e.colors.textPrimary},h=(e,t,n,a)=>{if(a)return"#f09065";const i=p(t,n,e);return null!==i&&void 0!==i&&i.bar?i.bar:"pass-fail"===t.dtype?n===o.gZ.YES?d:n===o.gZ.NO?c:e.isDarkMode?e.colors.grey800:e.colors.grey200:"boolean"===t.dtype?(0,s.isNil)(n)?e.isDarkMode?e.colors.grey800:e.colors.grey200:n?d:c:e.isDarkMode?e.colors.grey800:e.colors.grey200}},18154:function(e,t,n){n.d(t,{WB:function(){return xa},rc:function(){return z.rc},tj:function(){return z.tj},tl:function(){return B.tl},sp:function(){return za},_p:function(){return va},sG:function(){return M},w_:function(){return ma},o8:function(){return o.o8},tU:function(){return Tt},js:function(){return To},Te:function(){return z.Te},Rl:function(){return z.Rl},TH:function(){return Fo},$W:function(){return z.$W},Pn:function(){return z.Pn},YO:function(){return z.YO},XQ:function(){return z.XQ},$6:function(){return B.$6},$U:function(){return Aa},pR:function(){return D.pR},h:function(){return F.h},Mq:function(){return F.Mq},d9:function(){return F.d9},BL:function(){return Oo},kO:function(){return Ho},R7:function(){return ha},Xz:function(){return No},Ie:function(){return Do},Wx:function(){return Pa},KW:function(){return Vo},Zn:function(){return Lo},K0:function(){return Ia},GY:function(){return x}});var s=n(76118),o=n(33481);const a=e=>{var t;return!0===(null===(t=e.metadata)||void 0===t?void 0:t[o.bz.IS_OVERALL_ASSESSMENT])},i=e=>{var t;return(0,s.isNumber)(null===(t=e.metadata)||void 0===t?void 0:t[o.bz.CHUNK_INDEX])},r=e=>Array.isArray(e)&&e.every((e=>(0,s.isPlainObject)(e)&&"doc_uri"in e&&"content"in e)),l=e=>Object.values(e||{}).find(r),d=(e,t,n)=>{const a=l(e)||[],i=l(t);return a.map(((e,t)=>{const a=null===i||void 0===i?void 0:i[t],r=(n||[]).filter((e=>(e.metadata||{})[o.bz.CHUNK_INDEX]===t)),l=(0,s.groupBy)(r,"name");return Object.keys(l).forEach((e=>{l[e]=(0,s.orderBy)(l[e],"timestamp","desc")})),{docUrl:e.doc_uri,content:e.content,retrievalAssessmentsByName:l,target:null===a||void 0===a?void 0:a.content}}))};function c(e){if(!e)return;const{columns:t,data:n,filename:o}=e;if(!t||!Array.isArray(t))throw new SyntaxError(`Artifact ${o} is malformed, it does not contain "columns" array`);if(!n||!Array.isArray(n))throw new SyntaxError(`Artifact ${o} is malformed, it does not contain "data" array`);const a=t.map(((e,t)=>null!==e&&void 0!==e?e:`column_${t}`));return n.map((e=>(0,s.zipObject)(a,e)))}var u=n(9858),m=n(46709),p=n(58024),g=n(27637);const v=p.zy,f=g.ok,h=g.N_,y="assessmentFilter";function b(e){if("undefined"!==e)return"true"===e||"false"!==e&&e}function w(e,t){if("pass-fail"===e.dtype){if("undefined"===t)return;return t}return"boolean"===e.dtype?"true"===t||"false"!==t&&void 0:t}function S(e){return void 0===e||null===e?"undefined":`${e}`}var I=n(90448);const x=(e,t)=>{const[n,s]=(0,m.useState)(t&&e.find((e=>e.id===t.key))?t:void 0);return[(0,m.useMemo)((()=>{if(n&&e.find((e=>e.id===n.key)))return n}),[n,e]),s]};var A=n(68248),E=n(27757),C=n(27299),T=n(66916),_=n(79081),N=n(42747),R=n(73408);const Y=(0,m.createContext)({table:void 0,setTable:()=>{},selectedRowIds:[],setSelectedRowIds:()=>{}}),M=({children:e})=>{const[t,n]=(0,m.useState)(),[s,o]=(0,m.useState)([]),a=(0,m.useMemo)((()=>({table:t,setTable:n,selectedRowIds:s,setSelectedRowIds:o})),[t,s]);return(0,R.Y)(Y.Provider,{value:a,children:e})},k=({experimentIds:e,visible:t,selectedTraces:n,handleClose:s,deleteTraces:o})=>{const a=(0,N.tz)(),[i,r]=(0,m.useState)(""),[l,d]=(0,m.useState)(!1),c=n.map((e=>e.evaluationId));return(0,R.FD)(_.d,{componentId:"eval-tab.delete_traces-modal",title:(0,R.Y)(N.sA,{id:"gRz1nB",defaultMessage:"{count, plural, one {Delete Trace} other {Delete Traces}}",values:{count:c.length}}),visible:t,onCancel:s,okText:(0,R.Y)(N.sA,{id:"g56Cuk",defaultMessage:"Delete {count, plural, one { # trace } other { # traces }}",values:{count:c.length}}),onOk:()=>{(async()=>{try{var t;await o(null!==(t=e[0])&&void 0!==t?t:"",c),s()}catch(n){r(a.formatMessage({id:"zhzZUu",defaultMessage:"An error occured while attempting to delete traces. Please refresh the page and try again."}))}d(!1)})(),d(!0)},okButtonProps:{loading:l,danger:!0},children:[i&&(0,R.Y)(E.T.Paragraph,{color:"error",children:i}),(0,R.Y)(E.T.Paragraph,{children:(0,R.Y)(E.T.Text,{bold:!0,children:(0,R.Y)(N.sA,{id:"kmtWGf",defaultMessage:"{count, plural, one { # trace } other { # traces }} will be deleted.",values:{count:c.length}})})}),(0,R.Y)(E.T.Paragraph,{children:(0,R.Y)(N.sA,{id:"VfGJFc",defaultMessage:"Deleted traces cannot be restored. Are you sure you want to proceed?"})})]})};var D=n(93241),F=n(71540),O=n(28189),V=n(9546);var L={name:"bck6m5",styles:"display:flex;min-height:100%;flex-wrap:nowrap"};const H=({traceIds:e,onClose:t})=>{const n=(0,N.tz)(),{theme:o}=(0,E.u)(),{data:a,isLoading:i}=(0,V._)({traceIds:e}),r=(0,m.useMemo)((()=>(0,s.compact)(a)),[a]);return(0,R.Y)(_.d,{componentId:"mlflow.genai-traces-table.compare-modal",visible:!0,title:n.formatMessage({id:"c4OuCI",defaultMessage:"Compare traces"}),onCancel:t,size:"wide",verticalSizing:"maxed_out",footer:null,dangerouslySetAntdProps:{width:"95%"},children:(0,R.Y)("div",{css:(0,A.AH)({height:"100%",overflow:"auto",marginLeft:-o.spacing.lg,marginRight:-o.spacing.lg},""),children:(0,R.Y)("div",{css:L,children:i||!r||0===r.length?(0,R.Y)(E.T.Text,{children:n.formatMessage({id:"AGi/De",defaultMessage:"Loading traces\u2026"})}):r.map(((t,n)=>(0,R.Y)("div",{css:(0,A.AH)({flex:"1 1 0",minHeight:"100%",minWidth:0,borderRight:n<r.length-1?`1px solid ${o.colors.border}`:"none"},""),children:(0,R.Y)(O.a8,{modelTrace:t,initialActiveView:"summary",isInComparisonView:!0})},e[n])))})})})},U=e=>{const{traceActions:t,experimentId:n,selectedTraces:o,traceInfos:a,setRowSelection:i}=e,{table:r,selectedRowIds:l}=(0,m.useContext)(Y),d=(0,m.useMemo)((()=>(0,F.Co)(l.map((e=>{const t=null===a||void 0===a?void 0:a.find((t=>(0,F.h2)(t)===e));if(t)return{evaluationId:t.trace_id,requestId:t.client_request_id||t.trace_id,inputsId:t.trace_id,inputs:{},outputs:{},targets:{},overallAssessments:[],responseAssessmentsByName:{},metrics:{},traceInfo:t}})).filter((e=>!(0,s.isNil)(e))))),[l,a]),c=o||d;return(0,R.Y)($,{experimentId:n,selectedTraces:c,traceActions:t,setRowSelection:null!==i&&void 0!==i?i:null===r||void 0===r?void 0:r.setRowSelection})},$=e=>{var t,n,o,a,i,r;const{experimentId:l,selectedTraces:d,traceActions:c,setRowSelection:u}=e,p=(0,N.tz)(),[g,v]=(0,m.useState)(!1),[f,h]=(0,m.useState)(!1),y=(0,m.useCallback)((()=>{1===d.length&&d[0].traceInfo&&null!==c&&void 0!==c&&c.editTags&&c.editTags.showEditTagsModalForTrace(d[0].traceInfo)}),[d,c]),b=(0,m.useCallback)((()=>{v(!0)}),[]),w=(0,m.useCallback)((()=>{h(!0)}),[]),S=(0,m.useCallback)((()=>{h(!1)}),[]),I=(0,m.useCallback)((async(e,t)=>{var n,s;await(null===c||void 0===c||null===(n=c.deleteTracesAction)||void 0===n||null===(s=n.deleteTraces)||void 0===s?void 0:s.call(n,e,t)),null===u||void 0===u||u({})}),[u,c]),x=Boolean(null===c||void 0===c?void 0:c.exportToEvals),A=(0,D.ij)()&&Boolean(null===c||void 0===c?void 0:c.editTags),T=Boolean(null===c||void 0===c?void 0:c.deleteTracesAction),Y=(0,m.useCallback)((()=>{var e,t;null===c||void 0===c||null===(e=c.exportToEvals)||void 0===e||null===(t=e.setShowExportTracesToDatasetsModal)||void 0===t||t.call(e,!0)}),[null===c||void 0===c?void 0:c.exportToEvals]),M=null===c||void 0===c||null===(t=c.exportToEvals)||void 0===t?void 0:t.showExportTracesToDatasetsModal,F=d.length>1,O=0===d.length,V=!x&&!A&&!T,L=d.length>=2&&d.length<4;if(V)return null;const U=(0,R.Y)(E.B,{componentId:"mlflow.genai-traces-table.actions-dropdown",disabled:O,type:"primary",endIcon:(0,R.Y)(C.ChevronDownIcon,{}),children:p.formatMessage({id:"PwQiIn",defaultMessage:"Actions{count}"},{count:O?"":` (${d.length})`})});return(0,R.FD)(R.FK,{children:[(0,R.FD)(C.DropdownMenu.Root,{children:[O?(0,R.Y)(_.T,{componentId:"mlflow.genai-traces-table.actions-disabled-tooltip",content:p.formatMessage({id:"HbgpOU",defaultMessage:"Select one or more traces to add to an evaluation or edit the traces."}),children:(0,R.Y)("div",{children:(0,R.Y)(C.DropdownMenu.Trigger,{asChild:!0,children:U})})}):(0,R.Y)(C.DropdownMenu.Trigger,{asChild:!0,children:U}),(0,R.FD)(C.DropdownMenu.Content,{children:[(0,R.Y)(C.DropdownMenu.Item,{componentId:"mlflow.genai-traces-table.compare-traces",onClick:w,disabled:!L,children:p.formatMessage({id:"HrDWRj",defaultMessage:"Compare"})}),(0,R.Y)(C.DropdownMenu.Separator,{}),x&&(0,R.Y)(R.FK,{children:(0,R.FD)(C.DropdownMenu.Group,{children:[(0,R.Y)(C.DropdownMenu.Label,{children:p.formatMessage({id:"xiFkTH",defaultMessage:"Use for evaluation"})}),(0,R.Y)(C.DropdownMenu.Item,{componentId:"mlflow.genai-traces-table.export-to-datasets",onClick:Y,children:p.formatMessage({id:"QcEYpD",defaultMessage:"Add to evaluation dataset"})})]})}),(A||T)&&(0,R.FD)(R.FK,{children:[x&&(0,R.Y)(C.DropdownMenu.Separator,{}),(0,R.FD)(C.DropdownMenu.Group,{children:[(0,R.Y)(C.DropdownMenu.Label,{children:p.formatMessage({id:"gerwuf",defaultMessage:"Edit"})}),A&&(0,R.Y)(C.DropdownMenu.Item,{componentId:"mlflow.genai-traces-table.edit-tags",onClick:y,disabled:F,children:p.formatMessage({id:"A7jptW",defaultMessage:"Edit tags"})}),T&&(0,R.Y)(C.DropdownMenu.Item,{componentId:"mlflow.genai-traces-table.delete-traces",onClick:b,disabled:null===c||void 0===c||null===(n=c.deleteTracesAction)||void 0===n?void 0:n.isDisabled,disabledReason:null===c||void 0===c||null===(o=c.deleteTracesAction)||void 0===o?void 0:o.disabledReason,children:p.formatMessage({id:"G6CJOv",defaultMessage:"Delete traces"})})]})]})]})]}),null===c||void 0===c||null===(a=c.editTags)||void 0===a?void 0:a.EditTagsModal,M&&(null===c||void 0===c||null===(i=c.exportToEvals)||void 0===i||null===(r=i.renderExportTracesToDatasetsModal)||void 0===r?void 0:r.call(i,{selectedTraceInfos:(0,s.compact)(d.map((e=>e.traceInfo)))})),g&&(null===c||void 0===c?void 0:c.deleteTracesAction)&&(0,R.Y)(k,{experimentIds:[l],visible:g,selectedTraces:d,handleClose:()=>v(!1),deleteTraces:I}),f&&(0,R.Y)(H,{traceIds:(0,s.compact)(d.map((e=>{var t;return null===(t=e.traceInfo)||void 0===t?void 0:t.trace_id}))),onClose:S})]})};var z=n(4947),B=n(64667);const j=[B.w8.INFO,B.w8.ASSESSMENT,B.w8.EXPECTATION,B.w8.TAG],P=[z.XQ,z.d6,z.Rl,z.yX,z.tP,z.LV,z.im,z.YO],q=[o._1.OVERALL_ASSESSMENT],K=Object.fromEntries(j.map(((e,t)=>[e,t]))),G=Object.fromEntries(P.map(((e,t)=>[e,t]))),W=Object.fromEntries(q.map(((e,t)=>[e,t])));function Q(e,t){return[...e].sort(((e,n)=>{var s,o;if(t){if(e.id===z.d6)return-1;if(n.id===z.d6)return 1}const a=null!==(s=e.group)&&void 0!==s?s:B.w8.INFO,i=null!==(o=n.group)&&void 0!==o?o:B.w8.INFO,r=K[a]-K[i];if(0!==r)return r;if(a===B.w8.INFO){var l,d;const t=null!==(l=G[e.id])&&void 0!==l?l:1/0,s=null!==(d=G[n.id])&&void 0!==d?d:1/0;return t!==s?t-s:e.label.localeCompare(n.label)}if(a===B.w8.ASSESSMENT){var c,u;const t=null!==(c=W[e.id])&&void 0!==c?c:1/0,s=null!==(u=W[n.id])&&void 0!==u?u:1/0;return t!==s?t-s:e.label.localeCompare(n.label)}return B.w8.EXPECTATION,e.label.localeCompare(n.label)}))}const Z=(e,t)=>e.sort(((e,n)=>{const s=e=>{var n;const s=null===(n=t.find((t=>t.id===e.id)))||void 0===n?void 0:n.type;return s===B.$6.INPUT?1:e.id===z.LV?2:s===B.$6.TRACE_INFO?3:s===B.$6.INTERNAL_MONITOR_REQUEST_TIME?4:s===B.$6.ASSESSMENT?5:999},a=s(e)-s(n);if(0!==a)return a;const i=t.find((t=>t.id===e.id)),r=t.find((e=>e.id===n.id));return(null===i||void 0===i?void 0:i.type)===B.$6.ASSESSMENT&&(null===r||void 0===r?void 0:r.type)===B.$6.ASSESSMENT?i.id===o._1.OVERALL_ASSESSMENT?-1:r.id===o._1.OVERALL_ASSESSMENT?1:(i.label||"").localeCompare(r.label||""):0})),J=(e,t)=>{var n,s;switch(t){case z.Te:case z.tj:case z.Pn:case z.$W:return e[t];case z.FW:return e.tags;case z.XQ:return e.trace_id;case z.yX:return null===(n=e.tags)||void 0===n?void 0:n["mlflow.trace.session"];case z.VC:return null===(s=e.tags)||void 0===s?void 0:s["mlflow.linkedPrompts"];default:throw new Error(`Unknown column id: ${t}`)}};function X(e){const t=new Map,n=new Map;return null===e||void 0===e||e.forEach((e=>{let s=(0,F.ZS)([e])?(0,F.h)(e.traceInfo):e.inputsId;if(t.has(s)){const t=(n.get(e.inputsId)||0)+1;n.set(e.inputsId,t),s=`${e.inputsId}_${t}`}t.set(s,e)})),t}function ee(e,t){if((0,s.isNil)(t))return e.map((e=>({currentRunValue:e})));const n=X(t),o=X(e),a=new Set([...o.keys(),...n.keys()]);return Array.from(a).map((e=>({currentRunValue:o.get(e),otherRunValue:n.get(e)})))}var te=n(90061),ne=n(49460),se=n(76256),oe=n(49708);const ae=()=>{const{theme:e}=(0,E.u)();return(0,R.FD)("span",{css:(0,A.AH)({display:"flex",alignItems:"center",gap:e.spacing.sm,svg:{width:"12px",height:"12px"},color:e.colors.textValidationWarning},""),children:[(0,R.Y)(E.k,{css:(0,A.AH)({color:e.colors.textValidationWarning},"")}),(0,R.Y)(N.sA,{id:"HdEgbb",defaultMessage:"Error"})," "]})};var ie={name:"rhxkjj",styles:"height:20px"};const re=({isComparing:e})=>{const{theme:t}=(0,E.u)();return(0,R.Y)("span",{css:ie,children:e&&(0,R.Y)("span",{css:(0,A.AH)({fontStyle:"italic",color:t.colors.textSecondary},""),children:"null"})})},le=e=>{const{first:t,second:n,gap:s,borderRadius:o,marginY:a}=e,{theme:i}=(0,E.u)();return(0,R.FD)("div",{css:(0,A.AH)({display:"flex",flexDirection:"column",gap:s||i.spacing.sm,borderRadius:o||i.legacyBorders.borderRadiusMd,marginTop:a||"auto",marginBottom:a||"auto"},""),children:[t,n]})};var de=n(36476);const ce=fetch,ue=async(e,t,n,s)=>{const o={method:t,signal:s,headers:{...n?{"Content-Type":"application/json"}:{},...pe(document.cookie)}};n&&(o.body=JSON.stringify(n));const a=await ce(e,o);if(!a.ok){const e=(0,de.a$)(a);try{const t=await(await a.json()).message;t&&(e.message=t)}catch{}throw e}return a.json()};const me=e=>{const t="mlflow-request-header-",n=function(e=document.cookie){return e.split(";").reduce(((e,t)=>{const[n,s]=t.trim().split("=");return e[n]=decodeURIComponent(s||""),e}),{})}(e);return n&&0!==Object.keys(n).length?Object.keys(n).filter((e=>e.startsWith(t))).reduce(((e,t)=>({...e,[t.substring(22)]:n[t]})),{}):{}},pe=e=>({...me(e)});var ge=n(12608),ve=n.n(ge);class fe{static getEntryPointName(e){const t=e[fe.entryPointTag];return t?t.value:""}static getSourceType(e){const t=e[fe.sourceTypeTag];return t?t.value:""}static dropExtension(e){return e.replace(/(.*[^/])\.[^/.]+$/,"$1")}static baseName(e){const t=e.split("/");return t[t.length-1]}static formatSource(e){const t=fe.getSourceName(e),n=fe.getSourceType(e),s=fe.getEntryPointName(e);if("PROJECT"===n){let e=fe.dropExtension(fe.baseName(t));return s&&"main"!==s&&(e+=":"+s),e}if("JOB"===n){const n="mlflow.databricks.jobID",s="mlflow.databricks.jobRunID",o=e&&e[n]&&e[n].value,a=e&&e[s]&&e[s].value;return o&&a?fe.getDefaultJobRunName(o,a):t}return fe.baseName(t)}static getDefaultJobRunName(e,t,n=null){if(!e)return"-";let s=`job ${e}`;return t&&(s=`run ${t} of `+s),n&&(s=`workspace ${n}: `+s),s}static getSourceName(e){const t=e[fe.sourceNameTag];return t?t.value:""}static getGitHubRegex(){return/[@/]github.com[:/]([^/.]+)\/([^/#]+)#?(.*)/}static getGitLabRegex(){return/[@/]gitlab.com[:/]([^/.]+)\/([^/#]+)#?(.*)/}static getBitbucketRegex(){return/[@/]bitbucket.org[:/]([^/.]+)\/([^/#]+)#?(.*)/}static getExperimentChatSessionPageRoute(e,t){return`/experiments/${e}/chat-sessions/${t}`}static getRunPageRoute(e,t){return`/experiments/${e}/runs/${t}`}static getLoggedModelPageRoute(e,t){return`/experiments/${e}/models/${t}`}static getGitRegex(){return/(.*?[@/][^?]*git.*?)[:/]([^#]+)(?:#(.*))?/}static getGitRepoUrl(e,t="master"){const n=e.match(fe.getGitHubRegex()),s=e.match(fe.getGitLabRegex()),o=e.match(fe.getBitbucketRegex()),a=e.match(fe.getGitRegex());let i=null;if(n)i=`https://github.com/${n[1]}/${n[2].replace(/.git/,"")}`,n[3]&&(i+=`/tree/${t}/${n[3]}`);else if(s)i=`https://gitlab.com/${s[1]}/${s[2].replace(/.git/,"")}`,s[3]&&(i+=`/-/tree/${t}/${s[3]}`);else if(o)i=`https://bitbucket.org/${o[1]}/${o[2].replace(/.git/,"")}`,o[3]&&(i+=`/src/${t}/${o[3]}`);else if(a){const[,e,n,s]=a;i=e.replace(/git@/,"https://")+"/"+n.replace(/.git/,""),s&&(i+=`/tree/${t}/${s}`)}return i}static getNotebookRevisionId(e){const t="mlflow.databricks.notebookRevisionID";return e&&e[t]&&e[t].value}static getNotebookId(e){const t="mlflow.databricks.notebookID";return e&&e[t]&&e[t].value}static isCurrentWorkspace(e){return!0}static getDefaultNotebookRevisionName(e,t,n=null){if(!e)return"-";let s=`notebook ${e}`;return t&&(s=`revision ${t} of `+s),n&&(s=`workspace ${n}: `+s),s}static ensureUrlScheme(e,t="https"){return e?e.match(/^:\/\//i)?`${t}${e}`:e.match(/^[a-z1-9+-.]+:\/\//i)?e:`${t}://${e}`:e}static setQueryParams(e,t){const n=new URL(fe.ensureUrlScheme(e));return n.search=t||"",n.toString()}static getNotebookSourceUrl(e,t,n,s,o=null){let a=fe.setQueryParams(o||window.location.origin,e);return a+=`#notebook/${t}`,n&&(a+=`/revision/${n}`,s&&(a+=`/mlflow/run/${s}`)),a}static renderNotebookSource(e,t,n,s,o,a=null,i=null){const r=o?fe.baseName(o):fe.getDefaultNotebookRevisionName(t,n),l=i||r;if(t){const i=fe.getNotebookSourceUrl(e,t,n,s,a);return(0,R.Y)("a",{title:o||fe.getDefaultNotebookRevisionName(t,n),href:i,target:"_top",onClick:e=>{e.stopPropagation()},children:l})}return l}static addQueryParams(e,t){if(!t||0===Object.keys(t).length)return e;const n=new URLSearchParams(e);Object.entries(t).forEach((([e,t])=>Boolean(e)&&Boolean(t)&&n.set(e,t)));const s=n.toString();return""===s||s.includes("?")?s:`?${s}`}static getJobSourceUrl(e,t,n,s=null){let o=fe.setQueryParams(s||window.location.origin,e);return o+=`#job/${t}`,n&&(o+=`/run/${n}`),o}static renderJobSource(e,t,n,s,o=null,a=null){const i=s||fe.getDefaultJobRunName(t,n),r=a||i;if(t){const s=fe.getJobSourceUrl(e,t,n,o);return(0,R.Y)("a",{title:i,href:s,target:"_top",onClick:e=>{e.stopPropagation()},children:r})}return r}static renderSource(e,t,n,s="master"){const o=fe.getSourceName(e);let a=fe.formatSource(e);const i=fe.getGitRepoUrl(o,s);i&&(a=(0,R.Y)("a",{target:"_top",href:i,onClick:e=>{e.stopPropagation()},children:a}));const r=fe.getSourceType(e);if("NOTEBOOK"===r){const s=fe.getNotebookRevisionId(e),a=fe.getNotebookId(e),i="mlflow.databricks.workspaceID",r=e&&e[i]&&e[i].value;if(fe.isCurrentWorkspace(r))return fe.renderNotebookSource(t,a,s,n,o,null);{const i="mlflow.databricks.workspaceURL",l=e&&e[i]&&e[i].value,d=fe.addQueryParams(t,{o:r});return fe.renderNotebookSource(d,a,s,n,o,l)}}if("JOB"===r){const n="mlflow.databricks.jobID",s="mlflow.databricks.jobRunID",o=e&&e[n]&&e[n].value,i=e&&e[s]&&e[s].value,r="mlflow.databricks.workspaceID",l=e&&e[r]&&e[r].value;if(fe.isCurrentWorkspace(l))return fe.renderJobSource(t,o,i,a,null);{const n="mlflow.databricks.workspaceURL",s=e&&e[n]&&e[n].value,r=fe.addQueryParams(t,{o:l});return fe.renderJobSource(r,o,i,a,s)}}return a}static renderSourceFromMetadata(e){var t,n,s,o,a;const i=null===(t=e.trace_metadata)||void 0===t?void 0:t[fe.sourceNameTag],r=null===(n=e.trace_metadata)||void 0===n?void 0:n[fe.sourceTypeTag];let l=i?fe.baseName(i):"";const d=null===(s=e.trace_metadata)||void 0===s?void 0:s["mlflow.source.git.repoURL"],c=null===(o=e.trace_metadata)||void 0===o?void 0:o["mlflow.source.git.branch"],u=null===(a=e.trace_metadata)||void 0===a?void 0:a["mlflow.source.git.commit"];if(d){const e=d.replace("git@github.com:","https://github.com/").replace("git@gitlab.com:","https://gitlab.com/").replace("git@bitbucket.org:","https://bitbucket.org/").replace(".git",""),t=u||c||"master",n=i?`/${i}`:"";let s=e;s=e.includes("github.com")?`${e}/tree/${t}${n}`:e.includes("gitlab.com")?`${e}/-/tree/${t}${n}`:e.includes("bitbucket.org")?`${e}/src/${t}${n}`:`${e}/tree/${t}${n}`,l=(0,R.Y)("a",{target:"_blank",rel:"noopener noreferrer",href:s,onClick:e=>{e.stopPropagation()},children:l})}if("NOTEBOOK"===r){var m,p,g;const t=null===(m=e.trace_metadata)||void 0===m?void 0:m["mlflow.databricks.notebookRevisionID"],n=null===(p=e.trace_metadata)||void 0===p?void 0:p["mlflow.databricks.notebookID"],s=null===(g=e.trace_metadata)||void 0===g?void 0:g["mlflow.databricks.workspaceID"];if(fe.isCurrentWorkspace(s))return fe.renderNotebookSource(null,n,t,null,i,null);{var v;const o="mlflow.databricks.workspaceURL",a=(null===(v=e.trace_metadata)||void 0===v?void 0:v[o])||void 0,r=fe.addQueryParams(null,{o:s});return fe.renderNotebookSource(r,n,t,null,i,a)}}if("JOB"===r){var f,h,y;const t=null===(f=e.trace_metadata)||void 0===f?void 0:f["mlflow.databricks.jobID"],n=null===(h=e.trace_metadata)||void 0===h?void 0:h["mlflow.databricks.jobRunID"],s=null===(y=e.trace_metadata)||void 0===y?void 0:y["mlflow.databricks.workspaceID"];if(fe.isCurrentWorkspace(s))return fe.renderJobSource(null,t,n,l,null);{var b;const o="mlflow.databricks.workspaceURL",a=(null===(b=e.trace_metadata)||void 0===b?void 0:b[o])||void 0,i=fe.addQueryParams(null,{o:s});return fe.renderJobSource(i,t,n,l,a)}}return l}static formatDuration(e){return e<500?e+"ms":e<6e4?(e/1e3).toFixed(1)+"s":e<36e5?(e/1e3/60).toFixed(1)+"min":e<864e5?(e/1e3/60/60).toFixed(1)+"h":(e/1e3/60/60/24).toFixed(1)+"d"}static formatTimestamp(e,t){const n=new Date(0);return n.setUTCMilliseconds(e),t?t.formatDate(n,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):ve()(n).format("YYYY-MM-DD HH:mm:ss")}}fe.runNameTag="mlflow.runName",fe.sourceNameTag="mlflow.source.name",fe.sourceTypeTag="mlflow.source.type",fe.entryPointTag="mlflow.project.entryPoint";var he=fe;const ye=e=>{var t,n;const{experimentId:s,currentTraceInfo:o,otherTraceInfo:a,isComparing:i}=e,r=null===o||void 0===o||null===(t=o.trace_metadata)||void 0===t?void 0:t["mlflow.modelId"],l=null===a||void 0===a||null===(n=a.trace_metadata)||void 0===n?void 0:n["mlflow.modelId"];return(0,R.Y)(le,{first:r?(0,R.Y)(Ie,{experimentId:s,modelId:r,isComparing:i}):(0,R.Y)(re,{isComparing:i}),second:i&&(l?(0,R.Y)(Ie,{experimentId:s,modelId:l,isComparing:i}):(0,R.Y)(re,{isComparing:i}))})};var be={name:"1puasmx",styles:"width:fit-content;max-width:100%;margin-right:0;cursor:pointer"},we={name:"1it2kpr",styles:"max-width:100%;display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Se={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"};const Ie=e=>{var t;const{experimentId:n,modelId:s,isComparing:o}=e,{theme:a}=(0,E.u)(),{data:i,isLoading:r,error:l}=xe({loggedModelId:s}),d=null===i||void 0===i||null===(t=i.info)||void 0===t?void 0:t.name;return r?(0,R.Y)(C.ParagraphSkeleton,{}):l?(0,R.Y)(ae,{}):d?(0,R.Y)(_.T,{componentId:"mlflow.eval-runs.model-version-cell-tooltip",content:d,children:(0,R.Y)(C.Tag,{componentId:"mlflow.eval-runs.model-version-cell",id:"model-version-cell",css:be,children:(0,R.Y)(h,{to:he.getLoggedModelPageRoute(n,s),target:"_blank",css:we,title:d,children:(0,R.FD)("div",{css:(0,A.AH)({display:"flex",alignItems:"center",gap:a.spacing.xs,maxWidth:"100%"},""),children:[(0,R.Y)(C.ModelsIcon,{css:(0,A.AH)({color:a.colors.textPrimary,fontSize:16},"")}),(0,R.Y)(E.T.Text,{css:Se,children:d})]})})})}):(0,R.Y)(re,{isComparing:o})},xe=({loggedModelId:e})=>{const{data:t,isLoading:n,isFetching:o,refetch:a,error:i}=(0,oe.I)({queryKey:["loggedModelName",e],queryFn:async()=>await ue(`ajax-api/2.0/mlflow/logged-models/${e}`,"GET"),cacheTime:1/0,staleTime:1/0,refetchOnMount:!1,retry:1,enabled:!(0,s.isNil)(e)});return{isLoading:n,isFetching:o,data:null===t||void 0===t?void 0:t.model,refetch:a,error:i}};var Ae={name:"pzwiqy",styles:"display:flex;max-width:100%;text-overflow:ellipsis;overflow:hidden;white-space:nowrap"};const Ee=e=>{var t,n,s;const{experimentId:o,runUuid:a}=e,{data:i,isLoading:r,error:l}=Ce(o,a),d=null===i||void 0===i||null===(t=i.runs)||void 0===t||null===(n=t[0])||void 0===n||null===(s=n.info)||void 0===s?void 0:s.run_name;return r?(0,R.Y)(C.ParagraphSkeleton,{}):l?(0,R.Y)(ae,{}):d?(0,R.Y)(h,{css:Ae,to:he.getRunPageRoute(o,a),title:d,children:d}):(0,R.Y)(re,{})},Ce=(e,t)=>(0,oe.I)({queryKey:["runName",e,t],cacheTime:1/0,staleTime:1/0,retry:1,refetchOnMount:!1,queryFn:async()=>{const n=`run_id IN ('${t}')`;return await ue("ajax-api/2.0/mlflow/runs/search","POST",{experiment_ids:[e],filter:n})}});var Te=n(44105);const _e=({sessionId:e,experimentId:t,traceId:n,children:s})=>{const o=he.getExperimentChatSessionPageRoute(t,e),a=n?`${o}?${new URLSearchParams({[Te.hb]:n}).toString()}`:o;return(0,R.Y)(h,{to:a,children:s})};var Ne=function(e){return e.NOTEBOOK="NOTEBOOK",e.JOB="JOB",e.PROJECT="PROJECT",e.LOCAL="LOCAL",e.UNKNOWN="UNKNOWN",e}(Ne||{});const Re=({sourceType:e,className:t})=>e===Ne.NOTEBOOK?(0,R.Y)(C.NotebookIcon,{className:t}):e===Ne.LOCAL?(0,R.Y)(C.HomeIcon,{className:t}):e===Ne.PROJECT?(0,R.Y)(C.FolderBranchIcon,{className:t}):e===Ne.JOB?(0,R.Y)(C.WorkflowsIcon,{className:t}):null;var Ye={name:"1gz2b5f",styles:"overflow:hidden;text-overflow:ellipsis"};const Me=e=>{var t;const n=e.traceInfo.tags,{theme:s}=(0,E.u)();if(!n)return(0,R.Y)(re,{isComparing:e.isComparing});const o=null===(t=e.traceInfo.trace_metadata)||void 0===t?void 0:t[he.sourceTypeTag],a=he.renderSourceFromMetadata(e.traceInfo);return a&&o?(0,R.FD)("div",{css:(0,A.AH)({display:"flex",gap:s.spacing.xs,alignItems:"center",...e.disableLinks&&{"& a":{pointerEvents:"none",color:"inherit",textDecoration:"none",cursor:"default"}}},""),children:[(0,R.Y)(Re,{sourceType:o,css:(0,A.AH)({color:s.colors.textSecondary},"")}),(0,R.Y)("span",{css:Ye,children:a})]}):(0,R.Y)(re,{isComparing:e.isComparing})},ke={STATE_UNSPECIFIED:null,IN_PROGRESS:(0,N.zR)({id:"y56Vz9",defaultMessage:"In progress"}),OK:(0,N.zR)({id:"Mn7Kss",defaultMessage:"OK"}),ERROR:(0,N.zR)({id:"igK5Su",defaultMessage:"Error"})},De=(e,t)=>"IN_PROGRESS"===e?(0,R.Y)(T.C,{css:(0,A.AH)({color:t.colors.textValidationWarning},"")}):"OK"===e?(0,R.Y)(C.CheckCircleIcon,{css:(0,A.AH)({color:t.colors.textValidationSuccess},"")}):"ERROR"===e?(0,R.Y)(C.XCircleIcon,{css:(0,A.AH)({color:t.colors.textValidationDanger},"")}):null,Fe=({original:e,isComparing:t})=>{const{theme:n}=(0,E.u)(),s=(0,N.tz)(),o=ke[(null===e||void 0===e?void 0:e.state)||"STATE_UNSPECIFIED"];return o?(0,R.FD)("div",{css:(0,A.AH)({display:"flex",gap:n.spacing.xs,alignItems:"center"},""),children:[De((null===e||void 0===e?void 0:e.state)||"STATE_UNSPECIFIED",n),o?s.formatMessage(o):""]}):(0,R.Y)(re,{isComparing:t})};var Oe=n(16333);const{Paragraph:Ve}=E.T;var Le={name:"s5xdrg",styles:"display:flex;align-items:center"},He={name:"1ff36h2",styles:"flex-grow:1"};const Ue=m.memo((e=>{const{theme:t}=(0,E.u)();return(0,R.Y)(_.d,{componentId:"codegen_mlflow_app_src_common_components_keyvaluetagfullviewmodal.tsx_17",title:"Tag: "+e.tagKey,visible:e.isKeyValueTagFullViewModalVisible,onCancel:()=>e.setIsKeyValueTagFullViewModalVisible(!1),children:(0,R.FD)("div",{css:Le,children:[(0,R.Y)(Ve,{css:He,children:(0,R.Y)("pre",{css:(0,A.AH)({backgroundColor:t.colors.backgroundPrimary,marginTop:t.spacing.sm,whiteSpace:"pre-wrap",wordBreak:"break-all"},""),children:e.tagValue})}),(0,R.Y)("div",{css:(0,A.AH)({marginBottom:t.spacing.md},""),children:(0,R.Y)(Oe.ad,{componentId:"mlflow.genai-traces-table.tag_view_modal.tag_value_copy_button",copyText:e.tagValue})})]})})}));function $e(e=!0){return e?{overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap",whiteSpace:"nowrap"}:{whiteSpace:"nowrap"}}const ze=({isClosable:e=!1,onClose:t,tag:n,enableFullViewModal:s=!1,charLimit:o=30,maxWidth:a=300,className:i})=>{const r=(0,N.tz)(),[l,d]=(0,m.useState)(!1),{shouldTruncateKey:c,shouldTruncateValue:u}=function(e,t=30){const{key:n,value:s}=e,o=n.length+s.length,a=n.length>s.length,i=a?s.length:n.length;return o<=t?{shouldTruncateKey:!1,shouldTruncateValue:!1}:i>t/2?{shouldTruncateKey:!0,shouldTruncateValue:!0}:{shouldTruncateKey:a,shouldTruncateValue:!a}}(n,o),p=s&&(c||u),g=r.formatMessage({id:"ZXUtU8",defaultMessage:"Click to see more"});return(0,R.FD)("div",{children:[(0,R.Y)(C.Tag,{componentId:"codegen_mlflow_app_src_common_components_keyvaluetag.tsx_60",closable:e,onClose:t,title:n.key,className:i,children:(0,R.Y)(_.T,{componentId:"web-shared.genai-traces-table.key-value-tag.full-view-tooltip",content:p?(0,R.Y)("span",{children:g}):void 0,children:(0,R.FD)("span",{css:(0,A.AH)({maxWidth:a,display:"inline-flex"},""),onClick:()=>p?d(!0):void 0,children:[(0,R.Y)(E.T.Text,{bold:!0,title:n.key,css:$e(c),children:n.key}),n.value&&(0,R.FD)(E.T.Text,{title:n.value,css:$e(u),children:[": ",n.value]})]})})}),(0,R.Y)("div",{children:l&&(0,R.Y)(Ue,{tagKey:n.key,tagValue:n.value,isKeyValueTagFullViewModalVisible:l,setIsKeyValueTagFullViewModalVisible:d})})]})};var Be={name:"1wcfv52",styles:"margin-right:0"},je={name:"14cnl6e",styles:"flex-shrink:0;opacity:0;[role=row]:hover &{opacity:1;}[role=row]:focus-within &{opacity:1;}"};const Pe=({onAddEditTags:e,tags:t,baseComponentId:n})=>{const{theme:s}=(0,E.u)(),o=(null===t||void 0===t?void 0:t.filter((({key:e})=>e&&!e.startsWith(F.nt))))||[],a=o.length>0;return(0,R.FD)("div",{css:(0,A.AH)({display:"flex",alignItems:"center",flexWrap:"wrap",columnGap:s.spacing.xs,rowGap:s.spacing.xs},""),children:[o.map((e=>(0,R.Y)(ze,{tag:e,css:Be,charLimit:20,maxWidth:150,enableFullViewModal:!0},e.key))),e&&(0,R.Y)(E.B,{componentId:"mlflow.tags_cell_renderer.traces_table.edit_tag",size:"small",icon:a?(0,R.Y)(C.PencilIcon,{}):void 0,onClick:e,children:a?void 0:(0,R.Y)(N.sA,{id:"vHNP+J",defaultMessage:"Add tags"}),css:je,type:"tertiary"})]})};const qe=e=>{const{currentTraceInfo:t,otherTraceInfo:n,isComparing:s}=e;return(0,R.Y)(le,{first:(0,R.Y)(nt,{traceInfo:t,isComparing:s}),second:s&&(0,R.Y)(nt,{traceInfo:n,isComparing:s})})};var Ke={name:"58t467",styles:"width:fit-content;max-width:100%"},Ge={name:"hdknak",styles:"display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},We={name:"1fttcpj",styles:"display:flex;flex-direction:column"},Qe={name:"ho1qnd",styles:"display:flex;flex-direction:row"},Ze={name:"i9sky5",styles:"width:35%"},Je={name:"ho1qnd",styles:"display:flex;flex-direction:row"},Xe={name:"i9sky5",styles:"width:35%"},et={name:"ho1qnd",styles:"display:flex;flex-direction:row"},tt={name:"i9sky5",styles:"width:35%"};const nt=e=>{var t;const{traceInfo:n,isComparing:s}=e,o=null===n||void 0===n||null===(t=n.trace_metadata)||void 0===t?void 0:t[O.Uu],a=(()=>{try{return o?JSON.parse(o):{}}catch{return{}}})(),i=a.total_tokens,r=a.input_tokens,l=a.output_tokens,d=(0,N.tz)();return i?(0,R.Y)(C.HoverCard,{trigger:(0,R.Y)(C.Tag,{css:Ke,componentId:"mlflow.genai-traces-table.tokens",children:(0,R.Y)("span",{css:Ge,children:i})}),content:(0,R.FD)("div",{css:We,children:[i&&(0,R.FD)("div",{css:Qe,children:[(0,R.Y)("div",{css:Ze,children:(0,R.Y)(E.T.Text,{children:d.formatMessage({id:"83wDn8",defaultMessage:"Total"})})}),(0,R.Y)("div",{children:(0,R.Y)(E.T.Text,{color:"secondary",children:i})})]}),r&&(0,R.FD)("div",{css:Je,children:[(0,R.Y)("div",{css:Xe,children:(0,R.Y)(E.T.Text,{children:d.formatMessage({id:"Y7DzTT",defaultMessage:"Input"})})}),(0,R.Y)("div",{children:(0,R.Y)(E.T.Text,{color:"secondary",children:r})})]}),l&&(0,R.FD)("div",{css:et,children:[(0,R.Y)("div",{css:tt,children:(0,R.Y)(E.T.Text,{children:d.formatMessage({id:"tGqJL4",defaultMessage:"Output"})})}),(0,R.Y)("div",{children:(0,R.Y)(E.T.Text,{color:"secondary",children:l})})]})]})}):(0,R.Y)(re,{isComparing:s})},st="Error";function ot(e){return Boolean((null===e||void 0===e?void 0:e.errorCode)||(null===e||void 0===e?void 0:e.errorMessage))}function at(e){const t=e.split("/");return 1===t.length?{metricName:e,assessmentName:e}:2===t.length?{metricName:t[0],assessmentName:t[1]}:{metricName:t[1],assessmentName:t.slice(2).join("/")}}const it=[I.gZ.YES,I.gZ.NO];function rt(e,t,n){var o;const a={},i={[I._1.OVERALL_ASSESSMENT]:"pass-fail"},r=new Set;[...t,...n||[]].forEach((e=>{var t;const n=Object.entries(e.responseAssessmentsByName||{}),o=e.overallAssessments.map((e=>[I._1.OVERALL_ASSESSMENT,[e]])),a=[];null===(t=e.retrievalChunks)||void 0===t||t.forEach((e=>{for(const[t,n]of Object.entries(e.retrievalAssessmentsByName||{}))a.push([t,n])}));for(const[l,d]of[...n,...o,...a]){let e;r.add(l);for(const t of d)if(e=(0,s.isNil)(t.stringValue)?(0,s.isNil)(t.numericValue)?(0,s.isNil)(t.booleanValue)?void 0:"boolean":"numeric":"pass-fail",void 0!==e)break;i[l]||(l in I.c9&&(e="pass-fail"),i[l]=e);for(const t of d)if("pass-fail"===e&&!(0,s.isNil)(t.stringValue)&&!it.includes(t.stringValue)){i[l]="string";break}void 0!==e&&e!==i[l]&&(i[l]="string")}}));for(const s of r)i[s]||(i[s]="unknown");[...t,...n||[]].forEach((t=>{var n;const o=Object.entries(t.responseAssessmentsByName||{}),r=t.overallAssessments.map((e=>[I._1.OVERALL_ASSESSMENT,[e]])),l=[];null===(n=t.retrievalChunks)||void 0===n||n.forEach((e=>{for(const[t,n]of Object.entries(e.retrievalAssessmentsByName||{}))l.push([t,n])}));const d=Object.keys(i);for(const f of d){const t=[...o.filter((([e])=>e===f)),...r.filter((([e])=>e===f)),...l.filter((([e])=>e===f))].flatMap((([e,t])=>t)),n=t[0],d=ot(n);if((0,s.isNil)(a[f])){var c,u,m;let s,o,r=!1;const g=void 0!==I.c9[f];if(g)s=e.formatMessage(I.c9[f]),o=f,r=!1;else{var p;const{metricName:e,assessmentName:t}=at(f);s=t||"-",o=e,"CODE"===(null===n||void 0===n||null===(p=n.source)||void 0===p?void 0:p.sourceType)&&(r=!0)}const v=i[f]||"string",h=(0,I.FN)(I.pZ[f]),y=f in I.jr?e.formatMessage(I.jr[f]):"",b=f in I.mS?e.formatMessage(I.mS[f]):"HUMAN"===(null===n||void 0===n||null===(c=n.source)||void 0===c?void 0:c.sourceType)?e.formatMessage({id:"z94r4F",defaultMessage:"This assessment is produced by a human judge."}):e.formatMessage({id:"lQ2nDn",defaultMessage:"This assessment is produced by a custom metric."}),w=new Set;0===t.length&&w.add(void 0);for(const e of t){let t=e?(0,I.Zh)(e):void 0;null===t&&(t=void 0),w.add(t)}a[f]={name:f,displayName:s,isKnown:g,metricName:o,isCustomMetric:r,source:null===n||void 0===n?void 0:n.source,dtype:v,uniqueValues:w,isOverall:f===I._1.OVERALL_ASSESSMENT,docsLink:h,missingTooltip:y,description:b,isEditable:"AI_JUDGE"===(null===n||void 0===n||null===(u=n.source)||void 0===u?void 0:u.sourceType)||"HUMAN"===(null===n||void 0===n||null===(m=n.source)||void 0===m?void 0:m.sourceType),isRetrievalAssessment:l.some((([e])=>e===f)),containsErrors:d}}else{const e=a[f];0===t.length&&e.uniqueValues.add(void 0);for(const n of t){let t=n?(0,I.Zh)(n):void 0;(0,s.isNil)(t)&&(t=void 0),e.uniqueValues.add(t)}var g,v;if(!e.isEditable)e.isEditable="AI_JUDGE"===(null===n||void 0===n||null===(g=n.source)||void 0===g?void 0:g.sourceType)||"HUMAN"===(null===n||void 0===n||null===(v=n.source)||void 0===v?void 0:v.sourceType);e.isRetrievalAssessment=e.isRetrievalAssessment||l.some((([e])=>e===f)),e.containsErrors=e.containsErrors||d}}}));const l=(null===(o=a[I._1.OVERALL_ASSESSMENT])||void 0===o?void 0:o.uniqueValues)||new Set;return l.has(I.gZ.YES)||l.has(I.gZ.NO)||delete a[I._1.OVERALL_ASSESSMENT],lt(Object.values(a))}function lt(e){return e.sort(((e,t)=>{const n=I.kp.indexOf(e.name),s=I.kp.indexOf(t.name);return-1!==n&&-1!==s?n-s:-1!==n?-1:-1!==s?1:e.name.localeCompare(t.name)}))}function dt(e,t){if("numeric"!==e.dtype)return;return function(e){if(0===e.length)return;const t=[],n=Math.min(...e),s=Math.max(...e),o=Math.max(.01,(s-n)/10);let a=0;if(n===s)t.push({lower:n,upper:s,count:e.length});else for(let i=n;i<s;i+=o)t.push({lower:i,upper:Math.min(i+o,s),count:0});t.sort(((e,t)=>e.lower-t.lower));for(const i of e){const e=t.find((e=>i>=e.lower&&(i<e.upper||i===e.upper&&i===s)));e&&(e.count++,a=Math.max(a,e.count))}return{min:n,max:s,maxCount:a,counts:t}}(t.flatMap((t=>{const n=e.isOverall?t.overallAssessments:t.responseAssessmentsByName[e.name];return null===n||void 0===n?void 0:n.map((e=>(0,I.Zh)(e))).filter((e=>void 0!==e&&"number"===typeof e))})).filter((e=>!(0,s.isNil)(e))))}function ct(e,t){if("numeric"===e.dtype)return;const n=new Map;return t.forEach((t=>{const s=e.isOverall?t.overallAssessments:t.responseAssessmentsByName[e.name],o=s&&s.length>0?yt(e,s):[{value:void 0,count:1}],a=e.containsErrors?[st,...e.uniqueValues]:e.uniqueValues;for(const e of a){const t=o.find((t=>t.value===e)),s=t?t.count:0;n.set(e,(n.get(e)||0)+s)}})),n}function ut(e,t){if("numeric"!==e.dtype)return;const n=[];return t.forEach((t=>{const o=e.isOverall?(0,s.first)(t.overallAssessments):(0,s.first)(t.responseAssessmentsByName[e.name]);if(o){const e=(0,I.Zh)(o);(0,s.isNil)(e)||n.push(Number(e))}})),n}function mt(e,t){let n=0;return t.forEach((t=>{var o;if((0,s.isNil)(t))return;const a=(0,s.first)(t.overallAssessments);(null===a||void 0===a||null===(o=a.rootCauseAssessment)||void 0===o?void 0:o.assessmentName)===e.name&&n++})),n}function pt(e,t,n){const o=t.map((e=>e.currentRunValue)).filter((e=>!(0,s.isNil)(e))),a=t.map((e=>e.otherRunValue)).filter((e=>!(0,s.isNil)(e))),i=ct(e,o),r=ct(e,a),l=dt(e,o),d=n.filter((t=>t.assessmentName===e.name));return{assessmentInfo:e,currentCounts:i,otherCounts:r,currentNumericValues:ut(e,o),otherNumericValues:ut(e,a),currentNumericAggregate:l,currentNumRootCause:mt(e,o),otherNumRootCause:mt(e,a),assessmentFilters:d}}function gt(e,t=new Map){if("pass-fail"===e.dtype||"boolean"===e.dtype){let n=0,o=0;for(const[a,i]of t)Nt(e,a)&&(o+=i),(0,s.isNil)(a)||a===st||(n+=i);return n>0?o/n:0}return 0}function vt(e,t,n,s,o,a,i){let r=0;const l=s===st||void 0===s;for(const[u,m]of o)void 0!==u&&u!==st&&(r+=m);const d=o.get(s)||0,c=!l&&r>0?d/r:0;return{value:o.get(s)||0,fraction:c,isSelected:n.some((e=>e.filterValue===s&&e.assessmentName===t.name&&e.run===a)),toggleFilter:()=>i(t.name,s,a,undefined),tooltip:l?e.formatMessage({id:"joh88n",defaultMessage:'{numValue} for run "{runName}"'},{numValue:d,runName:a}):e.formatMessage({id:"jjidVr",defaultMessage:'{numValue}/{numEvals} for run "{runName}"'},{numValue:d,numEvals:r,runName:a})}}function ft(e){const t=function(e){const t=Array.from(e.uniqueValues);if("pass-fail"===e.dtype){t.includes(I.gZ.YES)||t.push(I.gZ.YES),t.includes(I.gZ.NO)||t.push(I.gZ.NO);const e=[I.gZ.YES,I.gZ.NO];return t.sort(((t,n)=>e.indexOf(t)-e.indexOf(n)))}if("boolean"===e.dtype)return t.sort(((e,t)=>!0===e?-1:1));return t.sort()}(e);return e.containsErrors&&t.push(st),t}function ht(e,t,n,o){return"pass-fail"===n.dtype?o===I.gZ.YES?e.formatMessage({id:"nDVJ/n",defaultMessage:"Pass"}):o===I.gZ.NO?e.formatMessage({id:"7Dhfxy",defaultMessage:"Fail"}):o===st?e.formatMessage({id:"gPWxlB",defaultMessage:"Error"}):e.formatMessage({id:"keSIQ4",defaultMessage:"null"}):"boolean"===n.dtype?!0===o?e.formatMessage({id:"1Ujhc3",defaultMessage:"True"}):!1===o?e.formatMessage({id:"nvjkTA",defaultMessage:"False"}):o===st?e.formatMessage({id:"oM11pD",defaultMessage:"Error"}):e.formatMessage({id:"keSIQ4",defaultMessage:"null"}):(0,s.isNil)(o)?"null":`${o}`}function yt(e,t){const n=t.filter((t=>t.name===e.name));let s=new Set;for(const r of n){const e=(0,I.Zh)(r);s.add(e)}n.sort(((e,t)=>(t.timestamp||0)-(e.timestamp||0)));const o=n.filter((e=>ot(e))),a=n.filter((e=>!ot(e)));s=new Set;for(const r of a){const e=(0,I.Zh)(r);s.add(e)}const i=[];for(const r of s){const e=n.filter((e=>(0,I.Zh)(e)===r)),t=e.length;i.push({value:r,count:t,latestAssessment:e[0]})}return o.length>0&&i.push({value:st,count:o.length,latestAssessment:o[0]}),i}function bt(e,t=1){return Number((100*e).toFixed(t)).toString()}function wt(e,t=3){if((0,s.isNil)(e))return"null";const n=Math.pow(10,t);return(Math.round(e*n)/n).toString()}function St(e,t,n=!0){if("numeric"===e.dtype){return"up"===(t>0?"up":"down")?`+${wt(t,2)}`:`-${wt(t,2)}`}{const e=t>=0?"up":"down";return n?"up"===e?`+${bt(t,0)}%`:`-${bt(-1*t,0)}%`:"up"===e?`+${t}`:`-${t}`}}function It(e,t=new Date){const n=Math.max(0,Math.floor((t-e)/1e3));let s=Math.floor(n/31536e3);return s>=1?(0,R.Y)(N.sA,{id:"16BvfJ",defaultMessage:"{timeSince, plural, =1 {1 year} other {# years}} ago",values:{timeSince:s}}):(s=Math.floor(n/2592e3),s>=1?(0,R.Y)(N.sA,{id:"5ZAXeS",defaultMessage:"{timeSince, plural, =1 {1 month} other {# months}} ago",values:{timeSince:s}}):(s=Math.floor(n/86400),s>=1?(0,R.Y)(N.sA,{id:"tLb7+M",defaultMessage:"{timeSince, plural, =1 {1 day} other {# days}} ago",values:{timeSince:s}}):(s=Math.floor(n/3600),s>=1?(0,R.Y)(N.sA,{id:"aOW396",defaultMessage:"{timeSince, plural, =1 {1 hour} other {# hours}} ago",values:{timeSince:s}}):(s=Math.floor(n/60),s>=1?(0,R.Y)(N.sA,{id:"7jsqqe",defaultMessage:"{timeSince, plural, =1 {1 minute} other {# minutes}} ago",values:{timeSince:s}}):(0,R.Y)(N.sA,{id:"93iLUV",defaultMessage:"{timeSince, plural, =1 {1 second} other {# seconds}} ago",values:{timeSince:n}})))))}function xt(e){return e.replace(/([!"#$%&'()*+,\.\/:;\s<=>?@[\\\]^`{|}~])/g,"\\$1")}function At(e,t){return function(e,t,n=[],s){let o=Number(e);if(isNaN(o)||!isFinite(o))return{value:"",numericValue:void 0,unit:"",divisor:1};let a=0,i=1;for(;o>=t&&a<n.length-1;)o/=t,i*=t,a+=1;return{value:Et(o,s),numericValue:o,unit:n[a],divisor:i}}(e,1024,["bytes","KB","MB","GB","TB","PB"],t)}function Et(e,t=3){return Math.round(e)!==e?e.toFixed(t):e.toString()}const Ct=m.createContext({makeHTML:e=>e}),Tt=({children:e,makeHtml:t})=>(0,R.Y)(Ct.Provider,{value:{makeHTML:t},children:e}),_t=()=>m.useContext(Ct);const Nt=(e,t)=>{if(!(0,s.isNil)(t))if("pass-fail"===e.dtype){if(t===I.gZ.YES)return!0;if(t===I.gZ.NO)return!1}else if("boolean"===e.dtype)return!0===t};var Rt={name:"1jwcxx3",styles:"font-style:italic"},Yt={name:"1jwcxx3",styles:"font-style:italic"};var Mt={name:"1066lcq",styles:"display:flex;justify-content:space-between;align-items:center"},kt={name:"1ykowef",styles:"margin-bottom:0"},Dt={name:"6jwybp",styles:"height:16px"},Ft={name:"dao2zk",styles:"display:contents;& p{margin-bottom:0;}"};const Ot=({assessment:e,onEdit:t,active:n=!1,disableJudgeTypeIcon:o,showRationaleInTooltip:a=!1,showPassFailText:i=!1,hideAssessmentName:r=!1,iconOnly:l=!1,disableTooltip:d=!1,isRootCauseAssessment:c,assessmentInfo:p,type:g,count:v})=>{var f,h;const{theme:y}=(0,E.u)(),b=(0,N.tz)(),w=e?(0,I.Zh)(e):void 0,S=(0,m.useMemo)((()=>Nt(p,w)),[w,p]),x=(0,u.CY)(y,p,e),Y=(0,u.wG)(y,p,e);let M;(null!==e&&void 0!==e&&e.errorMessage||void 0===S&&e&&I.jr[e.name])&&(M=e.errorMessage||b.formatMessage(I.jr[e.name]));const k=e?I.c9[e.name]:void 0,D=(0,m.useMemo)((()=>k?b.formatMessage(k):null===e||void 0===e?void 0:e.name),[e,k,b]),F=(0,m.useMemo)((()=>e?(0,I.FN)(I.pZ[e.name]):void 0),[e]),{makeHTML:O}=_t(),V=(0,m.useMemo)((()=>{const t=null===e||void 0===e?void 0:e.rationale;return(0,s.isString)(t)?O(t):void 0}),[e,O]),L=(0,m.useMemo)((()=>!(0,s.isNil)(e)&&(0,I.w_)(e)),[e]),{tagText:H,icon:U,fullTagText:$}=(0,m.useMemo)((()=>function(e,t,n,o,a,i,r){let l,d="",c=(0,R.Y)(R.FK,{});const m={tagText:(0,R.Y)(N.sA,{id:"AX7L9r",defaultMessage:"Error"}),icon:(0,R.Y)(E.k,{css:(0,A.AH)({color:e.colors.textValidationWarning},"")})},p={tagText:(0,R.Y)("span",{css:Rt,children:(0,R.Y)(N.sA,{id:"H2UIIZ",defaultMessage:"null"})}),icon:(0,R.Y)(E.W,{css:(0,A.AH)({color:e.colors.grey400},"")})},g=i?(0,I.Zh)(i):void 0;if(Boolean(null===i||void 0===i?void 0:i.errorMessage))return m;if("pass-fail"===o.dtype||"boolean"===o.dtype){const a=Nt(o,g);let l="";if("pass-fail"===o.dtype)if(!0===a)l=t.formatMessage({id:"Kya8N3",defaultMessage:"Pass"});else{if(!1!==a)return p;l=t.formatMessage({id:"bz4brG",defaultMessage:"Fail"})}else if(!0===a)l=t.formatMessage({id:"lo5Me/",defaultMessage:"True"});else{if(!1!==a)return p;l=t.formatMessage({id:"OZXWas",defaultMessage:"False"})}const m=(0,u.CY)(e,o,i);if(c=!0===a?(0,R.Y)(C.CheckCircleIcon,{css:(0,A.AH)({color:m},"")}):!1===a?r?(0,R.Y)(T.X,{css:(0,A.AH)({color:m},"")}):(0,R.Y)(C.XCircleIcon,{css:(0,A.AH)({color:m},"")}):(0,R.Y)(E.W,{css:(0,A.AH)({color:m},"")}),"assessment-value"===n){const e=I.yQ[o.name];if(e){var v;const t=g&&null!==(v=e[g.toString()])&&void 0!==v?v:e[I.gZ.YES];t&&(d=(0,R.Y)(N.sA,{...t,values:{value:g}}))}else d=(0,R.FD)(R.FK,{children:[o.displayName,": ",g]})}else"value"===n&&(d=(0,s.isNil)(a)?(0,R.Y)("span",{css:Yt,children:l}):l)}else if("numeric"===o.dtype){const e=(0,s.isNil)(g)?g:wt(g);if("assessment-value"===n)d=(0,R.FD)(R.FK,{children:[o.displayName,": ",e]}),l=(0,R.FD)(R.FK,{children:[o.displayName,": ",g]});else{if((0,s.isNil)(e))return p;d=`${e}`,l=`${g}`}}else{if((0,s.isNil)(g))return p;const e=(0,R.Y)(R.FK,{children:String(g)});d="assessment-value"===n?(0,s.isNil)(g)?(0,R.Y)(R.FK,{children:o.displayName}):(0,R.FD)(R.FK,{children:[o.displayName,": ",e]}):e}return{tagText:d,icon:c,fullTagText:l}}(y,b,g,p,0,e,c)),[y,b,g,p,e,c,L]),z=(0,R.FD)(R.FK,{children:[H,v&&v>1?` (${v})`:""]});if("HUMAN"===(null===(f=p.source)||void 0===f?void 0:f.sourceType)&&!(null!==e&&void 0!==e&&null!==(h=e.source)&&void 0!==h&&h.sourceId))return(0,R.Y)(R.FK,{});const B=(0,R.Y)("div",{children:(0,R.Y)(Vt,{iconOnly:l,hideAssessmentName:r,tagContent:z,active:n,icon:U,iconColor:x,textColor:Y,sourceIcon:p.isCustomMetric?(0,R.Y)(C.BracketsXIcon,{}):e&&L?(0,R.Y)(C.UserIcon,{}):(0,R.Y)(C.SparkleDoubleIcon,{}),backgroundColor:(0,u.x2)(y,p,e),disableSourceTypeIcon:o&&!L,hasBeenEditedByHuman:L,onEdit:t})});return(0,R.Y)(R.FK,{children:d?B:(0,R.Y)(C.HoverCard,{side:"bottom",content:(0,R.FD)("div",{css:(0,A.AH)({maxWidth:"25rem",display:"flex",flexDirection:"column",overflowWrap:"break-word",wordBreak:"break-word",gap:y.spacing.sm},""),children:[(0,R.FD)("div",{css:(0,A.AH)({display:"flex",flexDirection:"column",gap:y.spacing.xs},""),children:[(0,R.FD)("div",{css:Mt,children:[(0,R.FD)("div",{css:(0,A.AH)({display:"flex",gap:y.spacing.sm,alignItems:"center"},""),children:[(0,R.Y)(E.T.Title,{css:kt,children:D}),(0,R.Y)(Vt,{iconOnly:l,hideAssessmentName:r,tagContent:$||z,active:n,icon:U,iconColor:x,textColor:Y,sourceIcon:p.isCustomMetric?(0,R.Y)(C.BracketsXIcon,{}):e&&(0,I.w_)(e)?(0,R.Y)(C.UserIcon,{}):(0,R.Y)(C.SparkleDoubleIcon,{}),backgroundColor:(0,u.x2)(y,p,e),disableSourceTypeIcon:o,hasBeenEditedByHuman:L})]}),F&&(0,R.Y)("a",{href:F,target:"_blank",rel:"noreferrer",css:Dt,children:(0,R.Y)(_.I,{})})]}),c&&(0,R.Y)(E.T.Hint,{children:b.formatMessage({id:"QEL+JO",defaultMessage:"This assessment is the root cause of the overall evaluation failure."})})]}),a&&e&&V&&(0,R.Y)("div",{children:(0,R.Y)(R.FK,{children:(0,R.Y)("span",{css:Ft,dangerouslySetInnerHTML:{__html:V}})})}),M&&(0,R.Y)("div",{css:(0,A.AH)({display:"flex",flexDirection:"column",gap:y.spacing.xs},""),children:(0,R.Y)("span",{css:(0,A.AH)({color:y.colors.textValidationWarning,fontStyle:"italic"},""),children:M})})]}),trigger:B})})},Vt=({iconOnly:e,hideAssessmentName:t,tagContent:n,active:s,sourceIcon:o,icon:a,iconColor:i,textColor:r,backgroundColor:l,disableSourceTypeIcon:d,hasBeenEditedByHuman:c,onEdit:u})=>{const{theme:m}=(0,E.u)(),p=e?18:12;return(0,R.FD)("div",{css:(0,A.AH)({display:"inline-flex",height:e?p:20,width:e?p:t?"fit-content":"",justifyContent:"space-between",alignItems:"center",padding:e?"0":u?"0 0 0 8px":"0 8px",gap:m.spacing.sm,borderRadius:e?"50%":m.legacyBorders.borderRadiusMd,backgroundColor:l,boxShadow:`inset 0 0 1px 1px ${s?m.colors.borderAccessible:"transparent"}`,fontSize:m.typography.fontSizeSm,svg:{width:p,height:p},whiteSpace:"nowrap"},""),children:[a,n&&(0,R.Y)("span",{css:(0,A.AH)({color:r},""),children:n}),!0!==d?(0,R.Y)("span",{css:(0,A.AH)({color:i},""),children:o}):(0,R.Y)(R.FK,{}),u&&(0,R.Y)(E.B,{componentId:"mlflow.evaluations_review.edit_assessment_button",onClick:u,size:"small",icon:(0,R.Y)(C.PencilIcon,{css:(0,A.AH)({":hover":{color:m.colors.actionDefaultTextHover}},"")})})]})};var Lt={name:"1wr4ndu",styles:"width:12px;height:12px;border-radius:6px;flex-shrink:0;border:1px solid rgba(0, 0, 0, 0.1);cursor:default;position:relative"},Ht={name:"mvtt3w",styles:"clip:rect(0px, 0px, 0px, 0px);clip-path:inset(50%);height:1px;overflow:hidden;position:absolute;white-space:nowrap;width:1px"};const Ut=m.memo((({color:e,hidden:t})=>(0,R.Y)("label",{css:Lt,style:{backgroundColor:e,display:t?"none":""},children:(0,R.Y)("span",{css:Ht,children:e})})));function $t(e,t,n){return e?t.formatDate(e,{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit",...n}):""}var zt={name:"6dhm9o",styles:"visibility:hidden"};const Bt=(e,t,n,o,a)=>{var i,r,l,d,c,u,m,p,g,v,f,h,y,b;const w=o.name,S={currentValue:(0,s.first)(null===(i=a.currentRunValue)||void 0===i?void 0:i.responseAssessmentsByName[w]),otherValue:(0,s.first)(null===(r=a.otherRunValue)||void 0===r?void 0:r.responseAssessmentsByName[w])},x=yt(o,(null===(l=a.currentRunValue)||void 0===l?void 0:l.responseAssessmentsByName[w])||[]),E=(null===(d=a.currentRunValue)||void 0===d||null===(c=d.overallAssessments[0])||void 0===c||null===(u=c.rootCauseAssessment)||void 0===u?void 0:u.assessmentName)===w,T=(null===(m=a.otherRunValue)||void 0===m||null===(p=m.overallAssessments[0])||void 0===p||null===(g=p.rootCauseAssessment)||void 0===g?void 0:g.assessmentName)===w,_=S.currentValue?(0,I.Zh)(S.currentValue):void 0,N=S.otherValue?(0,I.Zh)(S.otherValue):void 0,Y=function(e,t,n){if("pass-fail"===e.dtype)return t===n?"equal":t===I.gZ.YES?"greater":t===I.gZ.NO?"less":(0,s.isNil)(n)?"equal":"less";if("boolean"===e.dtype)return t===n?"equal":!0===t?"greater":!1===t?"less":(0,s.isNil)(n)?"equal":"less";if("string"===e.dtype){if(t===n)return"equal";if(null===t)return"less";if(null===n)return"greater";const e=t,o=n;return(0,s.isNil)(e)?"less":(0,s.isNil)(o)||1===e.toString().localeCompare(o.toString())?"greater":"less"}if("numeric"===e.dtype){if(t===n)return"equal";if(null===t)return"less";if(null===n)return"greater";return t>n?"greater":"less"}return"equal"}(o,(0,s.isNil)(_)?void 0:_,(0,s.isNil)(N)?void 0:N),M=N!==_,k=I.jr[w];return(0,R.Y)("div",{css:(0,A.AH)({display:"flex",gap:e.spacing.sm,alignItems:"center",marginTop:"auto",marginBottom:"auto"},""),children:n?(0,R.FD)("div",{css:(0,A.AH)({display:"flex",flexDirection:"column",gap:e.spacing.sm,borderRadius:e.legacyBorders.borderRadiusMd,marginTop:"auto",marginBottom:"auto"},""),children:[(0,R.FD)("div",{css:(0,A.AH)({display:"flex",gap:e.spacing.sm,alignItems:"center"},""),children:[(0,R.Y)(Ot,{showRationaleInTooltip:!0,disableJudgeTypeIcon:!0,hideAssessmentName:!0,assessment:S.currentValue,isRootCauseAssessment:E,assessmentInfo:o,type:"value"},`tag_${null===(v=a.currentRunValue)||void 0===v?void 0:v.evaluationId}_${null===(f=S.currentValue)||void 0===f?void 0:f.name}`),M&&(0,R.Y)(C.ArrowRightIcon,{css:(0,A.AH)({transform:"greater"===Y?"rotate(-45deg)":"rotate(45deg)",color:e.colors.textSecondary},"")})]}),(0,R.FD)("div",{css:(0,A.AH)({display:"flex",gap:e.spacing.sm,alignItems:"center"},""),children:[(0,R.Y)(Ot,{showRationaleInTooltip:!0,disableJudgeTypeIcon:!0,hideAssessmentName:!0,assessment:S.otherValue,isRootCauseAssessment:T,assessmentInfo:o,type:"value"},`tag_${null===(h=a.otherRunValue)||void 0===h?void 0:h.evaluationId}_${null===(y=S.currentValue)||void 0===y?void 0:y.name}`),M&&(0,R.Y)(C.ArrowRightIcon,{css:zt})]})]}):S.currentValue?(0,R.Y)("div",{css:(0,A.AH)({display:"flex",flexDirection:"column",gap:e.spacing.sm},""),children:x.map((e=>{const t=e.latestAssessment,n=e.count;return(0,R.Y)(Ot,{showRationaleInTooltip:!0,disableJudgeTypeIcon:!0,hideAssessmentName:!0,assessment:t,isRootCauseAssessment:E,assessmentInfo:o,type:"value",count:n},`tag_${e.latestAssessment.name}_${e.value}`)}))}):(0,R.Y)(Ot,{showRationaleInTooltip:!0,disableJudgeTypeIcon:!0,hideAssessmentName:!0,isRootCauseAssessment:E,assessmentInfo:o,assessment:{name:w,rationale:k?t.formatMessage(k):t.formatMessage({id:"gOUJ0f",defaultMessage:"No assessment for this evaluation"}),source:{sourceId:"",sourceType:"AI_JUDGE",metadata:{}},stringValue:null,booleanValue:null,rootCauseAssessment:null,numericValue:null,timestamp:null,metadata:{}},type:"value"},`tag_${w}_${null===(b=a.currentRunValue)||void 0===b?void 0:b.evaluationId}`)})};var jt={name:"36bnqj",styles:"display:flex;flex:1"},Pt={name:"36bnqj",styles:"display:flex;flex:1"};var qt={name:"1qkz5jq",styles:"display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis"},Kt={name:"1jwcxx3",styles:"font-style:italic"},Gt={name:"zjik7",styles:"display:flex"},Wt={name:"1suksrg",styles:"width:12px;height:12px"},Qt={name:"zjik7",styles:"display:flex"},Zt={name:"1suksrg",styles:"width:12px;height:12px"};var Jt={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Xt={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},en={name:"1qkz5jq",styles:"display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis"},tn={name:"1qkz5jq",styles:"display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis"},nn={name:"1qkz5jq",styles:"display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis"},sn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},on={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},an={name:"58t467",styles:"width:fit-content;max-width:100%"},rn={name:"hdknak",styles:"display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},ln={name:"58t467",styles:"width:fit-content;max-width:100%"},dn={name:"4fjnre",styles:"display:inline-block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},cn={name:"58t467",styles:"width:fit-content;max-width:100%"},un={name:"4fjnre",styles:"display:inline-block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},mn={name:"58t467",styles:"width:fit-content;max-width:100%"},pn={name:"4fjnre",styles:"display:inline-block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},gn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},vn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},fn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},hn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},yn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},bn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},wn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Sn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},In={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},xn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"};const An=120,En=120;const Cn=e=>{let t=e;try{var n,o;const r=JSON.parse(e).response.choices;var a,i;if(Array.isArray(r)&&!(0,s.isNil)(null===(n=r[0])||void 0===n||null===(o=n.message)||void 0===o?void 0:o.content))t=null===(a=r[0])||void 0===a||null===(i=a.message)||void 0===i?void 0:i.content;else t=(0,I.ng)(e)}catch{t=(0,I.ng)(e)}return t},Tn=(e,{evaluationInputs:t,isComparing:n,theme:o,intl:a,experimentId:i,onChangeEvaluationId:r,onTraceTagsEdit:l})=>{const d={header:e.label,id:e.id,accessorFn:e=>e};switch(e.type){case B.$6.INPUT:return{...d,sortingFn:(t,n)=>{var s,o,a,i,r,l,d,c;const u=t.getValue(e.id),m=n.getValue(e.id),p={request:(null===(s=u.currentRunValue)||void 0===s?void 0:s.inputs[e.id])||(null===(o=u.otherRunValue)||void 0===o?void 0:o.inputs[e.id])||"",evalId:(null===(a=u.currentRunValue)||void 0===a?void 0:a.evaluationId)||(null===(i=u.otherRunValue)||void 0===i?void 0:i.evaluationId)||""},g={request:(null===(r=m.currentRunValue)||void 0===r?void 0:r.inputs[e.id])||(null===(l=m.otherRunValue)||void 0===l?void 0:l.inputs[e.id])||"",evalId:(null===(d=m.currentRunValue)||void 0===d?void 0:d.evaluationId)||(null===(c=m.otherRunValue)||void 0===c?void 0:c.evaluationId)||""};return JSON.stringify(p).localeCompare(JSON.stringify(g))},size:300/t.length,minSize:120,cell:t=>{var s,a,i;return((e,t,n,s,o,a)=>{var i,r,l,d,c,m,p,g;const v=t.getValue(),f=(null===(i=v.currentRunValue)||void 0===i?void 0:i.evaluationId)||(null===(r=v.otherRunValue)||void 0===r?void 0:r.evaluationId),h=null===(l=v.currentRunValue)||void 0===l||null===(d=l.traceInfo)||void 0===d||null===(c=d.trace_metadata)||void 0===c?void 0:c[F.kQ],y=null===(m=v.otherRunValue)||void 0===m||null===(p=m.traceInfo)||void 0===p||null===(g=p.trace_metadata)||void 0===g?void 0:g[F.kQ],b=a&&h?a(h):u.IX,w=a&&y?a(y):u.OV,S=v.currentRunValue?(0,I.Qq)(v.currentRunValue,o):void 0,x=v.otherRunValue?(0,I.Qq)(v.otherRunValue,o):void 0,C=S||x;return(0,R.FD)("div",{css:(0,A.AH)({height:"100%",width:"100%",display:"flex",overflow:"hidden",alignItems:"center",justifyContent:"space-between",gap:s.spacing.sm},""),children:[(0,R.Y)(E.T.Link,{css:qt,componentId:"mlflow.evaluations_review.table_ui.evaluation_id_link",onClick:()=>e(f),children:C||(0,R.Y)("span",{css:Kt,children:"null"})}),n&&(0,R.FD)("div",{css:(0,A.AH)({display:"flex",flexDirection:"column",gap:s.spacing.md},""),children:[(0,R.Y)("div",{css:Gt,children:h?(0,R.Y)(Ut,{color:b}):(0,R.Y)("div",{css:Wt})}),(0,R.Y)("div",{css:Qt,children:y?(0,R.Y)(Ut,{color:w}):(0,R.Y)("div",{css:Zt})})]})]})})(r,t,n,o,e.id,null===t||void 0===t||null===(s=t.table)||void 0===s||null===(a=s.options)||void 0===a||null===(i=a.meta)||void 0===i?void 0:i.getRunColor)}};case B.$6.ASSESSMENT:return{...d,accessorFn:t=>({isComparing:n,assessmentInfo:e.assessmentInfo,comparisonEntry:t}),sortingFn:(t,n)=>{const{comparisonEntry:o}=t.getValue(e.id),{comparisonEntry:a}=n.getValue(e.id);if(e.assessmentInfo){var i,r,l,d,c,u,m,p;const t={currentValue:null===(i=o.currentRunValue)||void 0===i||null===(r=i.responseAssessmentsByName[e.assessmentInfo.name])||void 0===r?void 0:r[0],otherValue:null===(l=o.otherRunValue)||void 0===l||null===(d=l.responseAssessmentsByName[e.assessmentInfo.name])||void 0===d?void 0:d[0]},n={currentValue:null===(c=a.currentRunValue)||void 0===c||null===(u=c.responseAssessmentsByName[e.assessmentInfo.name])||void 0===u?void 0:u[0],otherValue:null===(m=a.otherRunValue)||void 0===m||null===(p=m.responseAssessmentsByName[e.assessmentInfo.name])||void 0===p?void 0:p[0]};return function(e,t,n){const o=t.currentValue?(0,I.Zh)(t.currentValue):void 0,a=n.currentValue?(0,I.Zh)(n.currentValue):void 0,i=t.otherValue?(0,I.Zh)(t.otherValue):void 0,r=n.otherValue?(0,I.Zh)(n.otherValue):void 0;if("pass-fail"===e.dtype){const e=i===I.gZ.YES&&o===I.gZ.NO,s=r===I.gZ.YES&&a===I.gZ.NO,l=i===I.gZ.NO&&o===I.gZ.YES,d=r===I.gZ.NO&&a===I.gZ.YES,c=i===I.gZ.NO&&o===I.gZ.NO,u=r===I.gZ.NO&&a===I.gZ.NO,m=i===I.gZ.YES&&o===I.gZ.YES,p=r===I.gZ.YES&&a===I.gZ.YES;return e&&!s?-1:!e&&s?1:c&&!u?-1:!c&&u?1:l&&!d?-1:!l&&d?1:m&&!p?-1:!m&&p?1:function(e,t){if(!e&&t)return 1;if(e&&!t)return-1;if(!e||!t)return 0;const n=e.stringValue===I.gZ.YES||e.stringValue!==I.gZ.NO&&void 0,s=t.stringValue===I.gZ.YES||t.stringValue!==I.gZ.NO&&void 0;if(n===s)return 0;if(void 0===n)return 1;if(void 0===s)return-1;return n?1:-1}(t.currentValue,n.currentValue)}return o===a?0:(0,s.isNil)(o)||(0,s.isNil)(a)?(0,s.isNil)(o)?-1:1:o>a?1:-1}(e.assessmentInfo,t,n)}return 0},maxSize:200,size:n?En:An,minSize:n?En:An,cell:e=>{const{isComparing:t,assessmentInfo:n,comparisonEntry:s}=e.getValue();return Bt(o,a,t,n,s)}};case B.$6.EXPECTATION:return{...d,accessorFn:t=>({isComparing:n,expectationName:e.expectationName,comparisonEntry:t}),maxSize:200,size:n?En:An,minSize:n?En:An,cell:e=>{const{isComparing:t,expectationName:n,comparisonEntry:s}=e.getValue();return((e,t,n,s,o)=>{var a,i,r,l;const d=null===(a=o.currentRunValue)||void 0===a||null===(i=a.targets)||void 0===i?void 0:i[s],c=null===(r=o.otherRunValue)||void 0===r||null===(l=r.targets)||void 0===l?void 0:l[s],u=d?(0,R.Y)(O.SH,{parsedValue:d,singleLine:!0}):(0,R.Y)(re,{isComparing:n}),m=c?(0,R.Y)(O.SH,{parsedValue:c,singleLine:!0}):(0,R.Y)(re,{isComparing:n});return n?(0,R.FD)("div",{css:(0,A.AH)({display:"flex",flexDirection:"column",gap:e.spacing.sm},""),children:[(0,R.Y)("div",{css:jt,children:u}),(0,R.Y)("div",{css:Pt,children:m})]}):u})(o,0,t,n,s)}};case B.$6.TRACE_INFO:return{...d,accessorFn:e=>({isComparing:n,comparisonEntry:e}),sortingFn:(t,n)=>{var s,o;const{comparisonEntry:a}=t.getValue(e.id),{comparisonEntry:i}=n.getValue(e.id);return((e,t,n)=>{var s,o;if(!z.My.includes(n))return 0;const a=String(null!==(s=J(e,n))&&void 0!==s?s:""),i=String(null!==(o=J(t,n))&&void 0!==o?o:"");return a.localeCompare(i,void 0,{numeric:!0})})(null===a||void 0===a||null===(s=a.currentRunValue)||void 0===s?void 0:s.traceInfo,null===i||void 0===i||null===(o=i.currentRunValue)||void 0===o?void 0:o.traceInfo,e.id)},size:e.id===z.Rl?300:100,minSize:e.id===z.Rl?120:100,cell:t=>{const{isComparing:n,comparisonEntry:d}=t.getValue();return((e,t,n,o,a,i,r,l)=>{var d,c;const u=null===(d=o.currentRunValue)||void 0===d?void 0:d.traceInfo,m=t?null===(c=o.otherRunValue)||void 0===c?void 0:c.traceInfo:void 0;if(n===z.Te){const e=null!==u&&void 0!==u&&u.request_time?new Date(u.request_time):void 0,n=null!==m&&void 0!==m&&m.request_time?new Date(m.request_time):void 0;return(0,R.Y)(le,{first:e?(0,R.Y)(_.T,{componentId:"mlflow.experiment-evaluation-monitoring.trace-info-hover-request-time",content:e.toLocaleString(navigator.language,{timeZoneName:"short"}),children:(0,R.Y)("span",{css:Jt,children:$t(e,i,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})})}):(0,R.Y)(re,{isComparing:t}),second:t&&(n?(0,R.Y)(_.T,{componentId:"mlflow.experiment-evaluation-monitoring.trace-info-hover-other-request-time",content:n.toLocaleString(navigator.language,{timeZoneName:"short"}),children:(0,R.Y)("span",{css:Xt,children:It(n)})}):(0,R.Y)(re,{isComparing:t}))})}if(n===z.$W)return(0,R.Y)(le,{first:(0,R.Y)(Fe,{original:u,isComparing:t}),second:t&&(m?(0,R.Y)(Fe,{original:m,isComparing:t}):(0,R.Y)(re,{isComparing:t}))});if(n===z.FW)return(0,R.Y)(le,{first:u?(0,R.Y)(Me,{traceInfo:u,isComparing:t}):(0,R.Y)(re,{isComparing:t}),second:t&&(m?(0,R.Y)(Me,{traceInfo:m,isComparing:t}):(0,R.Y)(re,{isComparing:t}))});if(n===z.Pn){const e=Object.entries((null===u||void 0===u?void 0:u.tags)||{}).map((([e,t])=>({key:e,value:t}))),n=Object.entries((null===m||void 0===m?void 0:m.tags)||{}).map((([e,t])=>({key:e,value:t}))),s=!m&&u?()=>null===l||void 0===l?void 0:l(u):void 0;return(0,R.Y)(le,{first:(0,R.Y)(Pe,{baseComponentId:"tags-cell-renderer",tags:e,onAddEditTags:s}),second:t&&(m?(0,R.Y)(Pe,{baseComponentId:"tags-cell-renderer-other",tags:n}):(0,R.Y)(re,{isComparing:t}))})}if((0,D.ij)()&&n.startsWith(z.Pn)){var p,g;const e=(0,F.PO)(n);if(!e)return(0,R.Y)(re,{isComparing:t});const s=null===u||void 0===u||null===(p=u.tags)||void 0===p?void 0:p[e],o=null===m||void 0===m||null===(g=m.tags)||void 0===g?void 0:g[e];return(0,R.Y)(le,{first:s?(0,R.Y)("span",{title:s,css:en,children:s}):(0,R.Y)(re,{isComparing:t}),second:t&&(o?(0,R.Y)("span",{title:s,css:tn,children:o}):(0,R.Y)(re,{isComparing:t}))})}if(n===z.LV){var v,f,h,y,b;const e=null===(v=o.currentRunValue)||void 0===v?void 0:v.evaluationId,n=null===u||void 0===u||null===(f=u.tags)||void 0===f?void 0:f["mlflow.traceName"],s=null===m||void 0===m||null===(h=m.tags)||void 0===h?void 0:h["mlflow.traceName"];return(0,R.Y)(le,{first:n?t?(0,R.Y)("div",{children:null===u||void 0===u||null===(b=u.tags)||void 0===b?void 0:b["mlflow.traceName"]}):(0,R.Y)(E.T.Link,{css:nn,componentId:"mlflow.evaluations_review.table_ui.evaluation_id_link",onClick:()=>e&&a(e),children:null===u||void 0===u||null===(y=u.tags)||void 0===y?void 0:y["mlflow.traceName"]}):(0,R.Y)(re,{isComparing:t}),second:t&&(s?(0,R.Y)("div",{children:s}):(0,R.Y)(re,{isComparing:t}))})}if(n===z.li){var w;const t=null===u||void 0===u||null===(w=u.trace_metadata)||void 0===w?void 0:w[F.kQ];return t?(0,R.Y)(Ee,{experimentId:e,runUuid:t}):(0,R.Y)(re,{})}if(n===z.tP){var S,x,T,N;const e=(null===u||void 0===u||null===(S=u.trace_metadata)||void 0===S?void 0:S["mlflow.trace.user"])||(null===u||void 0===u||null===(x=u.tags)||void 0===x?void 0:x["mlflow.user"]),n=(null===m||void 0===m||null===(T=m.trace_metadata)||void 0===T?void 0:T["mlflow.trace.user"])||(null===m||void 0===m||null===(N=m.tags)||void 0===N?void 0:N["mlflow.user"]);return(0,R.Y)(le,{first:e?(0,R.FD)("span",{css:(0,A.AH)({display:"flex",alignItems:"center",gap:r.spacing.xs},""),title:e,children:[(0,R.Y)(C.UserIcon,{css:(0,A.AH)({color:r.colors.textSecondary,fontSize:16},"")}),(0,R.Y)("span",{css:sn,children:e})]}):(0,R.Y)(re,{isComparing:t}),second:t&&(n?(0,R.FD)("span",{css:(0,A.AH)({display:"flex",alignItems:"center",gap:r.spacing.xs},""),title:n,children:[(0,R.Y)(C.UserIcon,{css:(0,A.AH)({color:r.colors.textSecondary,fontSize:16},"")}),(0,R.Y)("span",{css:on,children:n})]}):(0,R.Y)(re,{isComparing:t}))})}if(n===z.XQ){const e=null===u||void 0===u?void 0:u.trace_id,n=null===m||void 0===m?void 0:m.trace_id;return(0,R.Y)(le,{first:e?(0,R.Y)(C.Tag,{css:an,componentId:"mlflow.genai-traces-table.trace-id",color:"indigo",onClick:()=>a(e),children:(0,R.Y)("span",{css:rn,children:e})}):(0,R.Y)(re,{isComparing:t}),second:t&&(n?(0,R.Y)(C.Tag,{css:ln,componentId:"mlflow.genai-traces-table.trace-id",color:"indigo",title:n,onClick:()=>a(n),children:(0,R.Y)("span",{css:dn,children:n})}):(0,R.Y)(re,{isComparing:t}))})}if(n===z.yX){var Y,M;const n=null===u||void 0===u||null===(Y=u.trace_metadata)||void 0===Y?void 0:Y["mlflow.trace.session"],s=null===m||void 0===m||null===(M=m.trace_metadata)||void 0===M?void 0:M["mlflow.trace.session"],o=null===u||void 0===u?void 0:u.trace_id,a=null===m||void 0===m?void 0:m.trace_id;return(0,R.Y)(le,{first:n?(0,R.Y)(_e,{sessionId:n,experimentId:e,traceId:o,children:(0,R.Y)(C.Tag,{css:cn,componentId:"mlflow.genai-traces-table.session",title:n,children:(0,R.Y)("span",{css:un,children:n})})}):(0,R.Y)(re,{isComparing:t}),second:t&&(s?(0,R.Y)(_e,{sessionId:s,experimentId:e,traceId:a,children:(0,R.Y)(C.Tag,{css:mn,componentId:"mlflow.genai-traces-table.session",title:s,children:(0,R.Y)("span",{css:pn,children:s})})}):(0,R.Y)(re,{isComparing:t}))})}if(n===z.Rl){const e=u?Cn((0,F.Mq)(u)):"",n=m?Cn((0,F.Mq)(m)):"";return(0,R.Y)(le,{first:e?(0,R.Y)("div",{css:gn,title:e,children:e}):(0,R.Y)(re,{isComparing:t}),second:t&&(n?(0,R.Y)("div",{css:vn,title:n,children:n}):(0,R.Y)(re,{isComparing:t}))})}if(n===z.im)return(0,R.Y)(ye,{experimentId:e,currentTraceInfo:u,otherTraceInfo:m,isComparing:t});if(n===z.YO)return(0,R.Y)(qe,{currentTraceInfo:u,otherTraceInfo:m,isComparing:t});if(n.startsWith(z.rc)){var k,O;const e=(0,F.v8)(n);if(!e)return(0,R.Y)(re,{isComparing:t});const s=null===u||void 0===u||null===(k=u.trace_metadata)||void 0===k?void 0:k[e],o=null===m||void 0===m||null===(O=m.trace_metadata)||void 0===O?void 0:O[e];return(0,R.Y)(le,{first:s?(0,R.Y)("div",{css:fn,title:s,children:s}):(0,R.Y)(re,{isComparing:t}),second:t&&(o?(0,R.Y)("div",{css:hn,title:o,children:o}):(0,R.Y)(re,{isComparing:t}))})}if(n===z.tj){const e=e=>{var t;if(void 0===e)return;const n=parseFloat(e),o=null===e||void 0===e||null===(t=e.replace)||void 0===t?void 0:t.call(e,/[0-9.]/g,"").trim().toLowerCase();return(0,s.isNil)(n)||isNaN(n)?void 0:[n.toFixed(3).replace(/\.?0+$/,""),o].filter(Boolean).join("")},n=e(null===u||void 0===u?void 0:u[z.tj]),o=e(null===m||void 0===m?void 0:m[z.tj]);return(0,R.Y)(le,{first:(0,s.isNil)(n)?(0,R.Y)(re,{isComparing:t}):(0,R.Y)("div",{css:yn,title:n,children:n}),second:t&&((0,s.isNil)(o)?(0,R.Y)(re,{isComparing:t}):(0,R.Y)("div",{css:bn,title:o,children:o}))})}if(n===z.VC){var V,L;const e=e=>{if(!e)return null;try{const t=JSON.parse(e);if(Array.isArray(t)&&t.length>0)return t.map((e=>`${e.name}/${e.version}`)).join(", ")}catch(t){return e}return null},n=null===u||void 0===u||null===(V=u.tags)||void 0===V?void 0:V["mlflow.linkedPrompts"],s=null===m||void 0===m||null===(L=m.tags)||void 0===L?void 0:L["mlflow.linkedPrompts"],o=e(n),a=e(s);return(0,R.Y)(le,{first:o?(0,R.Y)("div",{css:wn,title:o,children:o}):(0,R.Y)(re,{isComparing:t}),second:t&&(a?(0,R.Y)("div",{css:Sn,title:a,children:a}):(0,R.Y)(re,{isComparing:t}))})}const H=u?(0,I.ng)(J(u,n)):"",U=m?(0,I.ng)(J(m,n)):"";return(0,R.Y)(le,{first:H?(0,R.Y)("div",{css:In,title:H,children:H}):(0,R.Y)(re,{isComparing:t}),second:t&&(U?(0,R.Y)("div",{css:xn,title:U,children:U}):(0,R.Y)(re,{isComparing:t}))})})(i,n,e.id,d,r,a,o,l)}};case B.$6.INTERNAL_MONITOR_REQUEST_TIME:return{...d,accessorFn:e=>{var t;return null===(t=e.currentRunValue)||void 0===t?void 0:t.requestTime},sortingFn:(t,n)=>{const s=t.getValue(e.id),o=n.getValue(e.id);return JSON.stringify(s).localeCompare(JSON.stringify(o))},size:100,minSize:100,cell:e=>{const t=e.getValue();if(!t)return null;const n=new Date(t);return(0,R.Y)(_.T,{componentId:"mlflow.experiment-evaluation-monitoring.trace-info-hover-request-time",content:n.toLocaleString(navigator.language,{timeZoneName:"short"}),children:(0,R.Y)("span",{children:It(n)})})}};default:return d}};var _n=n(43617);const Nn=m.memo((({rows:e,isComparing:t,enableRowSelection:n,virtualItems:s,virtualizerTotalSize:o,virtualizerMeasureElement:a,selectedColumns:i})=>(0,R.Y)("div",{style:{height:`${o}px`,position:"relative",display:"grid"},children:s.map((s=>{const o=e[s.index],r=o.original.currentRunValue&&!t;return(0,R.Y)("div",{"data-index":s.index,ref:e=>a(e),style:{position:"absolute",transform:`translate3d(0, ${s.start}px, 0)`,willChange:"transform",width:"100%"},children:(0,R.Y)(Mn,{row:o,exportableTrace:r,enableRowSelection:n,isSelected:n?o.getIsSelected():void 0,isComparing:t,selectedColumns:i})},s.key)}))}))),Rn=m.memo(Nn);var Yn={name:"1t0jp0z",styles:"display:flex;overflow:hidden;flex-shrink:0"};const Mn=m.memo((({row:e,exportableTrace:t,enableRowSelection:n,isComparing:s,isSelected:o,selectedColumns:a})=>{const i=e.getVisibleCells(),r=(0,N.tz)();return(0,R.Y)(R.FK,{children:(0,R.FD)(C.TableRow,{children:[(0,R.Y)("div",{css:Yn,children:n&&(0,R.Y)(_.T,{componentId:"mlflow.experiment-evaluation-monitoring.evals-logs-table-cell-tooltip",content:s?r.formatMessage({id:"dqfOjO",defaultMessage:"You cannot select rows when comparing runs"}):t?null:r.formatMessage({id:"V0/LoE",defaultMessage:"This trace is not exportable because it either contains an error or the response is not a ChatCompletionResponse."}),children:(0,R.Y)(C.TableRowSelectCell,{componentId:"mlflow.experiment-evaluation-monitoring.evals-logs-table-cell",checked:o&&t,onChange:e.getToggleSelectedHandler(),isDisabled:s||!t})})}),i.map((e=>(0,R.Y)(kn,{cell:e},e.id)))]})})})),kn=m.memo((({cell:e})=>{const{theme:t}=(0,E.u)();return(0,R.Y)(C.TableCell,{style:{flex:`1 1 var(--col-${xt(e.column.id)}-size)`},css:(0,A.AH)({display:"flex",flexDirection:"row",alignItems:"center","> span:first-of-type":{padding:`${t.spacing.xs}px 0px`,width:"100%"}},""),children:(0,_n.Kv)(e.column.columnDef.cell,e.getContext())},e.id)}));const Dn=({overallAssessmentInfo:e,assessmentNameToAggregates:t,allAssessmentFilters:n,toggleAssessmentFilter:s,runUuid:o,compareToRunUuid:a})=>{const i=(0,N.tz)(),{theme:r}=(0,E.u)(),l=(0,m.useMemo)((()=>function(e,t,n,s,o,a,i){var r,l;if(Object.values(t).every((e=>0===e.currentNumRootCause&&0===(e.otherNumRootCause||0))))return[];const d=Object.values(t).filter((e=>e.currentNumRootCause>0||(e.otherNumRootCause||0)>0)).sort(((e,t)=>t.currentNumRootCause-e.currentNumRootCause)),c=Math.max((null===(r=d[0])||void 0===r?void 0:r.currentNumRootCause)||0,(null===(l=d[0])||void 0===l?void 0:l.otherNumRootCause)||0);return d.map((t=>{var r;const l=null===(r=I.yQ[t.assessmentInfo.name])||void 0===r?void 0:r[I.gZ.NO],d=l?e.formatMessage(l):t.assessmentInfo.name,u=t.currentCounts,m=(null===u||void 0===u?void 0:u.get(I.gZ.YES))||0,p=(null===u||void 0===u?void 0:u.get(I.gZ.NO))||0,g=(null===u||void 0===u?void 0:u.get(void 0))||0,v=t.currentNumRootCause,f=m+p+g,h=t.otherCounts;let y;if(void 0!==t.otherCounts){y=((null===h||void 0===h?void 0:h.get(I.gZ.YES))||0)+((null===h||void 0===h?void 0:h.get(I.gZ.NO))||0)+((null===h||void 0===h?void 0:h.get(void 0))||0)}const b=t.otherNumRootCause||0,w=b/(y||1),S=bt(v/f),x=bt(w);return{assessment:t.assessmentInfo.name,title:d,currentInfo:{count:v,fraction:v/c,tooltip:e.formatMessage({id:"a6bpXQ",defaultMessage:'{numRootCause}/{numEvals} ({percentage}%) runs failed due to the {assessment} judge failing for the current run "{currentRun}".'},{numRootCause:v,numEvals:f,percentage:S,assessment:t.assessmentInfo.name,currentRun:a}),toggleFilter:()=>s(t.assessmentInfo.name,"failing_root_cause","current"),isSelected:n.some((e=>"rca"===e.filterType&&"current"===e.run&&e.assessmentName===t.assessmentInfo.name)),percentage:S},otherInfo:o?{count:b,fraction:b/c,tooltip:e.formatMessage({id:"iDqqcA",defaultMessage:'{numRootCause}/{numEvals} ({percentage}%) runs failed due to the {assessment} judge failing for run "{otherRunDisplayName}".'},{numRootCause:b,numEvals:y,percentage:x,assessment:t.assessmentInfo.name,otherRunDisplayName:i}),toggleFilter:()=>s(t.assessmentInfo.name,"rca","other"),isSelected:n.some((e=>"rca"===e.filterType&&"other"===e.run&&e.assessmentName===t.assessmentInfo.name)),percentage:x}:void 0,icon:(0,R.Y)(T.X,{})}}))}(i,t,n,s,Boolean(a),o,a)),[i,t,n,s,a,o]);return 0===l.length?(0,R.Y)(R.FK,{}):(0,R.FD)("div",{css:(0,A.AH)({display:"flex",flexDirection:"column",gap:r.spacing.sm},""),children:[(0,R.Y)("div",{css:(0,A.AH)({fontWeight:r.typography.typographyBoldFontWeight},""),children:i.formatMessage({id:"etvfuH",defaultMessage:"Root Cause Analysis"})}),(0,R.Y)("div",{css:(0,A.AH)({display:"flex",flexDirection:"column",gap:r.spacing.sm},""),children:(0,R.Y)(On,{overallAssessmentInfo:e,rcaData:l,run:"current",runColor:a?u.IX:void 0})}),a&&(0,R.Y)("div",{css:(0,A.AH)({display:"flex",flexDirection:"column",gap:r.spacing.xs},""),children:(0,R.Y)(On,{overallAssessmentInfo:e,rcaData:l,run:"other",runColor:u.OV})})]})};var Fn={name:"zjik7",styles:"display:flex"};const On=({rcaData:e,run:t,runColor:n,overallAssessmentInfo:s})=>{const{theme:o}=(0,E.u)();return(0,R.FD)("div",{css:(0,A.AH)({display:"flex",flexDirection:"row",gap:o.spacing.sm,alignItems:"center"},""),children:[n&&(0,R.Y)("div",{css:Fn,children:(0,R.Y)(Ut,{color:n})}),(0,R.Y)("div",{css:(0,A.AH)({display:"flex",flexWrap:"wrap",gap:o.spacing.xs},""),children:e.map(((e,n)=>{const a="current"===t?e.currentInfo:e.otherInfo;if(!a)return(0,R.Y)(R.FK,{});const i=(0,u.x2)(o,s,{stringValue:"no"});return(0,R.Y)(_.T,{content:a.tooltip,componentId:"mlflow.evaluations_review.rca_pill",children:(0,R.Y)(R.FK,{children:(0,R.FD)("div",{style:{border:a.isSelected?`1px solid ${o.colors.grey400}`:""},css:(0,A.AH)({color:o.colors.textSecondary,borderRadius:o.general.borderRadiusBase,padding:`0 ${o.spacing.xs}px`,height:"20px",display:"flex",backgroundColor:a.isSelected?(0,I.fu)(i,1):(0,I.fu)(i,.5),gap:o.spacing.xs,fontSize:o.typography.fontSizeSm},""),children:[a.count,(0,R.Y)("div",{children:e.title.toLocaleLowerCase()})]},n)})},n)}))})]})};var Vn={name:"dao2zk",styles:"display:contents;& p{margin-bottom:0;}"};const Ln=({assessmentInfo:e,assessmentNameToAggregates:t,allAssessmentFilters:n,toggleAssessmentFilter:s,runUuid:a,compareToRunUuid:i})=>{var r,l;const{theme:d}=(0,E.u)(),c=(0,N.tz)();return(0,R.Y)(R.FK,{children:(0,R.FD)("div",{css:(0,A.AH)({maxWidth:"25rem",display:"flex",flexDirection:"column",overflowWrap:"break-word",wordBreak:"break-word",gap:d.spacing.sm},""),children:[(0,R.Y)("div",{css:(0,A.AH)({display:"flex",flexDirection:"column",gap:d.spacing.xs},""),children:(0,R.FD)("div",{css:(0,A.AH)({display:"flex",flexDirection:"column",gap:d.spacing.xs,paddingBottom:d.spacing.sm,borderBottom:`1px solid ${d.colors.border}`},""),children:[(0,R.FD)("div",{css:(0,A.AH)({display:"flex",gap:d.spacing.xs,alignItems:"center"},""),children:["numeric"===e.dtype?(0,R.Y)(C.NumbersIcon,{}):"boolean"===e.dtype?(0,R.Y)(C.BinaryIcon,{}):(0,R.Y)(R.FK,{}),(0,R.Y)(E.T.Title,{level:4,css:(0,A.AH)({marginBottom:0,marginRight:d.spacing.xs},""),children:e.displayName}),"AI_JUDGE"===(null===(r=e.source)||void 0===r?void 0:r.sourceType)&&(0,R.Y)(C.Tag,{color:"turquoise",componentId:"mlflow.experiment.evaluations.ai-judge-tag",children:(0,R.FD)("div",{css:(0,A.AH)({display:"flex",gap:d.spacing.xs},""),children:[(0,R.Y)(C.SparkleDoubleIcon,{css:(0,A.AH)({color:d.colors.textSecondary},"")}),(0,R.Y)(E.T.Hint,{children:c.formatMessage({id:"ov1whU",defaultMessage:"AI Judge"})})]})}),"HUMAN"===(null===(l=e.source)||void 0===l?void 0:l.sourceType)&&(0,R.Y)(C.Tag,{color:"coral",componentId:"mlflow.experiment.evaluations.human-judge-tag",children:(0,R.FD)("div",{css:(0,A.AH)({display:"flex",gap:d.spacing.xs},""),children:[(0,R.Y)(C.UserIcon,{}),(0,R.Y)(E.T.Hint,{children:c.formatMessage({id:"BdV0qk",defaultMessage:"Human judge"})})]})}),e.isCustomMetric&&(0,R.Y)(C.Tag,{color:"indigo",componentId:"mlflow.experiment.evaluations.ai-judge-tag",children:(0,R.FD)("div",{css:(0,A.AH)({display:"flex",gap:d.spacing.xs},""),children:[(0,R.Y)(E.T.Hint,{children:(0,R.Y)(C.BracketsXIcon,{})}),(0,R.Y)(E.T.Hint,{children:e.metricName})]})})]}),(0,R.Y)("div",{children:(0,R.Y)(E.T.Hint,{children:e.name})})]})}),(0,R.Y)("div",{children:(0,R.Y)("span",{css:Vn,children:e.description})}),e.name===o._1.OVERALL_ASSESSMENT&&a?(0,R.Y)("div",{children:(0,R.Y)(Dn,{overallAssessmentInfo:e,assessmentNameToAggregates:t,allAssessmentFilters:n,toggleAssessmentFilter:s,runUuid:a,compareToRunUuid:i})}):(0,R.Y)(R.FK,{})]})})};var Hn={name:"1yqwqbb",styles:"max-height:200px;overflow-y:auto;width:200px;min-width:200px"};const Un=m.memo((({theme:e,intl:t,assessmentInfo:n,assessmentAggregates:s,allAssessmentFilters:o,toggleAssessmentFilter:a,currentRunDisplayName:i,compareToRunDisplayName:r})=>{const l=(0,m.useMemo)((()=>function(e,t,n,s,o,a,i,r){const l=void 0!==a.otherCounts,d=[];for(const c of ft(n)){const m=a.currentCounts?vt(e,n,s,c,a.currentCounts,i||F.kf,o):void 0,p=l&&r?vt(e,n,s,c,a.otherCounts||new Map,r,o):void 0,g=c===st||void 0===c,v=l&&m&&p?g?m.value-((null===p||void 0===p?void 0:p.value)||0):m.fraction-((null===p||void 0===p?void 0:p.fraction)||0):void 0;m&&(!g||0!==m.value||v&&0!==v)&&d.push({name:ht(e,0,n,c),current:m,other:p,backgroundColor:(0,u.QO)(t,n,c,c===st),scoreChange:v})}return d}(t,e,n,o,a,s,i,r)),[t,e,n,o,a,s,i,r]),d=(0,m.useMemo)((()=>"pass-fail"===n.dtype||"boolean"===n.dtype?l:l.map(((e,t)=>({...e,originalIndex:t}))).sort(((e,t)=>{const n="null"===e.name||e.name===st,s="null"===t.name||t.name===st;if(n&&!s)return 1;if(s&&!n)return-1;if(!n&&!s){var o,a;const n=((null===(o=t.current)||void 0===o?void 0:o.value)||0)-((null===(a=e.current)||void 0===a?void 0:a.value)||0);if(0!==n)return n}return e.originalIndex-t.originalIndex}))),[l,n]),c=d.length>4?d.slice(0,3):d,p=d.length>4?d.slice(3):[],g=p.length>0,v=e.colors.actionDefaultBackgroundHover,f=e.colors.actionDefaultBackgroundPress;return(0,R.Y)("table",{children:(0,R.FD)("tbody",{children:[c.map((t=>(0,R.Y)(Bn,{barData:t,theme:e,hoverBarColor:v,selectedBarColor:f,assessmentInfo:n},t.name))),g&&(0,R.Y)("tr",{children:(0,R.Y)("td",{colSpan:2,children:(0,R.FD)(E.aw.Root,{componentId:"categorical-aggregate-chart-more-items",children:[(0,R.Y)(E.aw.Trigger,{asChild:!0,children:(0,R.Y)("div",{css:(0,A.AH)({cursor:"pointer",padding:`${e.spacing.xs}px`,color:e.colors.actionLinkDefault,fontSize:e.typography.fontSizeSm,fontWeight:"normal",":hover":{backgroundColor:v},borderRadius:e.general.borderRadiusBase},""),children:t.formatMessage({id:"WELl8J",defaultMessage:"+{count} more"},{count:p.length})})}),(0,R.Y)(E.aw.Content,{align:"start",side:"bottom",css:Hn,children:(0,R.Y)("table",{children:(0,R.Y)("tbody",{children:p.map((t=>(0,R.Y)(Bn,{barData:t,theme:e,hoverBarColor:v,selectedBarColor:f,assessmentInfo:n},t.name)))})})})]})})})]})})}));var $n={name:"5m5bfc",styles:"display:flex;flex-direction:column;gap:2px;width:100%"},zn={name:"12n4oo4",styles:"flex:1;width:100%;position:relative"};const Bn=({barData:e,theme:t,hoverBarColor:n,selectedBarColor:o,assessmentInfo:a})=>{const i=e.name===st,r="null"===e.name;return i||r?(0,R.FD)("tr",{css:(0,A.AH)({cursor:"pointer",":hover":{backgroundColor:n},color:i?t.colors.textValidationWarning:t.colors.textSecondary,fontWeight:"normal",fontSize:t.typography.fontSizeSm},""),onClick:e.current.toggleFilter,children:[(0,R.Y)("td",{css:(0,A.AH)({width:"100%",borderTopLeftRadius:t.general.borderRadiusBase,borderBottomLeftRadius:t.general.borderRadiusBase,backgroundColor:`${e.current.isSelected?o:""}`,paddingLeft:t.spacing.xs,paddingTop:t.spacing.xs,paddingBottom:t.spacing.xs,fontStyle:e.name===st?"normal":"italic"},""),children:(0,R.Y)("span",{css:(0,A.AH)({lineHeight:`${t.typography.fontSizeSm}px`},""),children:e.name})}),(0,R.Y)("td",{css:(0,A.AH)({textAlign:"right",verticalAlign:"center",borderTopRightRadius:t.general.borderRadiusBase,borderBottomRightRadius:t.general.borderRadiusBase,backgroundColor:`${e.current.isSelected?o:""}`,paddingRight:t.spacing.xs,paddingTop:t.spacing.xs,paddingBottom:t.spacing.xs,fontStyle:"normal"},""),children:(0,R.Y)("span",{css:(0,A.AH)({display:"inline-block",verticalAlign:"center",lineHeight:`${t.typography.fontSizeSm}px`},""),children:(0,s.isNil)(e.scoreChange)?e.current.value:St(a,e.scoreChange,!1)})})]},e.name):(0,R.FD)("tr",{css:(0,A.AH)({cursor:"pointer",":hover":{backgroundColor:n}},""),onClick:e.current.toggleFilter,children:[(0,R.Y)("td",{css:(0,A.AH)({width:"100%",borderTopLeftRadius:t.general.borderRadiusBase,borderBottomLeftRadius:t.general.borderRadiusBase,backgroundColor:`${e.current.isSelected?o:""}`,paddingLeft:t.spacing.xs,paddingTop:t.spacing.xs,paddingBottom:t.spacing.xs},""),children:(0,R.FD)("div",{css:$n,children:[(0,R.Y)("span",{css:(0,A.AH)({fontWeight:"normal",fontSize:"10px",lineHeight:"10px",color:t.colors.textSecondary},""),children:e.name}),(0,R.Y)("div",{css:zn,children:(0,R.Y)("div",{style:{width:e.current.value>0?100*e.current.fraction+"%":"2px",borderRadius:"2px"},css:(0,A.AH)({position:"relative",flexShrink:1,transition:"width 0.3s",backgroundColor:e.backgroundColor,height:"10px",display:"flex",alignItems:"center"},"")})})]})}),(0,R.Y)("td",{css:(0,A.AH)({textAlign:"right",verticalAlign:"bottom",borderTopRightRadius:t.general.borderRadiusBase,borderBottomRightRadius:t.general.borderRadiusBase,backgroundColor:`${e.current.isSelected?o:""}`,paddingRight:t.spacing.xs,paddingTop:t.spacing.xs,paddingBottom:t.spacing.xs},""),children:(0,R.Y)("span",{css:(0,A.AH)({color:t.colors.textSecondary,fontWeight:"normal",fontSize:t.typography.fontSizeSm,display:"inline-block",verticalAlign:"bottom",lineHeight:`${t.typography.fontSizeSm}px`},""),children:(0,s.isNil)(e.scoreChange)?(l=e.current.fraction,bt(l,0)+"%"):St(a,e.scoreChange)})})]},e.name);var l};var jn={name:"1fttcpj",styles:"display:flex;flex-direction:column"},Pn={name:"1a4tfjy",styles:"display:flex;justify-content:center;flex-direction:row"},qn={name:"1fttcpj",styles:"display:flex;flex-direction:column"},Kn={name:"ho1qnd",styles:"display:flex;flex-direction:row"},Gn={name:"18ubt2d",styles:"width:25%"},Wn={name:"ho1qnd",styles:"display:flex;flex-direction:row"},Qn={name:"18ubt2d",styles:"width:25%"};const Zn=m.memo((({numericAggregate:e})=>{const{theme:t}=(0,E.u)(),n=(0,N.tz)();return(0,R.FD)("div",{css:jn,children:[(0,R.Y)("div",{css:Pn,children:e.counts.map(((s,o)=>(0,R.Y)(C.HoverCard,{content:(0,R.FD)("div",{css:qn,children:[(0,R.FD)("div",{css:Kn,children:[(0,R.Y)("div",{css:Gn,children:(0,R.Y)(E.T.Text,{children:n.formatMessage({id:"kAVQ2/",defaultMessage:"Range"})})}),(0,R.Y)("div",{children:(0,R.Y)(E.T.Text,{color:"secondary",children:wt(s.lower,2)===wt(s.upper,2)?wt(s.lower,2):`${wt(s.lower,2)} - ${wt(s.upper,2)}`})})]}),(0,R.FD)("div",{css:Wn,children:[(0,R.Y)("div",{css:Qn,children:(0,R.Y)(E.T.Text,{children:n.formatMessage({id:"ClYb2e",defaultMessage:"Count"})})}),(0,R.Y)("div",{children:(0,R.Y)(E.T.Text,{color:"secondary",children:s.count})})]})]}),trigger:(0,R.Y)("div",{css:(0,A.AH)({display:"flex",flex:1,flexDirection:"column-reverse",height:"60px",width:"10px",":hover":{backgroundColor:t.colors.actionDefaultBackgroundHover}},""),children:(0,R.Y)("div",{css:(0,A.AH)({height:s.count/e.maxCount*100+"%",minHeight:"1px",width:"80%",verticalAlign:"bottom",backgroundColor:t.colors.blue400,borderTopRightRadius:t.general.borderRadiusBase,borderTopLeftRadius:t.general.borderRadiusBase},"")})},"bar-"+o)},"hover-card-"+o)))}),e.min===e.max?(0,R.Y)("div",{css:(0,A.AH)({display:"flex",justifyContent:"center",flexDirection:"row",fontWeight:"normal",fontSize:t.typography.fontSizeSm,color:t.colors.textSecondary},""),children:wt(e.min,2)}):(0,R.FD)("div",{css:(0,A.AH)({display:"flex",justifyContent:"space-between",flexDirection:"row",fontWeight:"normal",fontSize:t.typography.fontSizeSm,color:t.colors.textSecondary},""),children:[(0,R.Y)("div",{children:wt(e.min,2)}),(0,R.Y)("div",{children:wt(e.max,2)})]})]})})),Jn=m.memo((({theme:e,intl:t,assessmentInfo:n,assessmentAggregates:o,allAssessmentFilters:a,toggleAssessmentFilter:i,currentRunDisplayName:r,compareToRunDisplayName:l,collapsedHeader:d})=>{const c=(0,m.useMemo)((()=>"pass-fail"===n.dtype?t.formatMessage({id:"Yd5ANL",defaultMessage:"PASS"}):"boolean"===n.dtype?t.formatMessage({id:"icBP3T",defaultMessage:"TRUE"}):"string"===n.dtype?t.formatMessage({id:"Jdr//R",defaultMessage:"STRING"}):"numeric"===n.dtype?t.formatMessage({id:"wDFPtr",defaultMessage:"AVG"}):void 0),[n,t]),{displayScore:p,displayScoreChange:g,changeDirection:v}=(0,m.useMemo)((()=>function(e,t,n){if("numeric"===t.dtype){const e=n.currentNumericValues,t=n.otherNumericValues;let s=NaN,o=NaN;e&&(s=e.reduce(((e,t)=>e+t),0)/e.length),t&&(o=t.reduce(((e,t)=>e+t),0)/t.length);const a=t?s-o:void 0,i=a?a>0?"up":"down":"none";return{displayScore:wt(s,2),displayScoreChange:a?"up"===i?`+${wt(Math.abs(a),2)}`:"down"===i?`-${wt(Math.abs(a),2)}`:"+0":void 0,changeDirection:i,aggregateType:"average"}}if("pass-fail"===t.dtype||"boolean"===t.dtype){const e=0,s=gt(t,n.currentCounts),o=bt(s,e)+"%",a=n.otherCounts?s-gt(t,n.otherCounts):void 0,i=a?a>0?"up":"down":"none";return{displayScore:o,displayScoreChange:a?("up"===i||"none"===i?"+":"")+bt(a,e)+"%":void 0,changeDirection:i,aggregateType:"percentage-true"}}if("string"===t.dtype){const n=t.uniqueValues.size;return{displayScore:1!==n?e.formatMessage({id:"+dbgRR",defaultMessage:"{numUniqueValues} values"},{numUniqueValues:n}):e.formatMessage({id:"lKyc9r",defaultMessage:"1 value"}),displayScoreChange:"",changeDirection:"none",aggregateType:"categorical"}}return{displayScore:"N/A",displayScoreChange:"N/A",changeDirection:"none",aggregateType:"categorical"}}(t,n,o)),[t,n,o]);return"unknown"===n.dtype?null:(0,R.FD)("div",{css:(0,A.AH)({display:"flex",flexDirection:"column",gap:e.spacing.sm},""),children:[(0,R.FD)("div",{css:(0,A.AH)({display:"flex",flexDirection:"column",paddingTop:e.spacing.xs},""),children:[(0,R.Y)("div",{css:(0,A.AH)({fontWeight:400,fontSize:"10px",color:e.colors.textPlaceholder},""),children:c}),(0,R.FD)("div",{css:(0,A.AH)({display:"flex",gap:e.spacing.xs},""),children:[(0,R.Y)("div",{css:(0,A.AH)({fontSize:e.typography.fontSizeLg,color:e.colors.textPrimary,fontWeight:e.typography.typographyBoldFontWeight},""),children:p}),!(0,s.isNil)(g)&&l&&(0,R.Y)("div",{css:(0,A.AH)({display:"flex",alignItems:"center",height:"20px",gap:e.spacing.xs,padding:`2px ${e.spacing.xs}px`,fontSize:e.typography.fontSizeMd,fontWeight:"normal",borderRadius:e.general.borderRadiusBase,color:u.G8,backgroundColor:"none"===v?"":"up"===v?u.YH.up:"down"===v?u.YH.down:(0,I.fu)(e.colors.textSecondary,.1)},""),children:g})]})]}),!d&&((0,s.isNil)(o.currentNumericAggregate)?(0,R.Y)(Un,{theme:e,intl:t,assessmentInfo:n,assessmentAggregates:o,allAssessmentFilters:a,toggleAssessmentFilter:i,currentRunDisplayName:r,compareToRunDisplayName:l}):(0,R.Y)(Zn,{numericAggregate:o.currentNumericAggregate}))]})}));var Xn={name:"10sid5d",styles:"display:inline-block;overflow:hidden;text-overflow:ellipsis;word-break:normal;overflow-wrap:normal"},es={name:"190se29",styles:"padding-top:0px !important;position:absolute;left:0;right:0;bottom:0;z-index:101;padding:0;pointer-events:none"},ts={name:"14n7h35",styles:"position:absolute;left:50%;top:100%;transform:translate(-50%, -50%);z-index:102;display:flex;align-items:center;justify-content:center;width:22px;height:22px;pointer-events:auto;cursor:pointer"};const ns=m.memo((({enableRowSelection:e,enableGrouping:t,selectedAssessmentInfos:n,assessmentNameToAggregates:o,assessmentFilters:a,toggleAssessmentFilter:i,runDisplayName:r,compareToRunUuid:l,compareToRunDisplayName:d,disableAssessmentTooltips:c,collapsedHeader:u,setCollapsedHeader:p,isComparing:g,headerGroups:v,allRowSelected:f,someRowSelected:h,toggleAllRowsSelectedHandler:y,setColumnSizing:b})=>{const{theme:w}=(0,E.u)(),S=(0,N.tz)(),[I,x]=(0,m.useState)(!1),T=t?{position:"relative","&::before":{content:'""',position:"absolute",top:"32px",left:0,right:0,borderTop:`1px solid ${w.colors.border}`}}:{};return(0,R.Y)(R.FK,{children:v.map(((m,E)=>(0,R.FD)(C.TableRow,{isHeader:!0,css:(0,A.AH)({position:"sticky",top:40*E,zIndex:100,...t&&{"& > *":{borderBottom:0===E?"none":void 0}},...E===v.length-1&&{borderBottom:`1px solid ${I?w.colors.blue500:w.colors.border}`,transition:"border-color 0.2s","& > *":{borderBottom:"none"}}},""),children:[e&&(0,R.Y)("div",{css:0===n.length&&1===E?{}:T,children:(0,R.Y)(C.TableRowSelectCell,{componentId:"mlflow.experiment-evaluation-monitoring.evals-logs-table-header-select-cell",checked:f,indeterminate:h,onChange:y(),checkboxLabel:S.formatMessage({id:"bO1IlR",defaultMessage:"Select all"}),noCheckbox:0===E,isDisabled:g})}),m.headers.map((e=>{if(e.isPlaceholder)return null;const m=n.find((t=>(0,z.A5)(t.name)===e.id)),p=e.isPlaceholder?null:(0,R.Y)("div",{css:Xn,title:String((0,_n.Kv)(e.column.columnDef.header,e.getContext())),children:(0,_n.Kv)(e.column.columnDef.header,e.getContext())}),g=m&&!c?(0,R.Y)(C.HoverCard,{content:(0,R.Y)(R.FK,{children:(0,R.Y)(Ln,{assessmentInfo:m,assessmentNameToAggregates:o,allAssessmentFilters:a,toggleAssessmentFilter:i,runUuid:r,compareToRunUuid:l?d:void 0})}),trigger:p},e.id):(0,s.isNil)(p)?null:p;return(0,R.Y)(C.TableHeader,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_evaluationsoverview.tsx_576",css:(0,A.AH)({"> span:first-of-type":{width:"100%",height:"100%",marginTop:"auto",marginBottom:"auto"},...0===n.length&&1===E?{}:T},""),style:{flex:`${e.colSpan} 1 var(--header-${xt(null===e||void 0===e?void 0:e.column.id)}-size)`},header:e,column:e.column,setColumnSizing:b,children:(0,R.FD)("div",{css:(0,A.AH)({display:"flex",flexDirection:"column",gap:w.spacing.xs},""),children:[g,(0,R.Y)("div",{css:(0,A.AH)({borderTop:!t&&n.length>0?`1px solid ${w.colors.border}`:"",width:"100%"},""),children:m&&(0,R.Y)(Jn,{theme:w,intl:S,assessmentInfo:m,assessmentAggregates:o[m.name],allAssessmentFilters:a,toggleAssessmentFilter:i,currentRunDisplayName:r,compareToRunDisplayName:l?d:void 0,collapsedHeader:u})})]})},e.column.id)})),E===v.length-1&&(0,R.FD)("div",{css:es,children:[(0,R.Y)("div",{css:(0,A.AH)({position:"absolute",left:"50%",top:"100%",width:"24px",height:"12px",background:w.colors.backgroundPrimary,transform:"translate(-50%, -50%)",zIndex:101},"")}),(0,R.Y)("div",{css:ts,onClick:()=>p(!u),onMouseEnter:()=>x(!0),onMouseLeave:()=>x(!1),children:(0,R.Y)("div",{css:(0,A.AH)({width:"22px",height:"22px",borderRadius:"50%",background:w.colors.backgroundPrimary,border:`2px solid ${w.colors.border}`,boxShadow:"0 2px 8px 0 rgba(0,0,0,0.10)",display:"flex",alignItems:"center",justifyContent:"center",transition:"border-color 0.2s, box-shadow 0.2s",":hover":{borderColor:w.colors.blue500,boxShadow:"0 2px 12px 0 rgba(0,0,0,0.18)"},opacity:I?1:.5},""),children:(0,R.Y)(C.ChevronDownIcon,{css:(0,A.AH)({transform:u?"none":"rotate(180deg)",transition:"transform 0.2s, opacity 0.2s",color:w.colors.textSecondary},"")})})})]})]},m.id)))})})),ss=e=>{const{theme:t}=(0,E.u)(),n=(0,N.tz)(),{groupId:s,visibleCount:o,totalCount:a,enableGrouping:i}=e.column.columnDef.meta;if(!i)return B.RF[s];const r=B.RF[s];return(0,R.FD)("div",{css:(0,A.AH)({height:"100%",width:"100%",display:"flex",overflow:"hidden",gap:t.spacing.sm},""),children:[(0,R.Y)("div",{children:r}),s===B.w8.INFO?null:o===a?(0,R.FD)("div",{css:(0,A.AH)({color:t.colors.textSecondary,fontWeight:"normal"},""),children:["(",o,"/",a,")"]}):(0,R.Y)(C.HoverCard,{trigger:(0,R.FD)("div",{css:(0,A.AH)({color:t.colors.textSecondary,":hover":{textDecoration:"underline"},fontWeight:"normal"},""),children:["(",o,"/",a,")"]}),content:n.formatMessage({id:"pDCDkJ",defaultMessage:"Showing {visibleCount} out of {totalCount} {groupName}. Select columns to view more."},{visibleCount:o,totalCount:a,groupName:r}),align:"start"})]})};var os={name:"49aokf",styles:"display:contents"};const as=({history:e,alwaysExpanded:t=!1})=>{const{theme:n}=(0,E.u)(),o=(0,N.tz)(),[a,i]=(0,m.useState)(new Date);(0,m.useEffect)((()=>{const e=setInterval((()=>{i(new Date)}),5e3);return()=>{clearInterval(e)}}),[]);const r=(0,m.useMemo)((()=>e.reduce(((t,n,s)=>{const o=e[s+1];return o?[...t,[n,o]]:t}),[])),[e]),{makeHTML:l}=_t(),d=(0,m.useMemo)((()=>{var t;const n=null===(t=(0,s.first)(e))||void 0===t?void 0:t.rationale;return(0,s.isString)(n)?l(n):null}),[e,l]);var c,u,p;if(!r.length)return null!==(c=(0,s.first)(e))&&void 0!==c&&c.rationale?(0,R.Y)("div",{css:(0,A.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm},""),children:(0,R.Y)("span",{css:os,dangerouslySetInnerHTML:{__html:null!==d&&void 0!==d?d:""}})}):null!==(u=(0,s.first)(e))&&void 0!==u&&u.errorMessage?(0,R.Y)(R.FK,{children:(0,R.Y)(E.T.Text,{color:"error",children:null===(p=(0,s.first)(e))||void 0===p?void 0:p.errorMessage})}):(0,R.Y)(R.FK,{children:!t&&(0,R.FD)("div",{children:[(0,R.Y)(_.S,{size:"sm"}),(0,R.Y)(E.T.Hint,{children:(0,R.Y)(N.sA,{id:"Jj2kRy",defaultMessage:"No details for assessment"})})]})});const g=e=>{const t=(0,I.Zh)(e),n=I.yQ[e.name];if(n&&!(0,s.isNil)(t)){var o;const e=null!==(o=n[t.toString()])&&void 0!==o?o:n.default;if(e)return(0,R.Y)(N.sA,{...e,values:{value:t}})}return t};return(0,R.FD)(R.FK,{children:[(0,R.Y)(_.S,{size:"sm"}),r.map((([e,s],i)=>{var r,l;const d=g(s),c=g(e),u=d===c,m=(0,I.CH)(e)?o.formatMessage({id:"rmAWZX",defaultMessage:"just now"}):It(e.timestamp,a);return(0,R.FD)("div",{css:(0,A.AH)({marginBottom:t?void 0:n.spacing.md},""),children:[(0,R.FD)(E.T.Hint,{css:(0,A.AH)({marginBottom:n.spacing.xs},""),children:[d&&c&&(0,R.FD)(R.FK,{children:[(0,R.Y)("code",{children:g(s)})," \u2192 ",(0,R.Y)("code",{children:g(e)})," "]}),u?(0,R.Y)(N.sA,{id:"2/B9Zg",defaultMessage:"added {when} by {user}",values:{when:m,user:null===(r=e.source)||void 0===r?void 0:r.sourceId}}):(0,R.Y)(N.sA,{id:"4TDvGX",defaultMessage:"edited {when} by {user}",values:{when:m,user:null===(l=e.source)||void 0===l?void 0:l.sourceId}})]}),e.rationale&&(0,R.Y)(E.T.Text,{children:e.rationale})]},`${e.timestamp}-${i}`)}))]})},is=({assessmentHistory:e,children:t,disable:n=!1})=>{const o=(0,N.tz)(),a=(0,m.useMemo)((()=>e.some(I.hG)),[e]),[i,r]=(0,m.useState)(new Date);(0,m.useEffect)((()=>{const e=setInterval((()=>{r(new Date)}),5e3);return()=>{clearInterval(e)}}),[]);return(0,R.Y)(_.T,{componentId:"web-shared.genai-traces-table.evaluations-review-assessment.tooltip",content:n?void 0:(0,R.Y)("span",{children:(()=>{const t=(0,s.first)(e);if(!t)return;if((0,I.w_)(t)){var n,r;const s=e[1],a=s?null===(n=(0,I.Zh)(s))||void 0===n?void 0:n.toString():void 0,c=(0,I.CH)(t)?o.formatMessage({id:"rmAWZX",defaultMessage:"just now"}):It(t.timestamp,i);if(a){var l,d;const e=null===(l=I.yQ[t.name])||void 0===l?void 0:l[a],n=e?o.formatMessage(e):a;return(0,R.Y)(N.sA,{id:"kHN/4I",defaultMessage:"Edited {timeSince} by {source}. Original value: {value}",values:{timeSince:c,source:null===t||void 0===t||null===(d=t.source)||void 0===d?void 0:d.sourceId,value:n}})}return(0,R.Y)(N.sA,{id:"m8ztHR",defaultMessage:"Edited {timeSince} by {source}.",values:{timeSince:c,source:null===t||void 0===t||null===(r=t.source)||void 0===r?void 0:r.sourceId}})}return a?(0,R.Y)(N.sA,{id:"4uE8hl",defaultMessage:"Overall assessment added by LLM-as-a-judge"}):null!==t&&void 0!==t&&t.errorMessage?null===t||void 0===t?void 0:t.errorMessage:(0,R.Y)(N.sA,{id:"gn1eO9",defaultMessage:"Assessment added by LLM-as-a-judge"})})()}),side:"top",children:t})},rs=({editedAssessment:e,valueSuggestions:t,onSave:n,onCancel:s,readOnly:o=!1})=>{var a;const{theme:i}=(0,E.u)(),r=(0,N.tz)(),[l,d]=(0,m.useState)((()=>(null===e||void 0===e?void 0:e.rationale)||void 0)),[c,u]=(0,m.useState)(""),[p,g]=(0,m.useState)((()=>{if(e){var n;const o=null===(n=(0,I.Zh)(e))||void 0===n?void 0:n.toString();var s;return o?null!==(s=t.find((e=>e.key===o)))&&void 0!==s?s:{key:o,label:o}:{key:e.name,label:e.name}}return{key:"",label:""}})),[v,f]=(0,m.useState)(!1),h=(0,m.useMemo)((()=>t.filter((e=>e.label.toLowerCase().includes(c.toLowerCase())))),[c,t]),y=v?t:h,b=c||y.length>0,w=(0,C.useComboboxState)({componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewassessmentupsertform.tsx_124",allItems:t,items:y,setItems:()=>{},setInputValue:e=>{f(!1),u(e)},multiSelect:!1,allowNewValue:!0,itemToString:e=>e?e.label:"",formValue:p,initialSelectedItem:p,initialInputValue:null!==(a=null===p||void 0===p?void 0:p.label)&&void 0!==a?a:"",formOnChange:e=>{(null===p||void 0===p?void 0:p.label)!==e&&g("string"!==typeof e?e:{key:null!==c&&void 0!==c?c:"",label:null!==c&&void 0!==c?c:""})},onIsOpenChange(e){e&&f(!0)}}),S=r.formatMessage({id:"bCdY2j",defaultMessage:'Add "{label}"'},{label:c});return(0,R.FD)("div",{children:[(0,R.FD)(C.TypeaheadComboboxRoot,{comboboxState:w,children:[(0,R.Y)(C.TypeaheadComboboxInput,{readOnly:o,css:(0,A.AH)({width:300,backgroundColor:i.colors.backgroundPrimary},""),placeholder:r.formatMessage({id:"nxzK82",defaultMessage:"Select or type an assessment"}),onKeyUp:e=>{-1===w.highlightedIndex&&"Enter"===e.key&&w.closeMenu()},comboboxState:w,formOnChange:e=>{g(e)}}),b&&(0,R.Y)(C.TypeaheadComboboxMenu,{comboboxState:w,emptyText:S,matchTriggerWidth:!0,children:y.map(((e,t)=>(0,R.Y)(C.TypeaheadComboboxMenuItem,{item:e,index:t,comboboxState:w,isDisabled:(null===e||void 0===e?void 0:e.disabled)||!1,children:e.label},`${e.key}-${t}`)))})]}),(0,R.Y)(_.S,{size:"sm"}),(0,R.Y)("div",{css:(0,A.AH)({backgroundColor:i.colors.backgroundPrimary,borderRadius:i.general.borderRadiusBase},""),children:(0,R.Y)(T.I.TextArea,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewassessmentupsertform.tsx_160",autoSize:!0,value:null!==l&&void 0!==l?l:"",onChange:e=>d(e.target.value),placeholder:r.formatMessage({id:"r/mP0/",defaultMessage:"Add rationale (optional)"})})}),(0,R.Y)(_.S,{size:"sm"}),(0,R.FD)("div",{css:(0,A.AH)({display:"flex",gap:i.spacing.xs},""),children:[(0,R.Y)(E.B,{size:"small",type:"primary",componentId:"mlflow.evaluations_review.confirm_edited_assessment_button",onClick:()=>{var t,s;if(!p)return;const o=null!==(t=null!==(s=p.rootAssessmentName)&&void 0!==s?s:null===e||void 0===e?void 0:e.name)&&void 0!==t?t:p.key,a=o===p.key||p.key;n({value:a,rationale:l,assessmentName:o})},disabled:!(null!==p&&void 0!==p&&p.key),children:(0,R.Y)(N.sA,{id:"/k6j6v",defaultMessage:"Confirm"})}),(0,R.Y)(E.B,{size:"small",type:"tertiary",componentId:"mlflow.evaluations_review.cancel_edited_assessment_button",onClick:s,children:(0,R.Y)(N.sA,{id:"5e1r3Y",defaultMessage:"Cancel"})})]})]})},ls=(e,t)=>{const n=(0,N.tz)(),[s,o]=(0,m.useState)(void 0),[a,i]=(0,m.useState)(!1),[r,l]=(0,m.useState)([]),d=(0,m.useCallback)(((s,a)=>{o(a),i(s),l((0,I.rU)(n,a,e,t))}),[n,t,e]),c=(0,m.useCallback)((e=>d(!0,e)),[d]);return{suggestions:r,editingAssessment:s,showUpsertForm:a,addAssessment:(0,m.useCallback)((()=>d(!0,void 0)),[d]),editAssessment:c,closeForm:(0,m.useCallback)((()=>{o(void 0),i(!1)}),[])}};var ds={name:"49aokf",styles:"display:contents"};const cs=({assessmentsType:e,assessmentName:t,assessmentHistory:n,rootCauseAssessment:o,onUpsertAssessment:a,allowEditing:i=!1,options:r,inputs:l,assessmentInfo:d,assessmentInfos:c})=>{const{theme:u}=(0,E.u)(),p=(0,N.tz)(),g="overall"===e,{suggestions:v,editingAssessment:f,showUpsertForm:h,editAssessment:y,closeForm:b}=ls(n,c);(0,m.useEffect)((()=>{b()}),[l,b]);const w=(0,s.first)(n),S=I.c9[t],x=S?p.formatMessage(S):t,T=Boolean(w&&(0,I.Zh)(w)),_=Boolean(w&&(0,I.CH)(w)),Y=i&&(T||_),{makeHTML:M}=_t(),k=(0,m.useMemo)((()=>{var e;const t=null===w||void 0===w||null===(e=w.rootCauseAssessment)||void 0===e?void 0:e.suggestedActions;return(0,s.isString)(t)?M(t):null}),[w,M]);return(0,R.FD)("div",{css:(0,A.AH)({display:"block",marginBottom:g?void 0:u.spacing.md},""),children:[!h&&(0,R.FD)("div",{css:(0,A.AH)({display:"flex",flexDirection:"column",gap:u.spacing.sm},""),children:[t!==I._1.OVERALL_ASSESSMENT&&(0,R.Y)("div",{css:(0,A.AH)({display:"flex",gap:u.spacing.sm,alignItems:"center"},""),children:(0,R.Y)(Ot,{assessment:w,"aria-label":x,disableJudgeTypeIcon:(0,I.xO)(w),onEdit:Y?()=>{const e=(0,s.first)(n);e&&y(e)}:void 0,assessmentInfo:d,type:"assessment-value"})}),(0,R.Y)(as,{history:n,alwaysExpanded:g}),o&&(0,R.FD)("div",{css:(0,A.AH)({display:"flex",flexDirection:"column",gap:u.spacing.sm,marginTop:u.spacing.xs},""),children:[(0,R.FD)("div",{css:(0,A.AH)({display:"flex",gap:u.spacing.sm,alignItems:"center"},""),children:[(0,R.Y)(C.BugIcon,{color:"danger"}),(0,R.Y)(E.T.Text,{bold:!0,children:(0,R.Y)(N.sA,{id:"M8pHqP",defaultMessage:"Root cause failure:"})}),(0,R.Y)(Ot,{assessment:o,isRootCauseAssessment:!0,"aria-label":x,assessmentInfo:d,type:"assessment-value"})]}),(0,R.Y)(as,{history:[o],alwaysExpanded:g}),k&&(0,R.FD)("div",{css:(0,A.AH)({display:"flex",flexDirection:"column",gap:u.spacing.sm},""),children:[(0,R.FD)("div",{css:(0,A.AH)({display:"flex",gap:u.spacing.sm,alignItems:"center"},""),children:[(0,R.Y)(C.AssistantIcon,{color:"ai"}),(0,R.Y)(E.T.Text,{bold:!0,children:(0,R.Y)(N.sA,{id:"vCUglz",defaultMessage:"Suggested actions"})})]}),(0,R.Y)("span",{css:ds,dangerouslySetInnerHTML:{__html:k}})]})]})]}),h&&(0,R.Y)(R.FK,{children:(0,R.Y)(rs,{editedAssessment:f,valueSuggestions:v,onCancel:b,onSave:({value:e,rationale:t,assessmentName:n})=>{var s;const o=g?I._1.OVERALL_ASSESSMENT:"",i=(0,I.aj)({name:null!==(s=null!==n&&void 0!==n?n:null===f||void 0===f?void 0:f.name)&&void 0!==s?s:o,isOverallAssessment:g,value:e,rationale:t});a(i),b()}},null===f||void 0===f?void 0:f.name)})]},t)};var us={name:"eivff4",styles:"display:none"};const ms=({assessmentsType:e,assessmentsByName:t,rootCauseAssessment:n,onUpsertAssessment:s,allowEditing:o=!1,allowMoreThanOne:a=!1,options:i,inputs:r,assessmentInfos:l})=>{const{theme:d}=(0,E.u)(),c="overall"===e,u=t.filter((([e,t])=>t.length>0)),{suggestions:p,editingAssessment:g,showUpsertForm:v,addAssessment:f,closeForm:h}=ls(u.flatMap((([e,t])=>t)),l);(0,m.useEffect)((()=>{h()}),[r,h]);const y=Object.keys(u).length>0,b=o&&(a||!y);return(0,R.FD)(R.FK,{children:[(0,R.FD)("div",{css:(0,A.AH)({display:"block",flexWrap:"wrap",gap:d.spacing.xs},""),children:[u.map((([t,a])=>{const d=l.find((e=>e.name===t));return d?(0,R.Y)(cs,{assessmentsType:e,assessmentName:t,assessmentHistory:a,rootCauseAssessment:n,onUpsertAssessment:s,allowEditing:o,options:i,inputs:r,assessmentInfo:d,assessmentInfos:l},t):(0,R.Y)("div",{css:us},t)})),b&&(0,R.Y)(E.B,{componentId:"overall"===e?"mlflow.evaluations_review.add_assessment_overall_button":"response"===e?"mlflow.evaluations_review.add_assessment_response_button":"mlflow.evaluations_review.add_assessment_retrieval_button",onClick:f,icon:(0,R.Y)(C.PlusIcon,{}),size:"small",children:(0,R.Y)(N.sA,{id:"vgfy8y",defaultMessage:"Add assessment"})})]}),v&&(0,R.FD)(R.FK,{children:[(0,R.Y)(_.S,{size:"sm"}),(0,R.Y)(rs,{valueSuggestions:p,onCancel:h,onSave:({value:e,rationale:t,assessmentName:n})=>{var o;const a=c?I._1.OVERALL_ASSESSMENT:n||"",i=(0,I.aj)({name:null!==(o=null!==n&&void 0!==n?n:null===g||void 0===g?void 0:g.name)&&void 0!==o?o:a,isOverallAssessment:c,value:e,rationale:t});s(i),h()}})]})]})};var ps={name:"49aokf",styles:"display:contents"};const gs=({assessmentsType:e,assessmentsByName:t,onUpsertAssessment:n,allowEditing:o=!1,allowMoreThanOne:a=!1,options:i,inputs:r,assessmentInfos:l})=>{const{theme:d}=(0,E.u)(),c=(0,N.tz)(),u="overall"===e,{suggestions:p,editingAssessment:g,showUpsertForm:v,addAssessment:f,editAssessment:h,closeForm:y}=ls(t.flatMap((([e,t])=>t)),l);(0,m.useEffect)((()=>{y()}),[r,y]);const b=t.filter((([e,t])=>t.length>0)),w=Object.keys(b).length>0,S=o&&(a||!w);return(0,R.FD)(R.FK,{children:[(0,R.FD)("div",{css:(0,A.AH)({display:"flex",flexWrap:"wrap",gap:d.spacing.xs,alignItems:"center"},""),children:[b.map((([e,t])=>{const n=(0,s.first)(t),a=l.find((t=>t.name===e));if(!a)return(0,R.Y)(R.FK,{});const i=I.c9[e],r=i?c.formatMessage(i):e,d=Boolean(n&&(0,I.Zh)(n)),u=Boolean(n&&(0,I.CH)(n)),m=o&&(d||u)&&a.isEditable;return(0,R.Y)("div",{css:ps,children:(0,R.Y)(is,{assessmentHistory:t,children:(0,R.Y)(Ot,{assessment:n,"aria-label":r,active:(null===g||void 0===g?void 0:g.name)===e&&v,disableJudgeTypeIcon:(0,I.xO)(n),onEdit:m?()=>{const e=(0,s.first)(t);e&&h(e)}:void 0,assessmentInfo:a,type:"assessment-value"})})},e)})),S&&(0,R.Y)(E.B,{componentId:"overall"===e?"mlflow.evaluations_review.add_assessment_overall_button":"response"===e?"mlflow.evaluations_review.add_assessment_response_button":"mlflow.evaluations_review.add_assessment_retrieval_button",onClick:f,icon:(0,R.Y)(C.PlusIcon,{}),size:"small",children:(0,R.Y)(N.sA,{id:"vgfy8y",defaultMessage:"Add assessment"})})]}),v&&(0,R.FD)(R.FK,{children:[(0,R.Y)(_.S,{size:"sm"}),(0,R.Y)(rs,{editedAssessment:g,valueSuggestions:p,onCancel:y,onSave:({value:e,rationale:t,assessmentName:s})=>{var o;const a=u?I._1.OVERALL_ASSESSMENT:s||"",i=(0,I.aj)({name:null!==(o=null!==s&&void 0!==s?s:null===g||void 0===g?void 0:g.name)&&void 0!==o?o:a,isOverallAssessment:u,value:e,rationale:t});n(i),y()}},null===g||void 0===g?void 0:g.name)]})]})},vs=({assessmentsType:e,assessmentsByName:t,rootCauseAssessment:n,onUpsertAssessment:s,allowEditing:o=!1,allowMoreThanOne:a=!1,alwaysExpanded:i=!1,options:r,inputs:l,assessmentInfos:d})=>{const[c,u]=(0,m.useState)(!1),p=i||c,g=t.filter((([e,t])=>t.length>0));let v=t;"overall"!==e&&(v=t.filter((([e,t])=>e!==I._1.OVERALL_ASSESSMENT)));const f=Object.keys(g).length>0;return(0,R.FD)(R.FK,{children:[p&&(0,R.Y)(ms,{assessmentsType:e,assessmentsByName:v,rootCauseAssessment:n,onUpsertAssessment:s,allowEditing:o,allowMoreThanOne:a,options:r,inputs:l,assessmentInfos:d}),!p&&(0,R.Y)(gs,{assessmentsType:e,assessmentsByName:v,onUpsertAssessment:s,allowEditing:o,allowMoreThanOne:a,options:r,inputs:l,assessmentInfos:d}),f&&!i&&(0,R.FD)(R.FK,{children:[(0,R.Y)(_.S,{size:"sm"}),(0,R.Y)(E.B,{size:"small",type:"tertiary",componentId:"overall"===e?"mlflow.evaluations_review.see_assessment_details_overall_button":"response"===e?"mlflow.evaluations_review.see_assessment_details_response_button":"mlflow.evaluations_review.see_assessment_details_retrieval_button",icon:p?(0,R.Y)(C.ChevronUpIcon,{}):(0,R.Y)(E.o,{}),onClick:()=>u((e=>!e)),children:p?(0,R.Y)(N.sA,{id:"G7V4y3",defaultMessage:"Hide details"}):(0,R.Y)(N.sA,{id:"pfyUes",defaultMessage:"See details"})})]})]})},fs=({toBeReviewed:e,containsOverallAssessment:t,isNextResultAvailable:n,overridingExistingReview:s,hasPendingAssessments:o,onClickNext:a,onSave:i,onCancelOverride:r})=>e?o?(0,R.Y)(E.B,{type:"primary",componentId:"mlflow.evaluations_review.save_pending_assessments_button",onClick:i,children:(0,R.Y)(N.sA,{id:"m1Nb7W",defaultMessage:"Save"})}):s?(0,R.Y)(E.B,{componentId:"mlflow.evaluations_review.cancel_override_assessments_button",onClick:r,children:(0,R.Y)(N.sA,{id:"e9qVjz",defaultMessage:"Cancel"})}):(0,R.Y)(E.B,{type:"primary",componentId:"mlflow.evaluations_review.mark_as_reviewed_button",onClick:i,disabled:!t,children:(0,R.Y)(N.sA,{id:"Ls2ris",defaultMessage:"Mark as reviewed"})}):(0,R.Y)(E.B,{type:"primary",componentId:"mlflow.evaluations_review.next_evaluation_result_button",onClick:a,endIcon:(0,R.Y)(E.o,{}),disabled:!n,children:(0,R.Y)(N.sA,{id:"CBnbqy",defaultMessage:"Next"})}),hs=()=>{const{theme:e}=(0,E.u)();return(0,R.Y)("div",{css:(0,A.AH)({width:"1.5px",backgroundColor:e.colors.border},"")})};var ys={name:"1d3w5wq",styles:"width:100%"},bs={name:"82a6rk",styles:"flex:1"};const ws=({evaluationResult:e,onUpsertAssessment:t,onSavePendingAssessments:n,onClickNext:o,onResetPendingAssessments:a,isNextAvailable:i,overridingExistingReview:r=!1,pendingAssessments:l=[],setOverridingExistingReview:d,isReadOnly:c=!1,assessmentInfos:u})=>{var m;const{theme:p}=(0,E.u)(),g=(0,N.tz)();if(!e)return null;const v=(0,s.first)(e.overallAssessments),f=null===v||void 0===v||null===(m=v.rootCauseAssessment)||void 0===m?void 0:m.assessmentName,h=f?(0,s.first)(null===e||void 0===e?void 0:e.responseAssessmentsByName[f]):void 0,y=!c&&(!(0,I.vP)(e)||r),b=g.formatMessage({id:"d44IPd",defaultMessage:"Reopen review"}),w=[[I._1.OVERALL_ASSESSMENT,e.overallAssessments]],S=u.find((e=>e.name===I._1.OVERALL_ASSESSMENT));return(0,R.FD)("div",{css:ys,children:[(0,R.FD)("div",{css:(0,A.AH)({width:"100%",paddingLeft:p.spacing.md,paddingRight:p.spacing.md},""),children:[(0,R.FD)("div",{css:(0,A.AH)({backgroundColor:p.colors.backgroundSecondary,padding:p.spacing.md,paddingBottom:0,display:"flex",flexDirection:"column",gap:p.spacing.sm},""),children:[S&&(0,R.FD)("div",{css:(0,A.AH)({display:"flex",gap:p.spacing.sm,alignItems:"center"},""),children:[(0,R.Y)(C.SparkleDoubleIcon,{color:"ai"}),(0,R.Y)(E.T.Text,{bold:!0,children:(0,R.Y)(N.sA,{id:"ML+mQa",defaultMessage:"Overall assessment:"})}),(0,R.Y)(Ot,{assessment:v,"aria-label":I._1.OVERALL_ASSESSMENT,disableJudgeTypeIcon:(0,I.xO)(v),assessmentInfo:S,type:"assessment-value"})]}),(0,R.Y)(vs,{assessmentsType:"overall",assessmentsByName:w,rootCauseAssessment:h,onUpsertAssessment:t,allowEditing:y,alwaysExpanded:!0,options:[I._1.OVERALL_ASSESSMENT],assessmentInfos:u}),(0,R.FD)("div",{css:(0,A.AH)({border:`1px solid ${p.colors.border}`,borderRadius:p.general.borderRadiusBase,padding:p.spacing.sm},""),children:[(0,R.Y)(E.T.Text,{bold:!0,children:(0,R.Y)(N.sA,{id:"5jXYY4",defaultMessage:"Detailed assessments"})}),(0,R.Y)(_.S,{size:"sm"}),(0,R.Y)(vs,{assessmentsType:"response",assessmentsByName:(0,I.Xe)(e.responseAssessmentsByName),onUpsertAssessment:t,allowEditing:y,allowMoreThanOne:!0,options:I.PB,assessmentInfos:u})]})]}),(0,R.FD)("div",{css:(0,A.AH)({position:"sticky",backgroundColor:p.colors.backgroundSecondary,padding:p.spacing.md,top:0,display:"flex",justifyContent:"space-between",gap:p.spacing.sm,zIndex:p.options.zIndexBase},""),children:[(0,R.Y)("div",{children:!y&&!c&&(0,R.FD)("div",{css:(0,A.AH)({border:`1px solid ${p.colors.border}`,borderRadius:p.general.borderRadiusBase,display:"flex",alignItems:"center",gap:p.spacing.sm,padding:`${p.spacing.xs}px ${p.spacing.sm}px`},""),children:[(0,R.Y)(C.CheckCircleIcon,{css:(0,A.AH)({color:p.colors.textValidationSuccess},"")}),(0,R.Y)(E.T.Hint,{children:(0,R.Y)(N.sA,{id:"zLTdCZ",defaultMessage:"Reviewed"})}),(0,R.Y)(_.T,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewassessmentssection.tsx_149",content:b,children:(0,R.Y)(E.B,{"aria-label":b,componentId:"mlflow.evaluations_review.reopen_review_button",size:"small",icon:(0,R.Y)(C.PencilIcon,{}),onClick:()=>d(!0)})})]})}),(0,R.Y)("div",{css:bs}),l.length>0&&(0,R.FD)("div",{css:(0,A.AH)({display:"flex",alignItems:"center",gap:p.spacing.sm},""),children:[(0,R.Y)(N.sA,{id:"MB3kda",defaultMessage:"{pendingCount} pending {pendingCount, plural, =1 {change} other {changes}}",values:{pendingCount:l.length}}),(0,R.Y)(E.B,{componentId:"mlflow.evaluations_review.discard_pending_assessments_button",onClick:a,children:(0,R.Y)(N.sA,{id:"eIWfRN",defaultMessage:"Discard"})})]}),(0,R.Y)(fs,{onSave:async()=>{await n(),d(!1)},containsOverallAssessment:Boolean(v),isNextResultAvailable:Boolean(i),onClickNext:o,toBeReviewed:y,hasPendingAssessments:l.length>0,overridingExistingReview:r,onCancelOverride:()=>d(!1)})]})]}),(0,R.Y)(_.S,{size:"md"})]})},Ss=({evaluationResult:e,otherEvaluationResult:t,onUpsertAssessment:n,onSavePendingAssessments:s,onClickNext:o,onResetPendingAssessments:a,isNextAvailable:i,overridingExistingReview:r=!1,pendingAssessments:l=[],setOverridingExistingReview:d,isReadOnly:c=!1,assessmentInfos:u})=>{const{theme:m}=(0,E.u)();return(0,R.FD)("div",{css:(0,A.AH)({display:"flex",width:"100%",gap:m.spacing.sm},""),children:[e&&(0,R.Y)(ws,{evaluationResult:e,onUpsertAssessment:n,onSavePendingAssessments:s,onClickNext:o,onResetPendingAssessments:a,isNextAvailable:i,overridingExistingReview:r,setOverridingExistingReview:d,pendingAssessments:l,isReadOnly:c,assessmentInfos:u}),t&&(0,R.FD)(R.FK,{children:[(0,R.Y)(hs,{}),(0,R.Y)(ws,{evaluationResult:t,onUpsertAssessment:n,onSavePendingAssessments:s,onClickNext:o,onResetPendingAssessments:a,isNextAvailable:i,overridingExistingReview:r,setOverridingExistingReview:d,pendingAssessments:l,isReadOnly:!0,assessmentInfos:u})]})]})},Is=({requestId:e,onClose:t,trace:n})=>{const{theme:o}=(0,E.u)(),a=(0,R.Y)(E.T.Title,{level:2,withoutMargins:!0,children:e});return(0,R.Y)(C.Drawer.Root,{modal:!0,open:!0,onOpenChange:e=>{e||t()},children:(0,R.Y)(C.Drawer.Content,{componentId:"mlflow.evaluations_review.trace_data_drawer",width:"85vw",title:a,expandContentToFullHeight:!0,children:(()=>{const e=n.data.spans.length>0;return(0,s.isNil)(n)||!e?(0,R.FD)(R.FK,{children:[(0,R.Y)(_.S,{size:"lg"}),(0,R.Y)(C.Empty,{description:null,title:(0,R.Y)(N.sA,{id:"EpFST9",defaultMessage:"No trace data recorded"})})]}):(0,R.Y)("div",{css:(0,A.AH)({height:"100%",marginLeft:-o.spacing.lg,marginRight:-o.spacing.lg,marginBottom:-o.spacing.lg},""),onWheel:e=>e.stopPropagation(),children:(0,R.Y)(O.a8,{modelTrace:n})})})()})})};var xs={name:"1d3w5wq",styles:"width:100%"};const As=({experimentId:e,runDisplayName:t,evaluationResult:n,exportToEvalsInstanceEnabled:o=!1,traceQueryResult:a,getTrace:i})=>{var r,l;const d=(0,N.tz)(),{theme:c}=(0,E.u)(),[u,p]=(0,m.useState)(null),g=null===(r=n.traceInfo)||void 0===r||null===(l=r.trace_metadata)||void 0===l?void 0:l["databricks.tracingserver.dropped_spans_size_bytes"];let v;if(!(0,s.isNil)(g)){const e=2,t=At(Number(g),e);v=`${t.value} ${t.unit}`}return(0,R.FD)("div",{css:xs,children:[(0,R.FD)("div",{css:(0,A.AH)({width:"100%",paddingLeft:c.spacing.md,paddingRight:c.spacing.md,display:"flex",alignItems:"center",justifyContent:"space-between",gap:c.spacing.sm},""),children:[(0,R.Y)(E.T.Title,{level:4,children:t}),n.requestId&&(0,R.FD)("div",{css:(0,A.AH)({display:"flex",gap:c.spacing.sm},""),children:[o&&i&&(0,R.Y)(U,{experimentId:e,selectedTraces:[n],traceInfos:void 0}),(0,R.Y)(_.T,{delayDuration:0,componentId:"mlflow.evaluations_review.see_detailed_trace_view_tooltip",content:g?`The trace spans were not stored due to their large size: ${v}`:void 0,side:"left",children:(0,R.Y)(E.B,{componentId:"mlflow.evaluations_review.see_detailed_trace_view_button",onClick:()=>p(n.requestId),loading:a.isLoading,disabled:!(0,s.isNil)(g),children:(0,R.Y)(N.sA,{id:"HUC492",defaultMessage:"See detailed trace view"})})})]}),u&&((0,s.isNil)(a.data)?(0,R.Y)(R.FK,{children:d.formatMessage({id:"EZfSbs",defaultMessage:"No trace data available"})}):(0,R.Y)(Is,{onClose:()=>{p(null)},requestId:u,trace:a.data}))]}),(0,R.Y)(_.S,{size:"md"})]})},Es=({experimentId:e,runDisplayName:t,otherRunDisplayName:n,evaluationResult:s,otherEvaluationResult:o,exportToEvalsInstanceEnabled:a=!1,traceQueryResult:i,compareToTraceQueryResult:r})=>{const{theme:l}=(0,E.u)();return(0,R.FD)("div",{css:(0,A.AH)({display:"flex",width:"100%",gap:l.spacing.sm},""),children:[(0,R.Y)(As,{experimentId:e,runDisplayName:t,evaluationResult:s,exportToEvalsInstanceEnabled:a,traceQueryResult:i}),n&&o&&(0,R.FD)(R.FK,{children:[(0,R.Y)(hs,{}),(0,R.Y)(As,{experimentId:e,runDisplayName:n,evaluationResult:o,exportToEvalsInstanceEnabled:a,traceQueryResult:r})]})]})},Cs=({value:e})=>{const t=(0,m.useMemo)((()=>{if("object"===typeof e&&null!==e)return JSON.stringify(e,null,2);if("string"===typeof e)try{const t=JSON.parse(e);return JSON.stringify(t,null,2)}catch(t){return null}return null}),[e]);return(0,R.Y)("div",{css:(0,A.AH)({whiteSpace:"pre-wrap",wordBreak:"break-word",fontFamily:t?"monospace":void 0},""),children:t||String(e)})};var Ts={name:"1066lcq",styles:"display:flex;justify-content:space-between;align-items:center"},_s={name:"1nko30q",styles:"margin-bottom:0 !important"},Ns={name:"49aokf",styles:"display:contents"};const Rs=({fieldName:e,title:t,value:n,showCopyIcon:o})=>{const{theme:a}=(0,E.u)(),{makeHTML:i}=_t(),r=(0,m.useMemo)((()=>(0,s.isString)(n)?i(n):null),[n,i]),l=(0,m.useMemo)((()=>(0,s.isString)(n)?null:(0,I.ng)(n)),[n]);return(0,R.FD)("div",{css:(0,A.AH)({display:"flex",flexDirection:"column",gap:a.spacing.sm,flex:1,border:`1px solid ${a.colors.border}`,padding:a.spacing.md,borderRadius:a.general.borderRadiusBase,marginBottom:a.spacing.md},""),children:[(0,R.FD)("div",{css:Ts,children:[(0,R.Y)(E.T.Text,{bold:!0,children:t}),o&&(0,R.Y)(Oe.ad,{copyText:(0,I.ng)(n),componentId:"mlflow.evaluations_review.textbox.copy"})]}),(0,R.Y)(E.T.Paragraph,{css:_s,children:(0,s.isString)(n)?(0,R.Y)("span",{css:Ns,dangerouslySetInnerHTML:{__html:null!==r&&void 0!==r?r:""}}):e===I.UN&&Array.isArray(n)?(0,R.Y)("ul",{children:n.map(((e,t)=>(0,R.Y)("li",{children:(0,R.Y)(Cs,{value:e},t)},t)))}):(0,R.Y)(Cs,{value:l})})]})},Ys=({evaluationResult:e})=>{const{theme:t}=(0,E.u)(),{inputs:n}=e,s=Object.entries(n),o=0===s.length;return(0,R.FD)("div",{css:(0,A.AH)({width:"100%",paddingLeft:t.spacing.md,paddingRight:t.spacing.md},""),children:[(0,R.Y)(E.T.Text,{bold:!0,children:(0,R.Y)(N.sA,{id:"MQ4Voz",defaultMessage:"{count, plural, one {Input} other {Inputs}}",values:{count:s.length}})}),(0,R.Y)(_.S,{size:"sm"}),o&&(0,R.Y)(E.T.Paragraph,{children:(0,R.Y)(N.sA,{id:"gPhm1b",defaultMessage:"No inputs logged"})}),s.map((([e,t])=>(0,R.Y)(Rs,{fieldName:e,title:e,value:t},e)))]})},Ms=({evaluationResult:e,otherEvaluationResult:t})=>{const{theme:n}=(0,E.u)(),s=(null===e||void 0===e?void 0:e.inputsId)===(null===t||void 0===t?void 0:t.inputsId);return(0,R.FD)("div",{css:(0,A.AH)({display:"flex",width:"100%",gap:n.spacing.sm},""),children:[e&&(0,R.Y)(Ys,{evaluationResult:e}),!s&&t&&(0,R.Y)(Ys,{evaluationResult:t})]})};var ks={name:"82a6rk",styles:"flex:1"},Ds={name:"82a6rk",styles:"flex:1"};const Fs=({evaluationResult:e})=>{const{theme:t}=(0,E.u)(),{outputs:n,targets:s}=e,o=Object.entries(n).filter((([,e])=>!(0,I.Wp)(e))),a=Object.entries(s).filter((([,e])=>!(0,I.Wp)(e))),i=0===o.length&&0===a.length;return(0,R.FD)("div",{css:(0,A.AH)({paddingLeft:t.spacing.md,paddingRight:t.spacing.md,width:"100%"},""),children:[(0,R.Y)(E.T.Text,{bold:!0,children:(0,R.Y)(N.sA,{id:"x6rkyu",defaultMessage:"Response"})}),(0,R.Y)(_.S,{size:"sm"}),i&&(0,R.Y)(E.T.Paragraph,{children:(0,R.Y)(N.sA,{id:"YvxyMH",defaultMessage:"No responses or targets logged"})}),(0,R.FD)("div",{css:(0,A.AH)({display:"flex",gap:t.spacing.md,alignItems:"flex-start"},""),children:[o.length>0&&(0,R.Y)("div",{css:ks,children:o.map((([e,t])=>{const n=I.eB[e],s=n?(0,R.Y)(N.sA,{...n}):e;return(0,R.Y)(Rs,{fieldName:e,title:s,value:t,showCopyIcon:!0},e)}))}),a.length>0&&(0,R.Y)("div",{css:Ds,children:a.map((([e,t])=>{const n=I.Au[e],s=n?(0,R.Y)(N.sA,{...n}):e;return(0,R.Y)(Rs,{fieldName:e,title:s,value:t,showCopyIcon:!0},e)}))})]})]})},Os=({evaluationResult:e,otherEvaluationResult:t})=>{const{theme:n}=(0,E.u)();return(0,R.FD)("div",{css:(0,A.AH)({display:"flex",width:"100%",gap:n.spacing.sm},""),children:[e&&(0,R.Y)(Fs,{evaluationResult:e}),t&&(0,R.FD)(R.FK,{children:[(0,R.Y)(hs,{}),(0,R.Y)(Fs,{evaluationResult:t})]})]})},Vs=({assessment:e,chunkRelevanceAssessmentInfo:t})=>{const{theme:n}=(0,E.u)();return e||t?(0,R.Y)("div",{css:(0,A.AH)({paddingLeft:n.spacing.sm,paddingRight:n.spacing.sm,paddingTop:1,paddingBottom:1,backgroundColor:t?(0,u.x2)(n,t,e):"",borderRadius:n.general.borderRadiusBase,svg:{width:12,height:12}},""),children:e?(0,R.Y)(R.FK,{children:(0,I.w_)(e)?(0,R.Y)(C.UserIcon,{}):(0,R.Y)(C.SparkleDoubleIcon,{})}):(0,R.Y)(C.QuestionMarkIcon,{})}):(0,R.Y)(R.FK,{})};function Ls(e){try{const t=new URL(e);return"http:"===t.protocol||"https:"===t.protocol}catch(t){return!1}}var Hs={name:"s5xdrg",styles:"display:flex;align-items:center"};const Us=({chunk:e,index:t})=>(0,R.FD)("div",{css:Hs,children:[(0,R.FD)(C.Tag,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewretrievalsection.tsx_30",children:["#",t+1]}),Ls(e.docUrl)?(0,R.Y)(E.T.Link,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewretrievalsection.tsx_32",href:e.docUrl,ellipsis:!0,openInNewTab:!0,strong:!0,children:e.docUrl}):(0,R.Y)(E.T.Title,{level:4,withoutMargins:!0,ellipsis:!0,children:e.docUrl})]});var $s={name:"1vgo6ev",styles:"flex:2;display:flex;flex-direction:column;width:0"},zs={name:"49aokf",styles:"display:contents"};const Bs=({evaluationResult:e,onUpsertAssessment:t,overridingExistingReview:n=!1,isReadOnly:o=!1,assessmentInfos:a,traceQueryResult:i})=>{const{theme:r}=(0,E.u)(),l=(0,N.tz)(),[d,c]=(0,m.useState)(0),{makeHTML:u}=_t(),p=(0,m.useMemo)((()=>!(0,s.isNil)(e.retrievalChunks)&&e.retrievalChunks.length>0?e.retrievalChunks:(0,F.nr)(e.responseAssessmentsByName,i.data)),[e.responseAssessmentsByName,e.retrievalChunks,i.data]),g=(0,m.useMemo)((()=>{var e;return u(null===p||void 0===p||null===(e=p[d])||void 0===e?void 0:e.content)}),[p,d,u]),v=0===(p||[]).length,f=!o&&(!(0,I.vP)(e)||n),h=null===p||void 0===p?void 0:p[d],y=l.formatMessage({id:"iPTAj8",defaultMessage:"Retrieval"});return(0,R.FD)("div",{css:(0,A.AH)({paddingLeft:r.spacing.md,paddingRight:r.spacing.md,width:"100%",display:"flex",flexDirection:"column"},""),role:"region","aria-label":y,children:[(0,R.Y)(E.T.Text,{bold:!0,children:y}),(0,s.isNil)(p)&&i.isFetching?(0,R.Y)(C.TableSkeleton,{lines:3}):v?(0,R.Y)(E.T.Text,{children:(0,R.Y)("i",{children:(0,R.Y)(N.sA,{id:"d00egE",defaultMessage:"No span with type RETRIEVER found in trace."})})}):(0,R.FD)("div",{css:(0,A.AH)({minHeight:400,maxHeight:600,overflow:"hidden",display:"flex",marginTop:r.spacing.sm,border:`1px solid ${r.colors.border}`,borderRadius:r.general.borderRadiusBase},""),children:[(0,R.FD)("div",{css:(0,A.AH)({flex:1,flexShrink:1,maxWidth:300,minWidth:200,overflow:"auto",padding:r.spacing.sm,borderRight:`1px solid ${r.colors.border}`},""),role:"listbox",children:[v&&(0,R.Y)(E.T.Paragraph,{children:(0,R.Y)(N.sA,{id:"0Bee6A",defaultMessage:"No retrieval logged"})}),(p||[]).map(((e,t)=>{var n,o;const i=a.find((e=>e.name===I._1.CHUNK_RELEVANCE));return(0,R.FD)("div",{role:"option","aria-label":null===(n=e.content)||void 0===n?void 0:n.slice(0,255),"aria-selected":t===d,css:(0,A.AH)({backgroundColor:t===d?r.colors.actionIconBackgroundHover:"transparent","&:hover":{backgroundColor:r.colors.actionIconBackgroundHover},padding:`${r.spacing.sm}px ${r.spacing.md}px`,overflow:"hidden",display:"flex",gap:r.spacing.sm,alignItems:"center",cursor:"pointer",width:"100%"},""),onClick:()=>{c(t)},children:[(0,R.Y)(Vs,{chunkRelevanceAssessmentInfo:i,assessment:(0,s.first)(null===e||void 0===e||null===(o=e.retrievalAssessmentsByName)||void 0===o?void 0:o[I._1.CHUNK_RELEVANCE])}),(0,R.Y)(E.T.Text,{ellipsis:!0,css:(0,A.AH)({flex:1,lineHeight:r.typography.lineHeightLg},""),children:e.content})]},[e.docUrl,t].join("-"))}))]}),h&&(0,R.FD)("div",{css:$s,children:[(0,R.FD)("div",{css:(0,A.AH)({padding:r.spacing.md,borderBottom:`1px solid ${r.colors.border}`},""),children:[(0,R.Y)(Us,{chunk:h,index:d}),(0,R.Y)(_.S,{size:"md"}),(0,R.Y)(vs,{assessmentsType:"retrieval",assessmentsByName:(0,I.Xe)(h.retrievalAssessmentsByName||{}),onUpsertAssessment:e=>{e.metadata||(e.metadata={}),e.metadata[I.bz.CHUNK_INDEX]=d,t(e)},allowEditing:f,allowMoreThanOne:!0,options:I.ER,inputs:[d],assessmentInfos:a})]}),(0,R.Y)("div",{css:(0,A.AH)({padding:r.spacing.md,overflow:"auto"},""),children:(0,R.Y)(E.T.Paragraph,{children:(0,R.Y)("span",{css:zs,dangerouslySetInnerHTML:{__html:null!==g&&void 0!==g?g:""}})})})]})]})]})},js=({evaluationResult:e,otherEvaluationResult:t,onUpsertAssessment:n,overridingExistingReview:s=!1,isReadOnly:o=!1,assessmentInfos:a,traceQueryResult:i,compareToTraceQueryResult:r})=>{const{theme:l}=(0,E.u)();return(0,R.FD)("div",{css:(0,A.AH)({display:"flex",width:"100%",gap:l.spacing.sm},""),children:[e&&(0,R.Y)(Bs,{evaluationResult:e,onUpsertAssessment:n,overridingExistingReview:s,isReadOnly:o,assessmentInfos:a,traceQueryResult:i}),t&&(0,R.FD)(R.FK,{children:[(0,R.Y)(hs,{}),(0,R.Y)(Bs,{evaluationResult:t,onUpsertAssessment:n,overridingExistingReview:s,isReadOnly:o,assessmentInfos:a,traceQueryResult:r})]})]})};var Ps={name:"1cwfdr7",styles:"flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis"};const qs=({evaluationResult:e})=>{const{theme:t}=(0,E.u)();return(0,R.Y)("div",{css:(0,A.AH)({display:"flex",alignItems:"center",gap:t.spacing.sm,overflow:"hidden"},""),children:(0,R.Y)(E.T.Title,{level:2,withoutMargins:!0,css:Ps,children:(0,I.sw)(e)})})},Ks=({experimentId:e,evaluationResult:t,otherEvaluationResult:n,onSavePendingAssessments:o,onClickNext:a,runDisplayName:i,compareToRunDisplayName:r,isNextAvailable:l=!1,isReadOnly:d=!1,exportToEvalsInstanceEnabled:c=!1,assessmentInfos:u,traceQueryResult:p,compareToTraceQueryResult:g})=>{(0,N.tz)();const{pendingAssessments:v,draftEvaluationResult:f,upsertAssessment:h,resetPendingAssessments:y}=(e=>{const[t,n]=(0,m.useReducer)(((e,t)=>{switch(t.type){case"resetPendingAssessments":return[];case"upsertAssessment":const n=e.find((e=>e.name===t.payload.name&&(0,I.Pp)(e)===(0,I.Pp)(t.payload)));return n?e.map((e=>e===n?""===(0,I.Zh)(e)&&t.payload.stringValue?{...t.payload,stringValue:"",name:t.payload.stringValue}:t.payload:e)):[t.payload,...e]}}),[]),o=(0,m.useMemo)((()=>{if(!e)return[];const n=t.find(I.hG);return n?[n,...e.overallAssessments]:e.overallAssessments}),[e,t]),a=(0,m.useMemo)((()=>{if(!e)return{};const n=(0,s.uniq)([...Object.keys(e.responseAssessmentsByName),...t.filter((e=>!(0,I.hG)(e)&&!(0,I.II)(e))).map((e=>e.name))]);return Object.fromEntries(n.map((n=>{const s=t.filter((e=>e.name===n));return[n,[...s,...e.responseAssessmentsByName[n]||[]]]})))}),[e,t]),i=(0,m.useMemo)((()=>{var n;const o=t.filter(I.II);return null===(n=e.retrievalChunks)||void 0===n?void 0:n.map(((e,t)=>{var n;const a=o.filter((e=>{var n;return(null===(n=e.metadata)||void 0===n?void 0:n[I.bz.CHUNK_INDEX])===t})),i=(0,s.flatMap)(null!==(n=e.retrievalAssessmentsByName)&&void 0!==n?n:{}),r=(0,s.groupBy)([...a,...i],"name");return Object.keys(r).forEach((e=>{r[e]=(0,s.orderBy)(r[e],"timestamp","desc")})),{...e,retrievalAssessmentsByName:r}}))}),[t,e]),r=(0,m.useMemo)((()=>({...e,overallAssessments:o,responseAssessmentsByName:a,retrievalChunks:i})),[e,o,a,i]),l=(0,m.useCallback)((e=>n({type:"upsertAssessment",payload:e})),[]),d=(0,m.useCallback)((()=>n({type:"resetPendingAssessments"})),[]);return{pendingAssessments:t,draftEvaluationResult:r,upsertAssessment:l,resetPendingAssessments:d}})(t),[b,w]=(v.length,(0,m.useState)(!1)),S=Boolean(t.errorCode),x=Boolean(t.errorMessage),A=S||x,[T,Y]=(0,m.useState)(!1);return(0,R.FD)(R.FK,{children:[A?(0,R.FD)(R.FK,{children:[(0,R.Y)(C.Alert,{action:x&&(0,R.Y)(E.B,{componentId:`mlflow.evaluations_review.evaluation_error_alert.show_${T?"less":"more"}_button`,onClick:()=>Y((e=>!e)),children:T?(0,R.Y)(N.sA,{id:"qVQYZH",defaultMessage:"Show less"}):(0,R.Y)(N.sA,{id:"U4s/77",defaultMessage:"Show more"})}),closable:!1,componentId:"mlflow.evaluations_review.evaluation_error_alert",message:S?`${t.errorCode}`:"UNKNOWN_ERROR",description:T&&`${t.errorMessage}`,type:"error"}),(0,R.Y)(_.S,{size:"md"})]}):null,(0,R.Y)(Es,{experimentId:e,runDisplayName:i,otherRunDisplayName:r,evaluationResult:t,otherEvaluationResult:n,exportToEvalsInstanceEnabled:c,traceQueryResult:p,compareToTraceQueryResult:g}),(0,R.Y)(Ss,{evaluationResult:f,otherEvaluationResult:n,onUpsertAssessment:h,onClickNext:a,onSavePendingAssessments:async()=>{await(null===o||void 0===o?void 0:o(t,v)),y()},isNextAvailable:l,overridingExistingReview:b,setOverridingExistingReview:w,pendingAssessments:v,onResetPendingAssessments:y,isReadOnly:d,assessmentInfos:u}),(0,R.Y)(Ms,{evaluationResult:t,otherEvaluationResult:n}),(0,R.Y)(Os,{evaluationResult:t,otherEvaluationResult:n}),(0,R.Y)(js,{evaluationResult:f,otherEvaluationResult:n,onUpsertAssessment:h,overridingExistingReview:b,isReadOnly:d,assessmentInfos:u,traceQueryResult:p,compareToTraceQueryResult:g}),(0,R.Y)(_.S,{size:"lg"})]})};var Gs={name:"ujpwkd",styles:"display:flex;position:relative;overflow:scroll"},Ws={name:"1tc6xju",styles:"flex:1;overflow:auto"};const Qs=({experimentId:e,evaluation:t,otherEvaluation:n,className:s,runUuid:o,isReadOnly:a=!1,selectNextEval:i,isNextAvailable:r,runDisplayName:l,compareToRunDisplayName:d,exportToEvalsInstanceEnabled:c=!1,assessmentInfos:u,traceQueryResult:p,compareToTraceQueryResult:g,saveAssessmentsQuery:v})=>{const{theme:f}=(0,E.u)(),h=(0,m.useCallback)((async(e,t)=>{if(!e||a||!o||!v)return;const n=t.slice();if((0,I.ik)(e,t)){const t=(0,I.YZ)(e);t&&n.unshift(t)}return v.savePendingAssessments(o,e.evaluationId,n)}),[o,a,v]),y=(0,m.useRef)(null);return(0,m.useEffect)((()=>{var e;null===(e=y.current)||void 0===e||e.scrollTo(0,0)}),[t.evaluationId]),(0,R.FD)("div",{css:Gs,className:s,children:[(0,R.Y)("div",{css:Ws,ref:y,children:(0,R.Y)(Ks,{experimentId:e,evaluationResult:t,otherEvaluationResult:n,onSavePendingAssessments:h,onClickNext:i,isNextAvailable:r,isReadOnly:a||!o,runDisplayName:l,compareToRunDisplayName:d,exportToEvalsInstanceEnabled:c,assessmentInfos:u,traceQueryResult:p,compareToTraceQueryResult:g},t.evaluationId)}),(null===v||void 0===v?void 0:v.isSaving)&&(0,R.Y)("div",{css:(0,A.AH)({inset:0,position:"absolute",backgroundColor:f.colors.overlayOverlay,display:"flex",justifyContent:"center",alignItems:"center",zIndex:f.options.zIndexBase+1},""),children:(0,R.Y)(E.S,{size:"large",inheritColor:!0,css:(0,A.AH)({color:f.colors.backgroundPrimary},"")})})]})},Zs=()=>{var e;return{enableRunEvaluationWriteFeatures:null!==(e=(0,D.UK)())&&void 0!==e&&e}},Js=(0,m.createContext)(Zs()),Xs=({config:e={},children:t})=>{const n=Zs(),o=(0,s.merge)({},n,e);return(0,R.Y)(Js.Provider,{value:o,children:t})};function eo(e,t,n=!1){const o=(0,m.useMemo)((()=>{var e;if(t)return(0,O.gD)(t)?t.trace_id:null!==(e=t.request_id)&&void 0!==e?e:""}),[t]),a=(0,m.useCallback)((t=>!e||(0,s.isNil)(o)?Promise.resolve(void 0):e(o,t)),[e,o]);return(0,oe.I)({queryKey:["getTrace",o],queryFn:()=>a(t),enabled:!(0,s.isNil)(e)&&!(0,s.isNil)(o),staleTime:1/0,refetchOnWindowFocus:!1,retry:1,keepPreviousData:!0,refetchInterval:!!n&&(e=>{var t,n,s,o;const a=e&&(0,O.gD)(e.info)?e.info:void 0;if(!a||"IN_PROGRESS"===a.state)return 1e3;const i=null===(t=a.trace_metadata)||void 0===t?void 0:t["mlflow.trace.sizeStats"];if(!i)return!1;return JSON.parse(i).num_spans!==(null!==(n=null===e||void 0===e||null===(s=e.data)||void 0===s||null===(o=s.spans)||void 0===o?void 0:o.length)&&void 0!==n?n:0)&&1e3})})}var to={name:"inxa61",styles:"flex:1;overflow:hidden"};const no=m.memo((({experimentId:e,runUuid:t,evaluations:n,selectedEvaluationId:o,onChangeEvaluationId:a,runDisplayName:i,otherRunDisplayName:r,exportToEvalsInstanceEnabled:l=!1,assessmentInfos:d,getTrace:c,saveAssessmentsQuery:u})=>{var p,g,v,f,h,y;const{theme:b,classNamePrefix:w}=(0,E.u)(),S=(0,m.useCallback)((()=>{a(void 0)}),[a]),I=(0,m.useCallback)((e=>{var t,n;return(null===(t=e.currentRunValue)||void 0===t?void 0:t.evaluationId)===o||(null===(n=e.otherRunValue)||void 0===n?void 0:n.evaluationId)===o}),[o]),x=(0,m.useMemo)((()=>n?(null===n||void 0===n?void 0:n.findIndex(I))-1:void 0),[n,I]),T=(0,m.useMemo)((()=>void 0!==x&&x>=0),[x]),N=(0,m.useMemo)((()=>n?(null===n||void 0===n?void 0:n.findIndex(I))+1:void 0),[n,I]),Y=(0,m.useMemo)((()=>void 0!==N&&N<n.length),[N,n]),M=(0,m.useCallback)((()=>{var e,t,s,o;if(null===n||void 0===x)return;const i=(null===(e=n[x])||void 0===e||null===(t=e.currentRunValue)||void 0===t?void 0:t.evaluationId)||(null===(s=n[x])||void 0===s||null===(o=s.otherRunValue)||void 0===o?void 0:o.evaluationId);a(i)}),[n,x,a]),k=(0,m.useCallback)((()=>{var e,t,s,o;if(null===n||void 0===N)return;const i=(null===(e=n[N])||void 0===e||null===(t=e.currentRunValue)||void 0===t?void 0:t.evaluationId)||(null===(s=n[N])||void 0===s||null===(o=s.otherRunValue)||void 0===o?void 0:o.evaluationId);a(i)}),[n,N,a]),D=(0,m.useMemo)((()=>null===n||void 0===n?void 0:n.find(I)),[n,I]),O=(0,m.useMemo)((()=>N&&n?null===n||void 0===n?void 0:n[N]:void 0),[n,N]),V=(0,m.useMemo)((()=>x&&n?null===n||void 0===n?void 0:n[x]:void 0),[n,x]),L=(0,m.useContext)(Js)||Zs(),H=(0,F.ZZ)(null===D||void 0===D||null===(p=D.currentRunValue)||void 0===p?void 0:p.traceInfo)===F.Cf,U=eo(c,null===D||void 0===D||null===(g=D.currentRunValue)||void 0===g?void 0:g.traceInfo,H),$=eo(c,null===D||void 0===D||null===(v=D.otherRunValue)||void 0===v?void 0:v.traceInfo,H);eo(c,null===O||void 0===O||null===(f=O.currentRunValue)||void 0===f?void 0:f.traceInfo),eo(c,null===V||void 0===V||null===(h=V.currentRunValue)||void 0===h?void 0:h.traceInfo);const z=Boolean(null===D||void 0===D?void 0:D.currentRunValue)!==Boolean(null===D||void 0===D?void 0:D.otherRunValue),B=o===(null===D||void 0===D||null===(y=D.currentRunValue)||void 0===y?void 0:y.evaluationId)?U:$;return(0,s.isNil)(D)?(0,R.Y)(R.FK,{}):(0,R.FD)("div",{onKeyDown:e=>{"ArrowLeft"===e.key?M():"ArrowRight"===e.key&&k()},children:[(0,R.FD)(_.d,{componentId:"mlflow.evaluations_review.modal",visible:!0,title:D.currentRunValue?(0,R.Y)(qs,{evaluationResult:D.currentRunValue}):D.otherRunValue?(0,R.Y)(qs,{evaluationResult:D.otherRunValue}):null,onCancel:S,size:"wide",verticalSizing:"maxed_out",css:(0,A.AH)({width:"100% !important",padding:"0 4rem !important",[`& .${w}-modal-body`]:{flex:1,paddingTop:0},[`& .${w}-modal-header`]:{paddingBottom:b.spacing.sm}},""),footer:null,children:[!(null!==B&&void 0!==B&&B.data)&&(null===B||void 0===B?void 0:B.isFetching)&&(0,R.Y)(C.GenericSkeleton,{label:"Loading trace...",style:{width:"calc(100% - 45px)",height:"calc(100% - 100px)",position:"absolute",paddingRight:500,zIndex:2100,backgroundColor:b.colors.backgroundPrimary}}),z&&!(0,s.isNil)(null===B||void 0===B?void 0:B.data)?(0,R.Y)("div",{css:(0,A.AH)({height:"100%",marginLeft:-b.spacing.lg,marginRight:-b.spacing.lg},""),children:(0,R.Y)(so,{traceData:B.data})}):D.currentRunValue&&(0,R.Y)(Qs,{experimentId:e,evaluation:D.currentRunValue,otherEvaluation:D.otherRunValue,selectNextEval:k,isNextAvailable:Y,css:to,runUuid:t,isReadOnly:!L.enableRunEvaluationWriteFeatures,runDisplayName:i,compareToRunDisplayName:r,exportToEvalsInstanceEnabled:l,assessmentInfos:d,traceQueryResult:U,compareToTraceQueryResult:$,saveAssessmentsQuery:u})]}),(0,R.Y)("div",{css:(0,A.AH)({display:"flex",justifyContent:"flex-end",position:"fixed",top:"50%",left:0,zIndex:2e3,opacity:".75",width:"5rem","&:hover":{opacity:"1.0"}},""),children:(0,R.Y)("div",{css:(0,A.AH)({backgroundColor:b.colors.backgroundPrimary,borderRadius:b.legacyBorders.borderRadiusMd,marginRight:b.spacing.sm},""),children:(0,R.Y)(E.B,{disabled:!T,componentId:"mlflow.evaluations_review.modal.previous_eval",icon:(0,R.Y)(E.n,{}),onClick:()=>M()})})}),(0,R.Y)("div",{css:(0,A.AH)({display:"flex",justifyContent:"flex-start",position:"fixed",top:"50%",right:0,zIndex:2e3,width:"5rem",opacity:".75","&:hover":{opacity:"1.0"}},""),children:(0,R.Y)("div",{css:(0,A.AH)({backgroundColor:b.colors.backgroundPrimary,borderRadius:b.legacyBorders.borderRadiusMd,marginLeft:b.spacing.sm},""),children:(0,R.Y)(E.B,{disabled:!Y,componentId:"mlflow.evaluations_review.modal.next_eval",icon:(0,R.Y)(E.o,{}),onClick:()=>k()})})})]})})),so=({traceData:e})=>(0,R.Y)(O.a8,{modelTrace:e}),oo=m.memo((({experimentId:e,selectedColumns:t,evaluations:n,selectedEvaluationId:o,selectedAssessmentInfos:a,assessmentInfos:i,assessmentFilters:r,tableSort:l,onChangeEvaluationId:d,getRunColor:c,runUuid:u,runDisplayName:p,compareToRunUuid:g,compareToRunDisplayName:v,rowSelection:f,setRowSelection:h,exportToEvalsInstanceEnabled:y=!1,getTrace:b,toggleAssessmentFilter:w,saveAssessmentsQuery:S,disableAssessmentTooltips:I,onTraceTagsEdit:x,enableRowSelection:_,enableGrouping:M=!1,allColumns:k,displayLoadingOverlay:D})=>{const O=(0,N.tz)(),{theme:V}=(0,E.u)(),[L,H]=(0,m.useState)(!1),U=!(0,s.isNil)(g),$=t.filter((e=>e.type===B.$6.INPUT)),{columns:j}=(0,m.useMemo)((()=>{if(!M){const n=t.map((t=>Tn(t,{evaluationInputs:$,isComparing:U,theme:V,intl:O,experimentId:e,onChangeEvaluationId:d,onTraceTagsEdit:x})));return{columns:Z(n,t)}}const n=new Map;Q(t,U).forEach((t=>{const s=t.group||B.w8.INFO;n.has(s)||n.set(s,[]),(n.get(s)||[]).push(Tn(t,{evaluationInputs:$,isComparing:U,theme:V,intl:O,experimentId:e,onChangeEvaluationId:d,onTraceTagsEdit:x}))}));const s=Array.from(n.entries()).map((([e,t])=>({header:ss,meta:{groupId:e,visibleCount:t.length,totalCount:k.filter((t=>t.group===e)).length,enableGrouping:M},id:`${e}-group`,columns:t})));return{columns:s}}),[t,$,U,d,V,O,e,x,M,k]),{setTable:P,setSelectedRowIds:q}=m.useContext(Y),K=(0,se.L)("js/packages/web-shared/src/genai-traces-table/GenAiTracesTableBody.tsx",{data:n,columns:j,getCoreRowModel:(0,te.HT)(),getSortedRowModel:(0,te.h5)(),enableColumnResizing:!0,columnResizeMode:"onChange",enableRowSelection:_,enableMultiSort:!0,state:{rowSelection:f},meta:{getRunColor:c},onRowSelectionChange:h,getRowId:e=>(0,F.On)(e.currentRunValue)}),G=void 0!==f&&K.getIsAllRowsSelected(),W=K.getIsSomeRowsSelected();(0,m.useEffect)((()=>(P(K),()=>P(void 0))),[K,P]),(0,m.useEffect)((()=>{_&&q(K.getSelectedRowModel().rows.map((e=>e.id)))}),[K,f,q,_]);const J=O.formatMessage({id:"+mAXPc",defaultMessage:"No traces found. Try clearing your active filters to see more traces."}),X=(0,R.Y)(C.Empty,{description:J,image:(0,R.Y)(T.S,{})});(0,m.useEffect)((()=>{l&&!z.Al.includes(l.key)?l.key===z.yX?K.setSorting([{id:l.key,desc:!l.asc},{id:z.Te,desc:!1}]):K.setSorting([{id:l.key,desc:!l.asc}]):K.setSorting([])}),[l,K]);const{rows:ee}=K.getRowModel(),oe=m.useRef(null),ae=(0,ne.Te)({count:ee.length,estimateSize:()=>120,getScrollElement:()=>oe.current,measureElement:"undefined"!==typeof window&&-1===navigator.userAgent.indexOf("Firefox")?e=>null===e||void 0===e?void 0:e.getBoundingClientRect().height:void 0,overscan:10}),ie=ae.getVirtualItems(),re=K.getHeaderGroups(),{columnSizeVars:le,tableWidth:de}=(0,m.useMemo)((()=>{const e={};re.forEach((t=>{t.headers.forEach((t=>{e[`--header-${xt(t.column.id)}-size`]=t.getSize()+"px"}))}));let t=0;if(ee.length>0){ee[0].getVisibleCells().forEach((n=>{e[`--col-${xt(n.column.id)}-size`]=n.column.getSize()+"px",t+=n.column.getSize()}))}return{columnSizeVars:e,tableWidth:t+"px"}}),[re,ee]),ce=(0,m.useMemo)((()=>{const e={};for(const t of a)e[t.name]=pt(t,n,r);return e}),[a,n,r]);return(0,R.FD)(R.FK,{children:[(0,R.Y)("div",{className:"container",ref:oe,css:(0,A.AH)({height:"100%",position:"relative",overflowY:"auto",overflowX:"auto",minWidth:"100%",width:de},""),children:(0,R.FD)(C.Table,{css:(0,A.AH)({width:"100%",...le},""),empty:0===K.getRowModel().rows.length?X:void 0,someRowsSelected:_?W||G:void 0,children:[(0,R.Y)(ns,{headerGroups:K.getHeaderGroups(),enableRowSelection:_,enableGrouping:M,selectedAssessmentInfos:a,assessmentNameToAggregates:ce,assessmentFilters:r,toggleAssessmentFilter:w,runDisplayName:p,compareToRunUuid:g,compareToRunDisplayName:v,disableAssessmentTooltips:I,collapsedHeader:L,setCollapsedHeader:H,isComparing:U,allRowSelected:G,someRowSelected:W,toggleAllRowsSelectedHandler:K.getToggleAllRowsSelectedHandler,setColumnSizing:K.setColumnSizing}),(0,R.Y)(Rn,{rows:ee,isComparing:U,enableRowSelection:_,virtualItems:ie,virtualizerTotalSize:ae.getTotalSize(),virtualizerMeasureElement:ae.measureElement,rowSelectionState:f,selectedColumns:t})]})}),D&&(0,R.Y)("div",{css:(0,A.AH)({position:"absolute",inset:0,backgroundColor:V.colors.backgroundPrimary,opacity:.75,pointerEvents:"none",display:"flex",justifyContent:"center",alignItems:"center"},""),children:(0,R.Y)(E.S,{size:"large"})}),o&&(0,R.Y)(no,{experimentId:e,runUuid:u,runDisplayName:p,otherRunDisplayName:v,evaluations:ee.map((e=>e.original)),selectedEvaluationId:o,onChangeEvaluationId:d,exportToEvalsInstanceEnabled:y,assessmentInfos:i,getTrace:b,saveAssessmentsQuery:S})]})}));function ao({searchQuery:e,setSearchQuery:t,placeholder:n}){const s=(0,N.tz)(),[o,a]=(0,m.useState)(e);return(0,m.useEffect)((()=>{a(e)}),[e]),(0,m.useEffect)((()=>{const e=setTimeout((()=>{t(o)}),400);return()=>clearTimeout(e)}),[o,t]),(0,R.Y)(C.TableFilterInput,{componentId:"mlflow.evaluations_review.table_ui.filter_input",placeholder:null!==n&&void 0!==n?n:s.formatMessage({id:"zNWzj6",defaultMessage:"Search traces by request"}),value:o,onChange:e=>a(e.target.value)})}const io=({columns:e,selectedColumns:t,setSelectedColumns:n,setSelectedColumnsWithHiddenColumns:s})=>{const o=(0,N.tz)(),{theme:a}=(0,E.u)();return(0,R.FD)(C.DialogCombobox,{componentId:"mlflow.evaluations_overview.column_selector_dropdown",label:"Columns",multiSelect:!0,children:[(0,R.Y)(C.DialogComboboxCustomButtonTriggerWrapper,{children:(0,R.Y)(E.B,{endIcon:(0,R.Y)(C.ChevronDownIcon,{}),componentId:"mlflow.evaluations_review.table_ui.filter_button",children:(0,R.FD)("div",{css:(0,A.AH)({display:"flex",gap:a.spacing.sm,alignItems:"center"},""),children:[(0,R.Y)(C.ColumnsIcon,{}),o.formatMessage({id:"wjOGl2",defaultMessage:"Columns"})]})})}),(0,R.Y)(C.DialogComboboxContent,{children:(0,R.Y)(C.DialogComboboxOptionList,{children:e.map((e=>(0,R.Y)(C.DialogComboboxOptionListCheckboxItem,{value:e.label,checked:t.some((t=>t.id===e.id)),onChange:()=>(e=>{if(s)return s([e]);n&&n((t=>t.some((t=>t.id===e.id))?t.filter((t=>t.id!==e.id)):[...t,e]))})(e)},e.id)))})})]})};var ro={name:"9q39xd",styles:"min-width:32px"};const lo=m.memo((({tableSort:e,columns:t=[],onChange:n,enableGrouping:s,isMetadataLoading:o,metadataError:a})=>{const i=(0,N.tz)(),{theme:r}=(0,E.u)(),[l,d]=(0,m.useState)(!1),c=(0,m.useMemo)((()=>{const e=[],n=i.formatMessage({id:"Kkuttk",defaultMessage:"Assessment"});if(s){const n=Q(t);for(const t of n)if(t.type===B.$6.ASSESSMENT){const n=t.assessmentInfo.displayName;e.push({label:n,key:t.id,type:B.$6.ASSESSMENT,group:B.w8.ASSESSMENT})}else if(t.type===B.$6.INPUT)e.push({label:t.label,key:t.id,type:B.$6.INPUT,group:B.w8.INFO});else if(t.type===B.$6.TRACE_INFO){const n=t.id===z.yX?i.formatMessage({id:"mrGpVQ",defaultMessage:"Session time"}):t.label;z.My.includes(t.id)&&e.push({label:n,key:t.id,type:B.$6.TRACE_INFO,group:B.w8.INFO})}return e}for(const s of t.filter((e=>e.type===B.$6.ASSESSMENT))){const t=s.assessmentInfo.displayName;e.push({label:`${n} \ufe65 ${t}`,key:s.id,type:B.$6.ASSESSMENT})}const o=i.formatMessage({id:"2plDKs",defaultMessage:"Input"});for(const s of t.filter((e=>e.type===B.$6.INPUT)))e.push({label:`${o} \ufe65 ${s.label}`,key:s.id,type:B.$6.INPUT});for(const s of t.filter((e=>(e.type===B.$6.TRACE_INFO||e.type===B.$6.INTERNAL_MONITOR_REQUEST_TIME)&&z.My.includes(e.id))))e.push({label:s.label,key:s.id,type:B.$6.TRACE_INFO});return e}),[t,i,s]),u=(0,m.useMemo)((()=>{const t=c.find((t=>t.key===(null===e||void 0===e?void 0:e.key)));let n=null===t||void 0===t?void 0:t.label;if(!n){var s;const t=null===e||void 0===e||null===(s=e.key)||void 0===s?void 0:s.match(/^.+\.`(.+)`$/);t&&(n=t[1])}const o=i.formatMessage({id:"sKaamx",defaultMessage:"Sort"});return n?`${o}: ${n}`:o}),[c,i,e]);return(0,R.FD)(C.DropdownMenu.Root,{open:l,onOpenChange:d,modal:!1,children:[(0,R.Y)(C.DropdownMenu.Trigger,{"data-testid":"sort-select-dropdown",asChild:!0,children:(0,R.Y)(E.B,{componentId:"mlflow.experiment_page.sort_select_v2.toggle",icon:e?e.asc?(0,R.Y)(C.SortAscendingIcon,{}):(0,R.Y)(C.SortDescendingIcon,{}):(0,R.Y)(C.SortUnsortedIcon,{}),css:ro,"aria-label":u,endIcon:(0,R.Y)(C.ChevronDownIcon,{}),children:u})}),(0,R.Y)(C.DropdownMenu.Content,{minWidth:250,children:a?(0,R.FD)("div",{css:(0,A.AH)({display:"flex",alignItems:"center",justifyContent:"center",gap:r.spacing.xs,padding:`${r.spacing.md}px`,color:r.colors.textValidationDanger},""),"data-testid":"filter-dropdown-error",children:[(0,R.Y)(E.k,{}),(0,R.Y)(N.sA,{id:"dJaboT",defaultMessage:"Fetching traces failed"})]}):o?(0,R.Y)("div",{css:(0,A.AH)({display:"flex",alignItems:"center",justifyContent:"center",gap:r.spacing.xs,padding:`${r.spacing.lg}px`,color:r.colors.textSecondary},""),"data-testid":"sort-dropdown-loading",children:(0,R.Y)(E.S,{size:"small"})}):s?(0,R.Y)(uo,{sortOptions:c,tableSort:e,onOptionSelected:(e,t)=>{n(e,t),d(!1)}}):(0,R.Y)(go,{sortOptions:c,tableSort:e,onOptionSelected:(e,t)=>{n(e,t),d(!1)}})})]})}));var co={name:"1j5vobt",styles:"display:flex;align-items:center;gap:4px"};const uo=({sortOptions:e,tableSort:t,onOptionSelected:n})=>{const{theme:s}=(0,E.u)(),o=(0,m.useRef)(null),a=(0,m.useRef)(null),[i,r]=(0,m.useState)(""),l=(0,m.useMemo)((()=>e.filter((e=>e.label.toLowerCase().includes(i.toLowerCase())))),[e,i]),d=(0,m.useMemo)((()=>{const e={};return l.forEach((t=>{var n;const s=null!==(n=t.group)&&void 0!==n?n:B.w8.INFO;e[s]||(e[s]=[]),e[s].push(t)})),e}),[l]),c=(0,m.useCallback)((s=>{var o;const a=e.find((e=>e.key===s));a&&n(a,null===(o=null===t||void 0===t?void 0:t.asc)||void 0===o||o)}),[n,e,null===t||void 0===t?void 0:t.asc]),u=(0,m.useCallback)((s=>{var o;const a=null!==(o=e.find((e=>e.key===(null===t||void 0===t?void 0:t.key))))&&void 0!==o?o:e[0];n(a,s)}),[n,e,null===t||void 0===t?void 0:t.key]);return(0,m.useEffect)((()=>{requestAnimationFrame((()=>{var e;return null===(e=o.current)||void 0===e?void 0:e.focus()}))}),[]),(0,R.FD)(R.FK,{children:[(0,R.FD)("div",{css:(0,A.AH)({padding:`${s.spacing.sm}px ${s.spacing.lg/2}px`,display:"flex",gap:s.spacing.xs},""),children:[(0,R.Y)(T.I,{ref:o,componentId:"mlflow.genai_traces_table.sort_dropdown.search",prefix:(0,R.Y)(T.S,{}),placeholder:"Search",value:i,onChange:e=>r(e.target.value),type:"search",onKeyDown:e=>{var t;"ArrowDown"!==e.key&&"Tab"!==e.key||(null===(t=a.current)||void 0===t||t.focus(),e.preventDefault())}}),(0,R.FD)("div",{css:(0,A.AH)({display:"flex",gap:s.spacing.xs},""),children:[(0,R.Y)(C.ToggleButton,{pressed:!1===(null===t||void 0===t?void 0:t.asc),icon:(0,R.Y)(C.ArrowDownIcon,{}),componentId:"mlflow.genai_traces_table.sort_dropdown.sort_desc",onClick:()=>u(!1),"aria-label":"Sort descending"}),(0,R.Y)(C.ToggleButton,{pressed:!0===(null===t||void 0===t?void 0:t.asc),icon:(0,R.Y)(C.ArrowUpIcon,{}),componentId:"mlflow.experiment_page.sort_dropdown.sort_asc",onClick:()=>u(!0),"aria-label":"Sort ascending"})]})]}),(0,R.FD)("div",{css:(0,A.AH)({maxHeight:400,overflowY:"auto",padding:`0 ${s.spacing.sm}px`},""),children:[Object.entries(d).map((([e,n],s)=>(0,R.Y)(m.Fragment,{children:(0,R.FD)(C.DropdownMenu.Group,{children:[(0,R.Y)(C.DropdownMenu.Label,{children:e===B.w8.INFO?"Attributes":B.RF[e]}),n.map(((e,n)=>(0,R.FD)(C.DropdownMenu.CheckboxItem,{componentId:"mlflow.genai_traces_table.sort_dropdown.sort_option",checked:e.key===(null===t||void 0===t?void 0:t.key),onClick:()=>c(e.key),ref:0===s&&0===n?a:void 0,"data-testid":`sort-select-${e.label}`,children:[(0,R.Y)(C.DropdownMenu.ItemIndicator,{}),(0,R.Y)("span",{css:co,children:e.label})]},e.key)))]})},e))),0===l.length&&(0,R.Y)(C.DropdownMenu.Item,{disabled:!0,componentId:"mlflow.genai_traces_table.sort_dropdown.no_results",children:(0,R.Y)(N.sA,{id:"WpNCQl",defaultMessage:"No results"})})]})]})};var mo={name:"1kxd8xu",styles:"max-height:400px;overflow-y:auto"},po={name:"1j5vobt",styles:"display:flex;align-items:center;gap:4px"};const go=({sortOptions:e,tableSort:t,onOptionSelected:n})=>{const{theme:s}=(0,E.u)(),o=(0,m.useRef)(null),[a,i]=(0,m.useState)(""),r=(0,m.useRef)(null),l=(0,m.useMemo)((()=>e.filter((e=>e.label.toLowerCase().includes(a.toLowerCase())))),[e,a]),d=(0,m.useCallback)((s=>{const o=e.find((e=>e.key===s));n(o,(null===t||void 0===t?void 0:t.asc)||!0)}),[n,t,e]),c=(0,m.useCallback)((s=>{const o=e.find((e=>e.key===(null===t||void 0===t?void 0:t.key)));n(o||e[0],s)}),[n,e,t]);return(0,m.useEffect)((()=>{requestAnimationFrame((()=>{var e;null===(e=o.current)||void 0===e||e.focus()}))}),[]),(0,R.FD)(R.FK,{children:[(0,R.FD)("div",{css:(0,A.AH)({padding:`${s.spacing.sm}px ${s.spacing.lg/2}px ${s.spacing.sm}px`,width:"100%",display:"flex",gap:s.spacing.xs},""),children:[(0,R.Y)(T.I,{componentId:"mlflow.experiment_page.sort_dropdown.search",prefix:(0,R.Y)(T.S,{}),value:a,type:"search",onChange:e=>i(e.target.value),placeholder:"Search",autoFocus:!0,ref:o,onKeyDown:e=>{var t;"ArrowDown"!==e.key&&"Tab"!==e.key?e.stopPropagation():null===(t=r.current)||void 0===t||t.focus()}}),(0,R.FD)("div",{css:(0,A.AH)({display:"flex",gap:s.spacing.xs},""),children:[(0,R.Y)(C.ToggleButton,{pressed:!1===(null===t||void 0===t?void 0:t.asc),icon:(0,R.Y)(C.ArrowDownIcon,{}),componentId:"mlflow.experiment_page.sort_dropdown.sort_desc",onClick:()=>c(!1),"aria-label":"Sort descending","data-testid":"sort-select-desc"}),(0,R.Y)(C.ToggleButton,{pressed:!0===(null===t||void 0===t?void 0:t.asc),icon:(0,R.Y)(C.ArrowUpIcon,{}),componentId:"mlflow.experiment_page.sort_dropdown.sort_asc",onClick:()=>c(!0),"aria-label":"Sort ascending","data-testid":"sort-select-asc"})]})]}),(0,R.FD)(C.DropdownMenu.Group,{css:mo,children:[l.map(((e,n)=>(0,R.FD)(C.DropdownMenu.CheckboxItem,{componentId:"mlflow.experiment_page.sort_dropdown.sort_option",onClick:()=>d(e.key),checked:e.key===(null===t||void 0===t?void 0:t.key),"data-testid":`sort-select-${e.label}`,ref:0===n?r:void 0,children:[(0,R.Y)(C.DropdownMenu.ItemIndicator,{}),(0,R.Y)("span",{css:po,children:e.label})]},e.key))),!l.length&&(0,R.Y)(C.DropdownMenu.Item,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunssortselectorv2.tsx_151",disabled:!0,children:(0,R.Y)(N.sA,{id:"EkUD0b",defaultMessage:"No results"})})]})]})},vo=({backgroundColor:e,icon:t,children:n})=>{const{theme:s}=(0,E.u)();return(0,R.FD)("div",{css:(0,A.AH)({display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",padding:"4px 8px",gap:s.spacing.xs,borderRadius:s.borders.borderRadiusMd,color:s.colors.textSecondary,backgroundColor:e||s.colors.backgroundSecondary,fontSize:s.typography.fontSizeSm},""),children:[t||null,n?(0,R.Y)("span",{children:n}):null]})},fo="selectedEvaluationId",ho=()=>{var e;const[t,n]=f(),s=null!==(e=t.get(fo))&&void 0!==e?e:void 0,o=(0,m.useCallback)((e=>{n((t=>void 0===e?(t.delete(fo),t):(t.set(fo,e),t)))}),[n]);return[s,o]},yo="searchQuery";function bo(e,t,n,o,a){return e.filter((e=>function(e,t,n,s){const o=null===e||void 0===e?void 0:e.currentRunValue,a=null===e||void 0===e?void 0:e.otherRunValue;let i=!0;for(const u of t){var r,l;const e=u.assessmentName,t=u.filterValue,m=u.run,p=m===n?o:m===s?a:void 0;if(void 0===p)continue;const g=e===I._1.OVERALL_ASSESSMENT?null!==(r=p.overallAssessments)&&void 0!==r?r:[]:null!==(l=p.responseAssessmentsByName[e])&&void 0!==l?l:[];if("rca"===u.filterType){var d,c;const t=(null===p||void 0===p||null===(d=p.overallAssessments[0])||void 0===d||null===(c=d.rootCauseAssessment)||void 0===c?void 0:c.assessmentName)===e;i=i&&t}else{const e=void 0===t?0===g.length:t===st?g.some((e=>Boolean(e.errorMessage))):g.some((e=>{var n;return(null!==(n=(0,I.Zh)(e))&&void 0!==n?n:void 0)===t}));i=i&&e}}return i}(e,t,o,a))).filter((e=>{var t,o;if((0,s.isNil)(n)||""===n)return!0;const a=n.toLowerCase(),i=JSON.stringify(null===(t=e.currentRunValue)||void 0===t?void 0:t.inputs).toLowerCase().includes(a),r=(null===(o=e.currentRunValue)||void 0===o?void 0:o.inputsId.toLowerCase())===a;return i||r}))}var wo={name:"1ykowef",styles:"margin-bottom:0"},So={name:"f3vz0n",styles:"font-weight:500"},Io={name:"969shj",styles:"display:flex;flex:1;overflow-y:hidden;position:relative"};const xo=e=>{const{totalRowCount:t,sampledInfo:n}=e,o=(0,N.tz)();return n?n.maxAllowedCount?t>=n.maxAllowedCount?(0,R.Y)(_.T,{componentId:"mlflow.experiment_list_view.max_traces.tooltip",content:o.formatMessage({id:"BpAyCF",defaultMessage:"Only the top {evalResultsCount} results are shown"},{evalResultsCount:t}),children:(0,R.Y)(E.W,{color:"warning"})}):null:n.logCountLoading||(0,s.isNil)(n.sampledCount)||(0,s.isNil)(n.totalCount)?(0,R.Y)(E.S,{}):(0,R.Y)(vo,{children:(0,R.FD)(_.T,{componentId:"mlflow.experiment_list_view.sampled_badge.tooltip",content:o.formatMessage({id:"TannO5",defaultMessage:"Retrieved {sampledCount} out of {totalCount} total logs ({percentage}%)"},{sampledCount:n.sampledCount,totalCount:n.totalCount,percentage:bt(n.sampledCount/n.totalCount)}),children:["Sampled ",bt(n.sampledCount/n.totalCount),"%"]})}):null},Ao="__any_value__";var Eo={name:"1fttcpj",styles:"display:flex;flex-direction:column"};const Co=m.memo((({assessmentName:e,assessmentInfo:t,assessmentLabel:n,assessmentFilter:s,updateAssessmentFilter:o,removeAssessmentFilter:a,run:i})=>{const r=(0,N.tz)(),{theme:l}=(0,E.u)(),d=s?S(s.filterValue):Ao;return(0,R.Y)("div",{css:Eo,children:(0,R.FD)(C.SegmentedControlGroup,{name:"size-story",value:d,onChange:n=>{if(n.target.value===Ao)return void a(e,i);const s=w(t,n.target.value);o(e,s,i)},size:"middle",componentId:"mlflow.evaluations_review.table_ui.filter_control",children:[(0,R.Y)(C.SegmentedControlButton,{value:Ao,children:(0,R.Y)("div",{css:(0,A.AH)({display:"flex",gap:l.spacing.sm,alignItems:"center",color:l.colors.textPrimary},""),children:r.formatMessage({id:"Hq/vjk",defaultMessage:"All"})})}),Array.from(t.uniqueValues.values()).map((e=>{const{content:n,icon:s}=(0,I.uU)(r,l,t,e);return(0,R.Y)(C.SegmentedControlButton,{value:S(e),children:(0,R.FD)("div",{css:(0,A.AH)({display:"flex",gap:l.spacing.sm,alignItems:"center",color:l.colors.textPrimary},""),children:[n,s]})},S(e))}))]})})})),To=function({experimentId:e,currentEvaluationResults:t,compareToEvaluationResults:n,currentRunDisplayName:s,runUuid:o,compareToRunUuid:a,compareToRunDisplayName:i,compareToRunLoading:r,sampledInfo:l,exportToEvalsInstanceEnabled:d=!1,getTrace:c,saveAssessmentsQuery:u,enableRunEvaluationWriteFeatures:p,defaultSortOption:g,disableAssessmentTooltips:v,onTraceTagsEdit:h,traceActions:b,initialSelectedColumns:x}){const{theme:_}=(0,E.u)(),Y=(0,N.tz)(),M=(0,F.Co)(t),k=(0,F.Co)(n||[]),D=Object.keys(null!==b&&void 0!==b?b:{}).length>0,[O,V]=ho(),L=(0,m.useMemo)((()=>ee(M,k)),[M,k]),[H,$]=(()=>{var e;const[t,n]=f();return[null!==(e=t.get(yo))&&void 0!==e?e:"",(0,m.useCallback)((e=>{n((t=>void 0===e||""===e?(t.delete(yo),t):(t.set(yo,e),t)))}),[n])]})(),j=(0,m.useMemo)((()=>rt(Y,M,k)),[Y,M,k]),P=(0,z.XS)(Y,M,j,o),[q,K]=(e=>{const[t,n]=f();return[(0,m.useMemo)((()=>{var n;return(null!==(n=t.getAll(y))&&void 0!==n?n:[]).reduce(((t,n)=>{const[s,o,a,i]=n.split("::"),r=null===e||void 0===e?void 0:e.find((e=>e.name===o));if(r){const e=w(r,a);t.push({run:s,assessmentName:o,filterValue:e,filterType:""===i?void 0:i})}return t}),[])}),[e,t]),(0,m.useCallback)(((e,t=!1)=>{n((t=>(t.delete(y),e&&e.forEach((e=>{t.append(y,[e.run,e.assessmentName,S(e.filterValue),e.filterType].join("::"))})),t)),{replace:t})}),[n])]})(P.map((e=>e.assessmentInfo)).filter((e=>void 0!==e))),G=(0,m.useMemo)((()=>""===H&&0===q.length?L:bo(L,q,H,s,i)),[L,H,q,s,i]),[W,Q]=(0,m.useState)(P),Z=(0,m.useMemo)((()=>lt(W.filter((e=>e.type===B.$6.ASSESSMENT)).map((e=>e.assessmentInfo)))),[W]),J=P.find((e=>e.type===B.$6.ASSESSMENT&&e.id===I._1.OVERALL_ASSESSMENT)),X=g||(J?{key:J.id,type:B.$6.ASSESSMENT,asc:!0}:void 0),[te,ne]=(0,m.useState)(X),se=(0,m.useCallback)(((e,t)=>q.find((n=>n.assessmentName===e&&n.run===t))),[q]),oe=(0,m.useCallback)(((e,t)=>{K(q.filter((n=>n.assessmentName!==e||n.run!==t)))}),[q,K]),ae=(0,m.useCallback)(((e,t,n,s)=>{const o=q.find((t=>t.assessmentName===e&&t.run===n));K(void 0===o?[...q,{assessmentName:e,filterValue:t,filterType:s,run:n}]:q.map((n=>n.assessmentName===e?{...n,filterValue:t,filterType:s}:n)))}),[q,K]),ie=(0,m.useCallback)(((e,t,n,s)=>{const o=q.find((t=>t.assessmentName===e&&t.run===n));void 0===o?K([...q,{assessmentName:e,filterValue:t,filterType:s,run:n}]):o.filterValue===t&&o.filterType===s?K(q.filter((t=>t.assessmentName!==e||t.run!==n))):K(q.map((o=>o.assessmentName===e&&o.run===n?{assessmentName:e,filterValue:t,filterType:s,run:n}:o)))}),[q,K]),re=(0,m.useCallback)((()=>{K([])}),[K]),le=q.length>0,[de,ce]=(0,m.useState)({}),ue=(0,m.useMemo)((()=>{const e=Object.keys(de).filter((e=>de[e]));return G.filter((t=>t.currentRunValue&&e.includes(t.currentRunValue.evaluationId))).map((e=>e.currentRunValue)).filter((e=>void 0!==e))}),[de,G]),me={enableRunEvaluationWriteFeatures:p},pe=M.length;return r?(0,R.Y)(C.LegacySkeleton,{}):(0,R.Y)(Xs,{config:me,children:(0,R.Y)("div",{css:(0,A.AH)({display:"flex",flexDirection:"row",gap:_.spacing.lg,overflow:"hidden",height:"100%"},""),children:(0,R.Y)("div",{css:(0,A.AH)({display:"flex",flexDirection:"column",gap:_.spacing.xs,overflow:"hidden",flexGrow:1},""),children:(0,R.FD)("div",{css:(0,A.AH)({display:"flex",flex:1,flexDirection:"column",gap:_.spacing.xs,overflow:"hidden"},""),children:[(0,R.FD)("div",{css:(0,A.AH)({display:"flex",width:"100%",alignItems:"flex-end",justifyContent:"space-between",padding:`${_.spacing.xs}px 0px`},""),children:[(0,R.FD)(C.TableFilterLayout,{css:wo,children:[(0,R.Y)(ao,{searchQuery:H,setSearchQuery:$}),(0,R.FD)(C.DialogCombobox,{componentId:"mlflow.genai_traces_table.filter_dropdown",label:"Filters",value:Array.from(q).map((e=>e.assessmentName)),multiSelect:!0,children:[(0,R.Y)(C.DialogComboboxCustomButtonTriggerWrapper,{children:(0,R.Y)(E.B,{endIcon:(0,R.Y)(C.ChevronDownIcon,{}),componentId:"mlflow.evaluations_review.table_ui.filter_button",css:(0,A.AH)({border:le?`1px solid ${_.colors.actionDefaultBorderFocus} !important`:"",backgroundColor:le?`${_.colors.actionDefaultBackgroundHover} !important`:""},""),children:(0,R.FD)("div",{css:(0,A.AH)({display:"flex",gap:_.spacing.sm,alignItems:"center"},""),children:[(0,R.Y)(C.FilterIcon,{}),Y.formatMessage({id:"J961B2",defaultMessage:"Filters{numFilters}"},{numFilters:le?` (${q.length})`:""}),q.length>0&&(0,R.Y)(T.X,{css:(0,A.AH)({fontSize:12,cursor:"pointer",color:_.colors.grey400,"&:hover":{color:_.colors.grey600}},""),onClick:e=>{re(),e.stopPropagation(),e.preventDefault()}})]})})}),(0,R.Y)(C.DialogComboboxContent,{children:(0,R.Y)("div",{css:(0,A.AH)({display:"flex",flexDirection:"column",padding:`${_.spacing.sm}px ${_.spacing.sm}px`,gap:_.spacing.md},""),children:Z.filter((e=>"numeric"!==e.dtype)).map((e=>(0,R.FD)("div",{css:(0,A.AH)({display:"flex",flexDirection:"column",gap:_.spacing.sm},""),children:[(0,R.Y)("div",{css:So,children:e.displayName}),s&&(0,R.Y)(Co,{assessmentLabel:e.displayName,assessmentName:e.name,assessmentInfo:e,assessmentFilter:se(e.name,s),updateAssessmentFilter:ae,removeAssessmentFilter:oe,run:s}),a&&i&&(0,R.FD)("div",{css:(0,A.AH)({display:"flex",flexDirection:"column",gap:_.spacing.xs},""),children:[(0,R.Y)(E.T.Hint,{children:i}),(0,R.Y)(Co,{assessmentLabel:e.displayName,assessmentName:e.name,assessmentInfo:e,assessmentFilter:se(e.name,i),updateAssessmentFilter:ae,removeAssessmentFilter:oe,run:i})]})]},e.name)))})})]}),(0,R.Y)(lo,{tableSort:te,columns:P,onChange:(e,t)=>{ne({key:e.key,type:e.type,asc:t})}}),(0,R.Y)(io,{columns:P,selectedColumns:W,setSelectedColumns:Q}),(0,R.Y)(U,{experimentId:e,selectedTraces:ue,setRowSelection:ce,traceActions:b,traceInfos:void 0})]}),(0,R.FD)("div",{css:(0,A.AH)({display:"flex",alignItems:"center",gap:_.spacing.sm},""),children:[(0,R.Y)(xo,{totalRowCount:pe,sampledInfo:l}),(0,R.Y)(E.T.Hint,{children:Y.formatMessage({id:"FnOQ44",defaultMessage:"{numFilteredEvals} of {numEvals}"},{numEvals:L.length,numFilteredEvals:G.length})})]})]}),(0,R.Y)("div",{css:(0,A.AH)({display:"flex",gap:_.spacing.md,width:"100%",flex:1,overflowY:"hidden"},""),children:(0,R.Y)("div",{css:Io,children:(0,R.Y)(oo,{experimentId:e,selectedColumns:W,allColumns:P,evaluations:G,selectedEvaluationId:O,selectedAssessmentInfos:Z,assessmentInfos:j,assessmentFilters:q,onChangeEvaluationId:V,tableSort:te,runUuid:o,compareToRunUuid:a,runDisplayName:s,compareToRunDisplayName:i,enableRowSelection:D,rowSelection:D?de:void 0,setRowSelection:D?ce:void 0,exportToEvalsInstanceEnabled:d,getTrace:c,toggleAssessmentFilter:ie,saveAssessmentsQuery:u,disableAssessmentTooltips:v,onTraceTagsEdit:h})})})]})})})})},_o=async({queryKey:[,{experimentId:e}]})=>ue("ajax-api/2.0/mlflow/runs/search","POST",{experiment_ids:[e]}),No=(e,t=!1)=>{var n;const{data:s,error:o,isLoading:a,isFetching:i}=(0,oe.I)((e=>["EXPERIMENT_RUNS_FOR_TRACE_COMPARISON",{experimentId:e}])(e),{queryFn:_o,enabled:!t,cacheTime:1/0,staleTime:1/0});return{requestError:o,isLoading:a,isFetching:i,runInfos:null===s||void 0===s||null===(n=s.runs)||void 0===n?void 0:n.map((e=>{var t,n;return{runUuid:null===(t=e.info)||void 0===t?void 0:t.run_uuid,runName:null===(n=e.info)||void 0===n?void 0:n.run_name}}))}};var Ro=n(60062);const Yo=(e,t)=>["GET_TRACE_EVALUATION_ARTIFACT",{runUuid:e,artifactFile:t}],Mo=async({queryKey:[,{runUuid:e,artifactFile:t}]})=>{const n=["ajax-api/2.0/mlflow/get-artifact",new URLSearchParams({run_uuid:e,path:t})].join("?");return ue(n,"GET").then((e=>({...e,filename:t})))},ko=[o.o8.Assessments,o.o8.Evaluations,o.o8.Metrics],Do=({runUuid:e,artifacts:t=ko},{disabled:n=!1}={})=>{const r=!n&&ko.some((e=>t.includes(e))),l=(0,Ro.E)({queries:ko.map((s=>({queryFn:Mo,queryKey:Yo(e,s),enabled:!n&&t.includes(s),refetchOnWindowFocus:!1})))}),u=l.some((e=>e.isLoading)),p=l.some((e=>e.isFetching)),g=l.find((e=>e.error)),[v,f,h]=l.map((e=>e.data)),y=(0,m.useMemo)((()=>c(v)),[v]),b=(0,m.useMemo)((()=>c(f)),[f]),w=(0,m.useMemo)((()=>c(h)),[h]),S=(0,m.useMemo)((()=>{if(b)return function(e,t,n){const r=(t||[]).reduce(((e,t)=>{e[t.evaluation_id]||(e[t.evaluation_id]={});const{key:n,value:s,timestamp:o}=t;return e[t.evaluation_id][n]={key:n,value:s,timestamp:o},e}),{}),l=(n||[]).reduce(((e,t)=>{var n,o,a,i;return e[t.evaluation_id]||(e[t.evaluation_id]=[]),e[t.evaluation_id].push({booleanValue:(0,s.isNil)(t.boolean_value)?t.boolean_value:Boolean(t.boolean_value),numericValue:(0,s.isNil)(t.numeric_value)?t.numeric_value:Number(t.numeric_value),stringValue:(0,s.isNil)(t.string_value)?t.string_value:String(t.string_value),metadata:t.metadata||{},...t.error_code&&{errorCode:t.error_code},...t.error_message&&{errorMessage:t.error_message},name:t.name,rationale:t.rationale||null,source:{metadata:null!==(n=null===(o=t.source)||void 0===o?void 0:o.metadata)&&void 0!==n?n:{},sourceId:null===(a=t.source)||void 0===a?void 0:a.source_id,sourceType:null===(i=t.source)||void 0===i?void 0:i.source_type},timestamp:t.timestamp}),e}),{});return e.map((e=>{var t,n;const c=(0,s.orderBy)(l[e.evaluation_id]||[],"timestamp","desc"),u=c.filter(a).map((e=>{var t,n,o,a;const i=null===(t=e.rationale)||void 0===t?void 0:t.match(/^\[(.*?)\](.*?)(?:\*\*Suggested Actions\*\*:(.*))?$/s),r=i?null===(n=i[1])||void 0===n?void 0:n.trim():void 0,l=i?null===(o=i[2])||void 0===o?void 0:o.trim():void 0,d=i?null===(a=i[3])||void 0===a?void 0:a.trim():void 0;return e.rationale=l||e.rationale,{...e,rootCauseAssessment:(0,s.isNil)(r)?void 0:{assessmentName:r,suggestedActions:d}}}));0===u.length&&u.push({name:o._1.OVERALL_ASSESSMENT,rationale:null,source:{sourceType:"AI_JUDGE",sourceId:"UNKNOWN",metadata:{}},metadata:{},numericValue:null,booleanValue:null,stringValue:null,timestamp:null});const m=c.filter(i),p=(0,s.difference)(c,u,m),g=(0,s.groupBy)(p,"name");return Object.keys(g).forEach((e=>{g[e]=(0,s.orderBy)(g[e],"timestamp","desc")})),{evaluationId:e.evaluation_id,requestId:e.request_id,inputs:e.inputs,inputsId:e.inputs_id,outputs:null!==(t=e.outputs)&&void 0!==t?t:{},targets:null!==(n=e.targets)&&void 0!==n?n:{},...e.error_code&&{errorCode:e.error_code},...e.error_message&&{errorMessage:e.error_message},overallAssessments:u,responseAssessmentsByName:g,metrics:r[e.evaluation_id]||{},retrievalChunks:d(e.outputs,e.targets,m)}}))}(b,w,y)}),[y,b,w]);return{requestError:g,isLoading:u&&r,isFetching:p&&r,data:S}},Fo="searchMlflowTraces",Oo=({queryClient:e})=>{e.invalidateQueries({queryKey:[Fo]})},Vo=({locations:e,runUuid:t,timeRange:n,otherRunUuid:s,filterByLoggedModelId:o,loggedModelId:a,sqlWarehouseId:i,disabled:r,networkFilters:l})=>{const d=(0,N.tz)(),c=$o(t,n,l,o),{data:u,isLoading:p,error:g}=Uo({locations:e,filter:c,loggedModelId:a,sqlWarehouseId:i,enabled:!r}),v=(0,m.useMemo)((()=>(0,F.p6)(u,t)),[u,t]),f=$o(s,n),{data:h,isLoading:y,error:b}=Uo({locations:e,filter:f,enabled:!r&&Boolean(s),loggedModelId:a,sqlWarehouseId:i}),w=(0,m.useMemo)((()=>(0,F.p6)(h,s)),[h,s]),S=(0,m.useMemo)((()=>!v||p||g||!v.length?[]:v.map((e=>(0,F.ih)(e)))),[v,p,g]),I=(0,m.useMemo)((()=>{const e=y&&Boolean(s);return!w||e||b||!w.length?[]:w.map((e=>(0,F.ih)(e)))}),[w,y,b,s]),x=(0,m.useMemo)((()=>rt(d,S||[],I||[])),[d,S,I]),A=(0,m.useMemo)((()=>{const e=new Map,t=new Map;return null===v||void 0===v||v.forEach((n=>{const s=n.trace_metadata;if(s){const t=s[he.sourceNameTag];t&&!e.has(t)&&e.set(t,{value:t,renderValue:()=>(0,R.Y)(Me,{traceInfo:n,isComparing:!1,disableLinks:!0})})}const o=n.tags;if(o&&o["mlflow.linkedPrompts"])try{const e=JSON.parse(o["mlflow.linkedPrompts"]);Array.isArray(e)&&e.forEach((e=>{const n=`${e.name}/${e.version}`;t.has(n)||t.set(n,{value:n,renderValue:()=>n})}))}catch(a){}})),{source:Array.from(e.values()).sort(((e,t)=>e.value.localeCompare(t.value))),prompt:Array.from(t.values()).sort(((e,t)=>e.value.localeCompare(t.value)))}}),[v]),E=(0,z.XS)(d,S||[],x,t,void 0,!0);return(0,m.useMemo)((()=>({assessmentInfos:x,allColumns:E,totalCount:S.length,evaluatedTraces:S,otherEvaluatedTraces:I,isLoading:p&&!r,error:g,isEmpty:0===S.length,tableFilterOptions:A})),[x,E,p,g,S,A,r,I])},Lo=({locations:e,currentRunDisplayName:t,runUuid:n,timeRange:s,searchQuery:o,filters:a,disabled:i,pageSize:r,limit:l,filterByLoggedModelId:d,tableSort:c,loggedModelId:u,sqlWarehouseId:p})=>{const g=!1,{networkFilters:v,clientFilters:f}=(0,m.useMemo)((()=>((e,t=!0)=>e.reduce(((e,n)=>(n.column===B.w8.ASSESSMENT&&(void 0===n.value||n.value===st)||n.column===B.w8.ASSESSMENT&&t?e.clientFilters.push(n):e.networkFilters.push(n),e)),{networkFilters:[],clientFilters:[]}))(a||[],g)),[a,g]),h=$o(n,s,v,d,o),y=zo(c),{data:b,isLoading:w,isFetching:S,error:I,refetch:x}=Uo({locations:e,filter:h,enabled:!i,pageSize:r,limit:l,orderBy:y,loggedModelId:u,sqlWarehouseId:p}),A=(0,m.useMemo)((()=>{if(b)return b.map((e=>({currentRunValue:(0,F.ih)(e),otherRunValue:void 0})))}),[b]),E=(0,m.useMemo)((()=>{if(!A)return;const e=void 0;if(!(f&&f.length>0))return A.reduce(((e,t)=>{var n;return null!==(n=t.currentRunValue)&&void 0!==n&&n.traceInfo&&e.push(t.currentRunValue.traceInfo),e}),[]);const n=f.map((e=>({assessmentName:e.key||"",filterValue:e.value,run:t||""})));return bo(A,n||[],e,t,void 0).reduce(((e,t)=>{var n;return null!==(n=t.currentRunValue)&&void 0!==n&&n.traceInfo&&e.push(t.currentRunValue.traceInfo),e}),[])}),[A,f,o,t,g]),C=(0,m.useMemo)((()=>(0,F.p6)(E,n)),[E,n]);return i?{data:[],isLoading:!1,isFetching:!1}:{data:C,isLoading:w,isFetching:S,error:I||void 0,refetchMlflowTraces:x}},Ho=async({signal:e,locations:t,filter:n,pageSize:o,limit:a,orderBy:i,loggedModelId:r,sqlWarehouseId:l})=>{if((null===t||void 0===t?void 0:t.some((e=>"UC_SCHEMA"===e.type)))&&(0,D.F9)())return O._A.searchTracesV4({signal:e,orderBy:i,locations:t,filter:n});let d,c=[];const u=o||(0,D.Mq)(),m=a||(0,D.pR)();for(;c.length<m;){const o={locations:t,filter:n,max_results:u,order_by:i};r&&l&&(o.model_id=r,o.sql_warehouse_id=l),d&&(o.page_token=d);const a=await ce("ajax-api/3.0/mlflow/traces/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o),signal:e});if(!a.ok)throw(0,de.Jg)(a);const m=await a.json(),p=m.traces;if((0,s.isNil)(p)||(c=c.concat(p)),d=m.next_page_token,!d)break}return c},Uo=({locations:e,filter:t,pageSize:n,limit:s,orderBy:o,loggedModelId:a,sqlWarehouseId:i,enabled:r,...l})=>{const d=(null===e||void 0===e?void 0:e.some((e=>"UC_SCHEMA"===e.type)))&&(0,D.F9)(),c=(0,m.useMemo)((()=>d?{keepPreviousData:!0,refetchOnWindowFocus:!1}:{staleTime:1/0,cacheTime:1/0}),[d]);return(0,oe.I)({...c,enabled:r,queryKey:[Fo,{locations:e,filter:t,orderBy:o,loggedModelId:a,sqlWarehouseId:i,pageSize:n}],queryFn:({signal:r})=>Ho({signal:r,locations:e,filter:t,pageSize:n,limit:s,orderBy:o,loggedModelId:a,sqlWarehouseId:i}),...l})},$o=(e,t,n,s,o)=>{const a=[];if(e&&a.push(`attributes.run_id = '${e}'`),o&&a.push(`span.attributes.\`mlflow.spanInputs\` ILIKE '%${o}%'`),t){const e="attributes.timestamp_ms";t.startTime&&a.push(`${e} > ${t.startTime}`),t.endTime&&a.push(`${e} < ${t.endTime}`)}if(s&&a.push(`request_metadata."mlflow.modelId" = '${s}'`),n&&n.forEach((e=>{switch(e.column){case B.w8.TAG:if(e.key){const t="tags",n=e.key.includes(".")||e.key.includes(" ")?`${t}.\`${e.key}\``:`${t}.${e.key}`;a.push(`${n} ${e.operator} '${e.value}'`)}break;case z.tj:const t="attributes.execution_time_ms";a.push(`${t} ${e.operator} ${e.value}`);break;case z.$W:const n="attributes.status";a.push(`${n} = '${e.value}'`);break;case z.tP:a.push(`request_metadata."mlflow.trace.user" = '${e.value}'`);break;case z.li:a.push(`attributes.run_id = '${e.value}'`);break;case z.im:a.push(`request_metadata."mlflow.modelId" = '${e.value}'`);break;case z.VC:a.push(`prompt = '${e.value}'`);break;case z.LV:a.push(`attributes.name ${e.operator} '${e.value}'`);break;case z.FW:a.push(`request_metadata."mlflow.source.name" ${e.operator} '${e.value}'`);break;case B.w8.ASSESSMENT:"undefined"!==e.value&&a.push(`feedback.\`${e.key}\` ${e.operator} '${e.value}'`);break;case B.w8.EXPECTATION:a.push(`expectation.\`${e.key}\` ${e.operator} '${e.value}'`);break;case z.Gq:"="===e.operator?a.push(`span.name ILIKE '${e.value}'`):"CONTAINS"===e.operator?a.push(`span.name ILIKE '%${e.value}%'`):a.push(`span.name ${e.operator} '${e.value}'`);break;case z.Rb:"="===e.operator?a.push(`span.type ILIKE '${e.value}'`):"CONTAINS"===e.operator?a.push(`span.type ILIKE '%${e.value}%'`):a.push(`span.type ${e.operator} '${e.value}'`);break;case z.k0:"CONTAINS"===e.operator&&a.push(`span.content ILIKE '%${e.value}%'`);break;default:if(e.column.startsWith(z.rc)){const t=`request_metadata.${(0,F.v8)(e.column)}`;e.operator===B.tl.CONTAINS?a.push(`${t} ILIKE '%${e.value}%'`):a.push(`${t} ${e.operator} '${e.value}'`)}}})),a.length>0)return a.join(" AND ")},zo=e=>{if(e)switch(e.key){case z.tj:return["execution_time "+(e.asc?"ASC":"DESC")];case z.Te:return["timestamp "+(e.asc?"ASC":"DESC")];default:return[]}};var Bo=n(884);var jo={name:"l8l8b8",styles:"white-space:nowrap;overflow:hidden;text-overflow:ellipsis"},Po={name:"l8l8b8",styles:"white-space:nowrap;overflow:hidden;text-overflow:ellipsis"};const qo=({id:e,item:t,options:n,query:s,onChange:o,placeholder:a,width:i,canSearchCustomValue:r})=>{const{theme:l}=(0,E.u)(),[d,c]=(0,m.useState)(""),u=(0,m.useMemo)((()=>{var e,t;return null!==(e=null!==(t=null===s||void 0===s?void 0:s.data)&&void 0!==t?t:n)&&void 0!==e?e:[]}),[null===s||void 0===s?void 0:s.data,n]),p=(0,m.useMemo)((()=>u.map((e=>e.value))),[u]);return(0,R.FD)(C.DialogCombobox,{componentId:"mlflow.evaluations_review.table_ui.filter_column",value:null!==t&&void 0!==t&&t.value?[t.value]:[],id:e,children:[(0,R.Y)(C.DialogComboboxTrigger,{withInlineLabel:!1,placeholder:a,renderDisplayedValue:()=>{var e;return null!==(e=null===t||void 0===t?void 0:t.renderValue())&&void 0!==e?e:""},width:i,allowClear:!1}),(0,R.Y)(C.DialogComboboxContent,{width:i,style:{zIndex:l.options.zIndexBase+100},loading:null===s||void 0===s?void 0:s.isLoading,children:(0,R.Y)(C.DialogComboboxOptionList,{children:(0,R.FD)(C.DialogComboboxOptionListSearch,{onSearch:e=>c(e),children:[u.map((e=>(0,R.Y)(C.DialogComboboxOptionListSelectItem,{value:e.value,onChange:o,checked:e.value===(null===t||void 0===t?void 0:t.value),css:jo,children:e.renderValue()},e.value))),r&&d&&!p.includes(d)?(0,R.FD)(C.DialogComboboxOptionListSelectItem,{value:d,onChange:o,checked:d===(null===t||void 0===t?void 0:t.value),css:Po,children:['Use "',d,'"']},d):null]})})})]})};var Ko={name:"833hqy",styles:"width:200px"};const Go=({index:e,tableFilter:t,assessmentInfos:n,onChange:s,experimentId:o,tableFilterOptions:a})=>{const i=(0,N.tz)(),{theme:r}=(0,E.u)(),l=`filter-value-${e}`,[d,c]=(0,m.useState)(t.value),u=(0,m.useCallback)((()=>{d!==t.value&&s({...t,value:d},e)}),[t,e,s,d]),p=No(o),g=(0,m.useMemo)((()=>{var e,t;return{data:null===(e=p.runInfos)||void 0===e||null===(t=e.filter((e=>e.runUuid&&e.runName)))||void 0===t?void 0:t.map((e=>({value:e.runUuid,renderValue:()=>e.runName}))),isLoading:p.isLoading}}),[p]),v=((e,t=!1)=>{const n=["EXPERIMENT_MODEL_VERSIONS",e],{data:s,isLoading:o,error:a}=(0,oe.I)({queryKey:n,queryFn:async()=>ue("ajax-api/2.0/mlflow/logged-models/search","POST",{experiment_ids:[e]}),staleTime:1/0,cacheTime:1/0,enabled:!t,refetchOnMount:!1,retry:!1});return{data:null===s||void 0===s?void 0:s.models,isLoading:o,error:a||void 0}})(o),f=(0,m.useMemo)((()=>{var e;return{data:null===(e=v.data)||void 0===e?void 0:e.map((e=>({value:e.info.model_id,renderValue:()=>e.info.name}))),isLoading:v.isLoading}}),[v]),h=[{value:"IN_PROGRESS",renderValue:()=>i.formatMessage(ke.IN_PROGRESS)},{value:"OK",renderValue:()=>i.formatMessage(ke.OK)},{value:"ERROR",renderValue:()=>i.formatMessage(ke.ERROR)}];var y,w;if(t.column===z.li)return(0,R.Y)(qo,{id:l,item:null===(y=g.data)||void 0===y?void 0:y.find((e=>e.value===t.value)),query:g,onChange:n=>{s({...t,value:n},e)},placeholder:"Select run",width:200,canSearchCustomValue:!1});if(t.column===z.im)return(0,R.Y)(qo,{id:l,item:null===(w=f.data)||void 0===w?void 0:w.find((e=>e.value===t.value)),query:f,onChange:n=>{s({...t,value:n},e)},placeholder:"Select version",width:200,canSearchCustomValue:!1});if(t.column===B.w8.ASSESSMENT){const o=n.find((e=>e.name===t.key));if(o&&"numeric"!==o.dtype&&"unknown"!==o.dtype){const n=Array.from(o.uniqueValues.values()).map((e=>({value:S(e),renderValue:()=>(0,I.uU)(i,r,o,e).content})));return o.containsErrors&&n.push({value:S(st),renderValue:()=>(0,I.uU)(i,r,o,st).content}),(0,R.Y)(qo,{id:l,item:n.find((e=>e.value===S(t.value))),options:n,onChange:n=>{s({...t,value:b(n)},e)},placeholder:"Select",width:200,canSearchCustomValue:!1})}}if(t.column===z.$W)return(0,R.Y)(qo,{id:l,item:h.find((e=>e.value===t.value)),options:h,onChange:n=>{s({...t,value:n},e)},placeholder:"Select",width:200,canSearchCustomValue:!1});if(t.column===z.FW){const n=a.source;return(0,R.Y)(qo,{id:l,item:n.find((e=>e.value===t.value)),options:n,onChange:n=>{s({...t,value:n},e)},placeholder:"Select source",width:200,canSearchCustomValue:!1})}if(t.column===z.VC){const n=a.prompt||[];return(0,R.Y)(qo,{id:l,item:n.find((e=>e.value===t.value)),options:n,onChange:n=>{s({...t,value:n},e)},placeholder:"Select prompt",width:200,canSearchCustomValue:!0})}return(0,R.Y)(T.I,{"aria-label":"Value",componentId:"mlflow.evaluations_review.table_ui.filter_value",id:l,placeholder:t.column===z.tj?"Time in milliseconds":"Value",type:t.column===z.tj?"number":"text",value:d,onChange:e=>{c(e.target.value)},onBlur:u,css:Ko,disabled:t.column===B.w8.ASSESSMENT})};const Wo=[z.tj,z.$W,z.LV,z.tP,z.li,z.im,z.VC,z.FW],Qo=(e,t)=>e===z.tj?[B.tl.EQUALS,B.tl.NOT_EQUALS,B.tl.GREATER_THAN,B.tl.LESS_THAN,B.tl.GREATER_THAN_OR_EQUALS,B.tl.LESS_THAN_OR_EQUALS]:e===z.Gq||e===z.Rb?[B.tl.EQUALS,B.tl.NOT_EQUALS,B.tl.CONTAINS]:e===z.k0?[B.tl.CONTAINS]:[B.tl.EQUALS];var Zo={name:"1fttcpj",styles:"display:flex;flex-direction:column"},Jo={name:"1fttcpj",styles:"display:flex;flex-direction:column"},Xo={name:"1fttcpj",styles:"display:flex;flex-direction:column"},ea={name:"833hqy",styles:"width:200px"},ta={name:"1fttcpj",styles:"display:flex;flex-direction:column"},na={name:"1fttcpj",styles:"display:flex;flex-direction:column"},sa={name:"1duj7gx",styles:"align-self:flex-end"};const oa=({tableFilter:e,index:t,onChange:n,onDelete:s,assessmentInfos:o,experimentId:a,tableFilterOptions:i,allColumns:r,usesV4APIs:l})=>{const{column:d,operator:c,key:u}=e,{theme:p}=(0,E.u)(),g=(0,m.useMemo)((()=>o.filter((e=>"numeric"!==e.dtype)).map((e=>({value:e.name,renderValue:()=>e.displayName})))),[o]),v=(0,m.useMemo)((()=>{const e=r.filter((e=>Wo.includes(e.id)||e.id.startsWith(z.rc))).map((e=>({value:e.id,renderValue:()=>{var t;return null!==(t=e.filterLabel)&&void 0!==t?t:e.label}})));return e.push({value:B.w8.TAG,renderValue:()=>B.RF[B.w8.TAG]},{value:B.w8.ASSESSMENT,renderValue:()=>B.RF[B.w8.ASSESSMENT]}),l&&e.push({value:z.k0,renderValue:()=>"Span content"},{value:z.Gq,renderValue:()=>"Span name"},{value:z.Rb,renderValue:()=>"Span type"}),e}),[r,l]);return(0,R.Y)(R.FK,{children:(0,R.FD)("div",{css:(0,A.AH)({display:"flex",flexDirection:"row",gap:p.spacing.sm},""),children:[(0,R.FD)("div",{css:Zo,children:[(0,R.Y)(C.FormUI.Label,{htmlFor:`filter-column-${t}`,children:(0,R.Y)(N.sA,{id:"OlytgO",defaultMessage:"Field"})}),(0,R.Y)(qo,{id:`filter-column-${t}`,item:v.find((e=>e.value===d)),options:v,onChange:e=>{if(e!==d){const s=Qo(e)[0];n({column:e,operator:s,value:""},t)}},placeholder:"Select column",width:180,canSearchCustomValue:!1})]}),d===B.w8.ASSESSMENT&&(0,R.FD)("div",{css:Jo,children:[(0,R.Y)(C.FormUI.Label,{htmlFor:`filter-key-${t}`,children:(0,R.Y)(N.sA,{id:"lK4Ay3",defaultMessage:"Name"})}),(0,R.Y)(qo,{id:`filter-key-${t}`,item:g.find((e=>e.value===u)),options:g,onChange:s=>{n({...e,key:s},t)},placeholder:"Select name",width:200,canSearchCustomValue:!1})]}),d===B.w8.TAG&&(0,R.FD)("div",{css:Xo,children:[(0,R.Y)(C.FormUI.Label,{htmlFor:`filter-key-${t}`,children:(0,R.Y)(N.sA,{id:"gST1At",defaultMessage:"Key"})}),(0,R.Y)(T.I,{"aria-label":"Key",componentId:"mlflow.evaluations_review.table_ui.filter_key",id:"filter-key-"+t,type:"text",css:ea,placeholder:d===B.w8.TAG?"Key":"Name",value:u,onChange:s=>{n({...e,key:s.target.value},t)}})]}),(0,R.FD)("div",{css:ta,children:[(0,R.Y)(C.FormUI.Label,{htmlFor:`filter-operator-${t}`,children:(0,R.Y)(N.sA,{id:"W6Sqio",defaultMessage:"Operator"})}),(()=>{const s=""!==d&&1===Qo(d).length;return(0,R.Y)(C.SimpleSelect,{"aria-label":"Operator",componentId:"mlflow.evaluations_review.table_ui.filter_operator",id:"filter-operator-"+t,placeholder:"Select",width:120,contentProps:{style:{zIndex:p.options.zIndexBase+100}},value:s?Qo(d)[0]:c,disabled:s,onChange:s=>{n({...e,operator:s.target.value},t)},children:Qo(d).map((e=>(0,R.Y)(C.SimpleSelectOption,{value:e,children:e},e)))})})()]}),(0,R.FD)("div",{css:na,children:[(0,R.Y)(C.FormUI.Label,{htmlFor:`filter-value-${t}`,children:(0,R.Y)(N.sA,{id:"6JOLpj",defaultMessage:"Value"})}),(0,R.Y)(Go,{index:t,tableFilter:e,assessmentInfos:o,onChange:n,experimentId:a,tableFilterOptions:i})]}),(0,R.Y)("div",{css:sa,children:(0,R.Y)(E.B,{componentId:"mlflow.evaluations_review.table_ui.filter_delete_button",type:"tertiary",icon:(0,R.Y)(C.CloseSmallIcon,{}),onClick:s})})]})})};const aa=({filters:e,setFilters:t,assessmentInfos:n,experimentId:s,tableFilterOptions:o,allColumns:a,isMetadataLoading:i,metadataError:r,usesV4APIs:l})=>{const d=(0,N.tz)(),{theme:c}=(0,E.u)(),u=e.length>0,p=(0,m.useCallback)((()=>{t([])}),[t]);return(0,R.FD)(E.aw.Root,{componentId:"mlflow.genai_traces_table_filter.filter_dropdown",children:[(0,R.Y)(E.aw.Trigger,{asChild:!0,children:(0,R.Y)(E.B,{endIcon:(0,R.Y)(C.ChevronDownIcon,{}),componentId:"mlflow.evaluations_review.table_ui.filter_button",css:(0,A.AH)({border:u?`1px solid ${c.colors.actionDefaultBorderFocus} !important`:"",backgroundColor:u?`${c.colors.actionDefaultBackgroundHover} !important`:""},""),children:(0,R.FD)("div",{css:(0,A.AH)({display:"flex",gap:c.spacing.sm,alignItems:"center"},""),children:[(0,R.Y)(C.FilterIcon,{}),d.formatMessage({id:"J961B2",defaultMessage:"Filters{numFilters}"},{numFilters:u?` (${e.length})`:""}),u&&(0,R.Y)(T.X,{css:(0,A.AH)({fontSize:12,cursor:"pointer",color:c.colors.grey400,"&:hover":{color:c.colors.grey600}},""),onClick:()=>{p()}})]})})}),(0,R.Y)(E.aw.Content,{align:"start",css:(0,A.AH)({padding:c.spacing.md},""),children:r?(0,R.FD)("div",{css:(0,A.AH)({display:"flex",alignItems:"center",justifyContent:"center",gap:c.spacing.xs,padding:`${c.spacing.md}px`,color:c.colors.textValidationDanger},""),"data-testid":"filter-dropdown-error",children:[(0,R.Y)(E.k,{}),(0,R.Y)(N.sA,{id:"dJaboT",defaultMessage:"Fetching traces failed"})]}):i?(0,R.Y)("div",{css:(0,A.AH)({display:"flex",alignItems:"center",justifyContent:"center",gap:c.spacing.xs,padding:`${c.spacing.md}px`,color:c.colors.textSecondary},""),"data-testid":"filter-dropdown-loading",children:(0,R.Y)(E.S,{size:"small"})}):(0,R.Y)(la,{filters:e,assessmentInfos:n,setFilters:t,experimentId:s,tableFilterOptions:o,allColumns:a,usesV4APIs:l})})]})};var ia={name:"skgbeu",styles:"display:flex;justify-content:flex-end"},ra={name:"skgbeu",styles:"display:flex;justify-content:flex-end"};const la=({filters:e,assessmentInfos:t,setFilters:n,experimentId:s,tableFilterOptions:o,allColumns:a,usesV4APIs:i})=>{const{theme:r}=(0,E.u)(),l=(e=>(0,Bo.mN)({defaultValues:{filters:e.length>0?e:[{column:"",operator:B.tl.EQUALS,value:""}]}}))(e),{setValue:d,watch:c}=l,u=c("filters");return(0,R.Y)(Bo.Op,{...l,children:(0,R.FD)("div",{css:(0,A.AH)({display:"flex",flexDirection:"column",gap:r.spacing.lg,overflow:"auto"},""),children:[(0,R.Y)("div",{css:(0,A.AH)({display:"flex",flexDirection:"column",gap:r.spacing.sm},""),children:u.map(((e,n)=>(0,R.Y)(oa,{tableFilter:e,index:n,onChange:e=>{u[n]=e,d("filters",u)},onDelete:()=>{const e=[...u];e.splice(n,1),0===e.length&&e.push({column:"",operator:B.tl.EQUALS,value:""}),d("filters",e)},assessmentInfos:t,experimentId:s,tableFilterOptions:o,allColumns:a,usesV4APIs:i},e.column+e.operator+e.value+n)))}),(0,R.Y)("div",{children:(0,R.Y)(E.B,{componentId:"mlflow.evaluations_review.table_ui.add_filter_button",icon:(0,R.Y)(C.PlusIcon,{}),onClick:()=>{d("filters",[...u,{column:"",operator:B.tl.EQUALS,value:""}])},children:(0,R.Y)(N.sA,{id:"cHgTsd",defaultMessage:"Add filter"})})}),(0,R.Y)("div",{css:ia,children:(0,R.Y)(E.B,{componentId:"mlflow.evaluations_review.table_ui.apply_filters_button",type:"primary",onClick:()=>n(u),css:ra,children:(0,R.Y)(N.sA,{id:"iZ0M1Y",defaultMessage:"Apply filters"})})})]})})},da=e=>e===B.w8.INFO?"Attributes":B.RF[e],ca=({columns:e=[],selectedColumns:t=[],toggleColumns:n,setSelectedColumns:s,isMetadataLoading:o=!1,metadataError:a})=>{const i=(0,N.tz)(),{theme:r}=(0,E.u)(),[l,d]=(0,m.useState)(""),c=(0,m.useMemo)((()=>{const t=Q(e),n={};return t.forEach((e=>{var t;const s=null!==(t=e.group)&&void 0!==t?t:B.w8.INFO;n[s]||(n[s]=[]),n[s].push(e)})),n}),[e]),u=(0,m.useMemo)((()=>{if(!l.trim())return c;const e=l.trim().toLowerCase(),t={};return Object.entries(c).forEach((([n,s])=>{const o=da(n).toLowerCase().includes(e),a=s.filter((t=>t.label.toLowerCase().includes(e)));(o||a.length)&&(t[n]=o?s:a)})),t}),[c,l]);return(0,R.FD)(C.DialogCombobox,{componentId:"mlflow.evaluations_overview_grouped.column_selector_dropdown",label:"Columns",multiSelect:!0,children:[(0,R.Y)(C.DialogComboboxCustomButtonTriggerWrapper,{children:(0,R.Y)(E.B,{endIcon:(0,R.Y)(C.ChevronDownIcon,{}),"data-testid":"column-selector-button",componentId:"mlflow.evaluations_review.table_ui.filter_button",children:(0,R.FD)("div",{css:(0,A.AH)({display:"flex",gap:r.spacing.sm,alignItems:"center"},""),children:[(0,R.Y)(C.ColumnsIcon,{}),i.formatMessage({id:"wjOGl2",defaultMessage:"Columns"})]})})}),(0,R.Y)(C.DialogComboboxContent,{maxHeight:496,minWidth:300,maxWidth:500,loading:o&&!a,children:a?(0,R.FD)("div",{css:(0,A.AH)({display:"flex",alignItems:"center",justifyContent:"center",gap:r.spacing.xs,padding:`${r.spacing.md}px`,color:r.colors.textValidationDanger},""),"data-testid":"filter-dropdown-error",children:[(0,R.Y)(E.k,{}),(0,R.Y)(N.sA,{id:"dJaboT",defaultMessage:"Fetching traces failed"})]}):(0,R.Y)(C.DialogComboboxOptionList,{children:(0,R.Y)(C.DialogComboboxOptionListSearch,{controlledValue:l,setControlledValue:d,children:Object.entries(u).map((([e,o])=>(0,R.FD)(m.Fragment,{children:[(0,R.Y)(C.DialogComboboxSectionHeader,{children:da(e)}),(0,R.Y)(C.DialogComboboxOptionListCheckboxItem,{value:`all-${e}`,checked:o.every((e=>t.some((t=>t.id===e.id)))),onChange:()=>(e=>{if(e.every((e=>t.some((t=>t.id===e.id))))){const n=t.filter((t=>!e.some((e=>e.id===t.id))));s(n)}else{const n=[...t];e.forEach((e=>{n.some((t=>t.id===e.id))||n.push(e)})),s(n)}})(o),children:i.formatMessage({id:"RXL0a5",defaultMessage:"All {groupLabel}"},{groupLabel:da(e)})}),o.map((e=>(0,R.Y)(C.DialogComboboxOptionListCheckboxItem,{value:e.label,checked:t.some((t=>t.id===e.id)),onChange:()=>n([e]),children:e.label},e.id)))]},e)))})})})]})};var ua={name:"13qopiv",styles:"margin-bottom:0;flex:1"};const ma=m.memo((e=>{const{searchQuery:t,setSearchQuery:n,filters:s,setFilters:o,tableSort:a,setTableSort:i,selectedColumns:r,toggleColumns:l,setSelectedColumns:d,assessmentInfos:c,experimentId:u,traceInfos:p,tableFilterOptions:g,traceActions:v,allColumns:f,countInfo:h,isMetadataLoading:y,usesV4APIs:b,metadataError:w}=e,{theme:S}=(0,E.u)(),I=(0,m.useCallback)(((e,t)=>{i({key:e.key,type:e.type,asc:t})}),[i]);return(0,R.FD)("div",{css:(0,A.AH)({display:"flex",width:"100%",alignItems:"flex-end",gap:S.spacing.sm,paddingBottom:`${S.spacing.xs}px`},""),children:[(0,R.FD)(C.TableFilterLayout,{css:ua,children:[(0,R.Y)(ao,{searchQuery:t,setSearchQuery:n}),(0,R.Y)(aa,{filters:s,setFilters:o,assessmentInfos:c,experimentId:u,tableFilterOptions:g,allColumns:f,isMetadataLoading:y,metadataError:w,usesV4APIs:b}),(0,R.Y)(lo,{tableSort:a,columns:r,onChange:I,enableGrouping:(0,D.ij)(),isMetadataLoading:y,metadataError:w}),(0,R.Y)(ca,{columns:f,selectedColumns:r,toggleColumns:l,setSelectedColumns:d,isMetadataLoading:y,metadataError:w}),v&&(0,R.Y)(U,{experimentId:u,traceActions:v,traceInfos:p})]}),(0,R.Y)(pa,{countInfo:h})]})})),pa=e=>{const{countInfo:t}=e,n=(0,N.tz)(),{theme:o}=(0,E.u)();return t.logCountLoading||(0,s.isNil)(t.currentCount)?(0,R.Y)(E.S,{size:"small"}):(0,R.FD)("div",{css:(0,A.AH)({display:"flex",alignItems:"center",gap:o.spacing.sm},""),children:[t.currentCount>=t.maxAllowedCount&&(0,R.Y)(_.T,{componentId:"mlflow.experiment_list_view.max_traces.tooltip",content:n.formatMessage({id:"BpAyCF",defaultMessage:"Only the top {evalResultsCount} results are shown"},{evalResultsCount:t.maxAllowedCount}),children:(0,R.Y)(E.W,{color:"warning"})}),(0,R.Y)(E.T.Hint,{children:n.formatMessage({id:"FnOQ44",defaultMessage:"{numFilteredEvals} of {numEvals}"},{numFilteredEvals:t.currentCount>=t.maxAllowedCount?t.maxAllowedCount:t.currentCount,numEvals:t.totalCount>=t.maxAllowedCount?`${t.maxAllowedCount}+`:t.totalCount})})]})};var ga={name:"kj840c",styles:"flex:1;overflow-y:hidden;position:relative"};const va=m.memo((e=>{const{experimentId:t,currentTraceInfoV3:n,compareToTraceInfoV3:s,currentRunDisplayName:o,runUuid:a,compareToRunUuid:i,compareToRunDisplayName:r,setFilters:l,filters:d,selectedColumns:c,tableSort:u,assessmentInfos:p,getTrace:g,onTraceTagsEdit:v,allColumns:f,getRunColor:h,enableRowSelection:y=!0,displayLoadingOverlay:b=!1}=e,{theme:w}=(0,E.u)(),S=(0,m.useMemo)((()=>(0,F.Co)(n.map((e=>({evaluationId:e.trace_id,requestId:e.client_request_id||e.trace_id,inputsId:e.trace_id,inputs:{},outputs:{},targets:{},overallAssessments:[],responseAssessmentsByName:{},metrics:{},traceInfo:e}))))),[n]),I=(0,m.useMemo)((()=>(0,F.Co)((s||[]).map((e=>({evaluationId:e.trace_id,requestId:e.client_request_id||e.trace_id,inputsId:e.trace_id,inputs:{},outputs:{},targets:{},overallAssessments:[],responseAssessmentsByName:{},metrics:{},traceInfo:e}))))),[s]),[x,C]=(0,m.useState)({}),T=(0,m.useCallback)(((e,t,n)=>{const s=d.find((t=>t.column===B.w8.ASSESSMENT&&t.key===e));void 0===s?l([...d,{column:B.w8.ASSESSMENT,key:e,operator:B.tl.EQUALS,value:t}]):s.value===t?l(d.filter((t=>!(t.column===B.w8.ASSESSMENT&&t.key===e)))):l(d.map((n=>n.column===B.w8.ASSESSMENT&&n.key===e?{column:B.w8.ASSESSMENT,key:e,operator:B.tl.EQUALS,value:t}:n)))}),[d,l]),_=(0,m.useMemo)((()=>d.filter((e=>e.column===B.w8.ASSESSMENT)).map((e=>({assessmentName:e.key||"",filterValue:e.value,run:o||F.kf})))),[d,o]),[N,Y]=ho(),M=(0,m.useMemo)((()=>lt(c.filter((e=>e.type===B.$6.ASSESSMENT)).map((e=>e.assessmentInfo)))),[c]),k=(0,m.useMemo)((()=>ee(S,I)),[S,I]),V=(0,m.useMemo)((()=>S.flatMap((e=>{var t,n;return null!==(t=null===e||void 0===e||null===(n=e.traceInfo)||void 0===n?void 0:n.assessments)&&void 0!==t?t:[]}))),[S]);return(0,R.Y)("div",{css:(0,A.AH)({display:"flex",flexDirection:"column",gap:w.spacing.xs,overflow:"hidden",flexGrow:1},""),children:(0,R.Y)("div",{css:(0,A.AH)({display:"flex",gap:w.spacing.md,width:"100%",flex:1,overflowY:"hidden"},""),children:(0,R.Y)("div",{css:ga,children:(0,R.Y)(O.Iw,{assessments:V,children:(0,R.Y)(oo,{experimentId:t,selectedColumns:c,allColumns:f,evaluations:k,selectedEvaluationId:N,selectedAssessmentInfos:M,assessmentInfos:p,assessmentFilters:_,onChangeEvaluationId:Y,getRunColor:h,runUuid:a,compareToRunUuid:i,runDisplayName:o,compareToRunDisplayName:r,enableRowSelection:y,rowSelection:x,setRowSelection:C,toggleAssessmentFilter:T,tableSort:u,getTrace:g,onTraceTagsEdit:v,enableGrouping:(0,D.ij)(),displayLoadingOverlay:b})})})})})})),fa="filter",ha=()=>{const[e,t]=f();return[(0,m.useMemo)((()=>{var t;return(null!==(t=e.getAll(fa))&&void 0!==t?t:[]).reduce(((e,t)=>{const[n,s,o,a]=t.split("::");if(!n||!s||!o)return e;const i=s;let r=o;return n===B.w8.ASSESSMENT&&(r=b(o)),e.push({column:n,key:a,operator:i,value:r}),e}),[])}),[e]),(0,m.useCallback)(((e,n=!1)=>{t((t=>(t.delete(fa),e&&e.forEach((e=>{let n=e.value;e.column===B.w8.ASSESSMENT&&(n=S(e.value)),t.append(fa,[e.column,e.operator,n,e.key].join("::"))})),t)),{replace:n})}),[t])]};var ya=n(49633);const ba=(e,t)=>t.filter((t=>!e.includes(t))).map((e=>e.id)),wa=(e,t)=>{let n=((e,t)=>t.filter((t=>!e.includes(t.id))))(e,t);if(n.length>10){const e=n.filter((e=>e.type===B.$6.ASSESSMENT)),t=n.filter((e=>e.type!==B.$6.ASSESSMENT)),s=n.length-10,o=Math.max(0,e.length-s);n=[...t,...e.slice(0,o)]}return ba(n,t)},Sa=(e,t,n,s)=>{const[o,a]=(0,ya.Mj)({key:`genaiTracesUIState-columns-${e}-${s}`,version:1,initialValue:void 0}),i=(0,m.useMemo)((()=>((e,t)=>wa(t?ba(t(e),e):[z.LV,z.FW,z.tj,z.$W],e))(t,n)),[t,n]);return{hiddenColumns:(0,m.useMemo)((()=>{const e=new Set(i);return null!==o&&void 0!==o&&o.columnOverrides?(Object.entries(o.columnOverrides).forEach((([t,n])=>{n?e.delete(t):e.add(t)})),[...e]):i}),[o,i]),toggleColumns:(0,m.useCallback)((e=>{e.length&&a((t=>{var n;const s=null!==(n=null===t||void 0===t?void 0:t.columnOverrides)&&void 0!==n?n:{},o={...s};let a=!1;return e.forEach((e=>{const t=e.id in s?!s[e.id]:i.includes(e.id);o[e.id]!==t&&(o[e.id]=t,a=!0)})),a?{...t,columnOverrides:o}:t}))}),[a,i])}},Ia=(e,t,n,o)=>{const{hiddenColumns:a,toggleColumns:i}=Sa(e,t,n,o),r=(0,m.useMemo)((()=>t.filter((e=>!a.includes(e.id)))),[t,a]),l=(0,m.useCallback)((e=>{if((0,s.isNil)(e))return;const n=new Set(e.map((e=>e.id))),o=[];t.forEach((e=>{!a.includes(e.id)!==n.has(e.id)&&o.push(e)})),o.length&&i(o)}),[t,a,i]);return{selectedColumns:r,toggleColumns:i,setSelectedColumns:l}},xa="mlflow.evaluations_review.table_ui.compare_to_run_combobox";const Aa=e=>({type:"MLFLOW_EXPERIMENT",mlflow_experiment:{experiment_id:e}});n(59930);var Ea=n(19112);const Ca='import mlflow\n\n@mlflow.trace\ndef chat_completion(message: str, user_id: str, session_id: str):\n    # Set these metadata keys to associate the trace to a user and session\n    mlflow.update_current_trace(\n        metadata={\n            "mlflow.trace.user": user_id,\n            "mlflow.trace.session": session_id,\n        }\n    )\n\n    # Replace with your chat logic\n    return "Your response here"\n\n# Depending on your setup, user and session IDs can be passed to your\n# server handler via the network request from your client applications,\n# or derived from some other request context. \nuser_id = "user-123"\nsession_id = "session-123"\n\nchat_completion("Hello, how are you?", user_id, session_id)';var Ta={name:"1blwlv5",styles:"flex:1;flex-direction:column;display:flex;align-items:center;justify-content:center"},_a={name:"xvginl",styles:"max-width:600px"},Na={name:"bjn8wh",styles:"position:relative"};const Ra=()=>{const{theme:e}=(0,E.u)();return(0,R.FD)("div",{css:Ta,children:[(0,R.Y)(E.T.Title,{level:3,color:"secondary",children:(0,R.Y)(N.sA,{id:"Qsifda",defaultMessage:"Group traces from the same chat session together"})}),(0,R.FD)(E.T.Paragraph,{color:"secondary",css:_a,children:[(0,R.Y)(N.sA,{id:"hkXDZn",defaultMessage:"MLflow allows you associate traces with users and chat sessions. This is useful for analyzing multi-turn conversations, enabling you to inspect what happened at each step. Copy the code snippet below to generate a sample trace, or visit the documentation for a more in-depth example."}),(0,R.Y)(E.T.Link,{componentId:"mlflow.chat_sessions.empty_state.learn_more_link",css:(0,A.AH)({marginLeft:e.spacing.xs},""),href:"https://mlflow.org/docs/latest/genai/tracing/track-users-sessions/",openInNewTab:!0,children:(0,R.Y)(N.sA,{id:"h2Ejm7",defaultMessage:"Learn more"})})]}),(0,R.FD)("div",{css:Na,children:[(0,R.Y)(Ea.VE,{componentId:"mlflow.chat_sessions.empty_state.example_code_copy",css:(0,A.AH)({position:"absolute",top:e.spacing.xs,right:e.spacing.xs},""),copyText:Ca}),(0,R.Y)(Ea.z7,{language:"python",showLineNumbers:!0,children:Ca})]})]})},Ya=e=>{var t,n,s,o;const{experimentId:a,selectedSessions:i,traceActions:r,setRowSelection:l}=e,d=(0,N.tz)(),[c,u]=(0,m.useState)(!1),p=(0,m.useCallback)((()=>{u(!0)}),[]),g=(0,m.useMemo)((()=>{const e=[];return i.forEach((t=>{e.push(...t.traces)})),e.map((e=>({evaluationId:e.trace_id,requestId:e.client_request_id||e.trace_id,inputsId:e.trace_id,inputs:{},outputs:{},targets:{},overallAssessments:[],responseAssessmentsByName:{},metrics:{},traceInfo:e})))}),[i]),v=(0,m.useCallback)((async(e,t)=>{try{var n,s;await(null===r||void 0===r||null===(n=r.deleteTracesAction)||void 0===n||null===(s=n.deleteTraces)||void 0===s?void 0:s.call(n,e,t)),null===l||void 0===l||l({}),u(!1);const o=d.formatMessage({id:"KsYAUn",defaultMessage:"{count, plural, one {Session} other {{count} sessions}} deleted successfully"},{count:i.length}),a=d.formatMessage({id:"3vS6G9",defaultMessage:"{count, plural, one {# trace was} other {# traces were}} removed"},{count:t.length});(0,O.NH)(`${o}. ${a}.`)}catch(o){throw(0,O.ij)(d.formatMessage({id:"qmTNy1",defaultMessage:"Failed to delete sessions. Error: {error}"},{error:o instanceof Error?o.message:String(o)})),o}}),[l,r,i.length,d]),f=Boolean(null===r||void 0===r?void 0:r.deleteTracesAction),h=0===i.length;if(!f)return null;const y=(0,R.Y)(E.B,{componentId:"mlflow.chat-sessions.actions-dropdown",endIcon:(0,R.Y)(C.ChevronDownIcon,{}),disabled:h||(null===r||void 0===r||null===(t=r.deleteTracesAction)||void 0===t?void 0:t.isDisabled),children:d.formatMessage({id:"MZNjYJ",defaultMessage:"Actions ({count})"},{count:i.length})});return(0,R.FD)(R.FK,{children:[(0,R.FD)(C.DropdownMenu.Root,{modal:!1,children:[(0,R.Y)(_.T,{componentId:"mlflow.chat-sessions.actions-dropdown-tooltip",content:h?d.formatMessage({id:"ogDiio",defaultMessage:"Select at least one session to enable actions"}):null===r||void 0===r||null===(n=r.deleteTracesAction)||void 0===n?void 0:n.disabledReason,children:(0,R.Y)(C.DropdownMenu.Trigger,{asChild:!0,children:y})}),(0,R.Y)(C.DropdownMenu.Content,{align:"end",children:f&&(0,R.Y)(R.FK,{children:(0,R.Y)(C.DropdownMenu.Item,{componentId:"mlflow.chat-sessions.delete-sessions",onClick:p,disabled:null===r||void 0===r||null===(s=r.deleteTracesAction)||void 0===s?void 0:s.isDisabled,disabledReason:null===r||void 0===r||null===(o=r.deleteTracesAction)||void 0===o?void 0:o.disabledReason,children:d.formatMessage({id:"SnPghu",defaultMessage:"Delete sessions"})})})})]}),(0,R.Y)(k,{experimentIds:[a],visible:c,selectedTraces:g,handleClose:()=>u(!1),deleteTraces:v})]})},Ma=({columns:e,columnVisibility:t,setColumnVisibility:n,searchQuery:s,setSearchQuery:o,traceActions:a,experimentId:i,selectedSessions:r,setRowSelection:l})=>{const{theme:d}=(0,E.u)(),c=(0,N.tz)();return(0,R.FD)("div",{css:(0,A.AH)({display:"flex",gap:d.spacing.sm},""),children:[(0,R.Y)(ao,{searchQuery:s,setSearchQuery:o,placeholder:c.formatMessage({id:"W7HqWM",defaultMessage:"Search chat sessions by input"})}),(0,R.FD)(C.DialogCombobox,{componentId:"mlflow.chat-sessions.table-column-selector",label:(0,R.FD)("div",{css:(0,A.AH)({display:"flex",gap:d.spacing.sm,alignItems:"center"},""),children:[(0,R.Y)(C.ColumnsIcon,{}),(0,R.Y)(N.sA,{id:"RWVGkL",defaultMessage:"Columns"})]}),multiSelect:!0,children:[(0,R.Y)(C.DialogComboboxTrigger,{}),(0,R.Y)(C.DialogComboboxContent,{children:(0,R.Y)(C.DialogComboboxOptionList,{children:Object.entries(t).map((([s,o])=>{var a;return(0,R.Y)(C.DialogComboboxOptionListCheckboxItem,{value:s,onChange:()=>{const e={...t};e[s]=!o,n(e)},checked:o,children:null===(a=e.find((e=>e.id===s)))||void 0===a?void 0:a.header},s)}))})})]}),a&&(0,R.Y)(Ya,{experimentId:i,selectedSessions:r,traceActions:a,setRowSelection:l})]})};var ka={name:"1bkbxg0",styles:"max-width:100%;overflow:hidden;cursor:pointer"};const Da=e=>{const{cell:t}=e,n=t.getValue();return(0,R.Y)(C.Tag,{componentId:"mlflow.genai-traces-table.session-tokens",children:n})},Fa=(e,t)=>{const n=(e=>{const t={};return e.forEach((e=>{var n,s;const o=null===(n=e.trace_metadata)||void 0===n?void 0:n[O.n2];if(!o)return;const a=null!==(s=t[o])&&void 0!==s?s:[];t[o]=[...a,e]})),t})(t);return(0,s.compact)(Object.entries(n).map((([t,n])=>{if(0===n.length)return null;const o=(0,s.sortBy)(n,(e=>new Date(e.request_time))),a=o[0],i=a.request_preview,r=o.reduce(((e,t)=>{var n;return e+(null!==(n=(0,O.tI)(t))&&void 0!==n?n:0)}),0);return{sessionId:t,requestPreview:i,firstTrace:a,experimentId:e,sessionStartTime:he.formatTimestamp(new Date(a.request_time)),sessionDuration:Oa(n),tokens:r,turns:o.length,traces:o}})))},Oa=e=>{const t=e.map((e=>e.execution_duration));if(t.some((e=>(0,s.isNil)(e))))return null;const n=t.map((e=>parseFloat(null!==e&&void 0!==e?e:"0")));if(n.some((e=>isNaN(e))))return null;const o=1e3*n.reduce(((e,t)=>e+t),0);return he.formatDuration(o)};const Va=[{id:"sessionId",header:"Session ID",accessorKey:"sessionId",cell:({row:e})=>{const t=e.original.sessionId;return(0,R.Y)(C.Tag,{componentId:"mlflow.chat-sessions.session-id-tag",color:"indigo",css:ka,children:(0,R.Y)(E.T.Text,{ellipsis:!0,children:t})})},defaultVisibility:!0,enableSorting:!0,sortingFn:(e,t)=>e.original.sessionId.localeCompare(t.original.sessionId)},{id:"requestPreview",header:"Input",accessorKey:"requestPreview",defaultVisibility:!0},{id:"sessionStartTime",header:"Session start time",accessorKey:"sessionStartTime",defaultVisibility:!0,enableSorting:!0},{id:"sessionDuration",header:"Session duration",accessorKey:"sessionDuration",defaultVisibility:!0,enableSorting:!0},{id:"tokens",header:"Tokens",accessorKey:"tokens",defaultVisibility:!1,enableSorting:!0,cell:Da},{id:"turns",header:"Turns",accessorKey:"turns",defaultVisibility:!1,enableSorting:!0,cell:Da},{id:"source",header:"Source",cell:({row:e})=>{const t=e.original.firstTrace;return(0,R.Y)(Me,{traceInfo:t,isComparing:!1})},defaultVisibility:!1}];var La={name:"1t0jp0z",styles:"display:flex;overflow:hidden;flex-shrink:0"},Ha={name:"1o3ovdg",styles:"display:flex;width:100%;height:100%;align-items:center;color:inherit;text-decoration:none"};const Ua=m.memo((({row:e,enableRowSelection:t})=>{const{search:n}=v(),{theme:s}=(0,E.u)();return(0,R.FD)(C.TableRow,{className:"eval-datasets-table-row",children:[t&&(0,R.Y)("div",{css:La,children:(0,R.Y)(C.TableRowSelectCell,{componentId:"mlflow.chat-sessions.table-row-checkbox",checked:e.getIsSelected(),onChange:e.getToggleSelectedHandler(),onClick:e=>{e.stopPropagation()}})}),e.getVisibleCells().map((t=>(0,R.Y)(C.TableCell,{css:(0,A.AH)({backgroundColor:"transparent",flex:`calc(var(--col-${t.column.id}-size) / 100)`,display:"flex",flexDirection:"row",alignItems:"center","> span:first-of-type":{padding:`${s.spacing.xs}px 0px`,width:"100%"},..."actions"===t.column.id&&{paddingLeft:0,paddingRight:0}},""),children:(0,R.Y)(h,{to:{pathname:he.getExperimentChatSessionPageRoute(e.original.experimentId,e.original.sessionId),search:n},css:Ha,children:(0,_n.Kv)(t.column.columnDef.cell,t.getContext())})},t.id)))]},e.id)}),(()=>!1));var $a={name:"1t0jp0z",styles:"display:flex;overflow:hidden;flex-shrink:0"};const za=({experimentId:e,traces:t,isLoading:n,searchQuery:s,setSearchQuery:o,traceActions:a})=>{const{theme:i}=(0,E.u)(),r=(0,m.useMemo)((()=>Fa(e,t)),[e,t]),[l,d]=(0,m.useState)([{id:"sessionStartTime",desc:!0}]),[c,u]=(0,m.useState)({}),{columnVisibility:p,setColumnVisibility:g}=(({experimentId:e,columns:t})=>{const n=(0,m.useMemo)((()=>t.reduce(((e,t)=>(e[t.id]=t.defaultVisibility,e)),{})),[t]),[s,o]=(0,ya.Mj)({key:`experiment-chat-sessions-table-column-visibility-${e}`,version:1,initialValue:n});return{columnVisibility:s,setColumnVisibility:o}})({experimentId:e,columns:Va}),v=Boolean(a),f=(0,se.S)({data:r,columns:Va,getCoreRowModel:(0,te.HT)(),getSortedRowModel:(0,te.h5)(),onSortingChange:d,enableColumnResizing:!0,columnResizeMode:"onChange",enableRowSelection:v,onRowSelectionChange:u,getRowId:e=>e.sessionId,state:{sorting:l,columnVisibility:p,rowSelection:c}}),h=f.getState().columnSizingInfo,y=m.useMemo((()=>{const e=f.getFlatHeaders(),t={};for(const n of e)t[`--col-${n.column.id}-size`]=n.column.getSize();return t}),[h,f,p]),b=(0,m.useMemo)((()=>f.getSelectedRowModel().rows.map((e=>e.original))),[c]);return(0,R.FD)("div",{css:(0,A.AH)({display:"flex",flexDirection:"column",flex:1,minHeight:0,position:"relative",marginTop:i.spacing.sm},""),children:[(0,R.Y)(Ma,{columns:Va,columnVisibility:p,setColumnVisibility:g,searchQuery:s,setSearchQuery:o,traceActions:a,experimentId:e,selectedSessions:b,setRowSelection:u}),(0,R.FD)(C.Table,{style:{...y},empty:n||0!==r.length?void 0:(0,R.Y)(Ra,{}),scrollable:!0,someRowsSelected:v?f.getIsAllRowsSelected()||f.getIsSomeRowsSelected():void 0,children:[(0,R.FD)(C.TableRow,{isHeader:!0,children:[v&&(0,R.Y)("div",{css:$a,children:(0,R.Y)(C.TableRowSelectCell,{componentId:"mlflow.chat-sessions.table-header-checkbox",checked:f.getIsAllRowsSelected(),indeterminate:f.getIsSomeRowsSelected(),onChange:f.getToggleAllRowsSelectedHandler()})}),f.getLeafHeaders().map((e=>(0,R.Y)(C.TableHeader,{componentId:"mlflow.chat-sessions.table-header",header:e,column:e.column,sortable:e.column.getCanSort(),css:(0,A.AH)({cursor:e.column.getCanSort()?"pointer":"default",flex:`calc(var(--col-${e.id}-size) / 100)`},""),sortDirection:e.column.getIsSorted()||"none",onToggleSort:e.column.getToggleSortingHandler(),children:(0,_n.Kv)(e.column.columnDef.header,e.getContext())},e.id)))]}),!n&&f.getRowModel().rows.map((e=>(0,R.Y)(Ua,{row:e,enableRowSelection:v},e.id))),n&&(0,R.Y)(C.TableSkeletonRows,{table:f})]})]})};var Ba=n(39595);const ja="getTrace";function Pa(e,t){const n=(0,Ba.jE)(),o=(0,Ro.E)({queries:(null!==t&&void 0!==t?t:[]).map((t=>{const n=function(e){var t;return(0,O.gD)(e)?e.trace_id:null!==(t=e.request_id)&&void 0!==t?t:""}(t);return{queryKey:[ja,n],queryFn:async()=>null===e||void 0===e?void 0:e(n,t),enabled:!(0,s.isNil)(e)&&Boolean(n),refetchOnWindowFocus:!1,retry:1,keepPreviousData:!0}}))});return{data:function(e){const t=(0,m.useRef)(),n=!(!t.current||e.length!==t.current.length)&&e.every(((e,n)=>{var s;return e===(null===(s=t.current)||void 0===s?void 0:s[n])}));return n||(t.current=e),n&&t.current?t.current:e}((0,s.compact)(o.map((e=>e.data)))),isLoading:o.some((e=>e.isLoading)),invalidateSingleTraceQuery:(0,m.useCallback)((e=>{n.invalidateQueries({queryKey:[ja,e]})}),[n])}}},33481:function(e,t,n){n.d(t,{_1:function(){return a},bz:function(){return o},o8:function(){return s}});let s=function(e){return e.Evaluations="_evaluations.json",e.Assessments="_assessments.json",e.Metrics="_metrics.json",e}({}),o=function(e){return e.IS_OVERALL_ASSESSMENT="is_overall_assessment",e.CHUNK_INDEX="chunk_index",e.IS_COPIED_FROM_AI="is_copied_from_ai",e}({}),a=function(e){return e.OVERALL_ASSESSMENT="overall_assessment",e.SAFETY="safety",e.GROUNDEDNESS="groundedness",e.CORRECTNESS="correctness",e.RELEVANCE_TO_QUERY="relevance_to_query",e.CHUNK_RELEVANCE="chunk_relevance",e.CONTEXT_SUFFICIENCY="context_sufficiency",e.GUIDELINE_ADHERENCE="guideline_adherence",e.GLOBAL_GUIDELINE_ADHERENCE="global_guideline_adherence",e.TOTAL_TOKEN_COUNT="agent/total_token_count",e.TOTAL_INPUT_TOKEN_COUNT="agent/total_input_token_count",e.TOTAL_OUTPUT_TOKEN_COUNT="agent/total_output_token_count",e.DOCUMENT_RECALL="retrieval/ground_truth/document_recall",e.DOCUMENT_RATINGS="retrieval/ground_truth/document_ratings",e}({})},34599:function(e,t,n){n.d(t,{P4:function(){return o},lA:function(){return a},uz:function(){return s}});const s="GET_DATASET_RECORDS",o="SEARCH_EVALUATION_DATASETS",a="FETCH_TRACES"},64667:function(e,t,n){n.d(t,{$6:function(){return o},RF:function(){return i},tl:function(){return s},w8:function(){return a}});let s=function(e){return e.EQUALS="=",e.NOT_EQUALS="!=",e.GREATER_THAN=">",e.LESS_THAN="<",e.GREATER_THAN_OR_EQUALS=">=",e.LESS_THAN_OR_EQUALS="<=",e.CONTAINS="CONTAINS",e}({}),o=function(e){return e.ASSESSMENT="ASSESSMENT",e.EXPECTATION="EXPECTATION",e.TRACE_INFO="TRACE_INFO",e.INPUT="INPUT",e.INTERNAL_MONITOR_REQUEST_TIME="INTERNAL_MONITOR_REQUEST_TIME",e}({}),a=function(e){return e.ASSESSMENT="ASSESSMENT",e.EXPECTATION="EXPECTATION",e.TAG="TAG",e.INFO="INFO",e}({});const i={[a.ASSESSMENT]:"Assessments",[a.EXPECTATION]:"Expectations",[a.TAG]:"Tags",[a.INFO]:"\xa0"}},69986:function(e,t,n){n.d(t,{RT:function(){return m},Rb:function(){return r},Uv:function(){return i},a_:function(){return p},fz:function(){return g},lc:function(){return f}});var s=n(12803),o=n(71540),a=n(13433);async function i(e,t){var n;if(!e)return;if((0,o.ZZ)(t)===o.Cf){const t=await(0,a.UA)({traceId:e});if(null!==t&&void 0!==t&&t.trace&&t.trace.data)return{info:t.trace.trace_info||{},data:t.trace.data}}const[i,r]=await Promise.all([s.x.getExperimentTraceInfoV3(e),s.x.getExperimentTraceData(e)]);return r?{info:(null===i||void 0===i||null===(n=i.trace)||void 0===n?void 0:n.trace_info)||{},data:r}:void 0}async function r(e){if(!e)return;const[t,n]=await Promise.all([s.x.getExperimentTraceInfo(e).then((e=>e.trace_info||{})),s.x.getExperimentTraceData(e)]);return n?{info:t,data:n}:void 0}function l(e){if("trace_id"in e&&"span_id"in e){return!e.parent_span_id}const t=e;return!t.parent_span_id&&!t.parent_id}function d(e){var t;return((null===(t=e.data)||void 0===t?void 0:t.spans)||[]).find(l)||null}function c(e){return"string"===typeof e?e:JSON.stringify(e)}function u(e,t,n){var s;if(t in e){const n=e[t];if(void 0!==n)return c(n)}return void 0!==(null===(s=e.attributes)||void 0===s?void 0:s[n])?c(e.attributes[n]):null}function m(e){const t=d(e);return t?u(t,"inputs","mlflow.spanInputs"):null}function p(e){const t=d(e);return t?u(t,"outputs","mlflow.spanOutputs"):null}function g(e){const t={},n=e.info;return n.assessments&&Array.isArray(n.assessments)?(n.assessments.forEach((e=>{var n;if(!function(e){return"expectation"in e}(e))return;if(!1===e.valid)return;if("HUMAN"!==(null===(n=e.source)||void 0===n?void 0:n.source_type))return;const s=function(e){if("value"in e)return e.value;if("serialized_value"in e&&e.serialized_value)try{return JSON.parse(e.serialized_value.value)}catch{return e.serialized_value.value}return null}(e.expectation);void 0!==s&&null!==s&&(t[e.assessment_name]=s)})),t):t}function v(e){if("trace_id"in e&&"span_id"in e){var t;let n=null===(t=e.attributes)||void 0===t?void 0:t["mlflow.spanType"];if("string"===typeof n&&n.startsWith('"')&&n.endsWith('"'))try{n=JSON.parse(n)}catch{}return"RETRIEVER"===n}let n=e.span_type;if("string"===typeof n&&n.startsWith('"')&&n.endsWith('"'))try{n=JSON.parse(n)}catch{}return"RETRIEVER"===n}function f(e){const t=function(e){var t;const n=(null===(t=e.data)||void 0===t?void 0:t.spans)||[];if(0===n.length)return[];const s=n.filter(v);if(0===s.length)return[];const o=new Set;for(const i of s){const e="span_id"in i?i.span_id:i.context.span_id;e&&o.add(e)}const a=[];for(const i of s){let e,t=!0;if("trace_id"in i&&"span_id"in i)e=i.parent_span_id;else{const t=i;e=t.parent_span_id||t.parent_id}for(;e;){if(o.has(e)){t=!1;break}let s;for(const t of n)if(("span_id"in t?t.span_id:t.context.span_id)===e){s=t;break}if(!s)break;if("trace_id"in s&&"span_id"in s)e=s.parent_span_id;else{const t=s;e=t.parent_span_id||t.parent_id}}t&&a.push(i)}return a}(e);if(0===t.length)return null;const n=[];for(const a of t){let e=[],t="",i="";if("trace_id"in a&&"span_id"in a){var s;const n=a;t=n.span_id||"",i=n.name||t;let o=null===(s=n.attributes)||void 0===s?void 0:s["mlflow.spanOutputs"];if("string"===typeof o)try{o=JSON.parse(o)}catch{continue}o&&"object"===typeof o&&Array.isArray(o)&&(e=o.map((e=>{var t;return{doc_uri:e.doc_uri||e.uri||(null===(t=e.metadata)||void 0===t?void 0:t.doc_uri)||"",content:e.content||e.page_content||""}})))}else{var o;const n=a;t=(null===(o=n.context)||void 0===o?void 0:o.span_id)||"",i=n.name||t,n.outputs&&Array.isArray(n.outputs)&&(e=n.outputs.map((e=>({doc_uri:e.doc_uri||e.uri||"",content:e.content||e.page_content||""}))))}e.length>0&&n.push({span_id:t,span_name:i,documents:e})}return 0===n.length?null:{retrieved_documents:n}}},71540:function(e,t,n){n.d(t,{Cf:function(){return p},Co:function(){return R},Mq:function(){return E},On:function(){return g},PO:function(){return f},ZS:function(){return I},ZZ:function(){return C},c7:function(){return b},d9:function(){return w},h:function(){return A},h2:function(){return v},ih:function(){return N},kQ:function(){return d},kZ:function(){return y},kf:function(){return u},nr:function(){return Y},nt:function(){return c},p6:function(){return S},v8:function(){return h}});var s=n(76118),o=n(28189),a=n(21636),i=n(90448),r=n(33481),l=n(4947);const d="mlflow.sourceRun",c="mlflow.",u="monitor",m="mlflow.trace.spansLocation",p="TRACKING_STORE",g=e=>(null===e||void 0===e?void 0:e.evaluationId)||"",v=e=>(null===e||void 0===e?void 0:e.trace_id)||"",f=e=>e.split(":").pop(),h=e=>e.split(":").pop(),y=e=>`${l.Pn}:${e}`,b=e=>`${l.rc}:${e}`,w=e=>(0,s.uniq)(e.map((e=>Object.keys(e.tags||{}).filter((e=>e&&!e.startsWith(c))))).flat()),S=(e,t)=>e&&t?e.reduce(((e,n)=>{var s;const o=n.assessments||[],i=o.filter((e=>{var n;const s=null===(n=e.metadata)||void 0===n?void 0:n[a.Vg];return!s||s===t}));return(null===(s=n.tags)||void 0===s?void 0:s[a.Ex])?e:i.length===o.length?(e.push(n),e):(e.push({...n,assessments:i}),e)}),[]):e,I=e=>e.length>0&&Boolean(e[0].traceInfo),x=e=>{try{return JSON.parse(e)}catch{return e}},A=e=>{var t;return e.request_preview||e.request||(null===(t=e.trace_metadata)||void 0===t?void 0:t["mlflow.traceInputs"])||""},E=e=>{var t;return e.response_preview||e.response||(null===(t=e.trace_metadata)||void 0===t?void 0:t["mlflow.traceOutputs"])||""};function C(e){return(null===e||void 0===e?void 0:e.tags[m])||void 0}const T=["agent/latency_seconds"];const _=e=>{var t,n,s,o,a;const i=null===(t=e.feedback)||void 0===t?void 0:t.value,l=e.assessment_name===r._1.OVERALL_ASSESSMENT,d=(e=>{var t,n,s;if(null===(t=e.source)||void 0===t||!t.source_type)return;const o=null===(n=e.source)||void 0===n?void 0:n.source_type;let a;return a="LLM_JUDGE"===o?"AI_JUDGE":o,{sourceType:a,sourceId:(null===(s=e.source)||void 0===s?void 0:s.source_id)||"",metadata:{}}})(e),c=(null===(n=e.feedback)||void 0===n?void 0:n.error)||e.error;return{name:e.assessment_name,stringValue:"string"===typeof i?i:void 0,booleanValue:"boolean"===typeof i?i:void 0,numericValue:"number"===typeof i?i:void 0,errorCode:null===c||void 0===c?void 0:c.error_code,errorMessage:null===c||void 0===c?void 0:c.error_message,rationale:(null===(s=e.metadata)||void 0===s?void 0:s.root_cause_rationale)||e.rationale,source:d,rootCauseAssessment:l?{assessmentName:(null===(o=e.metadata)||void 0===o?void 0:o.root_cause_assessment)||"",suggestedActions:null===(a=e.metadata)||void 0===a?void 0:a.suggested_action}:void 0,metadata:e.metadata}},N=e=>{var t;const n=v(e),a=[],l={},d={};null===(t=e.assessments)||void 0===t||t.forEach((e=>{const t=e.assessment_name;T.includes(t)||!1!==e.valid&&((e=>Boolean("expectation"in e&&e.expectation))(e)?function(e,t){const n=e.assessment_name,s=(0,o.ed)(e);Array.isArray(s)?t[n]=s.map((e=>"string"===typeof e?x(e):e)):t[n]="string"===typeof s?x(s):s}(e,d):function(e,t,n){const s=e.assessment_name,o=_(e);s===r._1.OVERALL_ASSESSMENT&&t.push(o),n[s]||(n[s]=[]),n[s].push(o)}(e,a,l))}));const c=A(e),u=E(e);let m=c,p={},g={};try{var f;p=JSON.parse(c);const e=p.messages;var h;if(Array.isArray(e)&&!(0,s.isNil)(null===(f=e[0])||void 0===f?void 0:f.content))m=null===(h=e[e.length-1])||void 0===h?void 0:h.content;else m=(0,i.ng)(p)}catch{p={request:c}}try{g={response:JSON.parse(u)}}catch{g={response:u}}return{evaluationId:n,requestId:e.client_request_id||n,inputsId:n,inputsTitle:m,inputs:p,outputs:g,targets:d,overallAssessments:a,responseAssessmentsByName:l,metrics:{},traceInfo:e}},R=e=>I(e)?e.map((e=>{if(!e.traceInfo)return e;const t=N(e.traceInfo);return{...e,...t}})):e;function Y(e,t){var n,a;if((0,s.isNil)(t))return;let i="doc_uri";const r=t.info.tags;if(null!==r&&void 0!==r&&r.retrievers){const e=x(r.retrievers);"object"===typeof e&&e.length>0&&(i=e[0].doc_uri)}const l=t.data.spans.filter((e=>{var t,n;return(null===(t=e.attributes)||void 0===t?void 0:t["mlflow.spanType"])&&x(null===(n=e.attributes)||void 0===n?void 0:n["mlflow.spanType"])===o.VZ.RETRIEVER}));if(0===l.length)return[];const d=null===(n=l.at(-1))||void 0===n||null===(a=n.attributes)||void 0===a?void 0:a["mlflow.spanOutputs"];if(!d)return[];const c=x(d);if(!Array.isArray(c))return[];return c.map(((t,n)=>{var s;return{docUrl:null===(s=t.metadata)||void 0===s?void 0:s[i],content:t.page_content,retrievalAssessmentsByName:M(e,n)}}))}const M=(e,t)=>Object.fromEntries(Object.entries(e).map((([e,n])=>[e,n.filter((e=>{var n;return Number(null===e||void 0===e||null===(n=e.metadata)||void 0===n?void 0:n.span_output_key)===t}))])).filter((([e,t])=>t.length>0)))},90448:function(e,t,n){n.d(t,{Au:function(){return I},CH:function(){return H},ER:function(){return F},FN:function(){return v},II:function(){return Y},PB:function(){return D},Pp:function(){return B},Qq:function(){return N},UN:function(){return S},Wp:function(){return K},Xe:function(){return U},YZ:function(){return L},Zh:function(){return M},_1:function(){return p},aj:function(){return O},bz:function(){return b},c9:function(){return x},eB:function(){return w},fu:function(){return k},gZ:function(){return h},hG:function(){return R},ik:function(){return V},jr:function(){return A},kp:function(){return g},mS:function(){return E},ng:function(){return j},pZ:function(){return f},rU:function(){return P},sw:function(){return _},uU:function(){return y},vP:function(){return $},w_:function(){return z},xO:function(){return q},yQ:function(){return C}});var s=n(68248),o=n(76118),a=n(27299),i=n(27757),r=n(42747),l=n(44666),d=n(9858),c=n(73408);const u="Error",m="messages";let p=function(e){return e.OVERALL_ASSESSMENT="overall_assessment",e.SAFETY="safety",e.GROUNDEDNESS="groundedness",e.RETRIEVAL_GROUNDEDNESS="retrieval_groundedness",e.CORRECTNESS="correctness",e.RELEVANCE_TO_QUERY="relevance_to_query",e.CHUNK_RELEVANCE="chunk_relevance",e.RETRIEVAL_RELEVANCE="retrieval_relevance",e.CONTEXT_SUFFICIENCY="context_sufficiency",e.RETRIEVAL_SUFFICIENCY="retrieval_sufficiency",e.GUIDELINE_ADHERENCE="guideline_adherence",e.GUIDELINES="guidelines",e.GLOBAL_GUIDELINE_ADHERENCE="global_guideline_adherence",e}({});const g=[p.OVERALL_ASSESSMENT,p.CORRECTNESS,p.GLOBAL_GUIDELINE_ADHERENCE,p.GUIDELINE_ADHERENCE,p.GUIDELINES,p.RELEVANCE_TO_QUERY,p.CONTEXT_SUFFICIENCY,p.RETRIEVAL_SUFFICIENCY,p.CHUNK_RELEVANCE,p.RETRIEVAL_RELEVANCE,p.GROUNDEDNESS,p.RETRIEVAL_GROUNDEDNESS,p.SAFETY],v=e=>"https://mlflow.org/docs/latest/genai/eval-monitor/scorers/llm-judge/",f={[p.OVERALL_ASSESSMENT]:{basePath:"/generative-ai/agent-evaluation/llm-judge-metrics",hash:"how-quality-is-assessed-by-llm-judges"},[p.CORRECTNESS]:{basePath:"/generative-ai/agent-evaluation/llm-judge-reference",hash:"correctness"},[p.GROUNDEDNESS]:{basePath:"/generative-ai/agent-evaluation/llm-judge-reference",hash:"groundedness"},[p.RETRIEVAL_GROUNDEDNESS]:{basePath:"/generative-ai/agent-evaluation/llm-judge-reference",hash:"groundedness"},[p.RELEVANCE_TO_QUERY]:{basePath:"/generative-ai/agent-evaluation/llm-judge-reference",hash:"answer-relevance"},[p.SAFETY]:{basePath:"/generative-ai/agent-evaluation/llm-judge-reference",hash:"safety"},[p.CHUNK_RELEVANCE]:{basePath:"/generative-ai/agent-evaluation/llm-judge-reference",hash:"chunk-relevance-precision"},[p.RETRIEVAL_RELEVANCE]:{basePath:"/generative-ai/agent-evaluation/llm-judge-reference",hash:"chunk-relevance-precision"},[p.CONTEXT_SUFFICIENCY]:{basePath:"/generative-ai/agent-evaluation/llm-judge-reference",hash:"context-sufficiency"},[p.RETRIEVAL_SUFFICIENCY]:{basePath:"/generative-ai/agent-evaluation/llm-judge-reference",hash:"context-sufficiency"},[p.GUIDELINE_ADHERENCE]:{basePath:"/generative-ai/agent-evaluation/llm-judge-reference",hash:"guideline-adherence"},[p.GUIDELINES]:{basePath:"/generative-ai/agent-evaluation/llm-judge-reference",hash:"guideline-adherence"}};let h=function(e){return e.YES="yes",e.NO="no",e.UNKNOWN="unknown",e}({});function y(e,t,n,o){return o===u?{content:e.formatMessage({id:"/DvT6Y",defaultMessage:"Error"})}:"pass-fail"===n.dtype?o===h.YES?{content:e.formatMessage({id:"pm1RNL",defaultMessage:"Pass"}),icon:(0,c.Y)("span",{css:(0,s.AH)({color:`${(0,d.CY)(t,n,{stringValue:h.YES})} !important`,svg:{width:"12px",height:"12px"}},""),children:(0,c.Y)(a.CheckCircleIcon,{css:(0,s.AH)({backgroundColor:(0,d.x2)(t,n,{stringValue:h.YES}),borderRadius:"50%"},"")})})}:o===h.NO?{content:e.formatMessage({id:"9cTaBs",defaultMessage:"Fail"}),icon:(0,c.Y)("span",{css:(0,s.AH)({color:`${(0,d.CY)(t,n,{stringValue:h.NO})} !important`,svg:{width:"12px",height:"12px"}},""),children:(0,c.Y)(a.XCircleIcon,{css:(0,s.AH)({backgroundColor:(0,d.x2)(t,n,{stringValue:h.NO}),borderRadius:"50%"},"")})})}:{content:e.formatMessage({id:"27XMby",defaultMessage:"Missing"}),icon:(0,c.Y)("span",{css:(0,s.AH)({color:`${(0,d.CY)(t,n,{stringValue:h.UNKNOWN})} !important`,svg:{width:"12px",height:"12px"}},""),children:(0,c.Y)(i.W,{css:(0,s.AH)({backgroundColor:(0,d.x2)(t,n,{stringValue:h.UNKNOWN}),borderRadius:"50%"},"")})})}:"boolean"===n.dtype?!0===o?{content:e.formatMessage({id:"1Ujhc3",defaultMessage:"True"})}:!1===o?{content:e.formatMessage({id:"nvjkTA",defaultMessage:"False"})}:{content:e.formatMessage({id:"keSIQ4",defaultMessage:"null"})}:{content:`${o}`}}let b=function(e){return e.IS_OVERALL_ASSESSMENT="is_overall_assessment",e.CHUNK_INDEX="chunk_index",e.IS_COPIED_FROM_AI="is_copied_from_ai",e}({});const w={response:(0,r.zR)({id:"WiaEQ3",defaultMessage:"Model output"})},S="expected_facts",I={expected_response:(0,r.zR)({id:"CX8ytv",defaultMessage:"Expected output"}),[S]:(0,r.zR)({id:"N1G2a5",defaultMessage:"Expected facts"})},x={[p.OVERALL_ASSESSMENT]:(0,r.zR)({id:"uoJWOm",defaultMessage:"Overall"}),[p.CORRECTNESS]:(0,r.zR)({id:"7+XQ3q",defaultMessage:"Correctness"}),[p.GROUNDEDNESS]:(0,r.zR)({id:"Ws58cc",defaultMessage:"Groundedness"}),[p.RETRIEVAL_GROUNDEDNESS]:(0,r.zR)({id:"wY58OE",defaultMessage:"Retrieval groundedness"}),[p.CONTEXT_SUFFICIENCY]:(0,r.zR)({id:"GRaplV",defaultMessage:"Context sufficiency"}),[p.RETRIEVAL_SUFFICIENCY]:(0,r.zR)({id:"mdzFsD",defaultMessage:"Retrieval sufficiency"}),[p.RELEVANCE_TO_QUERY]:(0,r.zR)({id:"Yhydp3",defaultMessage:"Relevance"}),[p.SAFETY]:(0,r.zR)({id:"jMUqD1",defaultMessage:"Safety"}),[p.CHUNK_RELEVANCE]:(0,r.zR)({id:"qnMgLj",defaultMessage:"Chunk relevance"}),[p.RETRIEVAL_RELEVANCE]:(0,r.zR)({id:"opUoF8",defaultMessage:"Retrieval relevance"}),[p.GUIDELINE_ADHERENCE]:(0,r.zR)({id:"xV6NWF",defaultMessage:"Guideline adherence"}),[p.GUIDELINES]:(0,r.zR)({id:"ls3868",defaultMessage:"Guidelines"}),[p.GLOBAL_GUIDELINE_ADHERENCE]:(0,r.zR)({id:"tUAhDM",defaultMessage:"Global guideline adherence"})},A={[p.CORRECTNESS]:(0,r.zR)({id:"i7UTwK",defaultMessage:"Correctness assessment is missing. This is likely because you have not provided an expected response (ground truth) or grading notes."}),[p.GROUNDEDNESS]:(0,r.zR)({id:"jPW0Lj",defaultMessage:"Groundedness assessment is missing. This is likely because your agent is not returning retrieved_context."}),[p.RETRIEVAL_GROUNDEDNESS]:(0,r.zR)({id:"TXPJuE",defaultMessage:"Retrieval Groundedness assessment is missing. This is likely because your agent is not returning retrieved_context."}),[p.CONTEXT_SUFFICIENCY]:(0,r.zR)({id:"g0tloS",defaultMessage:"Context sufficiency assessment is missing. This is likely because your agent is not returning retrieved_context."}),[p.RETRIEVAL_SUFFICIENCY]:(0,r.zR)({id:"ffIouW",defaultMessage:"Retrieval sufficiency assessment is missing. This is likely because your agent is not returning retrieved_context."})},E={[p.OVERALL_ASSESSMENT]:(0,r.zR)({id:"hW5ehW",defaultMessage:"The overall assessment passes when all of the judges pass."}),[p.CORRECTNESS]:(0,r.zR)({id:"Y6gWro",defaultMessage:"The correctness LLM judge gives a binary evaluation and written rationale on whether the agent's generated response is factually accurate and semantically similar to the provided ground-truth response or grading notes."}),[p.GROUNDEDNESS]:(0,r.zR)({id:"+Wd9fs",defaultMessage:"The groundedness LLM judge returns a binary evaluation and written rationale on whether the generated response is factually consistent with the agent's retrieved context."}),[p.RETRIEVAL_GROUNDEDNESS]:(0,r.zR)({id:"6Q/0BO",defaultMessage:"The retrieval groundedness LLM judge returns a binary evaluation and written rationale on whether the generated response is factually consistent with the agent's retrieved context."}),[p.RELEVANCE_TO_QUERY]:(0,r.zR)({id:"oDwj2g",defaultMessage:"The relevance_to_query LLM judge determines whether the response is relevant to the input request."}),[p.SAFETY]:(0,r.zR)({id:"/gqx4n",defaultMessage:"The safety LLM judge returns a binary rating and a written rationale on whether the generated response has harmful or toxic content."}),[p.CHUNK_RELEVANCE]:(0,r.zR)({id:"aUOkOC",defaultMessage:"The chunk-relevance-precision LLM judge determines whether the chunks returned by the retriever are relevant to the input request. Precision is calculated as the number of relevant chunks returned divided by the total number of chunks returned. For example, if the retriever returns four chunks, and the LLM judge determines that three of the four returned documents are relevant to the request, then llm_judged/chunk_relevance/precision is 0.75."}),[p.RETRIEVAL_RELEVANCE]:(0,r.zR)({id:"rBydei",defaultMessage:"The retrieval-relevance LLM judge determines whether the chunks returned by the retriever are relevant to the input request. Precision is calculated as the number of relevant chunks returned divided by the total number of chunks returned. For example, if the retriever returns four chunks, and the LLM judge determines that three of the four returned documents are relevant to the request, then llm_judged/chunk_relevance/precision is 0.75."}),[p.CONTEXT_SUFFICIENCY]:(0,r.zR)({id:"bkWot5",defaultMessage:"The context sufficiency LLM judge determines whether the retrieved context is sufficient to generate the expected response."}),[p.RETRIEVAL_SUFFICIENCY]:(0,r.zR)({id:"fwxkdN",defaultMessage:"The retrieval sufficiency LLM judge determines whether the retrieved context is sufficient to generate the expected response."}),[p.GUIDELINE_ADHERENCE]:(0,r.zR)({id:"4Tg5Vr",defaultMessage:"The guideline adherence LLM judge determines whether the response adheres to the guidelines provided."}),[p.GUIDELINES]:(0,r.zR)({id:"98v9a0",defaultMessage:"The guidelines LLM judge determines whether the response adheres to the guidelines provided. All responses must adhere to guidelines."}),[p.GLOBAL_GUIDELINE_ADHERENCE]:(0,r.zR)({id:"zZ9sIi",defaultMessage:"The global guideline adherence LLM judge determines whether the response adheres to the global guidelines provided. All responses must adhere to global guidelines."})},C={[p.OVERALL_ASSESSMENT]:{[h.YES]:(0,r.zR)({id:"Za9+Cg",defaultMessage:"Pass"}),[h.NO]:(0,r.zR)({id:"j77+aP",defaultMessage:"Fail"})},[p.CHUNK_RELEVANCE]:{[h.YES]:(0,r.zR)({id:"B1Upnc",defaultMessage:"Relevant"}),[h.NO]:(0,r.zR)({id:"M+HfWb",defaultMessage:"Irrelevant"})},[p.RETRIEVAL_RELEVANCE]:{[h.YES]:(0,r.zR)({id:"++039K",defaultMessage:"Relevant"}),[h.NO]:(0,r.zR)({id:"akmaST",defaultMessage:"Irrelevant"})},[p.CONTEXT_SUFFICIENCY]:{[h.YES]:(0,r.zR)({id:"7S/ozs",defaultMessage:"Context sufficient"}),[h.NO]:(0,r.zR)({id:"aAAHaS",defaultMessage:"Context insufficient"})},[p.RETRIEVAL_SUFFICIENCY]:{[h.YES]:(0,r.zR)({id:"rBIGDf",defaultMessage:"Sufficient"}),[h.NO]:(0,r.zR)({id:"lhFnAG",defaultMessage:"Insufficient"})},[p.RELEVANCE_TO_QUERY]:{[h.YES]:(0,r.zR)({id:"rNkAcB",defaultMessage:"Relevant"}),[h.NO]:(0,r.zR)({id:"0M7VVC",defaultMessage:"Irrelevant"})},[p.GROUNDEDNESS]:{[h.YES]:(0,r.zR)({id:"/2InJv",defaultMessage:"Grounded"}),[h.NO]:(0,r.zR)({id:"ZfsnMj",defaultMessage:"Not grounded"})},[p.RETRIEVAL_GROUNDEDNESS]:{[h.YES]:(0,r.zR)({id:"e515YD",defaultMessage:"Grounded"}),[h.NO]:(0,r.zR)({id:"uSVfB9",defaultMessage:"Not grounded"})},[p.CORRECTNESS]:{[h.YES]:(0,r.zR)({id:"eSxQmg",defaultMessage:"Correct"}),[h.NO]:(0,r.zR)({id:"LhxSrc",defaultMessage:"Incorrect"})},[p.SAFETY]:{[h.YES]:(0,r.zR)({id:"DMOaoR",defaultMessage:"Safe"}),[h.NO]:(0,r.zR)({id:"CX/MSu",defaultMessage:"Unsafe"})},[p.GUIDELINE_ADHERENCE]:{[h.YES]:(0,r.zR)({id:"ZNYFUr",defaultMessage:"Adheres to guidelines"}),[h.NO]:(0,r.zR)({id:"hIBLi9",defaultMessage:"Violates guidelines"})},[p.GUIDELINES]:{[h.YES]:(0,r.zR)({id:"luV/3W",defaultMessage:"Adheres to guidelines"}),[h.NO]:(0,r.zR)({id:"WmgIQ+",defaultMessage:"Violates guidelines"})},[p.GLOBAL_GUIDELINE_ADHERENCE]:{[h.YES]:(0,r.zR)({id:"mtYPI8",defaultMessage:"Adheres to global guidelines"}),[h.NO]:(0,r.zR)({id:"rZyNgx",defaultMessage:"Violates global guidelines"})}},T=e=>{var t;return"AI_JUDGE"===(null===e||void 0===e||null===(t=e.source)||void 0===t?void 0:t.sourceType)},_=e=>{let t=N(e,"request");return(0,o.isNil)(t)&&(t=N(e,m)),(0,o.isNil)(t)&&!(0,o.isNil)(e.inputs)&&Object.keys(e.inputs).length>0&&(t=j(e.inputs)),((0,o.isNil)(t)||""===t)&&(t=e.evaluationId),t},N=(e,t)=>{var n,s;if(!(0,o.isNil)(e.inputsTitle))return"string"===typeof e.inputsTitle?e.inputsTitle:JSON.stringify(e.inputsTitle);let a;const i=e.inputs[t];var r;if((0,o.isPlainObject)(i)&&!(0,o.isNil)(i[m])&&Array.isArray(i[m])&&!(0,o.isNil)(null===(n=i[m][0])||void 0===n?void 0:n.content))a=null===(r=i[m][i[m].length-1])||void 0===r?void 0:r.content;else if((0,o.isNil)(i)||!Array.isArray(i)||(0,o.isNil)(null===(s=i[0])||void 0===s?void 0:s.content))a=i?j(i):void 0;else{var l;a=null===(l=i[i.length-1])||void 0===l?void 0:l.content}return a},R=e=>{var t;return!0===(null===(t=e.metadata)||void 0===t?void 0:t[b.IS_OVERALL_ASSESSMENT])},Y=e=>{var t;return(0,o.isNumber)(null===(t=e.metadata)||void 0===t?void 0:t[b.CHUNK_INDEX])},M=e=>{var t,n;const s=null!==(t=null!==(n=e.stringValue)&&void 0!==n?n:e.numericValue)&&void 0!==t?t:e.booleanValue;if(!(0,o.isNil)(s))return s};function k(e,t){let n=e;const s=n.startsWith("#");s&&(n=e.slice(1));return`${s?"#":""}${n}${Math.round(255*Math.min(Math.max(t,0),1)).toString(16).toUpperCase()}`}const D=[p.GUIDELINE_ADHERENCE,p.GUIDELINES,p.GLOBAL_GUIDELINE_ADHERENCE,p.RELEVANCE_TO_QUERY,p.CONTEXT_SUFFICIENCY,p.RETRIEVAL_SUFFICIENCY,p.CORRECTNESS,p.GROUNDEDNESS,p.RETRIEVAL_GROUNDEDNESS,p.SAFETY],F=[p.CHUNK_RELEVANCE],O=({name:e,isOverallAssessment:t,value:n,rationale:s,metadata:o={}})=>{var a;const i=null!==(a=(0,l.w)())&&void 0!==a?a:"";return{booleanValue:"boolean"===typeof n?n:null,numericValue:null,stringValue:"boolean"!==typeof n?n:null,name:e,metadata:t?{...o,[b.IS_OVERALL_ASSESSMENT]:!0}:o,rationale:null!==s&&void 0!==s?s:null,source:{sourceId:i,sourceType:"HUMAN",metadata:{}},timestamp:Date.now(),isDraft:!0}},V=(e,t)=>e.overallAssessments.length>0&&e.overallAssessments.every(T)&&!t.some(R),L=e=>{var t;const n=e.overallAssessments.find(T);if(!n)return null;const s=null!==(t=(0,l.w)())&&void 0!==t?t:"";return{...n,timestamp:Date.now(),isDraft:!0,source:{sourceType:"HUMAN",sourceId:s,metadata:{}},metadata:{...n.metadata,[b.IS_COPIED_FROM_AI]:!0}}},H=e=>"isDraft"in e&&e.isDraft,U=e=>(0,o.orderBy)(Object.entries(e),(([e,t],n)=>{const s=g.indexOf(e);return-1!==s?s:null!==(o=null===(a=t[t.length-1])||void 0===a?void 0:a.timestamp)&&void 0!==o?o:n;var o,a})),$=e=>{var t,n;return null!==(t=null===(n=e.overallAssessments)||void 0===n?void 0:n.filter((e=>!H(e))).some((e=>!T(e))))&&void 0!==t&&t},z=e=>{var t,n;return"HUMAN"===(null===(t=e.source)||void 0===t?void 0:t.sourceType)&&!(null!==(n=e.metadata)&&void 0!==n&&n[b.IS_COPIED_FROM_AI])},B=e=>{var t;return null===(t=e.metadata)||void 0===t?void 0:t[b.CHUNK_INDEX]},j=e=>(0,o.isPlainObject)(e)||Array.isArray(e)?JSON.stringify(e,void 0,2):e,P=(e,t,n,s)=>{if(t){const n=C[t.name];return n?Object.entries(n).map((([n,s])=>({key:n,label:e.formatMessage(s),rootAssessmentName:t.name}))):[]}return(s||[]).filter((e=>"boolean"===e.dtype)).map((e=>({key:e.name,label:e.name,rootAssessmentName:e.name,disabled:null===n||void 0===n?void 0:n.some((t=>t.name===e.name))})))},q=e=>{if(e){const t=Boolean(e.rationale),n=!(0,o.isNil)(M(e)),s=Boolean(e.errorMessage);return!(t||n||s)}return!1},K=e=>Array.isArray(e)&&e.every((e=>(0,o.isPlainObject)(e)&&"doc_uri"in e&&"content"in e))},93241:function(e,t,n){n.d(t,{F9:function(){return r},Mq:function(){return a},UK:function(){return s},ij:function(){return o},pR:function(){return i}});const s=()=>!1,o=()=>!0,a=()=>500,i=()=>1e3,r=()=>!1}}]);
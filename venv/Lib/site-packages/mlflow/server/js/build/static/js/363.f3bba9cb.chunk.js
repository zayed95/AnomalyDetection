"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[363],{10363:function(e,t,n){n.d(t,{$:function(){return Ge}});var a=n(68248),i=n(27757),s=n(46709),r=n(12803),o=n(77680),l=n(76118);const d="mlflow.traceName",c=(e,t)=>{var n,a;return null===(n=e.request_metadata)||void 0===n||null===(a=n.find((({key:e})=>e===t)))||void 0===a?void 0:a.value},u=e=>c(e,"mlflow.sourceRun"),m=e=>c(e,"total_tokens"),g=e=>{const t=c(e,"mlflow.traceInputs");if(!(0,l.isNil)(t))try{return JSON.stringify(JSON.parse(t))}catch(n){return t}},p=e=>{const t=c(e,"mlflow.traceOutputs");if(!(0,l.isNil)(t))try{return JSON.stringify(JSON.parse(t))}catch(n){return t}},h=(e,t)=>{var n,a,i;return Array.isArray(e.tags)?null===(a=e.tags)||void 0===a||null===(i=a.find((({key:e})=>e===t)))||void 0===i?void 0:i.value:null===(n=e.tags)||void 0===n?void 0:n[t]},f=e=>h(e,d)||e.request_id,v=["timestamp_ms"],w="select";let b=function(e){return e.requestId="request_id",e.traceName="traceName",e.timestampMs="timestamp_ms",e.inputs="inputs",e.outputs="outputs",e.runName="runName",e.totalTokens="total_tokens",e.source="source",e.latency="latency",e.tags="tags",e.status="status",e}({});const x={[b.requestId]:(0,o.zR)({id:"0HqSXX",defaultMessage:"Request ID"}),[b.traceName]:(0,o.zR)({id:"60C/WF",defaultMessage:"Trace name"}),[b.timestampMs]:(0,o.zR)({id:"V3BImd",defaultMessage:"Time created"}),[b.status]:(0,o.zR)({id:"PBkS4s",defaultMessage:"Status"}),[b.inputs]:(0,o.zR)({id:"TQZ+X6",defaultMessage:"Request"}),[b.outputs]:(0,o.zR)({id:"pHAqL+",defaultMessage:"Response"}),[b.runName]:(0,o.zR)({id:"yltHdB",defaultMessage:"Run name"}),[b.totalTokens]:(0,o.zR)({id:"O5FKCr",defaultMessage:"Tokens"}),[b.source]:(0,o.zR)({id:"eM4+ab",defaultMessage:"Source"}),[b.latency]:(0,o.zR)({id:"6oYktw",defaultMessage:"Execution time"}),[b.tags]:(0,o.zR)({id:"4qVc2+",defaultMessage:"Tags"})},S={UNSET:null,IN_PROGRESS:(0,o.zR)({id:"y56Vz9",defaultMessage:"In progress"}),OK:(0,o.zR)({id:"Mn7Kss",defaultMessage:"OK"}),ERROR:(0,o.zR)({id:"igK5Su",defaultMessage:"Error"})};var y=n(28126);const k="request_metadata.`mlflow.sourceRun`",I="request_metadata.`mlflow.modelId`",_=e=>`run_id IN (${e.map((e=>`'${e}'`)).join(",")})`,Y=({experimentIds:e,sorting:t,filter:n="",runUuid:a,loggedModelId:i})=>{const[o,d]=(0,s.useState)([]),[c,m]=(0,s.useState)(!0),[g,p]=(0,s.useState)(void 0),h=(0,s.useMemo)((()=>{const e=(0,l.first)(t);return e&&v.includes(e.id)?`${e.id} ${e.desc?"DESC":"ASC"}`:"timestamp_ms DESC"}),[t]),f=(0,s.useMemo)((()=>a||i?i?n?`${n} AND ${I}='${i}'`:`${I}='${i}'`:n?`${n} AND ${k}='${a}'`:`${k}='${a}'`:n),[n,a,i]),[w,b]=(0,s.useState)({0:void 0}),[x,S]=(0,s.useState)(0),Y=w[x],C=(0,s.useCallback)((async({experimentIds:e,currentPage:t=0,pageToken:n,silent:a,orderByString:i="",filterString:s=""})=>{a||m(!0),p(void 0);try{const a=await r.x.getExperimentTraces(e,i,n,s);if(!a.traces)return void d([]);const o=await(async(e,t)=>{const n=t.reduce(((e,t)=>{const n=t.request_id,a=u(t);return n&&a?{...e,[n]:a}:e}),{}),a=(0,l.uniq)((0,l.values)(n));if(a.length<1)return{};const i=((await r.x.searchRuns({experiment_ids:e,filter:_(a),run_view_type:y.qi.ALL})).runs||[]).reduce(((e,t)=>({...e,[t.info.runUuid]:t.info.runName})),{});return t.reduce(((e,t)=>{const a=t.request_id;if(!a)return e;const s=n[a];return{...e,[a]:i[s]||s}}),{})})(e,a.traces),c=a.traces.map((e=>{const t=e.request_id;if(!t)return{...e};const n=o[t];return{...e,runName:n}}));d(c),b((e=>({...e,[t+1]:a.next_page_token})))}catch(o){p(o)}finally{m(!1)}}),[]),T=!c&&void 0!==w[x+1],M=!c&&(1===x||void 0!==w[x-1]);(0,s.useEffect)((()=>{C({experimentIds:e,filterString:f,orderByString:h})}),[C,f,e,h]);const R=(0,s.useCallback)((()=>{d([]),b({0:void 0}),S(0),C({experimentIds:e})}),[C,e]);return{traces:o,loading:c,error:g,hasNextPage:T,hasPreviousPage:M,fetchNextPage:(0,s.useCallback)((()=>{S((e=>e+1)),C({experimentIds:e,currentPage:x+1,pageToken:w[x+1],filterString:f,orderByString:h})}),[e,x,C,w,f,h]),fetchPrevPage:(0,s.useCallback)((()=>{S((e=>e-1)),C({experimentIds:e,currentPage:x-1,pageToken:w[x-1],filterString:f,orderByString:h})}),[e,x,C,w,f,h]),refreshCurrentPage:(0,s.useCallback)(((t=!1)=>C({experimentIds:e,currentPage:x,pageToken:Y,silent:t,filterString:f,orderByString:h})),[e,x,C,Y,f,h]),reset:R}};var C=n(76256),T=n(27299),M=n(90061),R=n(43617),A=n(11522),D=n(91105),N=n(77153),P=n(60284),E=n(7655),z=n(40724),F=n(181),q=n(59281),H=n(73408);var $={name:"1wcfv52",styles:"margin-right:0"},L={name:"14cnl6e",styles:"flex-shrink:0;opacity:0;[role=row]:hover &{opacity:1;}[role=row]:focus-within &{opacity:1;}"};const O=({onAddEditTags:e,tags:t,baseComponentId:n})=>{const{theme:s}=(0,i.u)(),r=(null===t||void 0===t?void 0:t.filter((({key:e})=>e&&!e.startsWith(F.nt))))||[],o=r.length>0;return(0,H.FD)("div",{css:(0,a.AH)({display:"flex",alignItems:"center",flexWrap:"wrap",columnGap:s.spacing.xs,rowGap:s.spacing.xs},""),children:[r.map((e=>(0,H.Y)(q.t,{tag:e,css:$,charLimit:20,maxWidth:150,enableFullViewModal:!0},e.key)))," ",(0,H.Y)(i.B,{componentId:`${n}.traces_table.edit_tag`,size:"small",icon:o?(0,H.Y)(T.PencilIcon,{}):void 0,onClick:e,children:o?void 0:(0,H.Y)(z.A,{id:"vHNP+J",defaultMessage:"Add tags"}),css:L,type:"tertiary"})]})};var B=n(66916);const U=(e,t)=>"IN_PROGRESS"===e?(0,H.Y)(B.C,{css:(0,a.AH)({color:t.colors.textValidationWarning},"")}):"OK"===e?(0,H.Y)(T.CheckCircleIcon,{css:(0,a.AH)({color:t.colors.textValidationSuccess},"")}):"ERROR"===e?(0,H.Y)(T.XCircleIcon,{css:(0,a.AH)({color:t.colors.textValidationDanger},"")}):null,W=({row:{original:e}})=>{const{theme:t}=(0,i.u)(),n=(0,E.A)(),s=S[e.status||"UNSET"];return(0,H.FD)("div",{css:(0,a.AH)({display:"flex",gap:t.spacing.xs,alignItems:"center"},""),children:[U(e.status,t),s?n.formatMessage(s):""]})};var J=n(19112);const K={name:"rthgne",styles:"display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical"};var V={name:"ozd7xs",styles:"flex-shrink:0"};const j=({value:e,traceId:t,previewFieldName:n})=>{const{theme:o}=(0,i.u)(),[d,c]=(0,s.useState)(!1),[u,m]=(0,s.useState)(null),[g,p]=(0,s.useState)(!1),h=(0,s.useCallback)((async()=>{p(!0);try{const e=await r.x.getExperimentTraceData(t);if(n in e){const t=e[n],a=(0,l.isString)(t)?t:JSON.stringify(t);m(a)}}catch(e){const t=e instanceof N.s?e.getUserVisibleError():e.message;A.A.logErrorAndNotifyUser(`Error fetching response: ${t}`)}p(!1)}),[n,t]),f=e.length>=250;const v=(0,s.useCallback)((async()=>{!u&&f&&await h(),c(!0)}),[u,h,f]),w=(0,s.useCallback)((()=>{c(!1)}),[]);return(0,H.FD)("div",{css:(0,a.AH)({display:"flex",gap:o.spacing.xs},""),children:[(0,H.Y)(i.B,{componentId:"mlflow.traces.traces_table.expand_cell_preview",size:"small",icon:d?(0,H.Y)(T.ChevronDownIcon,{}):(0,H.Y)(i.o,{}),onClick:d?w:v,css:V,loading:g,type:"primary"}),(0,H.Y)("div",{title:e,css:["overflow:hidden;text-overflow:ellipsis;",!d&&K,""],children:d?(0,H.Y)(G,{value:null!==u&&void 0!==u?u:e}):e})]})},G=({value:e})=>{const{theme:t}=(0,i.u)(),n=(0,s.useMemo)((()=>{try{const t=JSON.parse(e);return JSON.stringify(t,null,2)}catch(t){return null}}),[e]);return(0,H.Y)("div",{css:(0,a.AH)({whiteSpace:"pre-wrap",wordBreak:"break-word",fontFamily:n?"monospace":void 0},""),children:(0,H.Y)(J.z7,{language:"json",wrapLongLines:!0,style:{padding:t.spacing.sm},theme:t.isDarkMode?"duotoneDark":"light",children:n||e})})},Z=({row:{original:e}})=>(0,H.Y)(j,{previewFieldName:"request",traceId:e.request_id||"",value:g(e)||""}),X=({row:{original:e}})=>(0,H.Y)(j,{previewFieldName:"response",traceId:e.request_id||"",value:p(e)||""});var Q=n(71625);const ee=({row:{original:e}})=>(0,H.Y)(Q.t,{value:(0,l.keyBy)(e.tags,"key")}),te=e=>`--header-${e}-size`,ne=e=>`--col-${e}-size`,ae=s.memo((({row:e})=>{const{theme:t}=(0,i.u)();return(0,H.Y)("div",{role:"row","data-testid":"endpoints-list-table-rows",css:(0,a.AH)({minHeight:t.general.buttonHeight,display:"flex",flexDirection:"row",":hover":{backgroundColor:"var(--table-row-hover)"},paddingRight:"32px",borderBottom:"1px solid var(--table-separator-color)"},""),children:e.getAllCells().map((e=>{var n,a;const i=null===(n=e.column.columnDef.meta)||void 0===n?void 0:n.multiline,s=e.column.id===w?t.spacing.sm:`${t.spacing.sm}px ${t.spacing.xs}px`;return(0,H.Y)("div",{role:"cell",css:[{"--table-row-vertical-padding":`${t.spacing.sm}px`,flex:`calc(var(${ne(e.column.id)}) / 100)`,overflow:"hidden",whiteSpace:i?"pre-wrap":"nowrap",textOverflow:i?"ellipsis":void 0,padding:s},null===(a=e.column.columnDef.meta)||void 0===a?void 0:a.styles,""],children:(0,R.Kv)(e.column.columnDef.cell,e.getContext())},e.id)}))},e.id)}),((e,t)=>e.columns===t.columns&&e.selected===t.selected&&(0,l.isEqual)(e.row.original.tags,t.row.original.tags)));var ie=n(79081);const se=s.memo((({row:{original:e}})=>e.timestamp_ms?(0,H.Y)(ie.T,{componentId:"mlflow.experiment-tracking.traces-timestamp.display",content:new Date(e.timestamp_ms).toLocaleString(navigator.language,{timeZoneName:"short"}),side:"right",children:(0,H.Y)("span",{children:A.A.timeSinceStr(e.timestamp_ms)})}):null),(()=>!0)),re=({table:e})=>{const t=e.getIsAllRowsSelected()||!!e.getIsSomeRowsSelected()&&null;return(0,H.Y)(T.Checkbox,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_traces_tracesviewtableheadercheckbox.tsx_14","data-testid":"trace-table-header-checkbox",isChecked:t,wrapperStyle:{padding:0,margin:0},onChange:e.toggleAllRowsSelected})},oe=({row:e})=>(0,H.Y)(T.Checkbox,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_traces_tracesviewtablecellcheckbox.tsx_12","data-testid":`trace-table-cell-checkbox-${e.id}`,disabled:!e.getCanSelect(),isChecked:e.getIsSelected(),wrapperStyle:{padding:0,margin:0},onChange:()=>e.toggleSelected()});var le=n(39767),de=n(31655);var ce={name:"s09txq",styles:"max-width:100%;text-overflow:ellipsis"};const ue=({row:{original:e},table:{options:{meta:t}}})=>{const{baseComponentId:n,onTraceClicked:a}=t;return(0,H.Y)(i.T.Link,{componentId:`${n}.traces_table.request_id_link`,ellipsis:!0,css:ce,onClick:()=>{null===a||void 0===a||a(e)},children:e.request_id})};var me={name:"s09txq",styles:"max-width:100%;text-overflow:ellipsis"};const ge=({row:{original:e},table:{options:{meta:t}}})=>{const{baseComponentId:n,onTraceClicked:a}=t;return(0,H.Y)(i.T.Link,{componentId:`${n}.traces_table.trace_name_link`,ellipsis:!0,css:me,onClick:()=>{null===a||void 0===a||a(e)},children:h(e,d)})};var pe={name:"hgn0g7",styles:"max-width:100%;text-overflow:ellipsis;display:inline-block;overflow:hidden"};const he=({row:{original:e}})=>{const t=u(e);if(!t||!e.experiment_id)return null;const n=e.runName||t;return(0,H.Y)(D.N_,{css:pe,to:P.Ay.getRunPageRoute(e.experiment_id,t),children:n})},fe=({row:{original:e},table:{options:{meta:t}}})=>{const{onTraceTagsEdit:n,baseComponentId:a}=t;return(0,H.Y)(O,{tags:e.tags||[],onAddEditTags:()=>null===n||void 0===n?void 0:n(e),baseComponentId:a})};var ve={name:"s09txq",styles:"max-width:100%;text-overflow:ellipsis"},we={name:"s09txq",styles:"max-width:100%;text-overflow:ellipsis"},be={name:"hgn0g7",styles:"max-width:100%;text-overflow:ellipsis;display:inline-block;overflow:hidden"};const xe=s.memo((({experimentIds:e,runUuid:t,traces:n,loading:a,error:r,onTraceClicked:o,onTraceTagsEdit:c,hasNextPage:g,hasPreviousPage:p,onNextPage:f,onPreviousPage:v,usingFilters:S,onResetFilters:y,sorting:k,setSorting:I,rowSelection:_,setRowSelection:Y,hiddenColumns:F=[],disableTokenColumn:q,baseComponentId:$,toggleHiddenColumn:L,disabledColumns:B=[]})=>{const U=(0,E.A)(),{theme:J}=(0,i.u)(),K=!a&&0===n.length&&!S&&!r,V=(0,de.rR)(),j=(0,s.useMemo)((()=>(0,l.entries)(x).map((([e,t])=>({key:e,label:U.formatMessage(t)}))).filter((({key:e})=>!B.includes(e)))),[U,B]),G=(0,s.useMemo)((()=>{if(K)return[];const e=[{id:w,header:re,enableResizing:!1,enableSorting:!1,cell:oe,meta:{styles:{minWidth:32,maxWidth:32}}},{header:U.formatMessage(x[b.requestId]),enableSorting:!1,enableResizing:!0,id:b.requestId,cell:V?ue:({row:{original:e}})=>(0,H.Y)(i.T.Link,{componentId:`${$}.traces_table.request_id_link`,ellipsis:!0,css:ve,onClick:()=>{null===o||void 0===o||o(e)},children:e.request_id}),meta:{styles:{minWidth:200}}},{header:U.formatMessage(x[b.traceName]),enableSorting:!1,enableResizing:!0,id:b.traceName,cell:V?ge:({row:{original:e}})=>(0,H.Y)(i.T.Link,{componentId:`${$}.traces_table.trace_name_link`,ellipsis:!0,css:we,onClick:()=>{null===o||void 0===o||o(e)},children:h(e,d)}),meta:{styles:{minWidth:150}}},{header:U.formatMessage(x[b.timestampMs]),id:b.timestampMs,accessorFn:e=>e.timestamp_ms,enableSorting:!0,enableResizing:!0,cell:se,meta:{styles:{minWidth:100}}},{header:U.formatMessage(x[b.status]),id:b.status,enableSorting:!1,enableResizing:!0,cell:W,meta:{styles:{minWidth:100}}},{header:U.formatMessage(x[b.inputs]),id:b.inputs,enableSorting:!1,enableResizing:!0,cell:Z,meta:{multiline:!0}},{header:U.formatMessage(x[b.outputs]),enableSorting:!1,enableResizing:!0,id:b.outputs,cell:X,meta:{multiline:!0}},{header:U.formatMessage(x[b.runName]),enableSorting:!1,enableResizing:!0,id:b.runName,cell:V?he:({row:{original:e}})=>{const t=u(e);if(!t||!e.experiment_id)return null;const n=e.runName||t;return(0,H.Y)(D.N_,{css:be,to:P.Ay.getRunPageRoute(e.experiment_id,t),children:n})}},{header:U.formatMessage(x[b.source]),enableSorting:!0,enableResizing:!0,id:b.source,cell:ee,meta:{styles:{minWidth:100}}}];return q||e.push({header:U.formatMessage(x[b.totalTokens]),enableSorting:!1,enableResizing:!0,id:b.totalTokens,accessorFn:e=>m(e),meta:{styles:{minWidth:80,maxWidth:80}}}),e.push({header:U.formatMessage(x[b.latency]),enableSorting:!1,enableResizing:!0,id:b.latency,accessorFn:e=>(0,l.isNil)(e.execution_time_ms)||!isFinite(e.execution_time_ms)?null:A.A.formatDuration(e.execution_time_ms),meta:{styles:{minWidth:100}}},{header:U.formatMessage(x[b.tags]),enableSorting:!1,enableResizing:!0,id:b.tags,cell:V?fe:({row:{original:e}})=>(0,H.Y)(O,{tags:e.tags||[],onAddEditTags:()=>null===c||void 0===c?void 0:c(e),baseComponentId:$})}),e.filter((e=>e.id&&!F.includes(e.id)))}),[U,o,c,q,F,$,V,K]),Q=(0,C.L)("mlflow/server/js/src/experiment-tracking/components/traces/TracesViewTable.tsx",{columns:G,data:K?[]:n,state:{sorting:k,rowSelection:_},getCoreRowModel:(0,M.HT)(),getRowId:(e,t)=>e.request_id||t.toString(),getSortedRowModel:(0,M.h5)(),onSortingChange:I,onRowSelectionChange:Y,enableColumnResizing:!0,enableRowSelection:!0,columnResizeMode:"onChange",meta:{baseComponentId:$,onTraceClicked:o,onTraceTagsEdit:c}}),ie=Q.getState().columnSizingInfo,ce=s.useMemo((()=>{if(K)return{};const e=Q.getFlatHeaders(),t={};return e.forEach((e=>{t[te(e.id)]=e.getSize(),t[ne(e.column.id)]=e.column.getSize()})),t}),[ie,G,Q,K]);return K?(0,H.Y)(le.i,{baseComponentId:$,runUuid:t}):(0,H.FD)(T.Table,{scrollable:!0,empty:(()=>{if(r){const e=r instanceof N.s?r.getMessageField():r.message;return(0,H.Y)(T.Empty,{image:(0,H.Y)(i.k,{}),description:e,title:(0,H.Y)(z.A,{id:"Cj2i02",defaultMessage:"Error"})})}return!a&&0===n.length&&S?(0,H.Y)(T.Empty,{description:(0,H.Y)(z.A,{id:"LTe7m4",defaultMessage:"No traces found with the current filter query. <button>Reset filters</button> to see all traces.",values:{button:e=>(0,H.Y)(i.T.Link,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_traces_tracesviewtable.tsx_289",onClick:y,children:e})}}),title:(0,H.Y)(z.A,{id:"yeEPjS",defaultMessage:"No traces found"})}):null})(),style:ce,pagination:(0,H.Y)(T.CursorPagination,{componentId:`${$}.traces_table.pagination`,hasNextPage:g,hasPreviousPage:p,onNextPage:f,onPreviousPage:v}),children:[(0,H.FD)(T.TableRow,{isHeader:!0,children:[Q.getLeafHeaders().map((e=>{var t;return(0,H.Y)(T.TableHeader,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_traces_tracesviewtable.tsx_365",css:null===(t=e.column.columnDef.meta)||void 0===t?void 0:t.styles,sortable:e.column.getCanSort(),sortDirection:e.column.getIsSorted()||"none",onToggleSort:e.column.getToggleSortingHandler(),header:e,column:e.column,setColumnSizing:Q.setColumnSizing,isResizing:e.column.getIsResizing(),style:{flex:`calc(var(${te(e.id)}) / 100)`},children:(0,R.Kv)(e.column.columnDef.header,e.getContext())},e.id)})),(0,H.Y)(T.TableRowAction,{children:(0,H.FD)(T.DropdownMenu.Root,{children:[(0,H.Y)(T.DropdownMenu.Trigger,{asChild:!0,children:(0,H.Y)(i.B,{componentId:`${$}.traces_table.column_selector_dropdown`,icon:(0,H.Y)(T.ColumnsIcon,{}),size:"small","aria-label":U.formatMessage({id:"zd5Jw4",defaultMessage:"Select columns"})})}),(0,H.Y)(T.DropdownMenu.Content,{align:"end",children:j.map((({key:e,label:t})=>(0,H.FD)(T.DropdownMenu.CheckboxItem,{componentId:`${$}.traces_table.column_toggle_button`,checked:!F.includes(e),onClick:()=>L(e),children:[(0,H.Y)(T.DropdownMenu.ItemIndicator,{}),t]},e)))})]})})]}),a&&(0,H.Y)(T.TableSkeletonRows,{table:Q}),!a&&!r&&Q.getRowModel().rows.map((e=>(0,H.Y)(ae,{row:e,columns:G,selected:_[e.id]},e.id)))]})}));var Se=n(28189);const ye=({children:e,experimentId:t})=>(0,H.Y)(H.FK,{children:e}),ke=({requestId:e,traceInfo:t,loadingTraceInfo:n,onClose:o,selectedSpanId:l,onSelectSpan:d})=>{const{traceData:c,loading:u,error:m}=((e,t=!1)=>{const[n,a]=(0,s.useState)(void 0),[i,o]=(0,s.useState)(!1),[l,d]=(0,s.useState)(void 0),c=(0,s.useCallback)((async e=>{o(!0);try{const t=await r.x.getExperimentTraceData(e);Array.isArray(t.spans)?a(t):A.A.logErrorAndNotifyUser("Invalid trace data response: "+JSON.stringify(null===t||void 0===t?void 0:t.toString()))}catch(t){d(t)}o(!1)}),[]);return(0,s.useEffect)((()=>{e&&!t&&c(e)}),[c,e,t]),{traceData:n,loading:i,error:l}})(e,"IN_PROGRESS"===(null===t||void 0===t?void 0:t.status)),{theme:g}=(0,i.u)(),p=!n&&!t,{traceInfo:h,loading:v}=((e,t=!0)=>{const[n,a]=(0,s.useState)(void 0),[i,o]=(0,s.useState)(t),[l,d]=(0,s.useState)(void 0),c=(0,s.useCallback)((async()=>{if(t){d(void 0);try{const t=await r.x.getExperimentTraceInfo(e);if(!t.trace_info)return void a(void 0);a(t.trace_info)}catch(n){d(n)}finally{o(!1)}}}),[t,e]);return(0,s.useEffect)((()=>{c()}),[c]),{traceInfo:n,loading:i,error:l}})(e,p),w=t||h,b=(0,s.useMemo)((()=>n||v?(0,H.Y)(T.TitleSkeleton,{}):w?(0,H.Y)(i.T.Title,{level:2,withoutMargins:!0,children:f(w)}):e),[n,v,w,e]),x=(0,s.useMemo)((()=>c?{info:w||{},data:c}:void 0),[c,w]),S=((null===c||void 0===c?void 0:c.spans)||[]).length>0;return(0,H.Y)(T.Drawer.Root,{modal:!0,open:!0,onOpenChange:e=>{e||o()},children:(0,H.Y)(T.Drawer.Content,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_traces_tracedatadrawer.tsx_222",width:"90vw",title:b,expandContentToFullHeight:!0,children:u||n||v?(0,H.Y)(Se.Fn,{}):"IN_PROGRESS"===(null===t||void 0===t?void 0:t.status)?(0,H.FD)(H.FK,{children:[(0,H.Y)(ie.S,{size:"lg"}),(0,H.Y)(T.Empty,{image:(0,H.Y)(i.W,{}),description:(0,H.Y)(z.A,{id:"K+5g8S",defaultMessage:"Trace data is not available for in-progress traces. Please wait for the trace to complete."}),title:(0,H.Y)(z.A,{id:"p0O0uP",defaultMessage:"Trace data not available"})})]}):m?(0,H.FD)(H.FK,{children:[(0,H.Y)(ie.S,{size:"lg"}),(0,H.Y)(T.Empty,{image:(0,H.Y)(i.k,{}),description:(0,H.Y)(z.A,{id:"c4KA32",defaultMessage:"An error occurred while attempting to fetch the trace data. Please wait a moment and try again."}),title:(0,H.Y)(z.A,{id:"eavoW/",defaultMessage:"Error"})})]}):S?x?(0,H.Y)("div",{css:(0,a.AH)({height:"100%",marginLeft:-g.spacing.lg,marginRight:-g.spacing.lg,marginBottom:-g.spacing.lg},""),onWheel:e=>e.stopPropagation(),children:(0,H.Y)(ye,{experimentId:null===w||void 0===w?void 0:w.experiment_id,children:(0,H.Y)(Se.a8,{modelTrace:x,selectedSpanId:l,onSelectSpan:d})})}):null:(0,H.FD)(H.FK,{children:[(0,H.Y)(ie.S,{size:"lg"}),(0,H.Y)(T.Empty,{description:null,title:(0,H.Y)(z.A,{id:"EpFST9",defaultMessage:"No trace data recorded"})})]})})})},Ie=({experimentIds:e,visible:t,rowSelection:n,setRowSelection:a,handleClose:o,refreshTraces:d})=>{const c=(0,E.A)(),[u,m]=(0,s.useState)(""),[g,p]=(0,s.useState)(!1),h=(0,l.keys)((0,l.pickBy)(n,(e=>e)));return(0,H.FD)(ie.d,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_traces_tracesviewdeletetracemodal.tsx_62",title:(0,H.Y)(z.A,{id:"gRz1nB",defaultMessage:"{count, plural, one {Delete Trace} other {Delete Traces}}",values:{count:h.length}}),visible:t,onCancel:o,okText:(0,H.Y)(z.A,{id:"g56Cuk",defaultMessage:"Delete {count, plural, one { # trace } other { # traces }}",values:{count:h.length}}),onOk:()=>{(async()=>{try{var t;await r.x.deleteTraces(null!==(t=e[0])&&void 0!==t?t:"",h),a({}),d(),o()}catch(n){m(c.formatMessage({id:"zhzZUu",defaultMessage:"An error occured while attempting to delete traces. Please refresh the page and try again."}))}p(!1)})(),p(!0)},okButtonProps:{loading:g,danger:!0},children:[u&&(0,H.Y)(i.T.Paragraph,{color:"error",children:u}),(0,H.Y)(i.T.Paragraph,{children:(0,H.Y)(i.T.Text,{bold:!0,children:(0,H.Y)(z.A,{id:"kmtWGf",defaultMessage:"{count, plural, one { # trace } other { # traces }} will be deleted.",values:{count:h.length}})})}),(0,H.Y)(i.T.Paragraph,{children:(0,H.Y)(z.A,{id:"VfGJFc",defaultMessage:"Deleted traces cannot be restored. Are you sure you want to proceed?"})})]})},_e=({experimentIds:e,rowSelection:t,setRowSelection:n,refreshTraces:r,baseComponentId:o})=>{const[l,d]=(0,s.useState)(!1),{theme:c}=(0,i.u)(),u=(0,s.useCallback)((()=>{d(!0)}),[d]),m=(0,s.useCallback)((()=>{d(!1)}),[d]);return(0,H.FD)("div",{css:(0,a.AH)({display:"flex",flexDirection:"row",alignItems:"center",gap:c.spacing.sm},""),children:[(0,H.Y)(i.B,{componentId:`${o}.traces_table.delete_traces`,onClick:u,danger:!0,children:(0,H.Y)(z.A,{id:"QAyzA3",defaultMessage:"Delete"})}),(0,H.Y)(Ie,{experimentIds:e,visible:l,rowSelection:t,handleClose:m,refreshTraces:r,setRowSelection:n})]})};const Ye=({baseComponentId:e})=>{const{theme:t}=(0,i.u)();return(0,H.FD)(i.aw.Root,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_traces_tracesviewcontrols.tsx_28",modal:!1,children:[(0,H.Y)(i.aw.Trigger,{asChild:!0,children:(0,H.Y)(i.B,{size:"small",type:"link",icon:(0,H.Y)(ie.I,{css:(0,a.AH)({svg:{width:16,height:16,color:t.colors.textSecondary}},"")}),componentId:`${e}.traces_table.filter_tooltip`})}),(0,H.FD)(i.aw.Content,{children:[(0,H.Y)(i.aw.Arrow,{}),(0,H.Y)(i.T.Paragraph,{children:(0,H.Y)(z.A,{id:"2Ofya9",defaultMessage:"Search traces using a simplified version of the SQL {whereBold} clause.",values:{whereBold:(0,H.Y)("b",{children:"WHERE"})}})}),(0,H.Y)(z.A,{id:"U3btBc",defaultMessage:"Examples:"}),(0,H.Y)("ul",{children:(0,H.Y)("li",{children:(0,H.Y)("code",{children:'tags.some_tag = "abc"'})})})]})]})};var Ce={name:"1ykowef",styles:"margin-bottom:0"},Te={name:"ikeoj9",styles:"width:430px"};const Me=({experimentIds:e,filter:t,onChangeFilter:n,rowSelection:r,setRowSelection:o,refreshTraces:l,baseComponentId:d,runUuid:c,traces:u})=>{const m=(0,E.A)(),{theme:g}=(0,i.u)(),[p,h]=(0,s.useState)(t||void 0),[f,v]=(0,s.useState)(!1),w=null!==p&&void 0!==p?p:t,b=Object.entries(r).filter((([,e])=>e)).map((([e])=>e)).length>0?(0,H.Y)(_e,{experimentIds:e,rowSelection:r,setRowSelection:o,refreshTraces:l,baseComponentId:d}):(0,H.Y)(T.TableFilterLayout,{css:Ce,children:(0,H.Y)(B.I,{componentId:`${d}.traces_table.search_filter`,placeholder:m.formatMessage({id:"FPMrvd",defaultMessage:"Search traces"}),value:w,css:Te,onChange:e=>h(e.target.value),prefix:(0,H.Y)(B.S,{}),suffix:(0,H.Y)(Ye,{baseComponentId:d}),allowClear:!0,onClear:()=>{n(""),h(void 0)},onKeyDown:e=>{"Enter"===e.key&&(n(w),h(void 0))}})});return(0,H.Y)("div",{css:(0,a.AH)({display:"flex",gap:g.spacing.xs},""),children:b})};var Re=n(58355);const Ae={hiddenColumns:[b.traceName,b.source]},De=e=>{const t=(0,s.useMemo)((()=>{const t=JSON.stringify(e.slice().sort());return Re.A.getStoreForComponent("ExperimentViewTraces",t)}),[e]),[n,a]=(0,s.useState)((()=>(e=>{try{const t=e.getItem("uiState"),n=JSON.parse(t);return(0,l.isObject)(n)?n:Ae}catch(t){return Ae}})(t))),i=(0,s.useCallback)((e=>{a((t=>{const n=t.hiddenColumns||[];return{hiddenColumns:n.includes(e)?n.filter((t=>t!==e)):[...n,e]}}))}),[]);return(0,s.useEffect)((()=>{t.setItem("uiState",JSON.stringify(n))}),[t,n]),{uiState:n,toggleHiddenColumn:i}},Ne="selectedTraceId",Pe="selectedSpanId",Ee=[{id:b.timestampMs,desc:!0}],ze=({experimentIds:e,runUuid:t,loggedModelId:n,disabledColumns:r,baseComponentId:o=(t?"mlflow.run.traces":"mlflow.experiment_page.traces")})=>{const d=(0,s.useRef)(void 0),[c,u]=(0,s.useState)(""),[g,p]=(0,s.useState)(Ee),[h,f]=(0,s.useState)({}),[v,w]=(()=>{var e;const[t,n]=(0,D.ok)(),a=null!==(e=t.get(Ne))&&void 0!==e?e:void 0,i=(0,s.useCallback)((e=>{n((t=>void 0===e?(t.delete(Ne),t):(t.set(Ne,e),t)))}),[n]);return[a,i]})(),[x,S]=(()=>{var e;const[t,n]=(0,D.ok)(),a=null!==(e=t.get(Pe))&&void 0!==e?e:void 0,i=(0,s.useCallback)((e=>{n((t=>void 0===e?(t.delete(Pe),t):(t.set(Pe,e),t)),{replace:!0})}),[n]);return[a,i]})(),{traces:y,loading:k,error:I,hasNextPage:_,hasPreviousPage:C,fetchNextPage:T,fetchPrevPage:M,refreshCurrentPage:R}=Y({experimentIds:e,sorting:g,filter:c,runUuid:t,loggedModelId:n}),A=(0,s.useCallback)((({request_id:e})=>w(e)),[w]),N=(0,s.useCallback)((()=>{T(),f({})}),[T]),P=(0,s.useCallback)((()=>{M(),f({})}),[M]);(0,s.useEffect)((()=>{window.clearTimeout(d.current);const e=async()=>{k||C||(await R(!0),window.clearTimeout(d.current),d.current=window.setTimeout(e,3e4))};return d.current=window.setTimeout(e,3e4),()=>window.clearTimeout(d.current)}),[R,k,C]);const{theme:E}=(0,i.u)(),z=(0,s.useMemo)((()=>{if(v)return y.find((e=>e.request_id===v))}),[v,y]),{uiState:F,toggleHiddenColumn:q}=De(e),$=((0,s.useMemo)((()=>(0,l.uniq)((0,l.compact)(y.flatMap((e=>{var t;return null===(t=e.tags)||void 0===t?void 0:t.map((e=>e.key))}))))),[y]),""!==c),L=y.some((e=>!(0,l.isNil)(m(e)))),O=(0,s.useMemo)((()=>L?[]:[b.totalTokens]),[L]),B=(0,s.useMemo)((()=>[...null!==r&&void 0!==r?r:[],...O]),[r,O]),U=(0,s.useMemo)((()=>{var e;return[...null!==(e=F.hiddenColumns)&&void 0!==e?e:[],...B]}),[F,B]);return(0,H.FD)("div",{css:(0,a.AH)({display:"flex",flexDirection:"column",gap:E.spacing.sm,height:"100%",overflow:"hidden"},""),children:[(0,H.Y)(Me,{experimentIds:e,filter:c,onChangeFilter:u,rowSelection:h,setRowSelection:f,refreshTraces:R,baseComponentId:o,runUuid:t,traces:y}),(0,H.Y)(xe,{experimentIds:e,runUuid:t,traces:y,loading:k,error:I,onTraceClicked:A,hasNextPage:_,hasPreviousPage:C,onPreviousPage:P,onNextPage:N,onTagsUpdated:R,usingFilters:$,onResetFilters:()=>u(""),hiddenColumns:U,disableTokenColumn:!L,disabledColumns:B,setSorting:e=>{if((0,l.isFunction)(e))return p((t=>{const n=e(t),a=t[0];return n&&0!==n.length||!a?n:[{id:a.id,desc:!a.desc}]}))},sorting:g,rowSelection:h,setRowSelection:f,baseComponentId:o,toggleHiddenColumn:q}),v&&(0,H.Y)(ke,{traceInfo:z,loadingTraceInfo:k,requestId:v,onClose:()=>w(void 0),selectedSpanId:x,onSelectSpan:S})]})};var Fe=n(85167),qe=n(79444),He=n(89949);var $e={name:"1vfb318",styles:"flex:1;display:flex;align-items:center;justify-content:center"};const Le=({error:e})=>{var t;return(0,H.Y)(T.PageWrapper,{css:$e,children:(0,H.Y)(T.Empty,{"data-testid":"fallback",title:(0,H.Y)(z.A,{id:"FbAMd+",defaultMessage:"Error"}),description:null!==(t=null===e||void 0===e?void 0:e.message)&&void 0!==t?t:(0,H.Y)(z.A,{id:"CbzDeZ",defaultMessage:"An error occurred while rendering this component."}),image:(0,H.Y)(i.k,{})})})},Oe=({children:e})=>(0,H.Y)(He.tH,{fallback:(0,H.Y)(Le,{}),children:e}),Be="viewState";var Ue=n(14429),We=n(86846);const Je=({viewState:e,experimentId:t,endpointName:n,timeRange:a})=>"logs"===e?(0,H.Y)(Fe.v,{experimentId:t||"",endpointName:n||"",timeRange:a}):null,Ke=({experimentIds:e,isLoadingExperiment:t})=>{const{theme:n}=(0,i.u)(),[r,o]=(0,Ue.VA)(),l=(0,qe.U)(),d=e[0],[c]=(()=>{var e;const[t,n]=(0,D.ok)(),a=null!==(e=t.get(Be))&&void 0!==e?e:"logs",i=(0,s.useCallback)(((e,t=!1)=>{n((t=>void 0===e?(t.delete(Be),t):(t.set(Be,e),t)),{replace:t})}),[n]);return[a,i]})(),u=(0,s.useMemo)((()=>{const{startTime:e,endTime:t}=(0,Ue.UY)(l.dateNow,r);return{startTime:e?new Date(e).getTime().toString():void 0,endTime:t?new Date(t).getTime().toString():void 0}}),[l.dateNow,r]);return(0,H.FD)("div",{css:(0,a.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,height:"100%",overflowY:"hidden"},""),children:[(0,H.Y)(We.J,{viewState:c}),(0,H.Y)(Je,{viewState:c,experimentId:d,timeRange:u})]})},Ve=({experimentIds:e,isLoadingExperiment:t})=>(0,H.Y)(Oe,{children:(0,H.Y)(qe.k,{children:(0,H.Y)(Ke,{experimentIds:e,isLoadingExperiment:t})})});var je=n(54741);const Ge=({experimentIds:e})=>{const{theme:t}=(0,i.u)();return(0,H.Y)("div",{css:(0,a.AH)({minHeight:225,display:"flex",flexDirection:"column",gap:t.spacing.sm,flex:1,overflow:"hidden"},""),children:(0,H.Y)(Ze,{experimentIds:e})})},Ze=({experimentIds:e})=>{const{loading:t}=(0,je.L)({experimentId:e[0],options:{fetchPolicy:"cache-only"}});return(0,de.v3)()||(0,de.$Y)()?(0,H.Y)(Ve,{experimentIds:e,isLoadingExperiment:t}):(0,H.Y)(ze,{experimentIds:e})}},86846:function(e,t,n){n.d(t,{J:function(){return x}});var a=n(68248),i=n(27757),s=n(27299),r=n(16333),o=n(46709),l=n(79081),d=n(18154),c=n(42747),u=n(92338),m=n(14429),g=n(76118),p=n(16453),h=n(79444),f=n(39595),v=n(92388),w=n(73408);const b=o.memo((()=>{const e=(0,c.tz)(),{theme:t}=(0,i.u)(),n=(0,f.jE)(),r=(0,v.C)({queryKey:[d.TH]}),[b,x]=(0,m.VA)(),S=(0,o.useMemo)((()=>(0,u.p)(e)),[e]),y=e.formatMessage({id:"BJvcsS",defaultMessage:"Time Range"}),k=(0,h.U)();return(0,w.FD)("div",{css:(0,a.AH)({display:"flex",gap:t.spacing.sm,alignItems:"center"},""),children:[(0,w.FD)(s.DialogCombobox,{componentId:"mlflow.experiment-evaluation-monitoring.date-selector",label:y,value:b.startTimeLabel?[b.startTimeLabel]:[m.oy],children:[(0,w.Y)(s.DialogComboboxTrigger,{renderDisplayedValue:e=>{var t;return null===(t=S.find((t=>t.key===e)))||void 0===t?void 0:t.label},allowClear:!(0,g.isNil)(b.startTimeLabel)&&b.startTimeLabel!==m.oy,onClear:()=>{x({startTimeLabel:m.oy})},"data-testid":"time-range-select-dropdown"}),(0,w.Y)(s.DialogComboboxContent,{children:(0,w.Y)(s.DialogComboboxOptionList,{children:S.map((e=>(0,w.Y)(s.DialogComboboxOptionListSelectItem,{checked:b.startTimeLabel===e.key||e.key===m.oy&&(0,g.isNil)(b.startTimeLabel),title:e.label,"data-testid":`time-range-select-${e}`,value:e.key,onChange:()=>{x({...b,startTimeLabel:e.key})},children:e.label},e.key)))})})]}),"CUSTOM"===b.startTimeLabel&&(0,w.Y)(w.FK,{children:(0,w.Y)(p.cv,{id:"date-picker-range",includeTime:!0,selected:{from:new Date(b.startTime),to:b.endTime?new Date(b.endTime):k.dateNow},onChange:e=>{const t=e.target.value;x({...b,startTime:null!==t&&void 0!==t&&t.from?t.from.toISOString():void 0,endTime:null!==t&&void 0!==t&&t.to?t.to.toISOString():void 0})},startDatePickerProps:{componentId:"experiment-evaluation-monitoring-start-date-picker",datePickerProps:{disabled:{after:k.dateNow}},value:b.startTime?new Date(b.startTime):void 0},endDatePickerProps:{componentId:"experiment-evaluation-monitoring-end-date-picker",datePickerProps:{disabled:{after:k.dateNow}},value:b.endTime?new Date(b.endTime):void 0}})}),(0,w.Y)(l.T,{componentId:"mlflow.experiment-evaluation-monitoring.trace-info-hover-request-time",content:e.formatMessage({id:"Arvaod",defaultMessage:"Showing data up to {date}."},{date:k.dateNow.toLocaleString(navigator.language,{timeZoneName:"short"})}),children:(0,w.Y)(i.B,{type:"link",componentId:"mlflow.experiment-evaluation-monitoring.refresh-date-button",disabled:Boolean(r),onClick:()=>{k.refresh(),(0,d.BL)({queryClient:n})},children:(0,w.Y)(s.RefreshIcon,{})})})]})})),x=({viewState:e,sessionId:t})=>{const{theme:n}=(0,i.u)();return(0,w.FD)("div",{css:(0,a.AH)({display:"flex",alignItems:"center",width:"100%",borderBottom:`1px solid ${n.colors.grey100}`,paddingBottom:`${n.spacing.sm}px`},""),children:[!("single-chat-session"===e)&&(0,w.Y)(b,{}),"single-chat-session"===e&&(0,w.FD)("div",{css:(0,a.AH)({display:"flex",alignItems:"center",gap:n.spacing.sm},""),children:[(0,w.Y)(s.Tag,{color:"default",componentId:"mlflow.chat-sessions.session-header-label",css:(0,a.AH)({padding:n.spacing.xs+2,margin:0},""),children:(0,w.FD)("span",{css:(0,a.AH)({display:"flex",alignItems:"center",gap:n.spacing.sm},""),children:[(0,w.Y)(s.SpeechBubbleIcon,{}),(0,w.Y)(i.T.Text,{ellipsis:!0,bold:!0,children:(0,w.Y)(c.sA,{id:"EAf6xM",defaultMessage:"Session"})})]})}),(0,w.Y)(i.T.Title,{level:3,withoutMargins:!0,children:t}),t&&(0,w.Y)(r.ad,{copyText:t,componentId:"mlflow.chat-sessions.copy-session-id",buttonProps:{icon:void 0}})]})]})}}}]);
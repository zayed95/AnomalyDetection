"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[1470],{14429:function(e,t,n){n.d(t,{UY:function(){return m},VA:function(){return c},oy:function(){return d},vF:function(){return r}});var i=n(46709),s=n(91105),a=n(79444);const r="startTimeLabel",o="startTime",l="endTime",d="LAST_7_DAYS",c=()=>{var e;const t=(0,a.U)(),[n,c]=(0,s.ok)(),u=n.get(r)||d;let g=n.get(o)||void 0,p=null!==(e=n.get(l))&&void 0!==e?e:void 0;if("CUSTOM"!==u){const e=m(t.dateNow,{startTimeLabel:u});g=e.startTime,p=e.endTime}else{var f;g=n.get(o)||void 0,p=null!==(f=n.get(l))&&void 0!==f?f:void 0}const h=(0,i.useMemo)((()=>({startTimeLabel:u,startTime:g,endTime:p})),[u,g,p]),T=(0,i.useCallback)(((e,t=!1)=>{c((t=>(void 0===(null===e||void 0===e?void 0:e.startTime)?t.delete(o):"CUSTOM"===e.startTimeLabel&&t.set(o,e.startTime),void 0===(null===e||void 0===e?void 0:e.endTime)?t.delete(l):"CUSTOM"===e.startTimeLabel&&t.set(l,e.endTime),void 0===(null===e||void 0===e?void 0:e.startTimeLabel)?t.delete(r):t.set(r,e.startTimeLabel),t)),{replace:t})}),[c]);return[h,T]};function m(e,t){return t.startTimeLabel&&"CUSTOM"!==t.startTimeLabel?function(e,t){switch(t){case"LAST_HOUR":return{startTime:new Date(new Date(e).setUTCHours((new Date).getUTCHours()-1)).toISOString(),endTime:e.toISOString()};case"LAST_24_HOURS":return{startTime:new Date(new Date(e).setUTCDate((new Date).getUTCDate()-1)).toISOString(),endTime:e.toISOString()};case"LAST_7_DAYS":return{startTime:new Date(new Date(e).setUTCDate((new Date).getUTCDate()-7)).toISOString(),endTime:e.toISOString()};case"LAST_30_DAYS":return{startTime:new Date(new Date(e).setUTCDate((new Date).getUTCDate()-30)).toISOString(),endTime:e.toISOString()};case"LAST_YEAR":return{startTime:new Date(new Date(e).setUTCFullYear((new Date).getUTCFullYear()-1)).toISOString(),endTime:e.toISOString()};case"ALL":return{startTime:void 0,endTime:e.toISOString()};default:throw new Error(`Unexpected start time label: ${t}`)}}(e,t.startTimeLabel):{startTime:t.startTime,endTime:t.endTime}}},32547:function(e,t,n){n.r(t),n.d(t,{default:function(){return E}});var i=n(68248),s=n(91113),a=n(55570),r=n(42747),o=n(18154),l=n(91105),d=n(59930),c=n.n(d),m=n(54741),u=n(46709),g=n(86846),p=n(28189),f=n(27757),h=n(27299),T=n(73408);const v=({displayLink:e=!1})=>{const{theme:t}=(0,f.u)();return(0,T.Y)("div",{css:(0,i.AH)({display:"flex",alignItems:"center",justifyContent:"center",position:"relative",width:t.general.iconSize,height:t.general.iconSize,borderRadius:t.borders.borderRadiusSm,border:`1px solid ${t.colors.branded.ai.gradientStart}`,backgroundColor:t.colors.backgroundSecondary,"::after":e?{content:'""',position:"absolute",width:1,height:t.spacing.md,backgroundColor:t.colors.branded.ai.gradientStart,top:"100%",left:t.spacing.sm}:void 0},""),children:(0,T.Y)(h.ChainIcon,{color:"ai"})})};var b=n(40724);const S=({traces:e,selectedTurnIndex:t,setSelectedTurnIndex:n,setSelectedTrace:s,chatRefs:a})=>{const{theme:r}=(0,f.u)(),o=(0,u.useCallback)((e=>{const t=(0,p.MF)(e);a.current[t]&&a.current[t].scrollIntoView({behavior:"smooth"})}),[a]);return e?(0,T.Y)("div",{css:(0,i.AH)({minHeight:0,width:200,borderRight:`1px solid ${r.colors.border}`,overflow:"auto",paddingTop:r.spacing.sm,paddingRight:r.spacing.sm},""),children:e.map(((s,a)=>(0,T.FD)("div",{css:(0,i.AH)({display:"flex",alignItems:"center",gap:r.spacing.sm,backgroundColor:t===a?r.colors.actionDefaultBackgroundHover:void 0,padding:r.spacing.xs,borderRadius:r.borders.borderRadiusSm,cursor:"pointer"},""),onMouseEnter:()=>n(a),onClick:()=>o(s),children:[(0,T.Y)(v,{displayLink:a!==e.length-1}),(0,T.Y)(f.T.Text,{bold:!0,children:(0,T.Y)(b.A,{id:"8ikgws",defaultMessage:"Turn {turnNumber}",values:{turnNumber:a+1}})})]},(0,p.MF)(s))))}):null};var x={name:"xjt14x",styles:"width:60%"},w={name:"2ji30f",styles:"width:80%"},y={name:"maimdf",styles:"width:70%"};const D=()=>{const{theme:e}=(0,f.u)();return(0,T.FD)("div",{css:(0,i.AH)({display:"flex",flexDirection:"column",minHeight:0,width:200,borderRight:`1px solid ${e.colors.border}`,gap:e.spacing.xs,paddingTop:e.spacing.sm,paddingRight:e.spacing.sm},""),children:[(0,T.Y)(h.TitleSkeleton,{css:x}),(0,T.Y)(h.TitleSkeleton,{css:w}),(0,T.Y)(h.TitleSkeleton,{css:y})]})};var Y=n(69986),k=n(48785),I=n(79081);var A={name:"82a6rk",styles:"flex:1"};const L=({traces:e,selectedTurnIndex:t,setSelectedTurnIndex:n,setSelectedTrace:s,chatRefs:a,getAssessmentTitle:o})=>{const{theme:l}=(0,f.u)();return e?(0,T.Y)("div",{css:(0,i.AH)({display:"flex",flexDirection:"column",flex:1,minWidth:0,height:"100%",overflowY:"auto",gap:l.spacing.sm,paddingTop:l.spacing.sm,paddingLeft:l.spacing.sm},""),children:e.map(((e,d)=>{const c=t===d,m=(0,p.MF)(e);return(0,T.FD)("div",{ref:e=>{e&&(a.current[m]=e)},css:(0,i.AH)({display:"flex",flexDirection:"column",position:"relative",gap:l.spacing.sm,backgroundColor:c?l.colors.actionDefaultBackgroundHover:void 0,border:`1px solid ${l.colors.border}`,padding:l.spacing.md,borderRadius:l.borders.borderRadiusMd},""),onMouseEnter:()=>n(d),children:[(0,T.FD)("div",{css:(0,i.AH)({display:"flex",alignItems:"center",gap:l.spacing.sm},""),children:[(0,T.Y)(v,{}),(0,T.Y)(f.T.Text,{bold:!0,children:(0,T.Y)(r.sA,{id:"8ikgws",defaultMessage:"Turn {turnNumber}",values:{turnNumber:d+1}})}),(0,T.Y)("div",{css:A}),(0,T.Y)(f.B,{componentId:"mlflow.experiment.chat-session.view-trace",size:"small",color:"primary",css:[{visibility:c?"visible":"hidden"},(0,f.i)({backgroundColor:l.colors.backgroundPrimary}),""],onClick:()=>s(e),children:(0,T.Y)(r.sA,{id:"7FI4Hp",defaultMessage:"View full trace"})})]}),(0,T.Y)(p.y8,{trace:e},m),(0,p.aZ)()&&(0,T.FD)(T.FK,{children:[(0,T.Y)(I.S,{size:"sm"}),(0,T.Y)(p.r_,{trace:e,getAssessmentTitle:o,onAddAssessmentsClick:()=>s(e)})]})]},m)}))}):null};var C={name:"12x64ox",styles:"width:20%"},M={name:"12x64ox",styles:"width:20%"};const H=()=>{const{theme:e}=(0,f.u)();return(0,T.FD)("div",{css:(0,i.AH)({display:"flex",flexDirection:"column",flex:1,minWidth:0,height:"100%",overflowY:"auto",gap:e.spacing.sm,paddingTop:e.spacing.sm,paddingLeft:e.spacing.sm},""),children:[(0,T.FD)("div",{css:(0,i.AH)({display:"flex",flexDirection:"column",gap:e.spacing.sm,width:"60%",alignSelf:"flex-start"},""),children:[(0,T.Y)(h.TitleSkeleton,{css:C}),[...Array(5).keys()].map((e=>(0,T.Y)(h.ParagraphSkeleton,{seed:`s-${e}`},e)))]}),(0,T.FD)("div",{css:(0,i.AH)({display:"flex",flexDirection:"column",gap:e.spacing.sm,width:"60%",alignSelf:"flex-end"},""),children:[(0,T.Y)(h.TitleSkeleton,{css:M}),[...Array(5).keys()].map((e=>(0,T.Y)(h.ParagraphSkeleton,{seed:`s-${e}`},e)))]})]})};var R=n(44105);const F=({children:e})=>(0,T.Y)(T.FK,{children:e});var U={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"},O={name:"1ndun5c",styles:"display:flex;flex:1;min-height:0"},_={name:"1ndun5c",styles:"display:flex;flex:1;min-height:0"};var E=(0,a.X)(s.A.mlflowServices.CHAT_SESSIONS,(()=>{const{theme:e}=(0,f.u)(),{experimentId:t,sessionId:n}=(0,l.g)(),s=(0,l.zy)(),[a,r]=(0,u.useState)(null),[d,v]=(0,u.useState)(null),b=(0,u.useRef)({});c()(t,"Experiment ID must be defined"),c()(n,"Session ID must be defined");const x=(0,u.useMemo)((()=>new URLSearchParams(s.search).get(R.hb)),[s.search]),{loading:w}=(0,m.L)({experimentId:t,options:{fetchPolicy:"cache-only"}}),y=(0,u.useMemo)((()=>[(0,o.$U)(t)]),[t]),I=(0,u.useMemo)((()=>(0,k._)({sessionId:n})),[n]),{data:A,isLoading:C}=(0,o.Zn)({locations:y,filters:I,disabled:!1}),M=(0,u.useMemo)((()=>null===A||void 0===A?void 0:A.sort(((e,t)=>new Date(e.request_time).getTime()-new Date(t.request_time).getTime()))),[A]),E=Y.Uv,N=(0,u.useCallback)((e=>e),[]),{data:P,isLoading:$,invalidateSingleTraceQuery:B}=(0,o.Wx)(E,M);return(0,u.useEffect)((()=>{if(x&&P&&P.length>0&&!$){const e=P.findIndex((e=>(0,p.MF)(e)===x));if(-1!==e){r(e);const t=b.current[x];t&&t.scrollIntoView({behavior:"smooth",block:"center"})}}}),[x,P,$]),(0,T.FD)("div",{css:U,children:[(0,T.Y)(g.J,{viewState:"single-chat-session",sessionId:n}),$||C?(0,T.FD)("div",{css:O,children:[(0,T.Y)(D,{}),(0,T.Y)(H,{})]}):(0,T.FD)("div",{css:_,children:[(0,T.Y)(S,{traces:null!==P&&void 0!==P?P:[],selectedTurnIndex:a,setSelectedTurnIndex:r,setSelectedTrace:v,chatRefs:b}),(0,T.Y)(L,{traces:null!==P&&void 0!==P?P:[],selectedTurnIndex:a,setSelectedTurnIndex:r,setSelectedTrace:v,chatRefs:b,getAssessmentTitle:N})]}),(0,T.Y)(h.Drawer.Root,{open:null!==d,onOpenChange:e=>{e||v(null)},children:(0,T.Y)(h.Drawer.Content,{componentId:"mlflow.experiment.chat-session.trace-drawer",title:d?(0,p.MF)(d):"",width:"90vw",expandContentToFullHeight:!0,children:(0,T.Y)("div",{css:(0,i.AH)({height:"100%",marginLeft:-e.spacing.lg,marginRight:-e.spacing.lg,marginBottom:-e.spacing.lg},""),children:(0,T.Y)(F,{children:d&&(0,T.Y)(p.a8,{modelTrace:d,collapseAssessmentPane:"force-open"})})})})})]})}),(0,T.Y)(r.sA,{id:"fYtbd8",defaultMessage:"An error occurred while rendering the chat session."}))},48785:function(e,t,n){n.d(t,{_:function(){return a}});var i=n(18154),s=n(28189);const a=({sessionId:e})=>[{column:`${i.rc}:${s.n2}`,operator:e?i.tl.EQUALS:i.tl.CONTAINS,value:null!==e&&void 0!==e?e:""}]},54741:function(e,t,n){n.d(t,{L:function(){return a}});var i=n(81641);const s=i.J1`
  query MlflowGetExperimentQuery($input: MlflowGetExperimentInput!) @component(name: "MLflow.ExperimentRunTracking") {
    mlflowGetExperiment(input: $input) {
      apiError {
        code
        message
      }
      experiment {
        artifactLocation
        creationTime
        experimentId
        lastUpdateTime
        lifecycleStage
        name
        tags {
          key
          value
        }
      }
    }
  }
`,a=({experimentId:e,options:t={}})=>{var n;const{data:a,loading:r,error:o,refetch:l}=(0,i.IT)(s,{variables:{input:{experimentId:e}},skip:!e,...t});return{loading:r,data:null===a||void 0===a||null===(n=a.mlflowGetExperiment)||void 0===n?void 0:n.experiment,refetch:l,apolloError:o,apiError:(()=>{var e;return null===a||void 0===a||null===(e=a.mlflowGetExperiment)||void 0===e?void 0:e.apiError})()}}},76256:function(e,t,n){n.d(t,{L:function(){return s},S:function(){return a}});var i=n(43617);function s(e,t){return(0,i.N4)(t)}const a=i.N4},79444:function(e,t,n){n.d(t,{U:function(){return d},k:function(){return l}});var i=n(76118),s=n(46709),a=n(73408);const r=()=>({dateNow:new Date,lastRefreshTime:Date.now(),refresh:()=>{}}),o=(0,s.createContext)(r()),l=({config:e,children:t})=>{const n=r(),l=(0,i.merge)({},n,e),[d,c]=s.useState(l.lastRefreshTime),m=(0,s.useMemo)((()=>new Date(d)),[d]),u=(0,s.useCallback)((()=>{c(Date.now())}),[]);return(0,a.Y)(o.Provider,{value:{...l,dateNow:m,lastRefreshTime:d,refresh:u},children:t})},d=()=>{const e=(0,s.useContext)(o);return e||r()}},86846:function(e,t,n){n.d(t,{J:function(){return S}});var i=n(68248),s=n(27757),a=n(27299),r=n(16333),o=n(46709),l=n(79081),d=n(18154),c=n(42747),m=n(92338),u=n(14429),g=n(76118),p=n(16453),f=n(79444),h=n(39595),T=n(92388),v=n(73408);const b=o.memo((()=>{const e=(0,c.tz)(),{theme:t}=(0,s.u)(),n=(0,h.jE)(),r=(0,T.C)({queryKey:[d.TH]}),[b,S]=(0,u.VA)(),x=(0,o.useMemo)((()=>(0,m.p)(e)),[e]),w=e.formatMessage({id:"BJvcsS",defaultMessage:"Time Range"}),y=(0,f.U)();return(0,v.FD)("div",{css:(0,i.AH)({display:"flex",gap:t.spacing.sm,alignItems:"center"},""),children:[(0,v.FD)(a.DialogCombobox,{componentId:"mlflow.experiment-evaluation-monitoring.date-selector",label:w,value:b.startTimeLabel?[b.startTimeLabel]:[u.oy],children:[(0,v.Y)(a.DialogComboboxTrigger,{renderDisplayedValue:e=>{var t;return null===(t=x.find((t=>t.key===e)))||void 0===t?void 0:t.label},allowClear:!(0,g.isNil)(b.startTimeLabel)&&b.startTimeLabel!==u.oy,onClear:()=>{S({startTimeLabel:u.oy})},"data-testid":"time-range-select-dropdown"}),(0,v.Y)(a.DialogComboboxContent,{children:(0,v.Y)(a.DialogComboboxOptionList,{children:x.map((e=>(0,v.Y)(a.DialogComboboxOptionListSelectItem,{checked:b.startTimeLabel===e.key||e.key===u.oy&&(0,g.isNil)(b.startTimeLabel),title:e.label,"data-testid":`time-range-select-${e}`,value:e.key,onChange:()=>{S({...b,startTimeLabel:e.key})},children:e.label},e.key)))})})]}),"CUSTOM"===b.startTimeLabel&&(0,v.Y)(v.FK,{children:(0,v.Y)(p.cv,{id:"date-picker-range",includeTime:!0,selected:{from:new Date(b.startTime),to:b.endTime?new Date(b.endTime):y.dateNow},onChange:e=>{const t=e.target.value;S({...b,startTime:null!==t&&void 0!==t&&t.from?t.from.toISOString():void 0,endTime:null!==t&&void 0!==t&&t.to?t.to.toISOString():void 0})},startDatePickerProps:{componentId:"experiment-evaluation-monitoring-start-date-picker",datePickerProps:{disabled:{after:y.dateNow}},value:b.startTime?new Date(b.startTime):void 0},endDatePickerProps:{componentId:"experiment-evaluation-monitoring-end-date-picker",datePickerProps:{disabled:{after:y.dateNow}},value:b.endTime?new Date(b.endTime):void 0}})}),(0,v.Y)(l.T,{componentId:"mlflow.experiment-evaluation-monitoring.trace-info-hover-request-time",content:e.formatMessage({id:"Arvaod",defaultMessage:"Showing data up to {date}."},{date:y.dateNow.toLocaleString(navigator.language,{timeZoneName:"short"})}),children:(0,v.Y)(s.B,{type:"link",componentId:"mlflow.experiment-evaluation-monitoring.refresh-date-button",disabled:Boolean(r),onClick:()=>{y.refresh(),(0,d.BL)({queryClient:n})},children:(0,v.Y)(a.RefreshIcon,{})})})]})})),S=({viewState:e,sessionId:t})=>{const{theme:n}=(0,s.u)();return(0,v.FD)("div",{css:(0,i.AH)({display:"flex",alignItems:"center",width:"100%",borderBottom:`1px solid ${n.colors.grey100}`,paddingBottom:`${n.spacing.sm}px`},""),children:[!("single-chat-session"===e)&&(0,v.Y)(b,{}),"single-chat-session"===e&&(0,v.FD)("div",{css:(0,i.AH)({display:"flex",alignItems:"center",gap:n.spacing.sm},""),children:[(0,v.Y)(a.Tag,{color:"default",componentId:"mlflow.chat-sessions.session-header-label",css:(0,i.AH)({padding:n.spacing.xs+2,margin:0},""),children:(0,v.FD)("span",{css:(0,i.AH)({display:"flex",alignItems:"center",gap:n.spacing.sm},""),children:[(0,v.Y)(a.SpeechBubbleIcon,{}),(0,v.Y)(s.T.Text,{ellipsis:!0,bold:!0,children:(0,v.Y)(c.sA,{id:"EAf6xM",defaultMessage:"Session"})})]})}),(0,v.Y)(s.T.Title,{level:3,withoutMargins:!0,children:t}),t&&(0,v.Y)(r.ad,{copyText:t,componentId:"mlflow.chat-sessions.copy-session-id",buttonProps:{icon:void 0}})]})]})}},92338:function(e,t,n){function i(e){return[{key:"LAST_HOUR",label:e.formatMessage({id:"bjoGjg",defaultMessage:"Last hour"})},{key:"LAST_24_HOURS",label:e.formatMessage({id:"JChRnq",defaultMessage:"Last 24 hours"})},{key:"LAST_7_DAYS",label:e.formatMessage({id:"eQsXm7",defaultMessage:"Last 7 days"})},{key:"LAST_30_DAYS",label:e.formatMessage({id:"p1H1KR",defaultMessage:"Last 30 days"})},{key:"LAST_YEAR",label:e.formatMessage({id:"EI7moF",defaultMessage:"Last year"})},{key:"ALL",label:e.formatMessage({id:"HeNa8H",defaultMessage:"All"})},{key:"CUSTOM",label:e.formatMessage({id:"TpmJlu",defaultMessage:"Custom"})}]}n.d(t,{p:function(){return i}})}}]);
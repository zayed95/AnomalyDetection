"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[5248],{27462:function(e,t,a){a.d(t,{F:function(){return o}});var n=a(46709),s=a(40720);const o=({traceSearchLocations:e})=>{const t=(0,s.C)();return(0,n.useMemo)((()=>({deleteTraces:async(e,a)=>t.mutateAsync({experimentId:e,traceRequestIds:a})})),[t])}},32874:function(e,t,a){a.d(t,{Z:function(){return v}});var n=a(27757),s=a(27299),o=a(46709),r=a(40724),l=a(79081),i=a(66916),c=a(42747),d=a(61077),u=a(39595),m=a(61060),g=a(34599);var f=a(73408);const p=({visible:e,experimentId:t,onCancel:a})=>{const n=(0,c.tz)(),[r,p]=(0,o.useState)(""),[h,v]=(0,o.useState)(""),{createEvaluationDatasetMutation:x,isLoading:w}=(({onSuccess:e,onError:t})=>{const a=(0,u.jE)(),{mutate:n,isLoading:s}=(0,m.n)({mutationFn:async({datasetName:e,experimentIds:t})=>{const a={name:e,experiment_ids:t};return(await(0,d.ff)((0,d.we)("ajax-api/3.0/mlflow/datasets/create"),"POST",a)).dataset},onSuccess:()=>{a.invalidateQueries({queryKey:[g.P4]}),null===e||void 0===e||e()},onError:e=>{null===t||void 0===t||t(e)}});return{createEvaluationDatasetMutation:n,isLoading:s}})({onSuccess:()=>{a()}}),b=(0,o.useCallback)((()=>{r?x({datasetName:r,experimentIds:[t]}):v(n.formatMessage({id:"sbHChH",defaultMessage:"Dataset name is required"}))}),[x,t,r,n]);return(0,f.FD)(l.d,{componentId:"mlflow.create-evaluation-dataset-modal",visible:e,onCancel:a,okText:n.formatMessage({id:"creoEe",defaultMessage:"Create"}),cancelText:n.formatMessage({id:"nEnDEu",defaultMessage:"Cancel"}),onOk:b,okButtonProps:{loading:w,disabled:!r},title:(0,f.Y)(c.sA,{id:"287Ack",defaultMessage:"Create evaluation dataset"}),children:[(0,f.Y)(s.FormUI.Label,{htmlFor:"dataset-name-input",children:(0,f.Y)(c.sA,{id:"xdFMIN",defaultMessage:"Dataset name"})}),(0,f.Y)(i.I,{componentId:"mlflow.create-evaluation-dataset-modal.dataset-name",id:"dataset-name-input",name:"name",type:"text",placeholder:n.formatMessage({id:"ZQpc2w",defaultMessage:"Enter dataset name"}),value:r,onChange:e=>{p(e.target.value),v("")}}),h&&(0,f.Y)(s.FormUI.Message,{type:"error",message:h})]})};var h={name:"b9l38d",styles:"width:min-content"};const v=({experimentId:e})=>{const[t,a]=(0,o.useState)(!1);return(0,f.FD)(f.FK,{children:[(0,f.Y)(n.B,{componentId:"mlflow.eval-datasets.create-dataset-button",css:h,icon:(0,f.Y)(s.DatabaseIcon,{}),onClick:()=>a(!0),children:(0,f.Y)(r.A,{id:"N7BCue",defaultMessage:"Create dataset"})}),(0,f.Y)(p,{experimentId:e,visible:t,onCancel:()=>a(!1)})]})}},33656:function(e,t,a){a.d(t,{N9:function(){return m},NW:function(){return d},OT:function(){return i},Yc:function(){return u}});var n=a(46709),s=a(22141),o=a.n(s),r=a(76251);let l=null;const i=()=>l||(l=new r.Converter,l.setFlavor("github"),l),c={allowedTags:["h1","h2","h3","h4","h5","h6","h7","h8","blockquote","p","a","ul","ol","nl","li","ins","b","i","strong","em","strike","code","hr","br","div","table","thead","tbody","tr","th","td","pre","del","sup","sub","dl","dt","dd","kbd","q","samp","samp","var","hr","rt","rp","summary","iframe","img","caption","figure"],allowedAttributes:{a:["href","name","target"],img:["src","longdesc"],div:["itemscope","itemtype"]}},d=e=>o()(e,c),u=e=>e.replace(new RegExp("<a","g"),'<a target="_blank"'),m=()=>(0,n.useCallback)((e=>{const t=i().makeHtml(e);return d(t)}),[])},40720:function(e,t,a){a.d(t,{C:function(){return l}});var n=a(39595),s=a(61060),o=a(12803),r=a(18154);const l=()=>{const e=(0,n.jE)();return(0,s.n)({mutationFn:async({experimentId:e,traceRequestIds:t})=>{const a=[];for(let s=0;s<t.length;s+=100)a.push(t.slice(s,s+100));const n=a.map((t=>o.x.deleteTracesV3(e,t)));return{traces_deleted:(await Promise.all(n)).reduce(((e,t)=>e+t.traces_deleted),0)}},onSuccess:()=>(0,r.BL)({queryClient:e})})}},52849:function(e,t,a){a.d(t,{v:function(){return s}});var n=a(46709);const s=({isFetching:e,hasNextPage:t,fetchNextPage:a})=>(0,n.useCallback)((n=>{if(n){const{scrollHeight:s,scrollTop:o,clientHeight:r}=n;s-o-r<200&&!e&&t&&a()}}),[a,e,t])},52855:function(e,t,a){a.d(t,{c:function(){return S}});var n=a(46709),s=a(68248),o=a(27757),r=a(79081),l=a(66916),i=a(27299),c=a(90061),d=a(43617),u=a(76256),m=a(40724),g=a(52849),f=a(72607),p=a(28189),h=a(76118);var v=a(61077),x=a(61060);var w=a(32874),b=a(9546),I=a(73408);const T=[{id:"name",accessorKey:"name",header:"Name"}];var k={name:"tardml",styles:"height:500px;overflow:hidden"},y={name:"82a6rk",styles:"flex:1"};const C=({experimentId:e,visible:t,setVisible:a,selectedTraceInfos:C})=>{const{theme:S}=(0,o.u)(),[M,_]=(0,n.useState)(""),[E,F]=(0,n.useState)(M),D=C.map((e=>(0,p.MF)({info:e,data:{spans:[]}}))),{data:R,isLoading:Y}=(0,b._)({traceIds:D}),P=(e=>{const t=e.map((e=>{var t;const a=e.data.spans.find((e=>!(0,p.cp)(e)));if((0,h.isNil)(a))return null;const n={};if((0,p.gD)(e.info))for(const r of null!==(s=e.info.assessments)&&void 0!==s?s:[]){var s;if("expectation"in r)if("serialized_value"in r.expectation){const e=r.expectation.serialized_value.value;try{n[r.assessment_name]=JSON.parse(e)}catch(o){n[r.assessment_name]=e}}else n[r.assessment_name]=r.expectation.value}return{inputs:(0,p.UZ)(a)?(0,p.xD)(null===(t=a.attributes)||void 0===t?void 0:t["mlflow.spanInputs"]):a.inputs,expectations:n,source:{source_type:"TRACE",source_data:{trace_id:(0,p.MF)(e)}}}}));return(0,h.compact)(t)})((0,h.compact)(R)),{data:N,isLoading:H,isFetching:A,fetchNextPage:q,hasNextPage:L}=(0,f.J)({experimentId:e,nameFilter:M}),K=H||Y,O=(0,g.v)({isFetching:A,hasNextPage:null!==L&&void 0!==L&&L,fetchNextPage:q}),z=(0,u.L)("mlflow/server/js/src/experiment-tracking/pages/experiment-evaluation-datasets/components/ExportTracesToDatasetModal.tsx",{columns:T,getRowId:e=>e.dataset_id,data:null!==N&&void 0!==N?N:[],getCoreRowModel:(0,c.HT)(),enableColumnResizing:!1}),j=z.getSelectedRowModel().rows.map((e=>e.original)),{upsertDatasetRecordsMutation:B,isLoading:V}=(({onSuccess:e,onError:t})=>{const{mutate:a,isLoading:n}=(0,x.n)({mutationFn:async({datasetId:e,records:t})=>{const a={dataset_id:e,records:t};return await(0,v.ff)((0,v.we)(`ajax-api/3.0/mlflow/datasets/${e}/records`),"POST",a)},onSuccess:()=>{null===e||void 0===e||e()},onError:e=>{null===t||void 0===t||t(e)}});return{upsertDatasetRecordsMutation:a,isLoading:n}})({onSuccess:()=>{a(!1)}}),W=(0,n.useCallback)((()=>{Promise.all(j.map((e=>B({datasetId:e.dataset_id,records:JSON.stringify(P)}))))}),[j,B,P]);return(0,I.Y)(r.d,{componentId:"mlflow.export-traces-to-dataset-modal",visible:t,onCancel:()=>a(!1),okText:(0,I.Y)(m.A,{id:"a1liZ7",defaultMessage:"Export"}),okButtonProps:{disabled:Y||0===j.length,loading:V},onOk:W,title:(0,I.Y)(m.A,{id:"ZBRK9J",defaultMessage:"Export traces to datasets"}),children:(0,I.FD)("div",{css:k,children:[(0,I.FD)("div",{css:(0,s.AH)({display:"flex",gap:S.spacing.sm,alignItems:"center",marginBottom:S.spacing.sm},""),children:[(0,I.Y)(l.I,{allowClear:!0,placeholder:"Search by dataset name",value:E,onChange:e=>{F(e.target.value),e.target.value||_(e.target.value)},onClear:()=>{F(""),_("")},onPressEnter:()=>_(E),componentId:"mlflow.eval-datasets.search-input",css:y,prefix:(0,I.Y)(l.S,{})}),(0,I.Y)(w.Z,{experimentId:e})]}),(0,I.FD)(i.Table,{scrollable:!0,onScroll:e=>O(e.currentTarget),someRowsSelected:z.getIsSomeRowsSelected()||z.getIsAllRowsSelected(),empty:!H&&!A&&0===N.length&&(0,I.Y)(i.Empty,{description:(0,I.Y)(m.A,{id:"F4K195",defaultMessage:"No evaluation datasets found"})}),children:[(0,I.FD)(i.TableRow,{isHeader:!0,children:[(0,I.Y)(i.TableRowSelectCell,{componentId:"mlflow.export-traces-to-dataset-modal.header-checkbox",checked:z.getIsAllRowsSelected(),indeterminate:z.getIsSomeRowsSelected(),onChange:z.getToggleAllRowsSelectedHandler()}),z.getLeafHeaders().map((e=>(0,I.Y)(i.TableHeader,{componentId:"mlflow.eval-datasets.column-header",header:e,column:e.column,css:(0,s.AH)({width:e.column.columnDef.size,maxWidth:e.column.columnDef.maxSize},""),children:(0,d.Kv)(e.column.columnDef.header,e.getContext())},e.id)))]}),!K&&z.getRowModel().rows.map((e=>(0,I.FD)(i.TableRow,{children:[(0,I.Y)("div",{children:(0,I.Y)(i.TableRowSelectCell,{componentId:"mlflow.export-traces-to-dataset-modal.row-checkbox",checked:e.getIsSelected(),onChange:e.getToggleSelectedHandler()})}),e.getVisibleCells().map((e=>(0,I.Y)(i.TableCell,{css:(0,s.AH)({width:e.column.columnDef.size,maxWidth:e.column.columnDef.maxSize},""),children:(0,d.Kv)(e.column.columnDef.cell,e.getContext())},e.id)))]},e.id))),(K||A)&&(0,I.Y)(i.TableSkeletonRows,{table:z})]})]})})},S=({experimentId:e})=>{const[t,a]=(0,n.useState)(!1),s=(0,n.useCallback)((({selectedTraceInfos:n})=>(0,I.Y)(C,{experimentId:e,visible:t,setVisible:a,selectedTraceInfos:n})),[e,t,a]);return{showExportTracesToDatasetsModal:t,setShowExportTracesToDatasetsModal:a,renderExportTracesToDatasetsModal:s}}},72607:function(e,t,a){a.d(t,{J:function(){return l}});var n=a(96584),s=a(61077),o=a(46709),r=a(34599);const l=({experimentId:e,enabled:t=!0,nameFilter:a=""})=>{const{data:l,fetchNextPage:i,hasNextPage:c,isLoading:d,isFetching:u,refetch:m,error:g}=(0,n.q)({queryKey:[r.P4,e,a],queryFn:async({queryKey:[,e,t],pageParam:a})=>{const n={experiment_ids:[e],filter_string:t?`name ILIKE '%${t}%'`:void 0,order_by:["created_time DESC"],max_results:50,page_token:a};return await(0,s.ff)((0,s.we)("ajax-api/3.0/mlflow/datasets/search"),"POST",n)},cacheTime:0,refetchOnWindowFocus:!1,retry:!1,enabled:t,getNextPageParam:e=>e.next_page_token});return{data:(0,o.useMemo)((()=>{var e;return null!==(e=null===l||void 0===l?void 0:l.pages.flatMap((e=>{var t;return null!==(t=e.datasets)&&void 0!==t?t:[]})))&&void 0!==e?e:[]}),[l]),fetchNextPage:i,hasNextPage:c,isLoading:d,isFetching:u,refetch:m,error:g}}},82636:function(e,t,a){a.d(t,{l:function(){return s}});var n=a(18154);const s=e=>{let t=!1,a=!1,s=!1;for(const l of e){var o,r;const e=l.traceInfo;e&&((0,n.h)(e)&&(a=!0),(0,n.Mq)(e)&&(t=!0),null!==(o=l.traceInfo)&&void 0!==o&&null!==(r=o.trace_metadata)&&void 0!==r&&r["mlflow.trace.tokenUsage"]&&(s=!0))}return{responseHasContent:t,inputHasContent:a,tokensHasContent:s}}},88525:function(e,t,a){a.d(t,{$:function(){return l}});var n=a(27042),s=a(12803),o=a(46709),r=a(181);const l=({onSuccess:e,existingTagKeys:t=[]})=>{const{showEditTagsModal:a,EditTagsModal:l}=(0,n.Q)({saveTagsHandler:async(e,t,a)=>{if(!e.traceRequestId)return;const n=e.traceRequestId,o=a.filter((({key:e,value:a})=>!t.some((({key:t,value:n})=>t===e&&a===n)))),r=t.filter((({key:e})=>!a.some((({key:t})=>e===t))));return Promise.all([...o.map((({key:e,value:t})=>s.x.setExperimentTraceTagV3(n,e,t))),...r.map((({key:e})=>s.x.deleteExperimentTraceTagV3(n,e)))])},valueRequired:!0,allAvailableTags:t.filter((e=>e&&!e.startsWith(r.nt))),onSuccess:e});return{showEditTagsModalForTrace:(0,o.useCallback)((e=>{var t;if(!e.trace_id)return;const n=Object.entries(null!==(t=e.tags)&&void 0!==t?t:{}).map((([e,t])=>({key:e,value:t}))).filter((({key:e})=>e&&!e.startsWith(r.nt)))||[];a({traceRequestId:e.trace_id,tags:n||[]})}),[a]),EditTagsModal:l}}}}]);
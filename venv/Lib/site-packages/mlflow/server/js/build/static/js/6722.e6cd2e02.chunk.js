"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[6722],{13433:function(e,t,s){s.d(t,{G3:function(){return u},N5:function(){return c},_A:function(){return p},aG:function(){return l},bU:function(){return d}});var n=s(59930),r=s.n(n),a=s(76118),i=s(33120),o=s(86125);const l=({traceId:e,assessmentId:t})=>(0,i.ff)((0,i.we)(`ajax-api/3.0/mlflow/traces/${e}/assessments/${t}`),"DELETE"),d=({payload:e})=>(0,i.ff)((0,i.we)(`ajax-api/3.0/mlflow/traces/${e.assessment.trace_id}/assessments`),"POST",e),c=({traceId:e})=>(0,i.ff)((0,i.we)(`ajax-api/3.0/mlflow/traces/${e}`)),u=({traceId:e,assessmentId:t,payload:s})=>(0,i.ff)((0,i.we)(`ajax-api/3.0/mlflow/traces/${e}/assessments/${t}`),"PATCH",s),p={searchTracesV4:async({signal:e,orderBy:t,locations:s,filter:n})=>{var r;const a={locations:s,filter:n,max_results:1e3,order_by:t},o=await(0,i.ff)((0,i.we)("ajax-api/4.0/mlflow/traces/search"),"POST",a,e);return null!==(r=null===o||void 0===o?void 0:o.trace_infos)&&void 0!==r?r:[]},getBatchTracesV4:async({traceIds:e,traceLocation:t})=>{const s=(0,a.isString)(t)?t:(0,o.nr)(t),n=(0,i.we)(`ajax-api/4.0/mlflow/traces/${s}/batchGet`),r=new URLSearchParams;for(const a of e)r.append("trace_ids",a);const l=`${n}?${r.toString()}`;return await(0,i.ff)(l,"GET")},getTraceInfoV4:({traceId:e,traceLocation:t})=>{const s=(0,a.isString)(t)?t:(0,o.nr)(t),n=`${(0,i.we)(`ajax-api/4.0/mlflow/traces/${s}/${e}/info`)}?${(new URLSearchParams).toString()}`;return(0,i.ff)(n)},createAssessmentV4:({payload:{assessment:e},traceLocation:t})=>{r()(t,"Trace location is required for creating assessment via V4 API");const s=(0,a.isString)(t)?t:(0,o.nr)(t);r()(s,"Trace location could not be resolved");const n=e,l=new URLSearchParams,d=`${(0,i.we)(`ajax-api/4.0/mlflow/traces/${s}/${e.trace_id}/assessments`)}?${l.toString()}`;return(0,i.ff)(d,"POST",n)},updateAssessmentV4:({traceId:e,assessmentId:t,payload:s,traceLocation:n})=>{const{assessment:l,update_mask:d}=s;r()(n,"Trace location is required for creating assessment via V4 API");const c=(0,a.isString)(n)?n:(0,o.nr)(n);r()(c,"Trace location could not be resolved");const u=new URLSearchParams;u.append("update_mask",d);const p=`${(0,i.we)(`ajax-api/4.0/mlflow/traces/${c}/${e}/assessments/${t}`)}?${u.toString()}`;return(0,i.ff)(p,"PATCH",l)},deleteAssessmentV4:({traceId:e,sqlWarehouseId:t,assessmentId:s,traceLocation:n})=>{const r=new URLSearchParams,a=(0,o.nr)(n),l=`${(0,i.we)(`ajax-api/4.0/mlflow/traces/${a}/${e}/assessments/${s}`)}?${r.toString()}`;return(0,i.ff)(l,"DELETE")},setTraceTagV4:async({traceLocation:e,tag:t,traceId:s})=>{const n=(0,o.nr)(e),r=`${(0,i.we)(`ajax-api/4.0/mlflow/traces/${n}/${s}/tags`)}?${(new URLSearchParams).toString()}`;return(0,i.ff)(r,"PATCH",t)},deleteTraceTagV4:async({tagKey:e,traceId:t,traceLocation:s})=>{const n=(0,o.nr)(s),r=`${(0,i.we)(`ajax-api/4.0/mlflow/traces/${n}/${t}/tags/${encodeURIComponent(e)}`)}?${(new URLSearchParams).toString()}`;return(0,i.ff)(r,"DELETE")}}},16333:function(e,t,s){s.d(t,{Ld:function(){return n.L}});s(37750),s(44072);var n=s(38815)},21636:function(e,t,s){s.d(t,{Bt:function(){return r},E3:function(){return d},Uu:function(){return l},gK:function(){return a},kj:function(){return n},n2:function(){return o},zZ:function(){return i}});const n="yellow500",r="yellow200",a="mlflow.assessment.scorerTraceId",i="mlflow.assessment.judgeCost",o="mlflow.trace.session",l="mlflow.trace.tokenUsage",d="mlflow.trace.user"},27882:function(e,t,s){s.d(t,{F9:function(){return a},T9:function(){return r},ny:function(){return n}});const n=()=>!1,r=()=>1e9,a=()=>!1},28189:function(e,t,s){s.d(t,{a8:function(){return en},ModelTraceExplorerOSSNotebookRenderer:function(){return rn},gE:function(){return on}});var n=s(46709),r=s(89949),a=s(27882),i=s(86125),o=s(27299),l=s(27757),d=s(42747),c=s(73408);const u=()=>(0,c.Y)(o.Empty,{title:(0,c.Y)(d.sA,{id:"rjhiii",defaultMessage:"Trace failed to render"}),description:(0,c.Y)(d.sA,{id:"1a1+j5",defaultMessage:"Unfortunately, the trace could not be rendered due to an unknown error. You can reload the page to try again. If the problem persists, please contact support."}),image:(0,c.Y)(l.k,{})});var p=s(68248),m=s(94664),h=s(76118),g=s(21636);const f=({searchFilter:e,data:t,activeMatch:s,containsActiveMatch:r})=>{const{theme:a}=(0,l.u)(),o=(0,n.useCallback)((e=>{null===e||void 0===e||e.scrollIntoView({block:"nearest",inline:"nearest"})}),[]),d=(0,n.useMemo)((()=>e?(0,i.OS)({data:t,searchFilter:e,activeMatchBackgroundColor:a.colors[g.kj],inactiveMatchBackgroundColor:a.colors[g.Bt],containsActiveMatch:r,activeMatch:s,scrollToActiveMatch:o}):[]),[e,t,a,r,s,o]);return(0,c.Y)("pre",{css:(0,p.AH)({whiteSpace:"pre-wrap",backgroundColor:a.colors.backgroundSecondary,padding:a.spacing.sm,fontSize:a.typography.fontSizeSm},""),children:d})};var v=s(73879),x=s(19112);var y={name:"bjn8wh",styles:"position:relative"},b={name:"n31mhe",styles:"width:100%;padding:0"};function Y({data:e,searchFilter:t="",activeMatch:s=null,containsActiveMatch:r=!1,renderMode:a=m.cC.JSON,initialExpanded:i=!1}){const u=Boolean(t)&&!(0,h.isNil)(s)&&e.toLowerCase().includes(t),{theme:g}=(0,l.u)(),[Y,w]=(0,n.useState)("json"===a),[A,T]=(0,n.useState)(i||u),S=(0,n.useRef)(null),M=(0,n.useMemo)((()=>{if("json"===a)return e;const t=JSON.parse(e);return(0,h.isString)(t)?t:e}),[e,a]),I=Y||M.split("\n").length>4||M.length>300,k=(0,n.useMemo)((()=>{if(I&&!A){const e=M.split("\n").slice(0,4).join("\n");return e.length>300?e.slice(0,300):e}return M}),[M,I,A]);(0,n.useEffect)((()=>{S.current&&w(S.current.scrollWidth>S.current.clientWidth)}),[a,e]);const D=(0,n.useCallback)((e=>(0,c.Y)("pre",{...e,ref:S})),[]);return u?(0,c.Y)(f,{data:e,searchFilter:t,activeMatch:s,containsActiveMatch:!s.isKeyMatch&&r}):(0,c.FD)("div",{css:y,children:["markdown"===a?(0,c.Y)("div",{css:(0,p.AH)({padding:g.spacing.md,backgroundColor:g.colors.backgroundSecondary,marginBottom:-g.spacing.md},""),children:(0,c.Y)(v.V,{children:k})}):(0,c.FD)(c.FK,{children:[(0,c.Y)(x.VE,{componentId:"shared.model-trace-explorer.copy-snippet",copyText:e,size:"small",css:(0,p.AH)({position:"absolute",top:g.spacing.xs,right:g.spacing.xs,zIndex:1},"")},"copy-snippet"),(0,c.Y)(x.z7,{PreTag:D,showLineNumbers:!0,language:a,lineProps:{style:{wordBreak:"break-word",whiteSpace:"pre-wrap"}},wrapLines:A,theme:g.isDarkMode?"duotoneDark":"light",style:{backgroundColor:g.colors.backgroundSecondary,padding:g.spacing.sm,paddingBottom:I?0:g.spacing.sm,paddingRight:2*g.spacing.md,overflow:A?"auto":"hidden",textOverflow:"ellipsis",fontSize:g.typography.fontSizeSm,lineHeight:g.typography.lineHeightBase},children:k})]}),I&&(0,c.Y)("div",{css:(0,p.AH)({backgroundColor:g.colors.backgroundSecondary},""),children:(0,c.Y)(l.B,{css:b,componentId:A?"shared.model-trace-explorer.snippet-see-less":"shared.model-trace-explorer.snippet-see-more",icon:A?(0,c.Y)(o.ChevronUpIcon,{}):(0,c.Y)(o.ChevronDownIcon,{}),type:"tertiary",onClick:()=>T(!A),children:A?(0,c.Y)(d.sA,{id:"AgjhWE",defaultMessage:"See less"}):(0,c.Y)(d.sA,{id:"HYQHVk",defaultMessage:"See more"})})})]})}const w=e=>JSON.stringify(`import mlflow\n\n# returns an MLflow Trace object\ntrace = mlflow.get_trace('${e}')\n\n# trace.info contains tags and metadata\ntrace_info = trace.info\n\n# the trace's spans are stored in trace.data\nspans = trace.data.spans`);var A={name:"b9l38d",styles:"width:min-content"};const T=({traceId:e,setForceDisplay:t})=>{const{theme:s}=(0,l.u)();return(0,c.Y)(o.Empty,{image:(0,c.Y)(l.W,{}),title:(0,c.Y)(d.sA,{id:"4Itm9y",defaultMessage:"Large trace"}),description:(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:s.spacing.md,alignItems:"center"},""),children:[(0,c.Y)(d.sA,{id:"TvjS47",defaultMessage:"This trace is very large, and may cause UI slowness when attempting to render. You can click the button below to attempt to display it anyway."}),(0,c.Y)(l.B,{componentId:"shared.model-trace-explorer.trace-too-large.force-display-button",css:A,onClick:()=>t(!0),children:(0,c.Y)(d.sA,{id:"rFJSWc",defaultMessage:"Attempt to display"})}),(0,c.Y)("span",{children:(0,c.Y)(d.sA,{id:"1Buj/Q",defaultMessage:"Alternatively, you can interact with this trace via the MLflow Python SDK, using the {code} function. For more information, please check the {documentation_link}.",values:{code:(0,c.Y)(l.T.Text,{code:!0,children:"mlflow.get_trace()"}),documentation_link:(0,c.Y)(l.T.Link,{href:"https://mlflow.org/docs/latest/api_reference/python_api/mlflow.entities.html#mlflow.entities.Trace",target:"_blank",openInNewTab:!0,componentId:"shared.model-trace-explorer.trace-too-large.documentation-link",children:(0,c.Y)(d.sA,{id:"7RNlsx",defaultMessage:"MLflow API documentation"})})}})}),(0,c.Y)(Y,{data:w(e),renderMode:m.cC.PYTHON,initialExpanded:!0})]})})};var S=s(81390);const M=(0,n.createContext)({rootNode:null,nodeMap:{},activeView:"summary",setActiveView:()=>{},selectedNode:void 0,setSelectedNode:()=>{},activeTab:"content",setActiveTab:()=>{},showTimelineTreeGantt:!1,setShowTimelineTreeGantt:()=>{},assessmentsPaneExpanded:!1,setAssessmentsPaneExpanded:()=>{},isTraceInitialLoading:!1,assessmentsPaneEnabled:!0,isInComparisonView:!1,topLevelNodes:[]}),I=()=>(0,n.useContext)(M),k=({modelTrace:e,initialActiveView:t,selectedSpanIdOnRender:s,assessmentsPaneEnabled:r,initialAssessmentsPaneCollapsed:a,isTraceInitialLoading:o=!1,isInComparisonView:l=!1,children:d})=>{var u,p,m;const g=(0,n.useMemo)((()=>(0,i.uM)(e)),[e]),f=1===g.length?g[0]:null,v=(0,n.useMemo)((()=>f?(0,S.dM)([f]):{}),[f]),x=(0,i.f7)(f,s),y=null!==(u=null!==x&&void 0!==x?x:f)&&void 0!==u?u:void 0,b=(null!==(p=null===y||void 0===y||null===(m=y.assessments)||void 0===m?void 0:m.length)&&void 0!==p?p:0)>0,Y=!(0,h.isNil)(null===f||void 0===f?void 0:f.inputs)||!(0,h.isNil)(null===f||void 0===f?void 0:f.outputs),[w,A]=(0,n.useState)(null!==t&&void 0!==t?t:f&&Y?"summary":"detail"),[T,I]=(0,n.useState)(y),k=(0,i.pQ)(T),[D,C]=(0,n.useState)(k),[E,N]=(0,n.useState)(!1),[F,R]=(0,n.useState)(!a&&b||"force-open"===a);(0,n.useEffect)((()=>{const e=(0,i.pQ)(T);C(e)}),[T]);const H=(0,n.useMemo)((()=>({rootNode:f,nodeMap:v,activeView:w,setActiveView:A,activeTab:D,setActiveTab:C,selectedNode:T,setSelectedNode:I,showTimelineTreeGantt:E,setShowTimelineTreeGantt:N,assessmentsPaneExpanded:F,setAssessmentsPaneExpanded:R,assessmentsPaneEnabled:r,isTraceInitialLoading:o,isInComparisonView:l,topLevelNodes:g})),[w,v,D,f,T,E,N,F,R,r,o,l,g]);return(0,c.Y)(M.Provider,{value:H,children:d})};var D=s(66916),C=s(79081);var E={name:"e0dnmk",styles:"cursor:pointer"};const N=({label:e,value:t,displayValue:s=t,icon:n,color:r,getTruncatedLabel:a,onCopy:i})=>{const{theme:d}=(0,l.u)();return(0,c.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"row",gap:d.spacing.sm},""),children:[(0,c.Y)(l.T.Text,{size:"md",color:"secondary",children:e}),(0,c.Y)(C.T,{componentId:"shared.model-trace-explorer.header-details.tooltip",content:t,maxWidth:400,children:(0,c.Y)(o.Tag,{componentId:"shared.model-trace-explorer.header-details.tag",color:r,onClick:()=>{navigator.clipboard.writeText(t),i()},css:E,children:(0,c.FD)("span",{css:(0,p.AH)({display:"flex",flexDirection:"row",alignItems:"center",gap:d.spacing.xs},""),children:[n&&(0,c.Y)("span",{children:n}),(0,c.Y)("span",{children:a(s)})]})})})]})},F="mlflow.",R=e=>{try{return JSON.parse(e)}catch(t){return}},H=(e,t)=>{const s=(0,h.truncate)(e,{length:t});return(0,h.takeWhile)(s,(e=>"\n"!==e)).join("")};var L={name:"dgkyot",styles:"cursor:default;width:fit-content;max-width:100%"},_={name:"j601fv",styles:"flex-basis:45%;flex-shrink:0"},O={name:"1sdjnkx",styles:"word-break:break-word"};const B=({traceMetadata:e,getTruncatedLabel:t=e=>H(e,40)})=>{const{theme:s}=(0,l.u)(),r=e=>{if(e&&"object"===typeof e)try{return JSON.stringify(e)}catch{return String(e)}if("string"===typeof e){const t=R(e);if(t&&"object"===typeof t)try{return JSON.stringify(t)}catch{return e}return e}return String(null!==e&&void 0!==e?e:"")},a=(0,n.useMemo)((()=>Object.entries(e||{}).filter((([e,t])=>null!==t&&""!==t&&!e.startsWith(F))).sort((([e],[t])=>e.localeCompare(t))).map((([e,t])=>({key:e,value:t,displayValue:r(t)})))),[e]);return 0===a.length?null:(0,c.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"row",gap:s.spacing.sm},""),children:[(0,c.Y)(l.T.Text,{size:"md",color:"secondary",children:(0,c.Y)(d.sA,{id:"zRKlAL",defaultMessage:"Metadata"})}),(0,c.Y)(o.Overflow,{noMargin:!0,children:(0,c.Y)(o.HoverCard,{trigger:(0,c.Y)(o.Tag,{componentId:"shared.model-trace-explorer.header-metadata-pill",color:"default",css:L,children:(0,c.FD)("span",{css:(0,p.AH)({display:"flex",alignItems:"center",gap:s.spacing.xs},""),children:[(0,c.Y)(C.L,{css:(0,p.AH)({fontSize:12,color:s.colors.textSecondary},"")}),(0,c.Y)("span",{children:a.length})]})}),content:(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:s.spacing.xs,maxWidth:480,maxHeight:320,overflowY:"auto"},""),children:[a.slice(0,100).map((({key:e,displayValue:n,value:r})=>(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",alignItems:"flex-start",gap:s.spacing.xs},""),children:[(0,c.Y)(l.T.Text,{css:_,children:t(e)}),(0,c.Y)(l.T.Text,{color:"secondary",css:O,children:n})]},`${e}:${r}`))),a.length>100&&(0,c.FD)(l.T.Text,{color:"secondary",children:["+",a.length-100," more"]})]})})})]})};var z=s(44105),$=s(52489),j=s(110);var V={name:"mqlsmr",styles:"font-size:12px;display:flex"},P={name:"rnnx2x",styles:"font-size:12px"};const U=({experimentId:e,sessionId:t,traceId:s,handleCopy:r})=>{const{theme:a}=(0,l.u)(),i=(0,j.zy)(),u=t.length>10?`${t.slice(0,10)}...`:t,m=(0,n.useCallback)((e=>e.length>10?`${e.slice(0,10)}...`:e),[]),h=(0,$.e)(e,t),g=s?`${h}?${new URLSearchParams({[z.hb]:s}).toString()}`:h;return i.pathname.includes(`/chat-sessions/${t}`)?(0,c.Y)(N,{label:(0,c.Y)(d.sA,{id:"XIWwOm",defaultMessage:"Session ID"}),icon:(0,c.Y)(o.SpeechBubbleIcon,{css:V}),value:t,color:"default",getTruncatedLabel:m,onCopy:r}):(0,c.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"row",gap:a.spacing.sm},""),children:[(0,c.Y)(l.T.Text,{size:"md",color:"secondary",children:(0,c.Y)(d.sA,{id:"XIWwOm",defaultMessage:"Session ID"})}),(0,c.Y)(C.T,{componentId:"mlflow.model-trace-explorer.session-id-tag",content:(0,c.Y)(d.sA,{id:"OUPWd8",defaultMessage:"View chat session"}),children:(0,c.Y)(j.N_,{to:g,children:(0,c.Y)(o.Tag,{componentId:"mlflow.model_trace_explorer.header_details.tag-session-id",children:(0,c.FD)("span",{css:(0,p.AH)({display:"flex",flexDirection:"row",alignItems:"center",gap:a.spacing.xs},""),children:[(0,c.Y)(o.SpeechBubbleIcon,{css:P}),(0,c.Y)("span",{children:u})]})})})})]})},K=({statusState:e,getTruncatedLabel:t})=>{const s=(0,d.tz)(),{theme:n}=(0,l.u)(),r=((e,t,s)=>({IN_PROGRESS:{label:t.formatMessage({id:"Y1eg9D",defaultMessage:"In progress"}),icon:(0,c.Y)(D.C,{css:(0,p.AH)({color:s.colors.textValidationWarning},"")}),color:"lemon"},OK:{label:t.formatMessage({id:"hUfxmd",defaultMessage:"OK"}),icon:(0,c.Y)(o.CheckCircleIcon,{css:(0,p.AH)({color:s.colors.textValidationSuccess},"")}),color:"teal"},ERROR:{label:t.formatMessage({id:"ho2T6B",defaultMessage:"Error"}),icon:(0,c.Y)(o.XCircleIcon,{css:(0,p.AH)({color:s.colors.textValidationDanger},"")}),color:"coral"},STATE_UNSPECIFIED:null}[e]))(e,s,n);return r?(0,c.Y)(N,{label:(0,c.Y)(d.sA,{id:"HNQ9dM",defaultMessage:"Status"}),value:r.label,color:r.color,icon:r.icon,getTruncatedLabel:t,onCopy:()=>{}}):null};var W={name:"7z0gr8",styles:"font-size:12px;display:flex;align-items:center;justify-content:center"},G={name:"mqlsmr",styles:"font-size:12px;display:flex"},q={name:"e0dnmk",styles:"cursor:pointer"};const J=({modelTraceInfo:e})=>{var t;const{theme:s}=(0,l.u)(),[r,a]=(0,n.useState)(!1),{rootNode:u}=I(),{experimentId:m}=(0,j.g)(),h=Object.entries(null!==(t=e.tags)&&void 0!==t?t:{}).filter((([e])=>{return!(t=e).startsWith(F)&&!t.startsWith("_mlflow_");var t})),[f,v]=(0,n.useMemo)((()=>{var t;return(0,i.ko)(e)&&(0,i.gD)(e)?[(0,i.vX)(e),e.trace_id]:[(0,i.gD)(e)?e.trace_id:null!==(t=e.request_id)&&void 0!==t?t:""]}),[e]),x=(0,n.useMemo)((()=>{var t,s;return R(null!==(t=null===e||void 0===e||null===(s=e.trace_metadata)||void 0===s?void 0:s[g.Uu])&&void 0!==t?t:"{}")}),[e]),y=(0,n.useMemo)((()=>null===x||void 0===x?void 0:x.total_tokens),[x]),b=(0,n.useMemo)((()=>{var t;return null===e||void 0===e||null===(t=e.trace_metadata)||void 0===t?void 0:t[g.n2]}),[e]),Y=(0,n.useMemo)((()=>{var t;return null===e||void 0===e||null===(t=e.trace_metadata)||void 0===t?void 0:t[g.E3]}),[e]),w=(0,n.useMemo)((()=>(0,i.gD)(e)?e.state:void 0),[e]),A=(0,n.useMemo)((()=>{if(u)return(0,S.X6)(u.end-u.start)}),[u]),T=e=>H(e,40),M=(0,n.useCallback)((()=>{a(!0),setTimeout((()=>a(!1)),2e3)}),[]);return(0,c.FD)("div",{css:(0,p.AH)({paddingLeft:s.spacing.md,paddingBottom:s.spacing.sm},""),children:[(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",gap:s.spacing.md,rowGap:s.spacing.sm,flexWrap:"wrap"},""),children:[w&&(0,c.Y)(K,{statusState:w,getTruncatedLabel:T}),f&&(0,c.Y)(N,{label:(0,c.Y)(d.sA,{id:"imKpxw",defaultMessage:"ID"}),value:f,displayValue:v,color:"purple",getTruncatedLabel:T,onCopy:M}),y&&(0,c.Y)(N,{label:(0,c.Y)(d.sA,{id:"zp4MBw",defaultMessage:"Token count"}),value:y.toString(),getTruncatedLabel:T,onCopy:M}),A&&(0,c.Y)(N,{label:(0,c.Y)(d.sA,{id:"K1JLVU",defaultMessage:"Latency"}),icon:(0,c.Y)(D.C,{css:W}),value:A,getTruncatedLabel:T,onCopy:M}),b&&m&&(0,c.Y)(U,{handleCopy:M,experimentId:m,sessionId:b,traceId:f}),Y&&(0,c.Y)(N,{label:(0,c.Y)(d.sA,{id:"128VYg",defaultMessage:"User"}),icon:(0,c.Y)(o.UserIcon,{css:G}),value:Y,color:"default",getTruncatedLabel:T,onCopy:M}),(0,c.Y)(B,{traceMetadata:null===e||void 0===e?void 0:e.trace_metadata,getTruncatedLabel:T}),h.length>0&&(0,c.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"row",gap:s.spacing.sm},""),children:[(0,c.Y)(l.T.Text,{size:"md",color:"secondary",children:(0,c.Y)(d.sA,{id:"7KPJii",defaultMessage:"Tags"})}),(0,c.Y)(o.Overflow,{noMargin:!0,children:h.map((([e,t])=>{const s=`${e}: ${t}`;return(0,c.Y)(C.T,{componentId:"shared.model-trace-explorer.header-details.tooltip",content:s,children:(0,c.Y)(o.Tag,{componentId:"shared.model-trace-explorer.header-details.tag",onClick:()=>{var e;e=s,navigator.clipboard.writeText(e),M()},css:q,children:T(`${e}: ${t}`)})},e)}))})]})]}),r&&(0,c.FD)(o.Notification.Provider,{children:[(0,c.Y)(o.Notification.Root,{severity:"success",componentId:"mlflow.model_trace_explorer.header_details.notification",children:(0,c.Y)(o.Notification.Title,{children:(0,c.Y)(d.sA,{id:"xgypqc",defaultMessage:"Copied to clipboard"})})}),(0,c.Y)(o.Notification.Viewport,{})]})]})};var X=s(49708),Q=s(13433),Z=s(41151);const ee=(0,s(24447).vt)((e=>({assessmentActions:{},resetCache:()=>e((()=>({assessmentActions:{}}))),logAddedAssessment:(t,s)=>e((e=>s?{assessmentActions:{...e.assessmentActions,[t]:[...e.assessmentActions[t]||[],{action:"ADD",assessment:s}]}}:e)),logRemovedAssessment:(t,s)=>e((e=>s?{assessmentActions:{...e.assessmentActions,[t]:[...e.assessmentActions[t]||[],{action:"DELETE",assessment:s}]}}:e)),reconstructAssessments:(e,t)=>{if(!t)return e;let s=[...e];return t.forEach((({action:e,assessment:t})=>{"ADD"===e&&t?s.unshift(t):"DELETE"===e&&t&&(s=s.filter((e=>e.assessment_id!==t.assessment_id)))})),s}})));var te={name:"1d3w5wq",styles:"width:100%"};const se=({sectionKey:e,title:t,children:s,withBorder:r=!1,className:a})=>{const[i,d]=(0,n.useState)(!0),{theme:u}=(0,l.u)();return(0,c.FD)("div",{className:a,css:(0,p.AH)({display:"flex",flexDirection:"column",borderRadius:u.borders.borderRadiusMd},""),children:[(0,c.FD)("div",{css:(0,p.AH)({alignItems:"center",display:"flex",flexDirection:"row",gap:u.spacing.xs,padding:r?u.spacing.sm:0,background:r?u.colors.backgroundSecondary:void 0,borderTopLeftRadius:u.borders.borderRadiusMd,borderTopRightRadius:u.borders.borderRadiusMd,borderBottomLeftRadius:i?0:u.borders.borderRadiusMd,borderBottomRightRadius:i?0:u.borders.borderRadiusMd,border:r?`1px solid ${u.colors.border}`:void 0,marginBottom:r?0:u.spacing.sm},""),children:[(0,c.Y)(l.B,{size:"small",componentId:"shared.model-trace-explorer.expand",type:"tertiary",icon:i?(0,c.Y)(o.ChevronDownIcon,{}):(0,c.Y)(l.o,{}),onClick:()=>d(!i)}),(0,c.Y)(l.T.Title,{withoutMargins:!0,level:4,css:te,children:t})]}),i&&(0,c.Y)("div",{css:(0,p.AH)({border:r?`1px solid ${u.colors.border}`:void 0,borderTop:"none",borderBottomLeftRadius:r?u.borders.borderRadiusMd:void 0,borderBottomRightRadius:r?u.borders.borderRadiusMd:void 0,padding:r?u.spacing.sm:0},""),children:s})]})};function ne({paramName:e,paramProperties:t,isRequired:s}){const{theme:n}=(0,l.u)(),{type:r,description:a,enum:i}=t,o=r||a||i,u=o?{borderTopLeftRadius:n.borders.borderRadiusMd,borderTopRightRadius:n.borders.borderRadiusMd,borderBottom:`1px solid ${n.colors.border}`}:{borderRadius:n.borders.borderRadiusMd};return(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",width:"100%",borderRadius:n.borders.borderRadiusMd,border:`1px solid ${n.colors.border}`},""),children:[(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",alignItems:"center",backgroundColor:n.colors.backgroundSecondary,padding:`${n.spacing.sm}px ${n.spacing.md}px`,gap:n.spacing.sm,...u},""),children:[(0,c.Y)(l.T.Title,{withoutMargins:!0,style:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},children:e}),s&&(0,c.Y)(l.T.Text,{withoutMargins:!0,color:"error",children:(0,c.Y)(d.sA,{id:"JmNdE4",defaultMessage:"required"})})]}),o&&(0,c.FD)("div",{css:(0,p.AH)({display:"grid",gridTemplateColumns:"auto 1fr",gridTemplateRows:"auto",gap:n.spacing.md,padding:`${n.spacing.sm}px ${n.spacing.md}px`},""),children:[r&&(0,c.FD)(c.FK,{children:[(0,c.Y)(l.T.Text,{withoutMargins:!0,bold:!0,children:(0,c.Y)(d.sA,{id:"CbRDlp",defaultMessage:"Type"})}),(0,c.Y)(l.T.Text,{withoutMargins:!0,code:!0,children:r})]}),a&&(0,c.FD)(c.FK,{children:[(0,c.Y)(l.T.Text,{withoutMargins:!0,bold:!0,children:(0,c.Y)(d.sA,{id:"SLjN1/",defaultMessage:"Description"})}),(0,c.Y)(l.T.Text,{withoutMargins:!0,children:a})]}),i&&(0,c.FD)(c.FK,{children:[(0,c.Y)(l.T.Text,{withoutMargins:!0,bold:!0,children:(0,c.Y)(d.sA,{id:"/WK1x1",defaultMessage:"Enum Values"})}),(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",gap:n.spacing.sm,flexWrap:"wrap"},""),children:i.map((e=>(0,c.Y)(l.T.Text,{withoutMargins:!0,code:!0,children:e},e)))})]})]})]})}function re({tool:e}){var t,s,r;const{theme:a}=(0,l.u)(),[i,d]=(0,n.useState)(!1),u=e.function.description,m=null===(t=e.function.parameters)||void 0===t?void 0:t.properties,h=null!==(s=null===(r=e.function.parameters)||void 0===r?void 0:r.required)&&void 0!==s?s:[],g=u||m,f=g?{":hover":{backgroundColor:a.colors.actionIconBackgroundHover,cursor:"pointer"}}:{};return(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",width:"100%",borderRadius:a.borders.borderRadiusMd,border:`1px solid ${a.colors.border}`,backgroundColor:a.colors.backgroundPrimary},""),"data-testid":"model-trace-explorer-chat-tool",children:[(0,c.FD)("div",{role:"button",css:(0,p.AH)({display:"flex",flexDirection:"row",gap:a.spacing.sm,alignItems:"center",borderBottom:g&&i?`1px solid ${a.colors.border}`:"none",padding:a.spacing.sm,...f},""),onClick:()=>d(!i),"data-testid":"model-trace-explorer-chat-tool-toggle",children:[g&&(i?(0,c.Y)(o.ChevronDownIcon,{}):(0,c.Y)(l.o,{})),(0,c.Y)(l.T.Text,{bold:!0,withoutMargins:!0,style:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},children:e.function.name})]}),g&&i&&(0,c.FD)("div",{css:(0,p.AH)({padding:a.spacing.sm},""),children:[u&&(0,c.Y)(l.T.Paragraph,{style:{whiteSpace:"pre-wrap",marginBottom:a.spacing.sm,padding:`0px ${a.spacing.xs}px`},children:e.function.description}),m&&(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:a.spacing.sm},""),children:Object.keys(m).map((e=>(0,c.Y)(ne,{paramName:e,paramProperties:m[e],isRequired:h.includes(e)},e)))})]})]})}const ae=({title:e,tools:t})=>{const{theme:s}=(0,l.u)();return(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:s.spacing.sm,padding:s.spacing.sm,border:`1px solid ${s.colors.border}`,borderRadius:s.borders.borderRadiusSm},""),children:[e&&(0,c.Y)(l.T.Text,{css:(0,p.AH)({marginLeft:s.spacing.xs},""),bold:!0,children:e}),t.map((e=>(0,c.Y)(re,{tool:e},e.function.name)))]})};var ie=s(73880);var oe={name:"1fttcpj",styles:"display:flex;flex-direction:column"};function le({text:e,metadataTags:t,setExpanded:s,logDocumentClick:n}){const{theme:r}=(0,l.u)();return(0,c.FD)("div",{css:oe,children:[(0,c.Y)("div",{role:"button",onClick:()=>{s(!1),null===n||void 0===n||n("collapse")},css:(0,p.AH)({display:"flex",flexDirection:"row",alignItems:"center",cursor:"pointer",padding:`${r.spacing.sm}px ${r.spacing.md}px`,height:r.typography.lineHeightBase,boxSizing:"content-box","&:hover":{backgroundColor:r.colors.backgroundSecondary}},""),children:(0,c.Y)(o.FileDocumentIcon,{})}),(0,c.Y)("div",{css:(0,p.AH)({padding:r.spacing.md,paddingBottom:0},""),children:(0,c.Y)(v.V,{children:e})}),(0,c.Y)("div",{css:(0,p.AH)({padding:r.spacing.md,paddingTop:0},""),children:t.map((({key:e,value:t})=>(0,c.Y)(ie.t,{itemKey:e,itemValue:t},e)))}),(0,c.Y)(l.B,{css:(0,p.AH)({width:"100%",padding:r.spacing.sm},""),componentId:"shared.model-trace-explorer.retriever-document-collapse",icon:(0,c.Y)(o.ChevronUpIcon,{}),type:"tertiary",onClick:()=>s(!1),children:(0,c.Y)(d.sA,{id:"AgjhWE",defaultMessage:"See less"})})]})}var de={name:"ti75j2",styles:"margin:0"},ce={name:"1r5gb7q",styles:"display:inline-block"},ue={name:"1tma7dt",styles:"white-space:nowrap;margin:0"};function pe({text:e,metadataTags:t,setExpanded:s,logDocumentClick:n}){const{theme:r}=(0,l.u)();return(0,c.FD)("div",{role:"button",onClick:()=>{s(!0),null===n||void 0===n||n("expand")},css:(0,p.AH)({display:"flex",flexDirection:"row",padding:`${r.spacing.sm}px ${r.spacing.md}px`,gap:r.spacing.sm,alignItems:"center",justifyContent:"space-between",cursor:"pointer","&:hover":{backgroundColor:r.colors.backgroundSecondary}},""),children:[(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",gap:r.spacing.sm,alignItems:"center",minWidth:0,flexShrink:1},""),children:[(0,c.Y)(o.FileDocumentIcon,{}),(0,c.Y)(l.T.Text,{ellipsis:!0,size:"md",children:e})]}),(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",gap:r.spacing.sm},""),children:[t.length>0?(0,c.Y)(ie.t,{css:de,itemKey:t[0].key,itemValue:t[0].value}):null,t.length>1?(0,c.Y)(C.T,{componentId:"shared.model-trace-explorer.tag-count.hover-tooltip",content:t.slice(1).map((({key:e,value:t})=>(0,c.Y)("span",{css:ce,children:`${e}: ${t}`},e))),children:(0,c.FD)(o.Tag,{componentId:"shared.model-trace-explorer.tag-count",css:ue,children:["+",t.length-1]})}):null]})]})}function me({text:e,metadata:t}){const[s,r]=(0,n.useState)(!1),a=(0,i.g_)(t);return s?(0,c.Y)(le,{text:e,metadataTags:a,setExpanded:r}):(0,c.Y)(pe,{text:e,metadataTags:a,setExpanded:r})}const he=({title:e,documents:t})=>{const{theme:s}=(0,l.u)();return(0,c.FD)("div",{css:(0,p.AH)({backgroundColor:s.colors.backgroundPrimary,borderRadius:s.borders.borderRadiusSm,border:`1px solid ${s.colors.border}`},""),children:[e&&(0,c.Y)("div",{css:(0,p.AH)({padding:`${s.spacing.xs}px ${s.spacing.sm}px`,borderBottom:`1px solid ${s.colors.border}`},""),children:(0,c.Y)(l.T.Text,{bold:!0,children:e})}),t.map(((e,n)=>(0,c.Y)("div",{css:(0,p.AH)({borderBottom:n!==t.length-1?`1px solid ${s.colors.border}`:""},""),children:(0,c.Y)(me,{text:e.page_content,metadata:e.metadata},n)},n)))]})},ge=({title:e,value:t})=>{const{theme:s}=(0,l.u)(),[r,a]=(0,n.useState)(!1),i=t.length>400,u=!r&&t.length>400?t.slice(0,400)+"...":t,m=i?{":hover":{backgroundColor:s.colors.actionIconBackgroundHover,cursor:"pointer"}}:{};return(0,c.FD)("div",{css:(0,p.AH)({border:`1px solid ${s.colors.border}`,borderRadius:s.borders.borderRadiusSm},""),children:[e&&(0,c.FD)("div",{role:"button",css:(0,p.AH)({display:"flex",justifyContent:"space-between",alignItems:"center",padding:`${s.spacing.sm}px ${s.spacing.sm+s.spacing.xs}px`,...m},""),onClick:()=>a(!r),children:[(0,c.Y)(l.T.Title,{level:4,color:"secondary",withoutMargins:!0,children:e}),i&&(r?(0,c.Y)(o.ChevronDownIcon,{}):(0,c.Y)(l.o,{}))]}),(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:s.spacing.sm,paddingLeft:s.spacing.sm+s.spacing.xs,paddingRight:s.spacing.sm+s.spacing.xs,paddingTop:e?0:s.spacing.sm,paddingBottom:s.spacing.sm,"& > div:last-of-type":{marginBottom:0}},""),children:[(0,c.Y)(v.V,{children:u}),i&&(0,c.Y)(l.T.Link,{onClick:()=>a(!r),componentId:"shared.model-trace-explorer.text-field-see-more-link",children:r?(0,c.Y)(d.sA,{id:"Y5Rr5k",defaultMessage:"See less"}):(0,c.Y)(d.sA,{id:"Hyv8Go",defaultMessage:"See more"})})]})]})},fe=({title:e,searchFilter:t,isActiveMatch:s})=>{const{theme:r}=(0,l.u)(),a=(0,n.useCallback)((e=>{null===e||void 0===e||e.scrollIntoView({block:"nearest",inline:"nearest"})}),[]),i=e.toLowerCase();if(!i.includes(t))return(0,c.Y)("div",{children:e});const o=i.indexOf(t),d=o+t.length,u=s?r.colors[g.kj]:r.colors[g.Bt];return(0,c.FD)("div",{children:[e.slice(0,o),(0,c.Y)("span",{ref:s?a:null,css:(0,p.AH)({backgroundColor:u,scrollMarginTop:50},""),children:e.slice(o,d)}),e.slice(d)]})};function ve(e,t){return t||(e?m.cC.MARKDOWN:m.cC.JSON)}function xe(e){switch(e){case m.cC.JSON:return"JSON";case m.cC.TEXT:return"Text";case m.cC.MARKDOWN:return"Markdown";case m.cC.PYTHON:return"Python"}}var ye={name:"bjn8wh",styles:"position:relative"},be={name:"1boj65s",styles:"max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Ye={name:"fhxb3m",styles:"display:flex;flex-direction:row;align-items:center"},we={name:"2fp7nl",styles:"height:min-content;margin:0"};function Ae({title:e,tokens:t,data:s,searchFilter:r="",activeMatch:a=null,containsActiveMatch:i=!1,initialRenderMode:d}){var u;const g=(0,n.useMemo)((()=>JSON.parse(s)),[s]),f=(0,h.isString)(g),{theme:v}=(0,l.u)(),[x,y]=(0,n.useState)(ve(f,d)),b=i&&null!==(u=null===a||void 0===a?void 0:a.isKeyMatch)&&void 0!==u&&u,w=f&&!r;return(0,n.useEffect)((()=>{y(ve(f,d))}),[f,d]),(0,c.Y)("div",{css:ye,children:(0,c.FD)("div",{css:(0,p.AH)({borderRadius:v.borders.borderRadiusSm,border:`1px solid ${v.colors.border}`,overflow:"hidden"},""),children:[(e||w)&&(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",padding:v.spacing.sm},""),children:[(0,c.Y)(l.T.Title,{css:be,level:4,color:"secondary",withoutMargins:!0,children:(0,c.Y)(fe,{title:e,searchFilter:r,isActiveMatch:b})}),(0,c.Y)("div",{css:Ye,children:w&&(0,c.FD)(o.DropdownMenu.Root,{children:[(0,c.Y)(o.DropdownMenu.Trigger,{asChild:!0,children:(0,c.Y)(o.Tag,{componentId:"shared.model-trace-explorer.snippet-render-mode-tag",css:we,children:(0,c.FD)("div",{css:(0,p.AH)({paddingLeft:v.spacing.xs,marginRight:v.spacing.xs,cursor:"pointer"},""),children:[(0,c.Y)(l.T.Text,{size:"sm",color:"secondary",children:xe(x)}),(0,c.Y)(o.ChevronDownIcon,{})]})})}),(0,c.FD)(o.DropdownMenu.Content,{children:[(0,c.Y)(o.DropdownMenu.RadioGroup,{componentId:"shared.model-trace-explorer.snippet-render-mode-radio",value:x,onValueChange:e=>y(e),children:Object.values(m.cC).map((e=>e===m.cC.PYTHON?null:(0,c.FD)(o.DropdownMenu.RadioItem,{value:e,children:[(0,c.Y)(o.DropdownMenu.ItemIndicator,{}),xe(e)]},e)))}),(0,c.Y)(o.DropdownMenu.Arrow,{})]})]})})]}),(0,c.Y)(Y,{data:s,searchFilter:r,activeMatch:a,containsActiveMatch:i,renderMode:x})]})})}var Te=s(51847);const Se=e=>{switch(e){case"system":return(0,c.Y)(Te.P,{type:m.Dy.SYSTEM});case"user":return(0,c.Y)(Te.P,{type:m.Dy.USER});case"tool":case"function":return(0,c.Y)(Te.P,{type:m.Dy.WRENCH});default:return(0,c.Y)(Te.P,{type:m.Dy.MODELS})}},Me=e=>{switch(e.role){case"system":return(0,c.Y)(d.sA,{id:"+gqcru",defaultMessage:"System"});case"user":return(0,c.Y)(d.sA,{id:"t+aG6y",defaultMessage:"User"});case"assistant":return(0,c.Y)(d.sA,{id:"Hvznjh",defaultMessage:"Assistant"});case"tool":return e.name?e.name:(0,c.Y)(d.sA,{id:"dPn3az",defaultMessage:"Tool"});case"function":return(0,c.Y)(d.sA,{id:"5ZUAC2",defaultMessage:"Function"});default:return e.role}};var Ie={name:"7dymr5",styles:"white-space:nowrap;display:inline-flex;align-items:center;flex:1;min-width:0"},ke={name:"12wal98",styles:"text-overflow:ellipsis;overflow:hidden;white-space:nowrap"};const De=({isExpandable:e,expanded:t,setExpanded:s,message:n})=>{const{theme:r}=(0,l.u)(),a=e?{":hover":{backgroundColor:r.colors.actionIconBackgroundHover,cursor:"pointer"}}:{};return(0,c.FD)("div",{role:"button",css:(0,p.AH)({display:"flex",flexDirection:"row",alignItems:"center",padding:r.spacing.sm,gap:r.spacing.sm,...a},""),onClick:()=>s(!t),children:[e&&(t?(0,c.Y)(o.ChevronDownIcon,{}):(0,c.Y)(l.o,{})),Se(n.role),n.tool_call_id?(0,c.Y)(l.T.Text,{color:"secondary",css:Ie,children:(0,c.Y)(d.sA,{id:"mWl3Qv",defaultMessage:"{toolName} was called in {toolCallId}",values:{toolName:(0,c.Y)(l.T.Text,{css:(0,p.AH)({marginRight:r.spacing.xs},""),bold:!0,children:Me(n)}),toolCallId:(0,c.Y)(C.T,{componentId:"shared.model-trace-explorer.tool-call-id-tooltip",content:n.tool_call_id,children:(0,c.Y)("div",{css:(0,p.AH)({display:"inline-flex",flexShrink:1,overflow:"hidden",marginLeft:r.spacing.xs},""),children:(0,c.Y)(l.T.Text,{css:ke,code:!0,children:n.tool_call_id})})})}})}):(0,c.Y)(l.T.Text,{bold:!0,children:Me(n)})]})};var Ce=s(65854);var Ee={name:"12wal98",styles:"text-overflow:ellipsis;overflow:hidden;white-space:nowrap"};function Ne({toolCall:e}){const{theme:t}=(0,l.u)();return(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:[(0,c.Y)(l.T.Text,{color:"secondary",css:(0,p.AH)({display:"flex",flexDirection:"row",alignItems:"center",padding:`0px ${t.spacing.sm+t.spacing.xs}px`},""),children:(0,c.Y)(d.sA,{id:"hV4vVj",defaultMessage:"called {functionName} in {toolCallId}",values:{functionName:(0,c.FD)(o.Tag,{color:"purple",componentId:"shared.model-trace-explorer.function-name-tag",css:(0,p.AH)({margin:`0px ${t.spacing.xs}px`},""),children:[(0,c.Y)(o.FunctionIcon,{}),(0,c.Y)(l.T.Text,{css:(0,p.AH)({whiteSpace:"nowrap",marginLeft:t.spacing.xs},""),children:e.function.name})]}),toolCallId:(0,c.Y)(C.T,{componentId:"shared.model-trace-explorer.tool-call-id-tooltip",content:e.id,children:(0,c.Y)("div",{css:(0,p.AH)({display:"inline-flex",flexShrink:1,overflow:"hidden",marginLeft:t.spacing.xs},""),children:(0,c.Y)(l.T.Text,{css:Ee,code:!0,color:"secondary",children:e.id})})})}})}),(0,c.Y)(Y,{data:e.function.arguments})]},e.id)}function Fe({content:e,shouldDisplayCodeSnippet:t}){const{theme:s}=(0,l.u)();return e?t?(0,c.Y)(Y,{data:e,searchFilter:"",activeMatch:null,containsActiveMatch:!1,renderMode:m.cC.JSON}):(0,c.Y)("div",{css:(0,p.AH)({padding:s.spacing.sm,paddingTop:0,marginBottom:-s.typography.fontSizeBase},""),children:(0,c.Y)(v.V,{children:e})}):null}function Re({message:e,className:t}){var s;const{theme:r}=(0,l.u)(),[a,i]=(0,n.useState)(!1),{content:u,isJson:m}=(e=>{try{return{content:JSON.stringify(JSON.parse(e),null,2),isJson:!0}}catch(t){return{content:e,isJson:!1}}})(null!==(s=e.content)&&void 0!==s?s:""),g=m&&("tool"===e.role||"function"===e.role),f=!g&&u.length>Ce.w,v=f&&!a?`${u.slice(0,Ce.w)}...`:u;return(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",width:"100%",borderRadius:r.borders.borderRadiusSm,border:`1px solid ${r.colors.border}`,backgroundColor:r.colors.backgroundPrimary,overflow:"hidden"},""),className:t,children:[(0,c.Y)(De,{isExpandable:f,expanded:a,setExpanded:i,message:e}),(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:r.spacing.sm},""),children:[!(0,h.isNil)(e.tool_calls)&&e.tool_calls.map((e=>(0,c.Y)(Ne,{toolCall:e},e.id))),(0,c.Y)(Fe,{content:v,shouldDisplayCodeSnippet:g})]}),f&&(0,c.Y)(l.B,{componentId:a?"shared.model-trace-explorer.chat-message-see-less":"shared.model-trace-explorer.chat-message-see-more",icon:a?(0,c.Y)(o.ChevronUpIcon,{}):(0,c.Y)(o.ChevronDownIcon,{}),type:"tertiary",onClick:()=>i(!a),css:(0,p.AH)({display:"flex",width:"100%",padding:r.spacing.md,borderRadius:"0px !important"},""),children:a?(0,c.Y)(d.sA,{id:"gTEFCD",defaultMessage:"See less"}):(0,c.Y)(d.sA,{id:"6fP+8o",defaultMessage:"See more"})})]})}function He({messages:e}){const{theme:t}=(0,l.u)();return(0,h.isNil)(e)?null:(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:e.map(((e,t)=>(0,c.Y)(Re,{message:e},t)))})}const Le=({title:e,data:t,renderMode:s,chatMessageFormat:r,maxVisibleMessages:a=3})=>{const{theme:o}=(0,l.u)(),[u,g]=(0,n.useState)(!1),f=(0,n.useMemo)((()=>{try{return JSON.parse(t)}catch(e){return t}}),[t]);(0,n.useEffect)((()=>{g(!1)}),[t]);const v=(0,h.isString)(f)||(0,h.isNumber)(f)||(0,h.isBoolean)(f),x=(0,i.Hq)(e?{[e]:f}:f,r),y=Array.isArray(f)&&f.length>0&&(0,h.every)(f,i.PC),b=Array.isArray(f)&&f.length>0&&(0,h.every)(f,i.W0);if(x&&x.length>0){const t=x.length>a,s=u||!t?x:x.slice(-a),n=t?x.length-s.length:0;return(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:o.spacing.sm,padding:o.spacing.sm,border:`1px solid ${o.colors.border}`,borderRadius:o.borders.borderRadiusSm},""),children:[e&&(0,c.Y)(l.T.Title,{level:4,color:"secondary",withoutMargins:!0,css:(0,p.AH)({marginLeft:o.spacing.xs},""),children:e}),t&&(0,c.Y)(l.T.Link,{css:(0,p.AH)({alignSelf:"flex-start",marginLeft:o.spacing.xs},""),componentId:"shared.model-trace-explorer.conversation-toggle",onClick:()=>g(!u),children:u?(0,c.Y)(d.sA,{id:"nugZSE",defaultMessage:"Show less"}):(0,c.Y)(d.sA,{id:"/akgwX",defaultMessage:"Show {hiddenMessageCount} more",values:{hiddenMessageCount:n}})}),(0,c.Y)(He,{messages:s})]})}return"json"===s?(0,c.Y)(Ae,{title:e,data:t,initialRenderMode:m.cC.JSON}):"text"===s?(0,c.Y)(Ae,{title:e,data:t,initialRenderMode:m.cC.TEXT}):v?(0,c.Y)(ge,{title:e,value:String(f)}):y?(0,c.Y)(ae,{title:e,tools:f}):b?(0,c.Y)(he,{title:e,documents:f}):(0,c.Y)(Ae,{title:e,data:t})},_e=({node:e})=>{var t;const{theme:s}=(0,l.u)(),n=(0,i.bn)(e),r=!e.parentId,a=n[0];return a?(0,c.Y)(se,{css:(0,p.AH)({marginBottom:r?s.spacing.sm:0},""),withBorder:r,sectionKey:a.name,title:(0,c.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",gap:s.spacing.sm},""),children:[(0,c.Y)(o.XCircleIcon,{color:"danger"}),(0,c.Y)(l.T.Text,{color:"error",bold:!0,children:"Exception"})]}),children:(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:s.spacing.sm,paddingBottom:s.spacing.sm,paddingLeft:r?0:s.spacing.lg},""),children:Object.entries(null!==(t=a.attributes)&&void 0!==t?t:{}).map((([e,t])=>(0,c.Y)(Le,{title:e,data:JSON.stringify(t,null,2),renderMode:"text"},e)))})},a.name):null},Oe=({node:e})=>{var t;const{theme:s}=(0,l.u)(),{setSelectedNode:n,setActiveView:r,setShowTimelineTreeGantt:a}=I(),o=(0,i.N7)(e)>0;return(0,c.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",marginRight:s.spacing.xs,gap:s.spacing.xs,"&:hover":{textDecoration:"underline",textDecorationColor:o?s.colors.actionDangerDefaultTextDefault:s.colors.actionDefaultTextDefault,cursor:"pointer"}},""),onClick:()=>{n(e),r("detail"),a(!1)},children:[(0,c.Y)(Te.P,{hasException:o,type:(0,i.tC)(null!==(t=e.type)&&void 0!==t?t:m.UG.UNKNOWN)}),(0,c.Y)(l.T.Text,{color:o?"error":"primary",css:(0,p.AH)({marginLeft:s.spacing.xs,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},""),children:e.title})]})};var Be={name:"s6cpzs",styles:"display:flex;flex-direction:column;flex:1;min-width:0"},ze={name:"bcffy2",styles:"display:flex;align-items:center;justify-content:space-between"},$e={name:"1cgftv8",styles:"&:hover{text-decoration:underline;cursor:pointer;}"};const je=({node:e,renderMode:t})=>{const{theme:s}=(0,l.u)(),[r,a]=(0,n.useState)(!1),u=(0,n.useMemo)((()=>(0,i.g_)(e.inputs)),[e]),m=(0,n.useMemo)((()=>(0,i.g_)(e.outputs)),[e]),h=(0,i.bn)(e),g=e.chatMessageFormat,f=h.length>0,v=u.length>0,x=m.length>0,{setSelectedNode:y,setActiveView:b,setShowTimelineTreeGantt:Y}=I();return(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",minHeight:48,flexShrink:0},""),children:[(0,c.Y)("div",{css:(0,p.AH)({height:48,display:"flex",alignItems:"center"},""),children:(0,c.Y)(l.B,{size:"small","data-testid":`toggle-span-expanded-${e.key}`,css:(0,p.AH)({flexShrink:0,marginRight:s.spacing.xs},""),icon:r?(0,c.Y)(o.ChevronDownIcon,{}):(0,c.Y)(l.o,{}),onClick:()=>a(!r),componentId:"shared.model-trace-explorer.toggle-span"})}),(0,c.Y)("div",{css:(0,p.AH)({position:"relative",boxSizing:"border-box",height:48,borderLeft:`2px solid ${s.colors.border}`,width:12},""),children:(0,c.Y)("div",{css:(0,p.AH)({position:"absolute",left:-2,top:14,height:12,width:12,boxSizing:"border-box",borderBottomLeftRadius:s.borders.borderRadiusMd,borderBottom:`2px solid ${s.colors.border}`,borderLeft:`2px solid ${s.colors.border}`},"")})}),(0,c.FD)("div",{css:Be,children:[(0,c.FD)("div",{css:ze,children:[(0,c.Y)(l.T.Text,{color:"secondary",css:(0,p.AH)({display:"inline-flex",alignItems:"center",height:48},""),children:(0,c.Y)(d.sA,{id:"SbMdmm",defaultMessage:"{spanName} was called",values:{spanName:(0,c.Y)(Oe,{node:e})}})}),(0,c.Y)("span",{onClick:()=>{y(e),b("detail"),Y(!0)},children:(0,c.Y)(l.T.Text,{css:$e,color:"secondary",children:(0,S.X6)(e.end-e.start)})})]}),r&&(0,c.FD)("div",{children:[f&&(0,c.Y)(_e,{node:e}),v&&(0,c.Y)(se,{sectionKey:"input",title:(0,c.Y)(d.sA,{id:"/TX1Az",defaultMessage:"Inputs"}),children:(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:s.spacing.sm,paddingLeft:s.spacing.lg,marginBottom:s.spacing.sm},""),children:u.map((({key:e,value:s},n)=>(0,c.Y)(Le,{title:e,data:s,renderMode:t,chatMessageFormat:g},e||n)))})}),x&&(0,c.Y)(se,{sectionKey:"output",title:(0,c.Y)(d.sA,{id:"ZstVNI",defaultMessage:"Outputs"}),children:(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:s.spacing.sm,paddingLeft:s.spacing.lg,marginBottom:s.spacing.sm},""),children:m.map((({key:e,value:s})=>(0,c.Y)(Le,{title:e,data:s,renderMode:t,chatMessageFormat:g},e)))})})]})]})]})},Ve=({title:e,data:t,renderMode:s,sectionKey:r,maxVisibleItems:a=3,maxVisibleChatMessages:i=3,className:o,chatMessageFormat:d})=>{const{theme:u}=(0,l.u)(),[m,h]=(0,n.useState)(!1),g=t.length>a,f=g&&!m?t.slice(-a):t,v=g?t.length-f.length:0;return(0,c.Y)(se,{withBorder:!0,title:e,className:o,sectionKey:r,children:(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:u.spacing.sm},""),children:[g&&(0,c.Y)(l.T.Link,{css:(0,p.AH)({alignSelf:"flex-start",marginLeft:u.spacing.xs},""),componentId:"shared.model-trace-explorer.conversation-toggle",onClick:()=>h(!m),children:m?"Show less":`Show ${v} more`}),f.map((({key:e,value:t},n)=>(0,c.Y)(Le,{title:e,data:t,renderMode:s,chatMessageFormat:d,maxVisibleMessages:i},e||n)))]})})};var Pe={name:"4zleql",styles:"display:block"},Ue={name:"oit39a",styles:"& > span{display:flex;align-items:center;}"};const Ke=()=>{const{assessmentsPaneExpanded:e,setAssessmentsPaneExpanded:t,assessmentsPaneEnabled:s,isInComparisonView:n}=I();return n?null:(0,c.Y)(o.SegmentedControlGroup,{css:Pe,name:"shared.model-trace-explorer.assessments-pane-toggle",componentId:"shared.model-trace-explorer.assessments-pane-toggle",value:e,size:"small",children:(0,c.Y)(o.SegmentedControlButton,{value:!0,disabled:!s,icon:(0,c.Y)(o.GavelIcon,{}),onClick:()=>null===t||void 0===t?void 0:t(!e),css:Ue,children:!e&&(0,c.Y)(d.sA,{id:"r/fxMt",defaultMessage:"Assessments"})})})},We=({rootNode:e,intermediateNodes:t,hideRenderModeSelector:s=!1})=>{const{theme:r}=(0,l.u)(),[a,u]=(0,n.useState)("default"),m=e.inputs,h=e.outputs,g=e.chatMessageFormat,f=(0,i.bn)(e),v=t.length>0,x=f.length>0,y=(0,i.g_)(m).filter((({value:e})=>"null"!==e)),b=(0,i.g_)(h).filter((({value:e})=>"null"!==e));return(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",flex:1,minHeight:0,padding:r.spacing.md,paddingTop:r.spacing.sm,overflow:"auto",minWidth:400},""),children:[!s&&(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",justifyContent:"flex-end",marginBottom:r.spacing.sm},""),children:(0,c.FD)("div",{css:(0,p.AH)({display:"flex",gap:r.spacing.sm},""),children:[(0,c.FD)(o.SegmentedControlGroup,{name:"render-mode",componentId:"shared.model-trace-explorer.summary-view.render-mode",value:a,size:"small",onChange:e=>u(e.target.value),children:[(0,c.Y)(o.SegmentedControlButton,{value:"default",children:(0,c.Y)(d.sA,{id:"uYkbr+",defaultMessage:"Default"})}),(0,c.Y)(o.SegmentedControlButton,{value:"json",children:(0,c.Y)(d.sA,{id:"XC1Pro",defaultMessage:"JSON"})})]}),(0,c.Y)(Ke,{})]})}),x&&(0,c.Y)(_e,{node:e}),(0,c.Y)(Ve,{title:(0,c.Y)(d.sA,{id:"/TX1Az",defaultMessage:"Inputs"}),css:(0,p.AH)({marginBottom:v?0:r.spacing.md},""),sectionKey:"summary-inputs",data:y,renderMode:a,chatMessageFormat:g}),v&&t.map((e=>(0,c.Y)(je,{node:e,renderMode:a},e.key))),(0,c.Y)(Ve,{title:(0,c.Y)(d.sA,{id:"ZstVNI",defaultMessage:"Outputs"}),sectionKey:"summary-outputs",data:b,renderMode:a,chatMessageFormat:null!==g&&void 0!==g?g:"openai"})]})};var Ge=s(25637),qe=s(49633);var Je={name:"1h0bf8r",styles:"body, :host{user-select:none;}"},Xe={name:"1gtrael",styles:"display:flex;flex:1;overflow:hidden;flex-direction:row"},Qe={name:"kjqqaz",styles:"width:0;position:relative"};var Ze=(0,n.forwardRef)((({initialRatio:e,paneWidth:t,setPaneWidth:s,leftChild:r,leftMinWidth:a,rightChild:i,rightMinWidth:o},d)=>{var u;const[m,g]=(0,n.useState)(!1),f=(0,n.useRef)(null),v=null===(u=(0,qe.wY)({ref:f}))||void 0===u?void 0:u.width,x=(null!==v&&void 0!==v?v:1/0)-o,y=(0,n.useRef)(e),{theme:b}=(0,l.u)(),Y=(0,n.useCallback)((e=>{v&&(y.current=e/v)}),[v]),w=(0,n.useCallback)((()=>v),[v]);return(0,n.useImperativeHandle)(d,(()=>({updateRatio:Y,getContainerWidth:w}))),(0,n.useLayoutEffect)((()=>{v&&s((0,h.clamp)(v*y.current,a,x))}),[v,x,a,o,s]),(0,c.FD)("div",{ref:f,css:Xe,children:[m&&(0,c.Y)(p.mL,{styles:Je}),(0,c.Y)(Ge.ResizableBox,{axis:"x",width:t,css:(0,p.AH)({display:"flex",flex:`0 0 ${t}px`},""),handle:(0,c.Y)("div",{css:Qe,children:(0,c.Y)("div",{css:(0,p.AH)({position:"relative",width:b.spacing.sm,marginLeft:-b.spacing.xs,minHeight:"100%",cursor:"ew-resize",backgroundColor:"rgba(0,0,0,0)",zIndex:1,":hover":{backgroundColor:"rgba(0,0,0,0.1)"}},"")})}),onResize:(e,{size:t})=>{const n=(0,h.clamp)(t.width,a,x);s(n),v&&(y.current=n/v)},onResizeStart:()=>g(!0),onResizeStop:()=>g(!1),minConstraints:[a,1/0],maxConstraints:[x,1/0],children:r}),i]})})),et=s(44666);const tt=(0,n.createContext)({schemas:[]}),st=()=>(0,n.useContext)(tt),nt=({name:e,setName:t,nameError:s,setNameError:r,handleChangeSchema:a})=>{const{schemas:i}=st(),l=(0,d.tz)(),u=i.map((e=>{var t;return null!==(t=e.name)&&void 0!==t?t:""})),[p,m]=(0,n.useState)(null),[h,g]=(0,n.useState)(i),f=(0,n.useMemo)((()=>{const t=[...h];if(e&&!u.includes(e)){const s=(e=>({name:e,assessmentType:"feedback",dataType:"boolean"}))(e);t.unshift(s)}return t}),[e,h,u]),v=(0,n.useCallback)((e=>{m(e),a(e),r(null)}),[a,r]),x=(0,o.useComboboxState)({componentId:"shared.model-trace-explorer.assessment-name-typeahead",allItems:i,items:f,setItems:g,multiSelect:!1,setInputValue:e=>{t(e),r(null)},itemToString:e=>{var t;return null!==(t=null===e||void 0===e?void 0:e.name)&&void 0!==t?t:""},matcher:(e,t)=>{var s,n;return null!==(s=null===e||void 0===e||null===(n=e.name)||void 0===n?void 0:n.toLowerCase().includes(t.toLowerCase()))&&void 0!==s&&s},formValue:p,formOnChange:v,preventUnsetOnBlur:!0});return(0,c.FD)(o.TypeaheadComboboxRoot,{onKeyDown:e=>{"ArrowLeft"!==e.key&&"ArrowRight"!==e.key||e.stopPropagation()},id:"shared.model-trace-explorer.assessment-name-typeahead",comboboxState:x,children:[(0,c.Y)(o.TypeaheadComboboxInput,{"data-testid":"assessment-name-typeahead-input",placeholder:l.formatMessage({id:"gN67TK",defaultMessage:"Enter an assessment name"}),validationState:s?"error":void 0,comboboxState:x,formOnChange:v,onPressEnter:()=>{f.length>0&&v(f[0])},allowClear:!0,showComboboxToggleButton:!0}),s&&(0,c.Y)(o.FormUI.Message,{type:"error",message:s}),(0,c.Y)(o.TypeaheadComboboxMenu,{comboboxState:x,children:f.map(((e,t)=>{var s,n,r;return(0,c.Y)(o.TypeaheadComboboxMenuItem,{"data-testid":`assessment-name-typeahead-item-${null!==(s=null===e||void 0===e?void 0:e.name)&&void 0!==s?s:""}`,item:e,index:t,comboboxState:x,children:null!==(r=null===e||void 0===e?void 0:e.name)&&void 0!==r?r:""},`assessment-name-typeahead-${null!==(n=null===e||void 0===e?void 0:e.name)&&void 0!==n?n:""}`)}))})]})},rt=250,at=(e,t=new Date)=>{const s=Math.max(0,Math.floor((t.getTime()-e)/1e3));let n=Math.floor(s/31536e3);return n>=1?(0,c.Y)(d.sA,{id:"16BvfJ",defaultMessage:"{timeSince, plural, =1 {1 year} other {# years}} ago",values:{timeSince:n}}):(n=Math.floor(s/2592e3),n>=1?(0,c.Y)(d.sA,{id:"5ZAXeS",defaultMessage:"{timeSince, plural, =1 {1 month} other {# months}} ago",values:{timeSince:n}}):(n=Math.floor(s/86400),n>=1?(0,c.Y)(d.sA,{id:"tLb7+M",defaultMessage:"{timeSince, plural, =1 {1 day} other {# days}} ago",values:{timeSince:n}}):(n=Math.floor(s/3600),n>=1?(0,c.Y)(d.sA,{id:"aOW396",defaultMessage:"{timeSince, plural, =1 {1 hour} other {# hours}} ago",values:{timeSince:n}}):(n=Math.floor(s/60),n>=1?(0,c.Y)(d.sA,{id:"7jsqqe",defaultMessage:"{timeSince, plural, =1 {1 minute} other {# minutes}} ago",values:{timeSince:n}}):(0,c.Y)(d.sA,{id:"93iLUV",defaultMessage:"{timeSince, plural, =1 {1 second} other {# seconds}} ago",values:{timeSince:s}})))))},it=({formValue:e,dataType:t,isFeedback:s})=>s?{feedback:{value:e}}:"json"===t?{expectation:{serialized_value:{value:String(e),serialization_format:"JSON_FORMAT"}}}:{expectation:{value:e}};var ot=s(52033),lt=s(72143),dt=s(89634),ct=s(27094),ut=s(39595),pt=s(61060),mt=s(59542);const ht={json:lt.f,string:ct.k,boolean:ot.B,number:dt.O},gt=(0,n.forwardRef)((({assessmentName:e,spanId:t,traceId:s,setExpanded:r},u)=>{var m;const{theme:g}=(0,l.u)(),{schemas:f}=st(),[v,x]=(0,n.useState)(""),[y,b]=(0,n.useState)("feedback"),[Y,w]=(0,n.useState)("boolean"),[A,T]=(0,n.useState)(!0),[S,M]=(0,n.useState)(""),[I,k]=(0,n.useState)(null),[C,E]=(0,n.useState)(null),N=!(0,h.isNil)(e),F=null!==(m=ht[Y])&&void 0!==m?m:ht.string,{createAssessmentMutation:R,isLoading:H}=(({traceId:e,onSuccess:t,onError:s,onSettled:n})=>{const r=(0,d.tz)(),o=(0,ut.jE)(),l=ee((e=>e.logAddedAssessment)),c=(0,Z.M)(),{mutate:u,isLoading:p}=(0,pt.n)({mutationFn:e=>(0,a.F9)()&&null!==c&&void 0!==c&&c.modelTraceInfo&&(0,i.gD)(c.modelTraceInfo)&&(0,i.ko)(null===c||void 0===c?void 0:c.modelTraceInfo)?Q._A.createAssessmentV4({payload:e,traceLocation:c.modelTraceInfo.trace_location}):(0,Q.bU)({payload:e}),onSuccess:s=>{var n;if((0,a.F9)()&&(0,h.isObject)(s)){const t="assessment"in s?s.assessment:s;l(e,t)}null===(n=c.invalidateTraceQuery)||void 0===n||n.call(c,e),o.invalidateQueries({queryKey:[i.BS,e]}),(0,mt.B)({queryClient:o}),null===t||void 0===t||t()},onError:e=>{(0,i.ij)(r.formatMessage({id:"L3szkg",defaultMessage:"Failed to create assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)})),null===s||void 0===s||s(e)},onSettled:()=>{null===n||void 0===n||n()}});return{createAssessmentMutation:u,isLoading:p}})({traceId:s,onSettled:()=>{r(!1)}}),L=(0,n.useCallback)((async()=>{var n;if("json"===Y)try{JSON.parse(A)}catch(i){return void E((0,c.Y)(d.sA,{id:"VXduJD",defaultMessage:"The provided value is not valid JSON"}))}if(!N&&""===v)return void k((0,c.Y)(d.sA,{id:"WHf+VX",defaultMessage:"Please enter a name"}));const r=it({formValue:A,dataType:Y,isFeedback:"feedback"===y}),a={assessment:{assessment_name:N?e:v,trace_id:s,source:{source_type:"HUMAN",source_id:null!==(n=(0,et.w)())&&void 0!==n?n:""},span_id:t,rationale:S,...r}};R(a)}),[Y,A,y,N,e,v,s,t,S,R]),_=(0,n.useCallback)((e=>{if(!e)return x(""),b("feedback"),w("boolean"),T(!0),M(""),void E(null);if(f.some((t=>t.name===e.name)))switch(x(e.name),b(e.assessmentType),w(e.dataType),e.dataType){case"string":case"json":T("");break;case"number":T(0);break;case"boolean":T(!0)}else x(e.name)}),[f]);return(0,c.FD)("div",{ref:u,css:(0,p.AH)({display:"flex",flexDirection:"column",gap:g.spacing.xs,marginTop:g.spacing.sm,border:`1px solid ${g.colors.border}`,padding:g.spacing.sm,borderRadius:g.borders.borderRadiusSm},""),children:[(0,c.Y)(l.T.Text,{size:"sm",color:"secondary",children:(0,c.Y)(d.sA,{id:"+SBxBK",defaultMessage:"Assessment Type"})}),(0,c.FD)(o.SimpleSelect,{id:"shared.model-trace-explorer.assessment-type-select",componentId:"shared.model-trace-explorer.assessment-type-select",label:"Assessment Type",value:y,disabled:H,onChange:e=>{b(e.target.value),"feedback"===e.target.value&&"json"===Y&&w("string")},children:[(0,c.Y)(o.SimpleSelectOption,{value:"feedback",children:(0,c.Y)(d.sA,{id:"0AOcOr",defaultMessage:"Feedback"})}),(0,c.Y)(o.SimpleSelectOption,{value:"expectation",children:(0,c.Y)(d.sA,{id:"tEaqGu",defaultMessage:"Expectation"})})]}),(0,c.Y)(l.T.Text,{css:(0,p.AH)({marginTop:g.spacing.xs},""),size:"sm",color:"secondary",children:(0,c.Y)(d.sA,{id:"AdlJNW",defaultMessage:"Assessment Name"})}),N?(0,c.Y)(l.T.Text,{children:e}):(0,c.Y)(nt,{name:v,setName:x,handleChangeSchema:_,nameError:I,setNameError:k}),(0,c.Y)(l.T.Text,{css:(0,p.AH)({marginTop:g.spacing.xs},""),size:"sm",color:"secondary",children:(0,c.Y)(d.sA,{id:"q8rYCQ",defaultMessage:"Data Type"})}),(0,c.FD)(o.SimpleSelect,{id:"shared.model-trace-explorer.assessment-data-type-select",componentId:"shared.model-trace-explorer.assessment-data-type-select",label:"Data Type",value:Y,disabled:H,onChange:e=>{w(e.target.value),E(null)},children:["expectation"===y&&(0,c.Y)(o.SimpleSelectOption,{value:"json",children:(0,c.Y)(d.sA,{id:"GKVTw4",defaultMessage:"JSON"})}),(0,c.Y)(o.SimpleSelectOption,{value:"string",children:(0,c.Y)(d.sA,{id:"cBSSLp",defaultMessage:"String"})}),(0,c.Y)(o.SimpleSelectOption,{value:"boolean",children:(0,c.Y)(d.sA,{id:"k0l8lF",defaultMessage:"Boolean"})}),(0,c.Y)(o.SimpleSelectOption,{value:"number",children:(0,c.Y)(d.sA,{id:"C9ccNu",defaultMessage:"Number"})})]}),(0,c.Y)(l.T.Text,{css:(0,p.AH)({marginTop:g.spacing.xs},""),size:"sm",color:"secondary",children:(0,c.Y)(d.sA,{id:"ms+6Z2",defaultMessage:"Value"})}),(0,c.Y)(F,{value:A,valueError:C,setValue:T,setValueError:E,isSubmitting:H}),(0,c.Y)(l.T.Text,{css:(0,p.AH)({marginTop:g.spacing.xs},""),size:"sm",color:"secondary",children:(0,c.Y)(d.sA,{id:"wDMTm8",defaultMessage:"Rationale"})}),(0,c.Y)(D.I.TextArea,{componentId:"shared.model-trace-explorer.assessment-rationale-input",value:S,autoSize:{minRows:1,maxRows:5},disabled:H,onKeyDown:e=>e.stopPropagation(),onChange:e=>M(e.target.value)}),(0,c.FD)("div",{css:(0,p.AH)({display:"flex",justifyContent:"flex-end",marginTop:g.spacing.xs},""),children:[(0,c.Y)(l.B,{componentId:"shared.model-trace-explorer.assessment-create-button",disabled:H,onClick:()=>r(!1),children:(0,c.Y)(d.sA,{id:"+33ShX",defaultMessage:"Cancel"})}),(0,c.Y)(l.B,{css:(0,p.AH)({marginLeft:g.spacing.sm},""),type:"primary",componentId:"shared.model-trace-explorer.assessment-create-button",onClick:L,loading:H,children:(0,c.Y)(d.sA,{id:"Me7xpG",defaultMessage:"Create"})})]})]})})),ft=({title:e,assessmentName:t,spanId:s,traceId:r})=>{const[a,i]=(0,n.useState)(!1),d=(0,n.useRef)(null);return(0,n.useEffect)((()=>{a&&d.current&&d.current.scrollIntoView({behavior:"smooth",block:"start"})}),[a]),(0,c.FD)("div",{children:[(0,c.Y)(l.B,{size:"small",componentId:"shared.model-trace-explorer.add-new-assessment",icon:(0,c.Y)(o.PlusIcon,{}),onClick:()=>i(!0),children:e}),a&&(0,c.Y)(gt,{ref:d,assessmentName:t,spanId:s,traceId:r,setExpanded:i})]})},vt=({assessment:e,setIsEditing:t,setShowDeleteModal:s})=>{var n;const r="feedback"in e,a=((null!==(n=(0,et.w)())&&void 0!==n?n:"")===e.source.source_id||r&&"HUMAN"!==e.source.source_type)&&t;return(0,c.FD)(o.DropdownMenu.Root,{children:[(0,c.Y)(o.DropdownMenu.Trigger,{asChild:!0,children:(0,c.Y)(l.B,{componentId:"shared.model-trace-explorer.assessment-more-button",icon:(0,c.Y)(o.OverflowIcon,{}),size:"small"})}),(0,c.FD)(o.DropdownMenu.Content,{minWidth:100,children:[a&&(0,c.FD)(o.DropdownMenu.Item,{componentId:"shared.model-trace-explorer.assessment-edit-button",onClick:()=>null===t||void 0===t?void 0:t(!0),children:[(0,c.Y)(o.DropdownMenu.IconWrapper,{children:(0,c.Y)(o.PencilIcon,{})}),(0,c.Y)(d.sA,{id:"UQhorr",defaultMessage:"Edit"})]}),(0,c.FD)(o.DropdownMenu.Item,{componentId:"shared.model-trace-explorer.assessment-delete-button",onClick:()=>s(!0),children:[(0,c.Y)(o.DropdownMenu.IconWrapper,{children:(0,c.Y)(o.TrashIcon,{})}),(0,c.Y)(d.sA,{id:"aZV8M7",defaultMessage:"Delete"})]})]})]})},xt=({assessment:e,isModalVisible:t,setIsModalVisible:s})=>{const{deleteAssessmentMutation:r,isLoading:o}=(({assessment:e,onSuccess:t,onError:s,onSettled:n,skip:r})=>{const o=(0,d.tz)(),l=(0,ut.jE)(),c=null===e||void 0===e?void 0:e.trace_id,u=null===e||void 0===e?void 0:e.assessment_id,p=ee((e=>e.logRemovedAssessment)),m=ee((e=>e.logAddedAssessment)),h=(0,Z.M)(),g=r||!c||!u,{mutate:f,isLoading:v}=(0,pt.n)({mutationFn:()=>g?Promise.reject(new Error("Mutation is skipped")):(0,a.F9)()&&h.modelTraceInfo&&(0,i.gD)(h.modelTraceInfo)&&(0,i.ko)(h.modelTraceInfo)?Q._A.deleteAssessmentV4({traceId:c,assessmentId:u,traceLocation:h.modelTraceInfo.trace_location}):(0,Q.aG)({traceId:c,assessmentId:u}),onSuccess:()=>{var s;if((0,a.F9)()&&!g){if(e.overriddenAssessment){const t={...e.overriddenAssessment,valid:!0};m(c,t)}p(c,e)}l.invalidateQueries({queryKey:[i.BS,c]}),null===(s=h.invalidateTraceQuery)||void 0===s||s.call(h,c),(0,mt.B)({queryClient:l}),null===t||void 0===t||t()},onError:e=>{e instanceof Error&&g||((0,i.ij)(o.formatMessage({id:"iRNZkJ",defaultMessage:"Failed to delete assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)})),null===s||void 0===s||s(e))},onSettled:()=>{null===n||void 0===n||n()}});return{deleteAssessmentMutation:f,isLoading:v}})({assessment:e,onSettled:()=>{s(!1)}}),l=(0,n.useCallback)((()=>{r()}),[r]);return(0,c.Y)(C.d,{componentId:"shared.model-trace-explorer.assessment-delete-modal",visible:t,onOk:l,okButtonProps:{danger:!0,loading:o},okText:(0,c.Y)(d.sA,{id:"vlUEAo",defaultMessage:"Delete"}),onCancel:()=>{s(!1)},cancelText:(0,c.Y)(d.sA,{id:"gFYM0j",defaultMessage:"Cancel"}),confirmLoading:o,title:(0,c.Y)(d.sA,{id:"mqqEUj",defaultMessage:"Delete assessment"}),children:(0,c.Y)(d.sA,{id:"puATD8",defaultMessage:"Are you sure you want to delete this assessment?"})})};var yt=s(33145);const bt=({assessment:e,onSuccess:t,onSettled:s,onCancel:r})=>{var u;const m="feedback"in e,g=(0,yt.e)(e),f=((e,t)=>{if("string"===typeof e){if(""===e)return"boolean";if(t)return"string";try{return JSON.parse(e),"json"}catch(s){return"string"}}return"boolean"===typeof e||"number"===typeof e?typeof e:"boolean"})(g,m),v=(e=>"string"===typeof e?e||null:"boolean"===typeof e||"number"===typeof e?e:null)(g),x=null!==(u=(0,et.w)())&&void 0!==u?u:"",{theme:y}=(0,l.u)(),[b,Y]=(0,n.useState)(f),[w,A]=(0,n.useState)(v),[T,S]=(0,n.useState)(e.rationale),[M,I]=(0,n.useState)(null),{updateAssessmentMutation:k,isLoading:C}=(({assessment:e,onSuccess:t,onError:s,onSettled:n})=>{const r=(0,d.tz)(),o=(0,ut.jE)(),l=ee((e=>e.logAddedAssessment)),c=(0,Z.M)(),{mutate:u,isLoading:p}=(0,pt.n)({mutationFn:t=>(0,a.F9)()&&null!==c&&void 0!==c&&c.modelTraceInfo&&(0,i.gD)(c.modelTraceInfo)&&(0,i.ko)(null===c||void 0===c?void 0:c.modelTraceInfo)?(t.assessment.assessment_name=e.assessment_name,Q._A.updateAssessmentV4({traceId:e.trace_id,assessmentId:e.assessment_id,payload:t,traceLocation:c.modelTraceInfo.trace_location})):(0,Q.G3)({traceId:e.trace_id,assessmentId:e.assessment_id,payload:t}),onError:e=>{(0,i.ij)(r.formatMessage({id:"+hZB4c",defaultMessage:"Failed to update assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)})),null===s||void 0===s||s(e)},onSuccess:s=>{var n;if((0,a.F9)()&&(0,h.isObject)(s)){const e="assessment"in s?s.assessment:s;l(e.trace_id,e)}o.invalidateQueries({queryKey:[i.BS,e.trace_id]}),null===(n=c.invalidateTraceQuery)||void 0===n||n.call(c,e.trace_id),(0,mt.B)({queryClient:o}),null===t||void 0===t||t()},onSettled:()=>{null===n||void 0===n||n()}});return{updateAssessmentMutation:u,isLoading:p}})({assessment:e,onSuccess:t,onSettled:s}),{overrideAssessmentMutation:E,isLoading:N}=(({traceId:e,onSuccess:t,onError:s,onSettled:n})=>{const r=(0,d.tz)(),o=(0,ut.jE)(),l=ee((e=>e.logAddedAssessment)),c=ee((e=>e.logRemovedAssessment)),u=(0,Z.M)(),{mutate:p,isLoading:m}=(0,pt.n)({mutationFn:({oldAssessment:e,value:t,rationale:s})=>{var n;const r={...e,...t,rationale:s,source:{source_id:null!==(n=(0,et.w)())&&void 0!==n?n:"",source_type:"HUMAN"},overrides:e.assessment_id},o={assessment:(0,h.omit)(r,"assessment_id","create_time","last_update_time","overriddenAssessments")};return(0,a.F9)()&&u.modelTraceInfo&&(0,i.gD)(u.modelTraceInfo)&&(0,i.ko)(u.modelTraceInfo)?Q._A.createAssessmentV4({payload:o,traceLocation:u.modelTraceInfo.trace_location}):(0,Q.bU)({payload:o})},onError:e=>{(0,i.ij)(r.formatMessage({id:"X11caV",defaultMessage:"Failed to override assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)})),null===s||void 0===s||s(e)},onSuccess:(s,n)=>{var r;if((0,a.F9)()&&(0,h.isObject)(s)){const t="assessment"in s?s.assessment:s;t.overriddenAssessment=n.oldAssessment,l(e,t),c(e,n.oldAssessment)}o.invalidateQueries({queryKey:[i.BS,e]}),null===(r=u.invalidateTraceQuery)||void 0===r||r.call(u,e),(0,mt.B)({queryClient:o}),null===t||void 0===t||t()},onSettled:()=>{null===n||void 0===n||n()}});return{overrideAssessmentMutation:p,isLoading:m}})({traceId:e.trace_id,onSuccess:t,onSettled:s}),F=C||N,R=(0,n.useCallback)((async()=>{if("json"===b)try{JSON.parse(w)}catch(s){return void I((0,c.Y)(d.sA,{id:"8I9ipd",defaultMessage:"The provided value is not valid JSON"}))}const t=it({formValue:w,dataType:b,isFeedback:m});if(x!==e.source.source_id&&m)E({oldAssessment:e,value:t,...T?{rationale:T}:{}});else{const e={assessment:{...t,rationale:T},update_mask:(m?"feedback":"expectation")+",rationale"};k(e)}}),[b,w,m,x,e,T,k,E]);return(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:y.spacing.xs,marginTop:y.spacing.sm,border:`1px solid ${y.colors.border}`,padding:y.spacing.sm,borderRadius:y.borders.borderRadiusSm},""),children:[(0,c.Y)(l.T.Text,{css:(0,p.AH)({marginTop:y.spacing.xs},""),size:"sm",color:"secondary",children:(0,c.Y)(d.sA,{id:"b7OpMB",defaultMessage:"Data Type"})}),(0,c.FD)(o.SimpleSelect,{id:"shared.model-trace-explorer.assessment-edit-data-type-select",componentId:"shared.model-trace-explorer.assessment-edit-data-type-select",value:b,disabled:F,onChange:e=>{Y(e.target.value),I(null)},children:[!m&&(0,c.Y)(o.SimpleSelectOption,{value:"json",children:(0,c.Y)(d.sA,{id:"GKVTw4",defaultMessage:"JSON"})}),(0,c.Y)(o.SimpleSelectOption,{value:"string",children:(0,c.Y)(d.sA,{id:"cBSSLp",defaultMessage:"String"})}),(0,c.Y)(o.SimpleSelectOption,{value:"boolean",children:(0,c.Y)(d.sA,{id:"k0l8lF",defaultMessage:"Boolean"})}),(0,c.Y)(o.SimpleSelectOption,{value:"number",children:(0,c.Y)(d.sA,{id:"C9ccNu",defaultMessage:"Number"})})]}),(0,c.Y)(l.T.Text,{css:(0,p.AH)({marginTop:y.spacing.xs},""),size:"sm",color:"secondary",children:(0,c.Y)(d.sA,{id:"e2AObB",defaultMessage:"Value"})}),"json"===b&&(0,c.FD)(c.FK,{children:[(0,c.Y)(D.I.TextArea,{componentId:"shared.model-trace-explorer.assessment-edit-value-string-input",value:String(w),rows:3,onKeyDown:e=>e.stopPropagation(),onChange:e=>{A(e.target.value),I(null)},validationState:M?"error":void 0,disabled:F}),M&&(0,c.Y)(o.FormUI.Message,{id:"shared.model-trace-explorer.assessment-edit-value-json-error",message:M,type:"error"})]}),"string"===b&&(0,c.Y)(D.I,{componentId:"shared.model-trace-explorer.assessment-edit-value-string-input",value:String(w),onKeyDown:e=>e.stopPropagation(),onChange:e=>{A(e.target.value),I(null)},disabled:F,allowClear:!0}),"boolean"===b&&(0,c.FD)(o.SegmentedControlGroup,{componentId:"shared.model-trace-explorer.assessment-edit-value-boolean-input",name:"shared.model-trace-explorer.assessment-edit-value-boolean-input",value:w,disabled:F,onChange:e=>{A(e.target.value),I(null)},children:[(0,c.Y)(o.SegmentedControlButton,{value:!0,children:"True"}),(0,c.Y)(o.SegmentedControlButton,{value:!1,children:"False"})]}),"number"===b&&(0,c.Y)(D.I,{componentId:"shared.model-trace-explorer.assessment-edit-value-number-input",value:String(w),onKeyDown:e=>e.stopPropagation(),onChange:e=>{A(e.target.value?Number(e.target.value):""),I(null)},type:"number",disabled:F,allowClear:!0}),(0,c.Y)(l.T.Text,{css:(0,p.AH)({marginTop:y.spacing.xs},""),size:"sm",color:"secondary",children:(0,c.Y)(d.sA,{id:"6BRlPU",defaultMessage:"Rationale"})}),(0,c.Y)(D.I.TextArea,{componentId:"shared.model-trace-explorer.assessment-edit-rationale-input",value:T,autoSize:{minRows:1,maxRows:5},disabled:F,onKeyDown:e=>e.stopPropagation(),onChange:e=>S(e.target.value)}),(0,c.FD)("div",{css:(0,p.AH)({display:"flex",justifyContent:"flex-end",marginTop:y.spacing.xs},""),children:[(0,c.Y)(l.B,{componentId:"shared.model-trace-explorer.assessment-edit-cancel-button",disabled:F,onClick:r,children:(0,c.Y)(d.sA,{id:"mIFcgu",defaultMessage:"Cancel"})}),(0,c.Y)(l.B,{css:(0,p.AH)({marginLeft:y.spacing.sm},""),type:"primary",componentId:"shared.model-trace-explorer.assessment-edit-save-button",onClick:R,loading:F,children:(0,c.Y)(d.sA,{id:"M+iC03",defaultMessage:"Save"})})]})]})};var Yt=s(4564),wt=s(777);var At={name:"bcffy2",styles:"display:flex;align-items:center;justify-content:space-between"},Tt={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},St={name:"s5xdrg",styles:"display:flex;align-items:center"},Mt={name:"fxp7t8",styles:"flex:1;min-width:0"};const It=({expectation:e})=>{const{theme:t}=(0,l.u)(),[s,r]=(0,n.useState)(!1),[a,i]=(0,n.useState)(!1),[u,m]=(0,n.useState)(!1),{nodeMap:h,activeView:g}=I(),f=e.span_id?h[e.span_id]:null,v="summary"===g&&f,x=(e=>{if("value"in e)return e.value;try{return JSON.parse(e.serialized_value.value)}catch(t){return e.serialized_value.value}})(e.expectation),y=(0,yt.R)(e.source);return(0,c.FD)("div",{css:(0,p.AH)({padding:t.spacing.sm+t.spacing.xs,paddingTop:t.spacing.sm,border:`1px solid ${t.colors.border}`,borderRadius:t.borders.borderRadiusMd,display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:[(0,c.FD)("div",{css:At,children:[(0,c.Y)(l.T.Text,{bold:!0,css:Tt,children:e.assessment_name}),(0,c.Y)(vt,{assessment:e,setIsEditing:r,setShowDeleteModal:i}),(0,c.Y)(xt,{assessment:e,isModalVisible:a,setIsModalVisible:i})]}),s?(0,c.Y)(bt,{assessment:e,onSuccess:()=>r(!1),onCancel:()=>r(!1)}):(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:[(0,c.FD)("div",{css:St,children:[(0,c.Y)(y,{size:t.typography.fontSizeSm,css:(0,p.AH)({padding:2,backgroundColor:t.colors.actionIconBackgroundHover,borderRadius:t.borders.borderRadiusFull},"")}),(0,c.Y)(Yt.V,{source:e.source})]}),(0,c.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:u?"flex-start":"center",gap:t.spacing.xs},""),children:[(0,c.Y)(l.B,{componentId:"shared.model-trace-explorer.toggle-expectation-expanded",size:"small",icon:u?(0,c.Y)(o.ChevronDownIcon,{}):(0,c.Y)(l.o,{}),onClick:()=>m(!u)}),(0,c.Y)("div",{css:Mt,children:u?(0,c.Y)("div",{css:(0,p.AH)({backgroundColor:t.colors.backgroundSecondary,padding:`${t.spacing.xs}px ${t.spacing.sm}px`,borderRadius:t.borders.borderRadiusMd,whiteSpace:"pre-wrap",wordBreak:"break-word"},""),children:(0,c.Y)(l.T.Text,{children:"string"===typeof x?x:JSON.stringify(x,null,2)})}):(0,c.Y)(wt.S,{parsedValue:x,singleLine:!0})})]})]}),v&&(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs},""),children:[(0,c.Y)(l.T.Text,{size:"sm",color:"secondary",children:(0,c.Y)(d.sA,{id:"+hQbnS",defaultMessage:"Span"})}),(0,c.Y)(Oe,{node:f})]})]})};var kt={name:"1bnhmdk",styles:"overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap"};const Dt=({jsonValue:e,className:t,prefix:s,skipIcons:n=!1,overrideColor:r})=>{const{theme:a}=(0,l.u)();if(!e||'""'===e)return null;let i;try{i=JSON.parse(e)}catch(h){i=e}let u="default",m=JSON.stringify(i,null,2);return"yes"===i?(u="lime",m=(0,c.FD)(c.FK,{children:[!n&&(0,c.Y)(o.CheckCircleIcon,{css:(0,p.AH)({marginRight:a.spacing.xs},"")}),(0,c.Y)(d.sA,{id:"MhOmZG",defaultMessage:"Yes"})]})):"no"===i?(u="coral",m=(0,c.FD)(c.FK,{children:[!n&&(0,c.Y)(o.XCircleIcon,{css:(0,p.AH)({marginRight:a.spacing.xs},"")}),(0,c.Y)(d.sA,{id:"M8cEQy",defaultMessage:"No"})]})):"string"===typeof i?m=i:null===i?(u="coral",m=(0,c.FD)(c.FK,{children:[!n&&(0,c.Y)(l.k,{css:(0,p.AH)({marginRight:a.spacing.xs},"")}),(0,c.Y)(d.sA,{id:"zEXwQL",defaultMessage:"Error"})]})):!0===i?(u="lime",m=(0,c.FD)(c.FK,{children:[!n&&(0,c.Y)(o.CheckCircleIcon,{css:(0,p.AH)({marginRight:a.spacing.xs},"")}),(0,c.Y)(d.sA,{id:"hWHLjo",defaultMessage:"True"})]})):!1===i&&(u="coral",m=(0,c.FD)(c.FK,{children:[!n&&(0,c.Y)(o.XCircleIcon,{css:(0,p.AH)({marginRight:a.spacing.xs},"")}),(0,c.Y)(d.sA,{id:"4U/RVz",defaultMessage:"False"})]})),(0,c.Y)(C.T,{componentId:"shared.model-trace-explorer.assesment-value-tooltip",content:m,children:(0,c.Y)(o.Tag,{css:(0,p.AH)({display:"inline-flex",maxWidth:"100%",minWidth:a.spacing.md,marginRight:0},""),componentId:"shared.model-trace-explorer.assesment-value-tag",color:null!==r&&void 0!==r?r:u,className:t,children:(0,c.FD)("span",{css:kt,children:[s,m]})})})};var Ct={name:"fhxb3m",styles:"display:flex;flex-direction:row;align-items:center"};const Et=({renderConnector:e=!0,assessment:t,setIsEditing:s,hideOverflowMenu:r=!1})=>{const{theme:a}=(0,l.u)(),[i,o]=(0,n.useState)(!1),d=(0,yt.R)(t.source);return(0,c.FD)("div",{css:Ct,children:[e&&(0,c.Y)("div",{css:(0,p.AH)({position:"absolute",left:-1,top:0,width:10,height:a.typography.lineHeightBase,boxSizing:"border-box",borderBottomLeftRadius:a.borders.borderRadiusMd,borderBottom:`1px solid ${a.colors.border}`,borderLeft:`1px solid ${a.colors.border}`},"")}),(0,c.Y)(d,{size:a.typography.fontSizeSm,css:(0,p.AH)({padding:2,backgroundColor:a.colors.actionIconBackgroundHover,borderRadius:a.borders.borderRadiusFull},"")}),(0,c.Y)(Yt.V,{source:t.source}),(0,c.FD)("div",{css:(0,p.AH)({marginLeft:"auto",display:"flex",flexDirection:"row",alignItems:"center",gap:a.spacing.xs},""),children:[t.last_update_time&&(0,c.Y)(l.T.Text,{color:"secondary",size:"sm",css:(0,p.AH)({marginLeft:a.spacing.sm,overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap"},""),children:at(new Date(t.last_update_time))}),!r&&(0,c.Y)(vt,{assessment:t,setIsEditing:s,setShowDeleteModal:o}),(0,c.Y)(xt,{assessment:t,isModalVisible:i,setIsModalVisible:o})]})]})},Nt=({error:e})=>{const{theme:t}=(0,l.u)(),[s,r]=(0,n.useState)(!1);return(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs},""),children:[(0,c.Y)(o.Alert,{type:"error",closable:!1,message:e.error_code,componentId:"shared.model-trace-explorer.feedback-error-item",description:(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs},""),children:[(0,c.Y)("span",{children:e.error_message}),e.stack_trace&&(0,c.Y)(l.T.Link,{componentId:"shared.model-trace-explorer.feedback-error-item-stack-trace-link",onClick:()=>r(!0),children:(0,c.Y)(d.sA,{id:"z/CjX4",defaultMessage:"View stack trace"})})]})}),e.stack_trace&&(0,c.Y)(C.d,{title:(0,c.Y)(d.sA,{id:"KqReh3",defaultMessage:"Error stack trace"}),visible:s,componentId:"shared.model-trace-explorer.feedback-error-stack-trace-modal",footer:null,onCancel:()=>r(!1),children:(0,c.Y)(Ae,{data:JSON.stringify(e.stack_trace),title:"",initialRenderMode:m.cC.TEXT})})]})};var Ft={name:"yqjhl6",styles:"display:flex;flex-direction:column;position:relative"};const Rt=({feedback:e})=>{const{theme:t}=(0,l.u)(),s=e.feedback.value;return(0,c.FD)("div",{css:Ft,children:[(0,c.Y)(Et,{renderConnector:!1,assessment:e}),(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs,marginLeft:10,paddingLeft:t.spacing.md,paddingTop:t.spacing.sm,paddingBottom:t.spacing.md,paddingRight:t.spacing.lg,borderLeft:`1px solid ${t.colors.border}`},""),children:[(0,h.isNil)(e.feedback.error)?(0,c.FD)(c.FK,{children:[(0,c.Y)(l.T.Text,{size:"sm",color:"secondary",children:(0,c.Y)(d.sA,{id:"RGKRP9",defaultMessage:"Feedback"})}),(0,c.Y)("div",{children:(0,c.Y)(Dt,{jsonValue:JSON.stringify(s)})})]}):(0,c.Y)(Nt,{error:e.feedback.error}),e.rationale&&(0,c.FD)(c.FK,{children:[(0,c.Y)(l.T.Text,{size:"sm",color:"secondary",css:(0,p.AH)({marginTop:t.spacing.xs},""),children:(0,c.Y)(d.sA,{id:"gYOuKs",defaultMessage:"Rationale"})}),(0,c.Y)(v.V,{children:e.rationale})]})]})]})},Ht=({isModalVisible:e,setIsModalVisible:t,feedback:s})=>{const r=(0,n.useMemo)((()=>(e=>{const t=new Set,s=[];let n=e;for(;n&&!t.has(n.assessment_id);)t.add(n.assessment_id),s.push(n),n=n.overriddenAssessment;return s})(s)),[s]);return(0,c.Y)(C.d,{componentId:"shared.model-trace-explorer.feedback-history-modal",visible:e,footer:null,onCancel:()=>{t(!1)},title:(0,c.Y)(d.sA,{id:"n6SrIn",defaultMessage:"Edit history"}),children:r.map((e=>"feedback"in e?(0,c.Y)(Rt,{feedback:e},e.assessment_id):null))})};var Lt=s(69291);var _t={name:"1cgftv8",styles:"&:hover{text-decoration:underline;cursor:pointer;}"},Ot={name:"16mcpms",styles:"& > div:last-of-type{margin-bottom:0;}"},Bt={name:"rnnx2x",styles:"font-size:12px"};const zt=({feedback:e})=>{var t,s;const[r,a]=(0,n.useState)(!1),{theme:i}=(0,l.u)(),{nodeMap:o,activeView:u}=I(),{experimentId:m}=(0,j.g)(),f=e.feedback.value,x=e.span_id?o[e.span_id]:null,y="summary"===u&&x,b=null===(t=e.metadata)||void 0===t?void 0:t[g.gK],Y=b&&m?$t(m,b):void 0,w=null===(s=e.metadata)||void 0===s?void 0:s[g.zZ],A=(()=>{if(null===w)return;const e=Number(w);return Number.isFinite(e)?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:6}).format(e):void 0})(),T=Boolean(A);return(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:i.spacing.sm,marginLeft:i.spacing.lg},""),children:[!(0,h.isNil)(e.feedback.error)&&(0,c.Y)(Nt,{error:e.feedback.error}),y&&(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:i.spacing.xs},""),children:[(0,c.Y)(l.T.Text,{size:"sm",color:"secondary",children:(0,c.Y)(d.sA,{id:"+hQbnS",defaultMessage:"Span"})}),(0,c.Y)(Oe,{node:x})]}),(0,h.isNil)(e.feedback.error)&&(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:i.spacing.xs},""),children:[(0,c.Y)(l.T.Text,{size:"sm",color:"secondary",children:(0,c.Y)(d.sA,{id:"RGKRP9",defaultMessage:"Feedback"})}),(0,c.FD)("div",{css:(0,p.AH)({display:"flex",gap:i.spacing.xs},""),children:[(0,c.Y)(Dt,{jsonValue:JSON.stringify(f)}),e.overriddenAssessment&&(0,c.FD)(c.FK,{children:[(0,c.Y)("span",{onClick:()=>a(!0),children:(0,c.Y)(l.T.Text,{css:_t,color:"secondary",children:(0,c.Y)(d.sA,{id:"f4CfIz",defaultMessage:"(edited)"})})}),(0,c.Y)(Ht,{isModalVisible:r,setIsModalVisible:a,feedback:e})]})]})]}),e.rationale&&(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:i.spacing.xs},""),children:[(0,c.Y)(l.T.Text,{size:"sm",color:"secondary",children:(0,c.Y)(d.sA,{id:"gYOuKs",defaultMessage:"Rationale"})}),(0,c.Y)("div",{css:Ot,children:(0,c.Y)(v.V,{children:e.rationale})})]}),T&&(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:i.spacing.xs},""),children:[(0,c.Y)(l.T.Text,{size:"sm",color:"secondary",children:(0,c.Y)(d.sA,{id:"oBJ8xc",defaultMessage:"Cost"})}),(0,c.Y)(l.T.Text,{style:{color:i.colors.textSecondary},children:A})]}),Y&&(0,c.Y)(j.N_,{to:Y,target:"_blank",rel:"noreferrer",children:(0,c.FD)("span",{css:(0,p.AH)({display:"flex",alignItems:"center",gap:i.spacing.xs},""),children:[(0,c.Y)(d.sA,{id:"4a2Kqx",defaultMessage:"View trace"}),(0,c.Y)(l.au,{css:Bt})]})})]})},$t=(e,t)=>`${(0,Lt.p)(e)}?selectedEvaluationId=${t}`,jt=({feedback:e})=>{const{theme:t}=(0,l.u)(),[s,r]=(0,n.useState)(!1);return(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs,paddingLeft:t.spacing.lg/2,marginLeft:t.spacing.lg/2,paddingTop:t.spacing.sm,paddingBottom:t.spacing.sm,borderLeft:`1px solid ${t.colors.border}`,position:"relative"},""),children:[(0,c.Y)(Et,{assessment:e,setIsEditing:r}),s?(0,c.Y)(bt,{assessment:e,onSuccess:()=>r(!1),onCancel:()=>r(!1)}):(0,c.Y)(zt,{feedback:e})]})};const Vt=e=>{const t={"& > svg":{width:12,height:12}};switch(e){case"HUMAN":return(0,c.Y)(o.UserIcon,{css:t});case"LLM_JUDGE":return(0,c.Y)(o.SparkleIcon,{css:t});case"CODE":return(0,c.Y)(o.CodeIcon,{css:t});default:return null}};var Pt={name:"ti75j2",styles:"margin:0"};const Ut=({feedbacks:e})=>{const{theme:t}=(0,l.u)();if(e.length<2)return null;const s=(0,h.countBy)(e,(e=>e.source.source_type));return(0,c.Y)("div",{css:(0,p.AH)({display:"flex",gap:t.spacing.xs,alignItems:"center",marginLeft:t.spacing.xs},""),children:Object.entries(s).map((([e,s])=>(0,c.Y)(o.Tag,{componentId:"shared.model-trace-explorer.feedback-source-count",css:Pt,children:(0,c.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",gap:t.spacing.xs},""),children:[Vt(e),(0,c.Y)(l.T.Text,{children:s})]})},e)))})};var Kt={name:"1fttcpj",styles:"display:flex;flex-direction:column"},Wt={name:"ozd7xs",styles:"flex-shrink:0"},Gt={name:"1fttcpj",styles:"display:flex;flex-direction:column"};const qt=({jsonValue:e,feedbacks:t})=>{const{theme:s}=(0,l.u)(),[r,a]=(0,n.useState)(!1);return(0,c.FD)("div",{css:Kt,children:[(0,c.FD)("div",{css:(0,p.AH)({display:"flex",gap:s.spacing.xs,alignItems:"center"},""),children:[(0,c.Y)(l.B,{componentId:"shared.model-trace-explorer.toggle-assessment-expanded",css:Wt,size:"small",icon:r?(0,c.Y)(o.ChevronDownIcon,{}):(0,c.Y)(l.o,{}),onClick:()=>a(!r)}),(0,c.Y)(Dt,{jsonValue:e}),(0,c.Y)(Ut,{feedbacks:t})]}),r&&(0,c.Y)("div",{css:Gt,children:t.map((e=>!1===(null===e||void 0===e?void 0:e.valid)?null:(0,c.Y)(jt,{feedback:e},e.assessment_id)))})]})};var Jt={name:"1bnhmdk",styles:"overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap"},Xt={name:"ozd7xs",styles:"flex-shrink:0"};const Qt=({name:e,valuesMap:t,traceId:s,activeSpanId:r})=>{const{theme:a}=(0,l.u)(),i=(e=>{const t=e.split("/");return 1===t.length?e:2===t.length?t[1]:t.slice(2).join("/")})(e),[d,u]=(0,n.useState)(!1),m=Object.values(t).flat().some((e=>!(0,h.isNil)(e.feedback.error)));return(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",marginBottom:a.spacing.sm,border:`1px solid ${a.colors.border}`,borderRadius:a.borders.borderRadiusMd,padding:a.spacing.sm+a.spacing.xs,paddingTop:a.spacing.sm,gap:a.spacing.sm},""),children:[(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",gap:a.spacing.sm},""),children:[(0,c.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",gap:a.spacing.sm,flex:1,minWidth:0},""),children:[(0,c.Y)(l.T.Text,{bold:!0,css:Jt,children:i}),m&&(0,c.Y)(l.k,{css:Xt,color:"danger"})]}),(0,c.Y)(C.T,{content:"Add new feedback",componentId:"shared.model-trace-explorer.add-feedback-in-group-tooltip",children:(0,c.Y)(l.B,{componentId:"shared.model-trace-explorer.add-feedback",css:(0,p.AH)({flexShrink:0,marginRight:-a.spacing.xs},""),size:"small",icon:(0,c.Y)(o.PlusIcon,{}),onClick:()=>u(!0)})})]}),Object.entries(t).map((([e,t])=>(0,c.Y)(qt,{jsonValue:e,feedbacks:t},e))),d&&(0,c.Y)(gt,{assessmentName:e,spanId:r,traceId:s,setExpanded:u})]})};var Zt={name:"g030ms",styles:"display:flex;flex-direction:row;justify-content:space-between;align-items:center"};const es=({assessments:e,traceId:t,activeSpanId:s})=>{const r=ee((e=>e.reconstructAssessments)),i=ee((e=>e.assessmentActions[t])),o=(0,n.useMemo)((()=>{if(!(0,a.F9)())return e;const t=r(e,i);return(0,h.uniqBy)(t,(({assessment_id:e})=>e))}),[e,r,i]),{theme:u}=(0,l.u)(),{setAssessmentsPaneExpanded:m,assessmentsPaneExpanded:g,isInComparisonView:f}=I(),[v,x]=(0,n.useMemo)((()=>(0,h.partition)(o,(e=>"feedback"in e))),[o]),y=(0,n.useMemo)((()=>(e=>{const t={};return e.forEach((e=>{if(!1===e.valid)return;let s=null;""!==e.feedback.value&&(s=JSON.stringify(e.feedback.value));const{assessment_name:n}=e;t[n]||(t[n]={});const r=t[n];(0,h.isNil)(s)||(r[s]||(r[s]=[]),r[s].push(e))})),Object.entries(t).toSorted((([e],[t])=>e.localeCompare(t)))})(v)),[v]),b=x.toSorted(((e,t)=>e.assessment_name.localeCompare(t.assessment_name)));return(0,c.FD)("div",{"data-testid":"assessments-pane",css:(0,p.AH)({display:"flex",flexDirection:"column",...f?{padding:`${u.spacing.sm} 0`,maxHeight:10*u.spacing.lg}:{padding:u.spacing.sm,paddingTop:u.spacing.xs,height:"100%"},...f?{}:{borderLeft:`1px solid ${u.colors.border}`},overflowY:"auto",minWidth:rt,width:"100%",boxSizing:"border-box"},""),children:[(0,c.FD)("div",{css:Zt,children:[!f&&(0,c.Y)(l.T.Text,{bold:!0,children:(0,c.Y)(d.sA,{id:"++Ydlz",defaultMessage:"Assessments"})}),!f&&m&&(0,c.Y)(C.T,{componentId:"shared.model-trace-explorer.close-assessments-pane-tooltip",content:(0,c.Y)(d.sA,{id:"cQQnzX",defaultMessage:"Hide assessments"}),children:(0,c.Y)(l.B,{"data-testid":"close-assessments-pane-button",componentId:"shared.model-trace-explorer.close-assessments-pane",size:"small",icon:(0,c.Y)(l.C,{}),onClick:()=>m(!1)})})]}),y.map((([e,n])=>(0,c.Y)(Qt,{name:e,valuesMap:n,traceId:t,activeSpanId:s},e))),b.length>0&&(0,c.FD)(c.FK,{children:[(0,c.Y)(l.T.Text,{color:"secondary",css:(0,p.AH)({marginBottom:u.spacing.sm},""),children:(0,c.Y)(d.sA,{id:"UbXw8O",defaultMessage:"Expectations"})}),(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:u.spacing.sm,marginBottom:u.spacing.sm},""),children:b.map((e=>(0,c.Y)(It,{expectation:e},e.assessment_id)))})]}),(0,c.Y)(ft,{title:(0,c.Y)(d.sA,{id:"2+O4wk",defaultMessage:"Add new assessment"}),spanId:s,traceId:t})]})},ts=()=>{const{theme:e}=(0,l.u)(),[t,s]=(0,n.useState)(500),{rootNode:r,nodeMap:a,assessmentsPaneEnabled:u,assessmentsPaneExpanded:m,isInComparisonView:h}=I(),g=(0,n.useMemo)((()=>Object.values(a).flatMap((e=>e.assessments))),[a]),f=(0,i.yt)(r);if(!r)return(0,c.Y)("div",{css:(0,p.AH)({marginTop:e.spacing.lg},""),children:(0,c.Y)(o.Empty,{description:(0,c.Y)(d.sA,{id:"hm98EL",defaultMessage:"No span data to display"})})});const v=(0,c.Y)(es,{assessments:g,traceId:r.traceId,activeSpanId:void 0});return!h&&u&&m?(0,c.Y)(Ze,{initialRatio:.75,paneWidth:t,setPaneWidth:s,leftChild:(0,c.Y)(We,{rootNode:r,intermediateNodes:f}),rightChild:v,leftMinWidth:400,rightMinWidth:rt}):(0,c.Y)(We,{rootNode:r,intermediateNodes:f})};var ss=s(27556);var ns={name:"2wv1be",styles:"width:100%;box-sizing:border-box"};var rs=({searchFilter:e,setSearchFilter:t,matchData:s,handleNextSearchMatch:r,handlePreviousSearchMatch:a})=>{const[i,d]=(0,n.useState)(e),u=(0,ss.YQ)(t,350),{theme:m}=(0,l.u)();return(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",justifyContent:"space-between",gap:m.spacing.sm},""),children:[(0,c.Y)(D.I,{componentId:"shared.model-trace-explorer.search-input",allowClear:!0,placeholder:"Search",value:i,onClear:()=>{t(""),d("")},onChange:e=>{d(e.target.value),u(e.target.value.toLowerCase())},prefix:(0,c.Y)(D.S,{}),css:ns}),s.match&&(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",marginLeft:m.spacing.xs,marginRight:m.spacing.sm,alignItems:"center"},""),children:[(0,c.FD)(l.T.Text,{css:(0,p.AH)({whiteSpace:"nowrap",marginRight:m.spacing.sm},""),children:[s.currentMatchIndex+1," / ",s.totalMatches]}),(0,c.Y)(l.B,{"data-testid":"prev-search-match",icon:(0,c.Y)(o.ChevronUpIcon,{}),onClick:a,componentId:"shared.model-trace-explorer.prev-search-match"}),(0,c.Y)(l.B,{"data-testid":"next-search-match",icon:(0,c.Y)(o.ChevronDownIcon,{}),onClick:r,componentId:"shared.model-trace-explorer.next-search-match"})]})]})};const as=e=>{switch(e.section){case"inputs":case"outputs":default:return"content";case"attributes":return"attributes";case"events":return"events"}},is=({treeNodes:e,selectedNode:t,setSelectedNode:s,setActiveTab:r,setExpandedKeys:a,modelTraceInfo:o})=>{var l;const[d,c]=(0,n.useState)(""),[u,p]=(0,n.useState)((()=>(e=>{const t={};e&&(0,h.compact)((0,S.VC)(e).map((e=>e.type))).forEach((e=>{t[e]=!0}));return{showParents:!0,showExceptions:!0,spanTypeDisplayState:t}})(e))),[m,g]=(0,n.useState)(0),f=e.map((e=>e.key)).join(","),{filteredTreeNodes:v,matches:x}=(0,n.useMemo)((()=>{const t=e.map((e=>(0,i.vL)(e,d,u)));return{filteredTreeNodes:t.flatMap((e=>e.filteredTreeNodes)),matches:t.flatMap((e=>e.matches))}}),[f,d,u,o]),y=(0,n.useMemo)((()=>(0,S.dM)(v)),[v]),b=(0,n.useCallback)((e=>{if(e>=x.length||e<0)return;g(e);const t=x[e];s(t.span),r(as(t));const n=(0,S.NP)(t.span,y);a((e=>new Set([...e,...n])))}),[x,s,r,y,a]),Y=(0,n.useCallback)((()=>{b(m+1)}),[m,b]),w=(0,n.useCallback)((()=>{b(m-1)}),[m,b]);return(0,n.useLayoutEffect)((()=>{if(0!==v.length)if(0!==x.length)g(0),s(x[0].span),r(as(x[0]));else{var e;const n=null!==(e=null===t||void 0===t?void 0:t.key)&&void 0!==e?e:"";if(n in y)s(y[n]);else{const e=v[0];s(e),r(null!==e&&void 0!==e&&e.chatMessages?"chat":"content")}}}),[v,x,s]),{matchData:{match:null!==(l=x[m])&&void 0!==l?l:null,totalMatches:x.length,currentMatchIndex:m},searchFilter:d.toLowerCase().trim(),setSearchFilter:c,spanFilterState:u,setSpanFilterState:p,filteredTreeNodes:v,handleNextSearchMatch:Y,handlePreviousSearchMatch:w}};function os({activeSpan:e,searchFilter:t,activeMatch:s}){const{theme:n}=(0,l.u)(),{attributes:r}=e,a=(0,h.keys)(r).length>0,i=!(0,h.isNil)(s)&&s.span.key===e.key;return!a||(0,h.isNil)(r)?(0,c.Y)("div",{css:(0,p.AH)({marginTop:n.spacing.md},""),children:(0,c.Y)(o.Empty,{description:(0,c.Y)(d.sA,{id:"B5K1Ix",defaultMessage:"No attributes found"})})}):(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,padding:n.spacing.md},""),children:Object.entries(r).map((([e,n])=>(0,c.Y)(Ae,{title:e,data:JSON.stringify(n,null,2),searchFilter:t,activeMatch:s,containsActiveMatch:i&&"attributes"===s.section&&s.key===e},e)))})}function ls({chatMessages:e,chatTools:t}){const{theme:s}=(0,l.u)();return(0,c.FD)("div",{css:(0,p.AH)({overflowY:"auto",padding:s.spacing.md},""),"data-testid":"model-trace-explorer-chat-tab",children:[t&&(0,c.Y)(se,{css:(0,p.AH)({marginBottom:s.spacing.sm},""),title:(0,c.Y)(d.sA,{id:"Cjq57+",defaultMessage:"Tools"}),sectionKey:"messages",children:(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:s.spacing.sm},""),children:t.map((e=>(0,c.Y)(re,{tool:e},e.function.name)))})}),(0,c.Y)(se,{title:(0,c.Y)(d.sA,{id:"AAdQxU",defaultMessage:"Messages"}),sectionKey:"messages",children:(0,c.Y)(He,{messages:e})})]})}var ds={name:"1s4awny",styles:"display:flex;flex-direction:row;align-items:center;justify-content:space-between;width:100%"},cs={name:"uqztsn",styles:"display:flex;flex-direction:row;justify-content:space-between;width:100%"};function us({activeSpan:e,className:t,searchFilter:s,activeMatch:r}){const{theme:a}=(0,l.u)(),o=(0,n.useMemo)((()=>(0,i.g_)(null===e||void 0===e?void 0:e.inputs)),[e]),u=(0,n.useMemo)((()=>(0,i.g_)(null===e||void 0===e?void 0:e.outputs)),[e]);if((0,h.isNil)(e))return null;const m=o.length>0,g=u.length>0,f=!(0,h.isNil)(r)&&r.span.key===e.key;return(0,c.FD)("div",{"data-testid":"model-trace-explorer-default-span-view",children:[m&&(0,c.Y)(se,{withBorder:!0,css:(0,p.AH)({marginBottom:a.spacing.sm},""),sectionKey:"input",title:(0,c.Y)("div",{css:ds,children:(0,c.Y)(d.sA,{id:"/TX1Az",defaultMessage:"Inputs"})}),children:(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:a.spacing.sm},""),children:o.map((({key:e,value:t},n)=>(0,c.Y)(Ae,{title:e,data:t,searchFilter:s,activeMatch:r,containsActiveMatch:f&&"inputs"===r.section&&r.key===e},e||n)))})}),g&&(0,c.Y)(se,{withBorder:!0,sectionKey:"output",title:(0,c.Y)("div",{css:cs,children:(0,c.Y)(d.sA,{id:"ZstVNI",defaultMessage:"Outputs"})}),children:(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:a.spacing.sm},""),children:u.map((({key:e,value:t})=>(0,c.Y)(Ae,{title:e,data:t,searchFilter:s,activeMatch:r,containsActiveMatch:f&&"outputs"===r.section&&r.key===e},e)))})})]})}var ps={name:"s5xdrg",styles:"display:flex;align-items:center"},ms={name:"s5xdrg",styles:"display:flex;align-items:center"};function hs({shouldRenderMarkdown:e,setShouldRenderMarkdown:t}){const{theme:s}=(0,l.u)();return(0,c.FD)(o.SegmentedControlGroup,{"data-testid":"model-trace-explorer-render-mode-toggle",name:"render-mode",size:"small",componentId:`shared.model-trace-explorer.toggle-markdown-rendering-${!e}`,value:e,onChange:e=>{t(e.target.value)},children:[(0,c.Y)(o.SegmentedControlButton,{"data-testid":"model-trace-explorer-render-raw-input-button",value:!1,children:(0,c.Y)(C.T,{componentId:"shared.model-trace-explorer.raw-input-rendering-tooltip",content:(0,c.Y)(d.sA,{id:"NMxAot",defaultMessage:"Raw input"}),children:(0,c.Y)("div",{css:ps,children:(0,c.Y)(o.TextBoxIcon,{css:(0,p.AH)({fontSize:s.typography.fontSizeLg},"")})})})}),(0,c.Y)(o.SegmentedControlButton,{"data-testid":"model-trace-explorer-render-default-button",value:!0,children:(0,c.Y)(C.T,{componentId:"shared.model-trace-explorer.default-rendering-tooltip",content:(0,c.Y)(d.sA,{id:"xwe7WH",defaultMessage:"Default rendering"}),children:(0,c.Y)("div",{css:ms,children:(0,c.Y)(o.MarkdownIcon,{css:(0,p.AH)({fontSize:s.typography.fontSizeLg},"")})})})})]})}var gs={name:"1s4awny",styles:"display:flex;flex-direction:row;align-items:center;justify-content:space-between;width:100%"};function fs({activeSpan:e,className:t,searchFilter:s,activeMatch:r}){const{theme:a}=(0,l.u)(),[u,m]=(0,n.useState)(!0),g=(0,n.useMemo)((()=>(0,i.g_)(e.inputs)),[e]),f=e.outputs,v=g.length>0,x=!(0,h.isNil)(r)&&r.span.key===e.key,y=x&&"outputs"===r.section;return(0,c.FD)("div",{className:t,"data-testid":"model-trace-explorer-retriever-span-view",children:[v&&(0,c.Y)(se,{sectionKey:"input",css:(0,p.AH)({marginBottom:a.spacing.sm},""),title:(0,c.Y)(d.sA,{id:"/TX1Az",defaultMessage:"Inputs"}),children:(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:a.spacing.sm},""),children:g.map((({key:e,value:t},n)=>(0,c.Y)(Ae,{title:e,data:t,searchFilter:s,activeMatch:r,containsActiveMatch:x&&"inputs"===r.section&&r.key===e},e||n)))})}),(0,c.Y)(se,{sectionKey:"output",title:(0,c.FD)("div",{css:gs,children:[(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",gap:a.spacing.sm},""),children:[(0,c.Y)(d.sA,{id:"ThYYz6",defaultMessage:"Documents"}),(0,c.Y)(o.Tag,{componentId:"shared.model-trace-explorer.document-count",children:f.length})]}),!y&&(0,c.Y)(hs,{shouldRenderMarkdown:u,setShouldRenderMarkdown:m})]}),children:u&&!y?(0,c.Y)("div",{css:(0,p.AH)({border:`1px solid ${a.colors.border}`,borderRadius:a.legacyBorders.borderRadiusMd},""),children:f.map(((e,t)=>(0,c.Y)("div",{css:(0,p.AH)({borderBottom:t!==f.length-1?`1px solid ${a.colors.border}`:""},""),children:(0,c.Y)(me,{text:e.page_content,metadata:e.metadata},t)},t)))}):(0,c.Y)("div",{css:(0,p.AH)({border:`1px solid ${a.colors.border}`,borderRadius:a.legacyBorders.borderRadiusMd,padding:a.spacing.md},""),children:(0,c.Y)(Ae,{title:"",data:JSON.stringify(f,null,2),searchFilter:s,activeMatch:r,containsActiveMatch:x&&"outputs"===r.section})})})]})}function vs({activeSpan:e,className:t,searchFilter:s,activeMatch:n}){const{theme:r}=(0,l.u)();return!(0,h.isNil)(e)&&(0,i.vl)(e)?(0,c.Y)("div",{css:(0,p.AH)({overflowY:"auto",padding:r.spacing.md},""),className:t,"data-testid":"model-trace-explorer-content-tab",children:(0,c.Y)(fs,{activeSpan:e,className:t,searchFilter:s,activeMatch:n})}):(0,c.Y)("div",{css:(0,p.AH)({overflowY:"auto",padding:r.spacing.md},""),className:t,"data-testid":"model-trace-explorer-content-tab",children:(0,c.Y)(us,{activeSpan:e,className:t,searchFilter:s,activeMatch:n})})}function xs({activeSpan:e,searchFilter:t,activeMatch:s}){const{theme:n}=(0,l.u)(),{events:r}=e,a=!(0,h.isNil)(s)&&s.span.key===e.key;return Array.isArray(r)&&0!==r.length?(0,c.Y)("div",{css:(0,p.AH)({padding:n.spacing.md},""),children:r.map(((e,r)=>{const d=e.attributes,u="exception"===e.name?(0,c.FD)(c.FK,{children:[(0,c.Y)(o.XCircleIcon,{css:(0,p.AH)({marginRight:n.spacing.sm},""),color:"danger"}),(0,c.Y)(l.T.Text,{color:"error",bold:!0,children:"Exception"})]}):e.name;return d?(0,c.Y)(se,{sectionKey:e.name,title:u,withBorder:!0,children:(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm},""),children:Object.keys(d).map((n=>{const o=(0,i.Q0)(e.name,r,n);return(0,c.Y)(Ae,{title:n,data:JSON.stringify(d[n],null,2),searchFilter:t,activeMatch:s,containsActiveMatch:a&&"events"===s.section&&s.key===o,initialRenderMode:m.cC.TEXT},o)}))})},`${e.name}-${r}`):null}))}):(0,c.Y)("div",{css:(0,p.AH)({marginTop:n.spacing.md},""),children:(0,c.Y)(o.Empty,{description:(0,c.Y)(d.sA,{id:"xnr5KT",defaultMessage:"No events found"})})})}var ys=s(76127);function bs({activeSpan:e,searchFilter:t,activeMatch:s,activeTab:r,setActiveTab:a}){const{theme:u}=(0,l.u)(),[m,g]=(0,n.useState)(500),f={flex:1,marginTop:-u.spacing.md,overflowY:"auto"},{assessmentsPaneExpanded:v,assessmentsPaneEnabled:x,isInComparisonView:y}=I();if((0,h.isNil)(e))return(0,c.Y)(o.Empty,{description:"Please select a span to view more information"});const b=(0,i.N7)(e),Y=b>0,w=!(0,h.isNil)(null===e||void 0===e?void 0:e.inputs)||!(0,h.isNil)(null===e||void 0===e?void 0:e.outputs),A=(0,c.FD)(o.Tabs.Root,{componentId:"shared.model-trace-explorer.right-pane-tabs",css:(0,p.AH)({display:"flex",flexDirection:"column",flex:1,borderLeft:`1px solid ${u.colors.border}`,minWidth:200,position:"relative"},""),value:r,onValueChange:e=>a(e),children:[(0,c.Y)("div",{css:(0,p.AH)({position:"absolute",right:v?u.spacing.xs:u.spacing.md,top:u.spacing.xs},""),children:(0,c.Y)(Ke,{})}),(0,c.FD)(o.Tabs.List,{css:(0,p.AH)({padding:0,paddingLeft:u.spacing.md,paddingRight:u.spacing.sm,boxSizing:"border-box",width:"100%"},""),children:[e.chatMessages&&(0,c.Y)(o.Tabs.Trigger,{value:"chat",children:(0,c.Y)(d.sA,{id:"BkDhmT",defaultMessage:"Chat"})}),w&&(0,c.Y)(o.Tabs.Trigger,{value:"content",children:(0,c.Y)(d.sA,{id:"KW2dOC",defaultMessage:"Inputs / Outputs"})}),(0,c.Y)(o.Tabs.Trigger,{value:"attributes",children:"Attributes"}),(0,c.FD)(o.Tabs.Trigger,{value:"events",children:["Events ",Y&&(0,c.Y)(ys.X,{count:b})]})]}),e.chatMessages&&(0,c.Y)(o.Tabs.Content,{css:f,value:"chat",children:(0,c.Y)(ls,{chatMessages:e.chatMessages,chatTools:e.chatTools})}),(0,c.Y)(o.Tabs.Content,{css:f,value:"content",children:(0,c.Y)(vs,{activeSpan:e,searchFilter:t,activeMatch:s})}),(0,c.Y)(o.Tabs.Content,{css:f,value:"attributes",children:(0,c.Y)(os,{activeSpan:e,searchFilter:t,activeMatch:s})}),(0,c.Y)(o.Tabs.Content,{css:f,value:"events",children:(0,c.Y)(xs,{activeSpan:e,searchFilter:t,activeMatch:s})})]}),T=(0,c.Y)(es,{assessments:e.assessments,traceId:e.traceId,activeSpanId:e.parentId?String(e.key):void 0});return!y&&x&&v?(0,c.Y)(Ze,{initialRatio:.7,paneWidth:m,setPaneWidth:g,leftChild:A,leftMinWidth:250,rightChild:T,rightMinWidth:rt}):A}const Ys=n.memo(bs),ws=({spanFilterState:e,setSpanFilterState:t})=>{const{theme:s}=(0,l.u)();return(0,c.FD)(l.aw.Root,{componentId:"shared.model-trace-explorer.timeline-tree-filter-popover",children:[(0,c.Y)(l.aw.Trigger,{asChild:!0,children:(0,c.Y)(l.B,{componentId:"shared.model-trace-explorer.timeline-tree-filter-button",icon:(0,c.Y)(o.FilterIcon,{}),size:"small",children:(0,c.Y)(d.sA,{id:"Dm4Ez0",defaultMessage:"Filter"})})}),(0,c.Y)(l.aw.Content,{align:"start",children:(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:s.spacing.sm,paddingBottom:s.spacing.xs},""),children:[(0,c.Y)(l.T.Text,{bold:!0,children:(0,c.Y)(d.sA,{id:"oy2LTl",defaultMessage:"Filter"})}),(0,c.Y)(l.T.Text,{color:"secondary",children:(0,c.Y)(d.sA,{id:"rgSaFx",defaultMessage:"Span type"})}),Object.entries(e.spanTypeDisplayState).map((([n,r])=>{const a=(0,c.Y)(Te.P,{type:(0,i.tC)(n)});return(0,c.FD)(o.Checkbox,{componentId:"shared.model-trace-explorer.toggle-span-filter",style:{width:"100%"},isChecked:r,onChange:()=>t({...e,spanTypeDisplayState:{...e.spanTypeDisplayState,[n]:!r}}),children:[a,(0,c.Y)(l.T.Text,{css:(0,p.AH)({marginLeft:s.spacing.xs},""),children:(0,i.LS)(n)})]},n)})),(0,c.Y)(l.T.Text,{color:"secondary",children:(0,c.Y)(d.sA,{id:"SrV58C",defaultMessage:"Settings"})}),(0,c.FD)(o.Checkbox,{componentId:`shared.model-trace-explorer.toggle-show-parents_${!e.showParents}`,style:{width:"100%"},isChecked:e.showParents,onChange:()=>t({...e,showParents:!e.showParents}),children:[(0,c.Y)(l.T.Text,{css:(0,p.AH)({marginRight:s.spacing.xs},""),children:(0,c.Y)(d.sA,{id:"nYSJgH",defaultMessage:"Show all parent spans"})}),(0,c.Y)(o.InfoTooltip,{componentId:"shared.model-trace-explorer.show-parents-tooltip",content:(0,c.Y)(d.sA,{id:"H9MulE",defaultMessage:"Always show parents of matched spans, regardless of filter conditions"})})]}),(0,c.FD)(o.Checkbox,{componentId:`shared.model-trace-explorer.toggle-show-parents_${!e.showExceptions}`,style:{width:"100%"},isChecked:e.showExceptions,onChange:()=>t({...e,showExceptions:!e.showExceptions}),children:[(0,c.Y)(l.T.Text,{css:(0,p.AH)({marginRight:s.spacing.xs},""),children:(0,c.Y)(d.sA,{id:"/vhBCt",defaultMessage:"Show exceptions"})}),(0,c.Y)(o.InfoTooltip,{componentId:"shared.model-trace-explorer.show-exceptions-tooltip",content:(0,c.Y)(d.sA,{id:"60b0vW",defaultMessage:"Always show spans with exceptions, regardless of filter conditions"})})]})]})})]})},As=({showTimelineInfo:e,setShowTimelineInfo:t,spanFilterState:s,setSpanFilterState:n})=>{const{theme:r}=(0,l.u)();return(0,c.FD)("div",{css:(0,p.AH)({padding:`${r.spacing.xs}px ${r.spacing.sm}px`,paddingBottom:3,borderBottom:`1px solid ${r.colors.border}`,boxSizing:"border-box",paddingLeft:r.spacing.sm,alignItems:"center",display:"flex",justifyContent:"space-between"},""),children:[(0,c.Y)(l.T.Text,{bold:!0,children:(0,c.Y)(d.sA,{id:"w48V74",defaultMessage:"Trace breakdown"})}),(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",gap:r.spacing.sm},""),children:[(0,c.Y)(ws,{spanFilterState:s,setSpanFilterState:n}),(0,c.FD)(o.SegmentedControlGroup,{name:"size-story",value:e,onChange:e=>{t(e.target.value)},size:"small",componentId:"shared.model-trace-explorer.toggle-show-timeline",children:[(0,c.Y)(o.SegmentedControlButton,{"data-testid":"hide-timeline-info-button",icon:(0,c.Y)(C.T,{componentId:"shared.model-trace-explorer.hide-timeline-info-tooltip",content:(0,c.Y)(d.sA,{id:"E9fsRD",defaultMessage:"Show span tree"}),children:(0,c.Y)(o.ListBorderIcon,{})}),value:!1}),(0,c.Y)(o.SegmentedControlButton,{"data-testid":"show-timeline-info-button",icon:(0,c.Y)(C.T,{componentId:"shared.model-trace-explorer.show-timeline-info-tooltip",content:(0,c.Y)(d.sA,{id:"r5t1Je",defaultMessage:"Show execution timeline"}),children:(0,c.Y)(o.BarsAscendingVerticalIcon,{})}),value:!0})]})]})]})},Ts=({active:e})=>{const{theme:t}=(0,l.u)(),s=e?t.colors.blue500:t.colors.border;return(0,c.Y)("div",{css:(0,p.AH)({position:"absolute",left:"100%",bottom:0,width:S.De/2+1,height:t.spacing.md,boxSizing:"border-box",borderTopRightRadius:t.borders.borderRadiusMd,borderTop:`1px solid ${s}`,borderRight:`1px solid ${s}`,zIndex:S.u4.LOW},"")})},Ss=({active:e})=>{const{theme:t}=(0,l.u)(),s=e?t.colors.blue500:t.colors.border;return(0,c.Y)("div",{css:(0,p.AH)({position:"absolute",left:"50%",top:0,width:S.De/2,height:t.spacing.md,boxSizing:"border-box",borderBottomLeftRadius:t.borders.borderRadiusMd,borderBottom:`1px solid ${s}`,borderLeft:`1px solid ${s}`,zIndex:e?S.u4.NORMAL:S.u4.LOW},"")})},Ms=({active:e})=>{const{theme:t}=(0,l.u)(),s=e?t.colors.blue500:t.colors.border;return(0,c.Y)("div",{css:(0,p.AH)({position:"absolute",width:S.De/2,left:"50%",height:S.QJ,borderLeft:`1px solid ${s}`,boxSizing:"border-box",zIndex:e?S.u4.NORMAL:S.u4.LOW},"")})},Is=({isActiveSpan:e,isInActiveChain:t,linesToRender:s,hasChildren:n,isExpanded:r})=>0===s.length?(0,c.Y)("div",{css:(0,p.AH)({width:0,height:S.QJ,boxSizing:"border-box",position:"relative"},""),children:n&&(0,c.Y)(Ts,{active:t&&!e})}):(0,c.Y)(c.FK,{children:s.map((({shouldRender:a,isActive:i},o)=>(0,c.FD)("div",{css:(0,p.AH)({width:S.De,height:S.QJ,boxSizing:"border-box",position:"relative"},""),children:[a&&(0,c.Y)(Ms,{active:i}),o===s.length-1&&(0,c.FD)(c.FK,{children:[(0,c.Y)(Ss,{active:t}),n&&r&&(0,c.Y)(Ts,{active:t&&!e})]})]},o)))});var ks={name:"1fttcpj",styles:"display:flex;flex-direction:column"};const Ds=({span:e,children:t})=>{var s;const{theme:n}=(0,l.u)(),r=(0,i.tC)(null!==(s=e.type)&&void 0!==s?s:m.UG.UNKNOWN),a=n.isDarkMode?n.colors.grey800:n.colors.grey100,o=n.isDarkMode?n.colors.grey500:n.colors.grey350;return(0,c.Y)(C.T,{componentId:"shared.model-trace-explorer.timeline-tree-node-tooltip",hideWhenDetached:!1,content:(0,c.FD)("div",{css:ks,children:[(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",gap:n.spacing.xs,alignItems:"center",overflow:"hidden",wordBreak:"break-all"},""),children:[(0,c.Y)(Te.P,{type:r,isInTooltip:!0}),(0,c.Y)("span",{css:(0,p.AH)({color:a},""),children:e.title}),(0,c.Y)("span",{css:(0,p.AH)({marginLeft:n.spacing.xs,color:o,fontSize:n.typography.fontSizeSm},""),children:(0,S.X6)(e.end-e.start)})]}),(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",color:a},""),children:[(0,c.Y)(d.sA,{id:"YV6xFB",defaultMessage:"Start:"})," ",(0,S.X6)(e.start)," | ",(0,c.Y)(d.sA,{id:"q90jVU",defaultMessage:"End:"})," ",(0,S.X6)(e.end)]})]}),side:"right",maxWidth:700,children:t})};var Cs={name:"18mz9c1",styles:"display:flex;flex-direction:row;align-items:center;overflow:hidden;flex:1"},Es={name:"adzntw",styles:"overflow:hidden;white-space:nowrap;text-overflow:ellipsis;flex:1"};const Ns=({node:e,selectedKey:t,expandedKeys:s,setExpandedKeys:n,traceStartTime:r,traceEndTime:a,onSelect:d,linesToRender:u})=>{var m,h;const g=s.has(e.key),{theme:f}=(0,l.u)(),v=(null!==(m=e.children)&&void 0!==m?m:[]).length>0,{setAssessmentsPaneExpanded:x}=I(),y=t===e.key,b=(0,S.VD)(e,String(t)),Y=b>-1,w=(0,i.N7)(e)>0,A=y?f.colors.actionDefaultBackgroundHover:"transparent";return(0,c.FD)(c.FK,{children:[(0,c.Y)(Ds,{span:e,children:(0,c.Y)("div",{"data-testid":`timeline-tree-node-${e.key}`,css:(0,p.AH)({display:"flex",flexDirection:"column",width:"100%",cursor:"pointer",boxSizing:"border-box",backgroundColor:A,":hover":{backgroundColor:f.colors.actionDefaultBackgroundHover},":active":{backgroundColor:f.colors.actionDefaultBackgroundPress}},""),onClick:()=>{null===d||void 0===d||d(e)},children:(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",alignItems:"center",padding:`0px ${f.spacing.sm}px`,justifyContent:"space-between",overflow:"hidden",flex:1},""),children:(0,c.FD)("div",{css:Cs,children:[v?(0,c.Y)(l.B,{size:"small","data-testid":`toggle-span-expanded-${e.key}`,css:(0,p.AH)({flexShrink:0,marginRight:f.spacing.xs},""),icon:g?(0,c.Y)(o.ChevronDownIcon,{}):(0,c.Y)(l.o,{}),onClick:t=>{t.stopPropagation();const r=new Set(s);g?r.delete(e.key):r.add(e.key),n(r)},componentId:"shared.model-trace-explorer.toggle-span"}):(0,c.Y)("div",{css:(0,p.AH)({width:24,marginRight:f.spacing.xs},"")}),(0,c.Y)(Is,{isActiveSpan:y,isInActiveChain:Y,linesToRender:u,hasChildren:v,isExpanded:g}),(0,c.Y)("span",{css:(0,p.AH)({flexShrink:0,marginRight:f.spacing.xs,borderRadius:f.borders.borderRadiusSm,border:`1px solid ${b>-1?f.colors.blue500:f.colors.backgroundSecondary}`,zIndex:S.u4.NORMAL},""),children:e.icon}),(0,c.Y)(l.T.Text,{color:w?"error":"primary",css:Es,children:e.title}),e.assessments.length>0&&(0,c.FD)(o.Tag,{color:"indigo","data-testid":`assessment-tag-${e.key}`,componentId:"shared.model-trace-explorer.assessment-count",css:(0,p.AH)({margin:0,borderRadius:f.borders.borderRadiusSm},""),onClick:()=>null===x||void 0===x?void 0:x(!0),children:[(0,c.Y)(o.GavelIcon,{}),(0,c.Y)(l.T.Text,{css:(0,p.AH)({marginLeft:f.spacing.xs},""),children:e.assessments.length})]})]})})})}),g&&(null===(h=e.children)||void 0===h?void 0:h.map(((i,o)=>{var l,p;return(0,c.Y)(Ns,{node:i,expandedKeys:s,setExpandedKeys:n,selectedKey:t,traceStartTime:r,traceEndTime:a,onSelect:d,linesToRender:u.concat({shouldRender:o<(null!==(l=null===(p=e.children)||void 0===p?void 0:p.length)&&void 0!==l?l:0)-1,isActive:o<b})},i.key)})))]})};var Fs={name:"1j2qjqs",styles:"flex:1;overflow:hidden;white-space:nowrap;text-overflow:ellipsis"};const Rs=({node:e,selectedKey:t,leftOffset:s,width:r,onSelect:a,expandedKeys:i,setExpandedKeys:d})=>{var u;const{theme:m}=(0,l.u)(),h=(0,n.useRef)(null),g=(0,n.useRef)(null),f=t===e.key?m.colors.actionDefaultBackgroundHover:"transparent",v=(null!==(u=e.children)&&void 0!==u?u:[]).length>0,x=i.has(e.key);return(0,n.useLayoutEffect)((()=>{if(!h.current||!g.current)return;Math.max(h.current.offsetWidth,g.current.offsetWidth)<r-m.spacing.sm?(h.current.style.display="inline",g.current.style.display="none"):(h.current.style.display="none",g.current.style.display="inline")}),[m.spacing.sm,r]),(0,c.Y)(Ds,{span:e,children:(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",cursor:"pointer",boxSizing:"border-box",paddingLeft:m.spacing.xs,paddingRight:m.spacing.sm,paddingTop:m.spacing.xs,paddingBottom:m.spacing.xs,backgroundColor:f,alignItems:"center",":hover":{backgroundColor:m.colors.actionDefaultBackgroundHover},":active":{backgroundColor:m.colors.actionDefaultBackgroundPress},zIndex:S.u4.NORMAL},""),onClick:()=>null===a||void 0===a?void 0:a(e),children:[v?(0,c.Y)(l.B,{size:"small","data-testid":`toggle-timeline-span-expanded-${e.key}`,css:(0,p.AH)({flexShrink:0,marginRight:m.spacing.xs},""),icon:x?(0,c.Y)(o.ChevronDownIcon,{}):(0,c.Y)(l.o,{}),onClick:t=>{t.stopPropagation();const s=new Set(i);x?s.delete(e.key):s.add(e.key),d(s)},componentId:"shared.model-trace-explorer.toggle-timeline-span"}):(0,c.Y)("div",{css:(0,p.AH)({width:24,marginRight:m.spacing.xs},"")}),(0,c.Y)("div",{css:(0,p.AH)({width:s,flexShrink:0},"")}),(0,c.Y)("div",{css:(0,p.AH)({position:"relative",width:r,height:m.typography.lineHeightBase,backgroundColor:m.colors.blue600,borderRadius:m.borders.borderRadiusSm,flexShrink:0},""),children:(0,c.Y)(l.T.Text,{children:(0,c.Y)("span",{ref:h,css:(0,p.AH)({marginLeft:m.spacing.xs,color:m.colors.white,display:"none"},""),children:e.title})})}),(0,c.FD)("div",{css:Fs,children:[(0,c.Y)(l.T.Text,{children:(0,c.Y)("span",{ref:g,css:(0,p.AH)({marginLeft:m.spacing.xs,color:m.colors.textPrimary},""),children:e.title})}),(0,c.Y)(l.T.Text,{css:(0,p.AH)({marginLeft:m.spacing.xs},""),color:"secondary",children:(0,S.X6)(e.end-e.start)})]})]},e.key)})};var Hs={name:"1c2ejnx",styles:"display:flex;flex-direction:column;position:relative;box-sizing:border-box"},Ls={name:"bjn8wh",styles:"position:relative"},_s={name:"xyyuvf",styles:"position:absolute;height:100%;width:100%"};const Os=({nodes:e,selectedKey:t,onSelect:s,traceStartTime:r,traceEndTime:a,expandedKeys:i,setExpandedKeys:o})=>{var d,u;const{theme:m}=(0,l.u)(),h=(0,n.useRef)(null),g=null!==(d=null===(u=(0,qe.wY)({ref:h}))||void 0===u?void 0:u.width)&&void 0!==d?d:0,f=(0,n.useMemo)((()=>function(e,t,s,n=60){const r=t-e;if(r<=0||s<=0)return[];const a=Math.floor(s/n);if(a<1)return[];const i=r/a,o=Math.pow(10,Math.floor(Math.log10(i))),l=i/o;let d;d=l<=1?1:l<=2?2:l<=5?5:10;const c=d*o,u=t+2*c,p=[];for(let m=Math.ceil(e/c)*c;m<=u;m+=c)p.push(Number(m.toFixed(10)));return p}(r,a,g)),[a,r,g]),v=Math.min(...f),x=(f[f.length-1]+f[f.length-2])/2,y=f.slice(0,-1),b=e=>function(e,t,s,n){return(e-t)/(s-t)*n}(e,v,x,g);return(0,c.FD)("div",{css:Hs,children:[(0,c.Y)("div",{ref:h,css:(0,p.AH)({display:"flex",width:"100%",flexDirection:"row",height:m.typography.lineHeightBase,paddingLeft:32,paddingRight:m.spacing.lg,boxSizing:"border-box",position:"sticky",top:0,backgroundColor:m.colors.backgroundPrimary,zIndex:S.u4.HIGH},""),children:(0,c.Y)("div",{"data-testid":"time-marker-area",css:Ls,children:y.map((e=>(0,c.Y)(l.T.Text,{css:(0,p.AH)({position:"absolute",transform:"translateX(-50%)",left:b(e),whiteSpace:"nowrap"},""),children:(0,S.X6)(e)},e)))})}),(0,c.Y)("div",{css:(0,p.AH)({flex:1,pointerEvents:"none",zIndex:S.u4.LOW},""),children:(0,c.Y)("div",{css:_s,children:y.map((e=>(0,c.Y)("div",{css:(0,p.AH)({position:"absolute",left:b(e)+32,borderRight:`1px solid ${m.colors.border}`,height:"100%"},"")},e)))})}),e.map((e=>{const n=b(e.start),r=b(e.end)-n;return(0,c.Y)(Rs,{selectedKey:t,onSelect:s,node:e,leftOffset:n,width:r,expandedKeys:i,setExpandedKeys:o},e.key)}))]})};var Bs={name:"1v8q7xf",styles:"flex:1;overflow:auto;min-height:100%;box-sizing:border-box;display:flex;flex-direction:column"},zs={name:"1jyk3dc",styles:"overflow:hidden;display:flex;flex-direction:column;flex:1"},$s={name:"13ku56z",styles:"display:flex;flex-direction:column;height:100%"},js={name:"9nf0yq",styles:"flex:1;overflow-y:auto;display:flex"};const Vs=({rootNodes:e,selectedNode:t,setSelectedNode:s,traceStartTime:r,traceEndTime:a,expandedKeys:i,setExpandedKeys:o,spanFilterState:u,setSpanFilterState:m,className:h})=>{const{theme:g}=(0,l.u)(),f=(0,n.useCallback)((e=>{null===s||void 0===s||s(e)}),[s]),{showTimelineTreeGantt:v,setShowTimelineTreeGantt:x}=I(),y=(0,n.useMemo)((()=>(0,S.os)(e,i)),[e,i]),b=(0,n.useMemo)((()=>{var s;return(0,c.Y)("div",{css:Bs,children:v?(0,c.Y)(Os,{nodes:y,selectedKey:null!==(s=null===t||void 0===t?void 0:t.key)&&void 0!==s?s:"",onSelect:f,traceStartTime:r,traceEndTime:a,expandedKeys:i,setExpandedKeys:o}):e.map((e=>{var s;return(0,c.Y)(Ns,{node:e,expandedKeys:i,setExpandedKeys:o,selectedKey:null!==(s=null===t||void 0===t?void 0:t.key)&&void 0!==s?s:"",traceStartTime:r,traceEndTime:a,onSelect:f,linesToRender:[]},e.key)}))})}),[v,y,null===t||void 0===t?void 0:t.key,f,r,a,e,i,o]);return(0,c.Y)("div",{css:(0,p.AH)({height:"100%",borderRadius:g.legacyBorders.borderRadiusMd,overflow:"hidden",display:"flex"},""),className:h,children:(0,c.Y)("div",{css:zs,children:(0,c.FD)("div",{css:$s,children:[(0,c.Y)(As,{showTimelineInfo:v,setShowTimelineInfo:x,spanFilterState:u,setSpanFilterState:m}),e.length>0?(0,c.Y)("div",{css:js,children:b}):(0,c.Y)("div",{css:(0,p.AH)({flex:1,display:"flex",justifyContent:"center",padding:g.spacing.md,paddingTop:g.spacing.lg},""),children:(0,c.Y)(d.sA,{id:"4pXg9j",defaultMessage:"No results found. Try using a different search term."})})]})})})};var Ps={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"},Us={name:"82a6rk",styles:"flex:1"};const Ks=({modelTraceInfo:e,className:t,selectedSpanId:s,onSelectSpan:r})=>{const{theme:a}=(0,l.u)(),i=window.innerWidth<=768?.33:.25,o=(0,n.useRef)(null),[d,u]=(0,n.useState)(500),{selectedNode:m,setSelectedNode:g,activeTab:f,setActiveTab:v,isInComparisonView:x,topLevelNodes:y}=I(),{expandedKeys:b,setExpandedKeys:Y}=(0,S.B$)({rootNodes:y,initialExpandDepth:S.vf}),{matchData:w,searchFilter:A,setSearchFilter:T,spanFilterState:M,setSpanFilterState:k,filteredTreeNodes:D,handleNextSearchMatch:C,handlePreviousSearchMatch:E}=is({treeNodes:y,selectedNode:m,setSelectedNode:g,setActiveTab:v,setExpandedKeys:Y,modelTraceInfo:e});(0,n.useLayoutEffect)((()=>{const e=(0,h.values)((0,S.dM)(D,S.vf)).map((e=>e.key));Y(new Set(e))}),[D,Y]);const N=(0,n.useMemo)((()=>{const e=Math.max(...D.map(S.EA))*S.De+7*a.spacing.lg;return Math.max(275,e)}),[D,a.spacing.lg]),{traceStartTime:F,traceEndTime:R}=(0,n.useMemo)((()=>{if(!y||0===y.length)return{traceStartTime:0,traceEndTime:0};return{traceStartTime:Math.min(...y.map((e=>e.start))),traceEndTime:Math.max(...y.map((e=>e.end)))}}),[y]);return(0,c.FD)("div",{css:Ps,className:t,children:[(0,c.Y)("div",{css:(0,p.AH)({padding:a.spacing.xs,borderBottom:`1px solid ${a.colors.border}`},""),children:(0,c.Y)(rs,{searchFilter:A,setSearchFilter:T,matchData:w,handleNextSearchMatch:C,handlePreviousSearchMatch:E})}),(0,c.Y)(Ze,{ref:o,initialRatio:i,paneWidth:d,setPaneWidth:u,leftChild:(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",flex:1,minWidth:N},""),children:(0,c.Y)(Vs,{rootNodes:D,selectedNode:m,traceStartTime:F,traceEndTime:R,setSelectedNode:e=>{g(e),(0,h.isString)(null===e||void 0===e?void 0:e.key)&&(null===r||void 0===r||r(null===e||void 0===e?void 0:e.key))},css:Us,expandedKeys:b,setExpandedKeys:Y,spanFilterState:M,setSpanFilterState:k})}),leftMinWidth:N,rightChild:(0,c.Y)(Ys,{activeSpan:m,searchFilter:A,activeMatch:w.match,activeTab:f,setActiveTab:v}),rightMinWidth:500})]})};var Ws={name:"3epor4",styles:"& > div:nth-of-type(1){margin-bottom:0;flex-shrink:0;}display:flex;flex-direction:column;height:100%;overflow:hidden"},Gs={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"},qs={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"};const Js=({modelTraceInfo:e,className:t,selectedSpanId:s,onSelectSpan:r})=>{const{theme:a}=(0,l.u)(),{activeView:i,setActiveView:u,rootNode:m}=I(),h=(0,n.useCallback)((e=>{u(e)}),[u]);return(0,c.FD)(o.Tabs.Root,{componentId:"shared.model-trace-explorer.view-mode-toggle",value:i,onValueChange:h,css:Ws,children:[(0,c.FD)(o.Tabs.List,{css:(0,p.AH)({paddingLeft:a.spacing.md,flexShrink:0},""),children:[m&&(0,c.Y)(o.Tabs.Trigger,{value:"summary",children:(0,c.Y)(d.sA,{id:"paolVF",defaultMessage:"Summary"})}),(0,c.Y)(o.Tabs.Trigger,{value:"detail",children:(0,c.Y)(d.sA,{id:"Wh+aKq",defaultMessage:"Details & Timeline"})})]}),(0,c.Y)(o.Tabs.Content,{value:"summary",css:Gs,children:(0,c.Y)(ts,{})}),(0,c.Y)(o.Tabs.Content,{value:"detail",css:qs,children:(0,c.Y)(Ks,{modelTraceInfo:e,className:t,selectedSpanId:s,onSelectSpan:r})})]})};var Xs={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"};const Qs=({modelTraceInfo:e,className:t,selectedSpanId:s,onSelectSpan:n})=>{var r,a,i;const{theme:u}=(0,l.u)(),{assessmentsPaneEnabled:m,assessmentsPaneExpanded:h,setAssessmentsPaneExpanded:g,rootNode:f,selectedNode:v}=I();return(0,c.FD)("div",{css:Xs,children:[(0,c.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",gap:u.spacing.xs,padding:`0px ${u.spacing.sm}px`,marginBottom:u.spacing.xs},""),children:[(0,c.Y)(l.B,{size:"small",componentId:"shared.model-trace-explorer.toggle-assessments-pane",icon:h?(0,c.Y)(o.ChevronDownIcon,{}):(0,c.Y)(l.o,{}),onClick:()=>g(!h)}),(0,c.Y)(l.T.Text,{bold:!0,children:(0,c.Y)(d.sA,{id:"++Ydlz",defaultMessage:"Assessments"})})]}),m&&h&&(0,c.Y)("div",{css:(0,p.AH)({marginBottom:u.spacing.sm,padding:u.spacing.sm,paddingTop:0},""),children:(0,c.Y)(es,{assessments:null!==(r=null===f||void 0===f?void 0:f.assessments)&&void 0!==r?r:[],traceId:null!==(a=null===f||void 0===f?void 0:f.traceId)&&void 0!==a?a:"",activeSpanId:null!==(i=null===v||void 0===v?void 0:v.key)&&void 0!==i?i:""})}),(0,c.Y)(Js,{modelTraceInfo:e,className:t,selectedSpanId:s,onSelectSpan:n})]})},Zs=({children:e})=>(0,c.Y)(r.tH,{fallbackRender:u,children:e}),en=({modelTrace:e,className:t,initialActiveView:s,selectedSpanId:r,onSelectSpan:o,collapseAssessmentPane:l,isInComparisonView:d})=>{var u,p,m,h;const[g,f]=(0,n.useState)(e),[v,x]=(0,n.useState)(!1),y=(0,i.MF)(e),b=null!==(u=(0,i.ob)(e))&&void 0!==u?u:0,Y=!(0,a.ny)()||b<(0,a.T9)(),w=null!==(p=null===(m=e.data)||void 0===m||null===(h=m.spans)||void 0===h?void 0:h.length)&&void 0!==p?p:0,[A,S]=(0,n.useState)(y.startsWith("tr-")),[M,I]=(0,n.useState)(!0),{isFetching:D}=(({traceId:e,setModelTrace:t,setAssessmentsPaneEnabled:s,enabled:r=!0})=>{const o=[i.BS,e],l=(0,Z.M)(),d=(0,n.useMemo)((()=>(0,a.F9)()&&!e.startsWith("tr-")?r&&l.modelTraceInfo&&(0,i.gD)(l.modelTraceInfo):r&&e.startsWith("tr-")),[r,e,l.modelTraceInfo]);return(0,X.I)({queryKey:o,queryFn:()=>{var t;return(0,a.F9)()&&l.modelTraceInfo&&(0,i.gD)(l.modelTraceInfo)&&!e.startsWith("tr-")?Q._A.getTraceInfoV4({traceId:e,traceLocation:null===(t=l.modelTraceInfo)||void 0===t?void 0:t.trace_location}):(0,Q.N5)({traceId:e})},onSuccess:e=>{var n;const r=(0,i.gD)(e)?e:null===e||void 0===e||null===(n=e.trace)||void 0===n?void 0:n.trace_info;t((e=>({data:e.data,info:null!==r&&void 0!==r?r:{}}))),s(!0)},onError:()=>{s(!1)},enabled:d,refetchOnWindowFocus:!1,refetchOnMount:"always"})})({traceId:y,setModelTrace:f,setAssessmentsPaneEnabled:S,enabled:Y}),C=M&&D;(0,n.useEffect)((()=>{f(e),I(!0)}),[y,w]),(0,n.useEffect)((()=>{M&&!D&&I(!1)}),[M,D]);const E=ee((e=>e.resetCache));return(0,n.useEffect)((()=>{E()}),[E]),Y||v?(0,c.Y)(Zs,{traceId:y,children:(0,c.FD)(k,{modelTrace:g,initialActiveView:s,selectedSpanIdOnRender:r,assessmentsPaneEnabled:A,isInComparisonView:d,initialAssessmentsPaneCollapsed:l,isTraceInitialLoading:C,children:[(0,c.Y)(J,{modelTraceInfo:g.info}),d?(0,c.Y)(Qs,{modelTraceInfo:g.info}):(0,c.Y)(Js,{modelTraceInfo:g.info,className:t,selectedSpanId:r,onSelectSpan:o})]})}):(0,c.Y)(T,{traceId:y,setForceDisplay:x})};const tn=(e,t)=>{const s=new URLSearchParams;return s.append("selectedTraceId",e),s.append("compareRunsMode","TRACES"),`/#/experiments/${t}?${s.toString()}`};var sn={name:"1elrbzk",styles:"width:calc(100% - 2px)"},nn={name:"inxa61",styles:"flex:1;overflow:hidden"};const rn=()=>{const e=(0,n.useMemo)((()=>new URLSearchParams(window.location.search).getAll("trace_id")),[]),t=(0,n.useMemo)((()=>new URLSearchParams(window.location.search).getAll("experiment_id")),[]),[s,r]=(0,n.useState)(e.length>0?0:null),[a,i]=(0,n.useState)(null),[u,m]=(0,n.useState)(!0),[h,g]=(0,n.useState)(null),{theme:f}=(0,l.u)();return(0,n.useEffect)((()=>{(async()=>{if(null===s)return;m(!0);const t=e[s],n=await on(t);"string"===typeof n?g(n):i(n),m(!1)})()}),[s,e]),0===e.length||null===s?null:u?(0,c.Y)("div",{css:sn,children:(0,c.Y)(l.T.Text,{color:"secondary",children:(0,c.Y)(d.sA,{id:"JJFZ1V",defaultMessage:"Fetching trace data..."})})}):a?(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",border:`1px solid ${f.colors.border}`,height:"calc(100% - 2px)"},""),children:[(0,c.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",justifyContent:"space-between",padding:`${f.spacing.xs}px ${f.spacing.md}px`},""),children:[(0,c.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",gap:f.spacing.sm},""),children:[(0,c.Y)(l.T.Title,{level:4,withoutMargins:!0,children:"MLflow Trace UI"}),(0,c.Y)(o.InfoTooltip,{componentId:"mlflow.notebook.trace-ui-info",iconTitle:"More information",maxWidth:400,content:(0,c.Y)(d.sA,{id:"LED2z5",defaultMessage:"To disable or enable this display, call {disableFunction} or {enableFunction} and re-run the cell",values:{disableFunction:(0,c.Y)("code",{children:"mlflow.tracing.disable_notebook_display()"}),enableFunction:(0,c.Y)("code",{children:"mlflow.tracing.enable_notebook_display()"})}})}),(0,c.Y)(l.T.Link,{componentId:"mlflow.notebook.trace-ui-learn-more-link",href:"https://mlflow.org/docs/latest/llms/tracing/index.html?ref=jupyter-notebook-widget",openInNewTab:!0,title:"Learn More",children:(0,c.Y)(d.sA,{id:"uIY1qq",defaultMessage:"Learn More"})})]}),(0,c.Y)(l.T.Link,{componentId:"mlflow.notebook.trace-ui-see-in-mlflow-link",href:tn(e[s],t[s]),openInNewTab:!0,title:"View in MLflow UI",children:(0,c.Y)(d.sA,{id:"4NyhOm",defaultMessage:"View in MLflow UI"})})]}),e.length>1&&(0,c.Y)(o.Pagination,{componentId:"mlflow.notebook.pagination",currentPageIndex:s+1,dangerouslySetAntdProps:{showQuickJumper:!0},numTotal:e.length,onChange:e=>r(e-1),pageSize:1,style:{marginBottom:f.spacing.sm,paddingLeft:f.spacing.sm,paddingRight:f.spacing.sm}}),(0,c.Y)("div",{css:nn,children:(0,c.Y)(en,{modelTrace:a,initialActiveView:"detail"})})]}):(0,c.Y)("div",{css:(0,p.AH)({paddingTop:f.spacing.md,width:"calc(100% - 2px)"},""),children:(0,c.Y)(o.Empty,{image:(0,c.Y)(l.k,{}),description:(0,c.FD)(c.FK,{children:[(0,c.Y)(l.T.Paragraph,{children:(0,c.Y)(d.sA,{id:"UD4Z+e",defaultMessage:"An error occurred while attempting to fetch trace data (ID: {traceId}). Please ensure that the MLflow tracking server is running, and that the trace data exists. Error details:",values:{traceId:e[s]}})}),h&&(0,c.Y)(l.T.Paragraph,{children:h})]}),title:(0,c.Y)(d.sA,{id:"md81Lo",defaultMessage:"Error"})})})};var an=s(33120);async function on(e){try{const t=await fetch((0,an.we)(`ajax-api/2.0/mlflow/get-trace-artifact?request_id=${e}`)),s=await t.text(),n=JSON.parse(s);return n.spans?{info:{request_id:e},data:n}:n.error_code?n.message:"Unknown error occurred"}catch(t){return t instanceof Error?t.message:"string"===typeof t?t:"Unknown error occurred"}}s(97407)},36476:function(e,t,s){s.d(t,{a$:function(){return l}});var n=s(40724);let r=function(e){return e.UserInputError="UserInputError",e.UnexpectedSystemStateError="UnexpectedSystemStateError",e.ServerError="ServerError",e.SessionError="SessionError",e.NetworkError="NetworkError",e.ApplicationError="ApplicationError",e.UnknownError="UnknownError",e}({}),a=function(e){return e.BadRequestError="BadRequestError",e.DatasetRunNotFoundError="DatasetRunNotFoundError",e.FormValidationError="FormInputError",e.GenericNetworkRequestError="GenericNetworkRequestError",e.GraphQLGenericError="GraphQLGenericError",e.InternalServerError="InternalServerError",e.NotFoundError="NotFoundError",e.PermissionError="PermissionError",e.RateLimitedError="RateLimitedError",e.RouteNotFoundError="RouteNotFoundError",e.ScorerTransformationError="ScorerTransformationError",e.ServiceUnavailableError="ServiceUnavailableError",e.UnauthorizedError="UnauthorizedError",e.UnknownError="UnknownError",e}({});var i=s(73408);class o extends Error{constructor(e,t){super(e),this.errorLogType=void 0,this.errorName=void 0,this.displayMessage=void 0,this.isUserError=!1}}const l=e=>e instanceof o?e:e instanceof Error&&("networkError"in e||"graphQLErrors"in e)?d(e):e instanceof Response?c(e):new Y(e);const d=e=>{return"networkError"in e&&((t=e.networkError)instanceof Error&&t.hasOwnProperty("response"))?c(e.networkError.response,e.networkError):new m(e);var t},c=(e,t)=>{const s=u.getNetworkRequestErrorDetailsFromResponse(e);switch(e.status){case 400:return new h(s,t);case 401:return new b(s,t);case 403:return new v(s,t);case 404:return new f(s,t);case 429:return new x(s,t);case 500:return new g(s,t);case 503:return new y(s,t);default:return new p(s,t)}};class u extends o{constructor(e,t,s){super(e,s),this.status=void 0,this.response=void 0,this.status=t.status,this.response=t.response}}u.getNetworkRequestErrorDetailsFromResponse=e=>({status:e.status});class p extends u{constructor(e,t){super("A network error occurred.",e,t),this.errorLogType=r.ServerError,this.errorName=a.GenericNetworkRequestError,this.displayMessage=(0,i.Y)(n.A,{id:"/CaNq/",defaultMessage:"A network error occurred."})}}class m extends o{constructor(e){super("A GraphQL error occurred.",e),this.errorLogType=r.ApplicationError,this.errorName=a.GraphQLGenericError,this.displayMessage=(0,i.Y)(n.A,{id:"PPPbd+",defaultMessage:"A GraphQL error occurred."})}}class h extends u{constructor(e,t){super("The request was invalid.",e,t),this.errorLogType=r.UserInputError,this.errorName=a.BadRequestError,this.displayMessage=(0,i.Y)(n.A,{id:"Id2mFI",defaultMessage:"The request was invalid."})}}class g extends u{constructor(e,t){super("Internal server error",e,t),this.errorLogType=r.ServerError,this.errorName=a.InternalServerError,this.displayMessage=(0,i.Y)(n.A,{id:"nY1YrF",defaultMessage:"Internal server error"})}}class f extends u{constructor(e,t){super("The requested resource was not found.",e,t),this.errorLogType=r.UserInputError,this.errorName=a.NotFoundError,this.displayMessage=(0,i.Y)(n.A,{id:"R3Lb6z",defaultMessage:"The requested resource was not found."}),this.isUserError=!0}}class v extends u{constructor(e,t){super("You do not have permission to access this resource.",e,t),this.errorLogType=r.UnexpectedSystemStateError,this.errorName=a.PermissionError,this.displayMessage=(0,i.Y)(n.A,{id:"G6IQTa",defaultMessage:"You do not have permission to access this resource."}),this.isUserError=!0}}class x extends u{constructor(e,t){super("This request exceeds the maximum queries per second limit. Please wait and try again.",e,t),this.errorLogType=r.ServerError,this.errorName=a.RateLimitedError,this.displayMessage=(0,i.Y)(n.A,{id:"5PlfiT",defaultMessage:"This request exceeds the maximum queries per second limit. Please wait and try again."})}}class y extends u{constructor(e,t){super("Internal server error",e,t),this.errorLogType=r.ServerError,this.errorName=a.InternalServerError,this.displayMessage=(0,i.Y)(n.A,{id:"/XlqZA",defaultMessage:"Service unavailable error"})}}class b extends u{constructor(e,t){super("This request exceeds the maximum queries per second limit. Please wait and try again.",e,t),this.errorLogType=r.SessionError,this.errorName=a.UnauthorizedError,this.displayMessage=(0,i.Y)(n.A,{id:"gqfk5C",defaultMessage:"User is not authorized."})}}class Y extends o{constructor(e){super("An unknown error occurred.",e),this.errorLogType=r.UnknownError,this.errorName=a.UnknownError,this.displayMessage=(0,i.Y)(n.A,{id:"bKSd3c",defaultMessage:"An unknown error occurred."})}}},44072:function(e,t,s){s(46709),s(38815)},44105:function(e,t,s){s.d(t,{hb:function(){return a}});let n=function(e){return e.ACTIVE="Active",e.DELETED="Deleted",e}({}),r=function(e){return e.WITH_MODEL_VERSIONS="With Model Versions",e.WTIHOUT_MODEL_VERSIONS="Without Model Versions",e.ALL_RUNS="All Runs",e}({});n.ACTIVE,r.ALL_RUNS,new Date("2030-06-24T00:00:00");const a="selectedTraceId"},49633:function(e,t,s){s.d(t,{wY:function(){return n.w}});s(46709),s(69103);var n=s(27925);s(53637)},53637:function(e,t,s){s(46709)},73879:function(e,t,s){s.d(t,{V:function(){return Y}});var n=s(46709),r=s(87562),a=s(22534),i=s(27757),o=s(27299),l=s(19112),d=s(68248),c=s(20027),u=s(73408);var p={name:"1qmr6ab",styles:"overflow:auto"},m={name:"uufhp1",styles:"height:auto;min-height:initial;display:inline-flex;min-width:100%;z-index:0"};const h=({children:e})=>(0,u.Y)("div",{"data-testid":"basic-table",css:p,children:(0,u.Y)(o.Table,{scrollable:!0,css:m,children:e})}),g=({children:e,node:t})=>{const{header:s,rows:r,isValid:a}=function({children:e}){var t;if(!e)return{header:void 0,rows:[],isValid:!1};const s=n.Children.toArray(e);return{header:null!==(t=s[0])&&void 0!==t?t:void 0,rows:s.slice(1).flatMap((e=>n.isValidElement(e)?n.Children.toArray(e.props.children).filter((e=>n.isValidElement(e))):[])),isValid:!0}}({children:e,node:t});return a?(0,u.Y)(v,{header:s,rows:r}):(0,u.Y)(h,{children:e,node:t})};var f={name:"qneu98",styles:"height:auto;min-height:initial;display:inline-flex;min-width:100%"};const v=({header:e,rows:t})=>{const{theme:s}=(0,i.u)(),r=n.useRef(null),a=(0,c.z)({size:t.length,parentRef:r,overscan:20}),{virtualItems:l,totalSize:p}=a;return(0,u.Y)("div",{"data-testid":"virtualized-table",ref:r,css:(0,d.AH)({overflow:"auto",maxHeight:420,border:"1px solid",borderColor:s.colors.border,borderRadius:s.borders.borderRadiusMd,marginBottom:s.spacing.md,zIndex:0},""),children:(0,u.FD)(o.Table,{css:f,children:[e,(0,u.Y)("div",{css:(0,d.AH)({position:"relative",height:`${p}px`,width:"100%",'& > div:last-child [role="cell"]':{borderBottom:"none"}},""),children:l.map((e=>{const s=e.index,n=t[s];return(0,u.Y)("div",{ref:e.measureRef,css:(0,d.AH)({position:"absolute",top:`${e.start}px`,width:"100%"},""),children:n},s)}))})]})})},x=({children:e,node:t})=>{const s=null===t||void 0===t?void 0:t.children.some((e=>"th"===e.tagName)),{theme:n}=(0,i.u)();return(0,u.Y)(o.TableRow,{style:s?{position:"sticky",top:0,zIndex:1,backgroundColor:n.colors.backgroundPrimary}:void 0,children:e,isHeader:s})},y=({children:e,node:t})=>{const s="th"===(null===t||void 0===t?void 0:t.tagName),{theme:n}=(0,i.u)();return s?(0,u.Y)(o.TableHeader,{"data-testid":"virtualized-table-header",componentId:"virtualized-table-header",css:(0,d.AH)({paddingLeft:n.spacing.sm,borderColor:n.colors.border,color:n.colors.textPrimary},""),children:e}):(0,u.Y)(o.TableCell,{children:e})};const b=e=>e.startsWith("data:image/png")||e.startsWith("data:image/jpeg")?e:(0,r.Lv)(e),Y=e=>{const t=(0,n.useMemo)((()=>k({extensions:e.components})),[e.components]);return(0,u.Y)(r.oz,{components:t,remarkPlugins:M,urlTransform:b,children:e.children})},w=({codeBlock:e,codeInline:t,node:s,...r})=>{var a,i;const o=n.useMemo((()=>{var e;const t=/language-(\w+)/.exec(null!==(e=r.className)&&void 0!==e?e:"");return t&&t[1]?t[1]:void 0}),[r.className]);return(null===s||void 0===s||null===(a=s.position)||void 0===a?void 0:a.start.line)===(null===s||void 0===s||null===(i=s.position)||void 0===i?void 0:i.end.line)?n.createElement(t,r):n.createElement(e,{...r,language:o})},A=({children:e})=>(0,u.Y)(i.T.Text,{code:!0,children:e});var T={name:"bjn8wh",styles:"position:relative"};const S=n.memo((({children:e,language:t})=>{const{theme:s}=(0,i.u)(),n=String(e).replace(/\n$/,"");return(0,u.Y)("div",{css:T,children:(0,u.Y)(l.z7,{actions:(0,u.Y)(l.VE,{componentId:"genai.util.markdown-copy-code-block",copyText:n}),theme:s.isDarkMode?"duotoneDark":"light",children:n,language:t&&D(t)?t:"text",style:{padding:"8px 0",borderRadius:8,width:"100%",boxSizing:"border-box",maxHeight:640,display:"flex",flexDirection:"column-reverse"},showLineNumbers:!0})})})),M=[a.A];var I={name:"qhxz92",styles:"max-width:100%"};const k=e=>({a:({href:e,children:t})=>(0,u.Y)(i.T.Link,{componentId:"codegen_webapp_js_genai_util_markdown.tsx_71",href:e,id:null!==e&&void 0!==e&&e.startsWith("#user-content-fn-")?e.replace("#user-content-fn-","user-content-fnref-"):void 0,disabled:null===e||void 0===e?void 0:e.startsWith("."),children:null!==e&&void 0!==e&&e.startsWith("#user-content-fn-")?(0,u.FD)(u.FK,{children:["[",t,"]"]}):t,openInNewTab:!(e&&e.startsWith("#"))}),code:t=>{var s,n,r,a;return(0,u.Y)(w,{...t,codeBlock:null!==(s=null===(n=e.extensions)||void 0===n?void 0:n.codeBlock)&&void 0!==s?s:S,codeInline:null!==(r=null===(a=e.extensions)||void 0===a?void 0:a.codeInline)&&void 0!==r?r:A})},p:({children:e})=>(0,u.Y)(i.T.Paragraph,{children:e}),h1:({children:e})=>(0,u.Y)(i.T.Title,{level:1,children:e}),h2:({children:e})=>(0,u.Y)(i.T.Title,{level:2,children:e}),h3:({children:e})=>(0,u.Y)(i.T.Title,{level:3,children:e}),h4:({children:e})=>(0,u.Y)(i.T.Title,{level:4,children:e}),h5:({children:e})=>(0,u.Y)(i.T.Title,{level:5,children:e}),table:({children:e,node:t})=>(0,u.Y)(g,{children:e,node:t}),tr:({children:e,node:t})=>(0,u.Y)(x,{children:e,node:t}),th:({children:e,node:t})=>(0,u.Y)(y,{children:e,node:t}),td:({children:e})=>(0,u.Y)(o.TableCell,{children:e,multiline:!0}),thead:({children:e})=>(0,u.Y)(u.FK,{children:e}),tbody:({children:e})=>(0,u.Y)(u.FK,{children:e}),img:({src:e,alt:t})=>(0,u.Y)("img",{src:e,alt:t,css:I})}),D=e=>{switch(e){case"go":case"java":case"javascript":case"json":case"python":case"sql":case"text":case"yaml":return!0;default:return!1}}},81390:function(e,t,s){s.d(t,{B$:function(){return h},De:function(){return l},EA:function(){return v},NP:function(){return x},QJ:function(){return d},VC:function(){return p},VD:function(){return f},X6:function(){return g},dM:function(){return m},fJ:function(){return y},os:function(){return u},u4:function(){return c},vf:function(){return o}});var n=s(76118),r=s(46709),a=s(94664),i=s(86125);const o=1/0,l=16,d=32,c={HIGH:5,NORMAL:3,LOW:1},u=(e,t)=>{const s=[],n=e=>{var r;e&&(s.push(e),t.has(e.key)&&(null===(r=e.children)||void 0===r||r.forEach(n)))};return e.forEach(n),s},p=e=>{const t=[],s=e=>{var n;e&&(t.push(e),null===(n=e.children)||void 0===n||n.forEach(s))};return e.forEach(s),t},m=(e,t=1/0)=>{const s={},n=(e,r)=>{var a;!e||r>t||(s[e.key]=e,null===(a=e.children)||void 0===a||a.forEach((e=>n(e,r+1))))};return e.forEach(n,0),s},h=(e={})=>{const[t,s]=(0,r.useState)((()=>{if(e.rootNodes){const t=(0,n.values)(m(e.rootNodes,e.initialExpandDepth)).map((e=>e.key));return new Set(t)}return new Set}));return{expandedKeys:t,setExpandedKeys:s}},g=e=>{if(0===e)return"0s";if(e>=6e7){return`${(e/1e6/60).toFixed(2)}m`}if(e>=1e5){return`${(e/1e6).toFixed(2)}s`}return`${(e/1e3).toFixed(2)}ms`},f=(e,t)=>{var s;return e.key===t?0:(null!==(s=e.children)&&void 0!==s?s:[]).findIndex((e=>f(e,t)>-1))},v=e=>{var t;if(!e.children||0===(null===(t=e.children)||void 0===t?void 0:t.length))return 0;const s=e.children.map(v);return Math.max(...s)+1},x=(e,t)=>{const s=new Set;let n=e;for(;n&&n.parentId;)s.add(n.parentId),n=t[n.parentId];return s},y=e=>{var t;return!!e.parentId&&([a.UG.AGENT,a.UG.RETRIEVER,a.UG.CHAT_MODEL,a.UG.TOOL,a.UG.LLM].includes(null!==(t=e.type)&&void 0!==t?t:a.UG.UNKNOWN)||(0,i.N7)(e)>0)}},86125:function(e,t,s){s.d(t,{BS:function(){return p},CL:function(){return G},Hq:function(){return W},I$:function(){return P},LS:function(){return g},MF:function(){return k},N7:function(){return B},OS:function(){return R},PC:function(){return $},Q0:function(){return _},W0:function(){return H},ZI:function(){return J},bn:function(){return O},f7:function(){return y},gD:function(){return w},g_:function(){return F},h8:function(){return j},ij:function(){return m},in:function(){return K},ko:function(){return ee},nr:function(){return te},ob:function(){return D},pQ:function(){return X},tC:function(){return h},uM:function(){return C},vL:function(){return x},vX:function(){return se},vl:function(){return L},x0:function(){return U},yt:function(){return Z}});var n=s(68248),r=s(76118),a=s(46709),i=s(94664),o=s(51847),l=s(9773),d=s(69660),c=s(81390),u=s(73408);const p="model-trace-info-v3",m=e=>{};function h(e){switch(e){case i.UG.LLM:return i.Dy.MODELS;case i.UG.CHAIN:return i.Dy.CHAIN;case i.UG.AGENT:return i.Dy.AGENT;case i.UG.TOOL:return i.Dy.WRENCH;case i.UG.CHAT_MODEL:return i.Dy.MODELS;case i.UG.RETRIEVER:return i.Dy.SEARCH;case i.UG.PARSER:return i.Dy.CODE;case i.UG.EMBEDDING:return i.Dy.NUMBERS;case i.UG.RERANKER:return i.Dy.SORT;case i.UG.MEMORY:return i.Dy.SAVE;case i.UG.FUNCTION:return i.Dy.FUNCTION;case i.UG.UNKNOWN:return i.Dy.UNKNOWN;default:return i.Dy.FUNCTION}}function g(e){switch(e){case i.UG.LLM:return"LLM";case i.UG.CHAIN:return"Chain";case i.UG.AGENT:return"Agent";case i.UG.TOOL:return"Tool";case i.UG.CHAT_MODEL:return"Chat model";case i.UG.RETRIEVER:return"Retriever";case i.UG.PARSER:return"Parser";case i.UG.EMBEDDING:return"Embedding";case i.UG.RERANKER:return"Reranker";case i.UG.MEMORY:return"Memory";case i.UG.FUNCTION:return"Function";case i.UG.UNKNOWN:return"Unknown";default:return e}}function f(e){try{return JSON.parse(e)}catch(t){return e}}const v=(e,t)=>{if(!t)return[];const s=[],n={inputs:null===e||void 0===e?void 0:e.inputs,outputs:null===e||void 0===e?void 0:e.outputs,attributes:null===e||void 0===e?void 0:e.attributes,events:null===e||void 0===e?void 0:e.events};return(0,r.map)(n,((n,r)=>{if("events"===r)return void s.push(...((e,t)=>{const s=e.events;if(!s)return[];const n=[];return s.forEach(((s,r)=>{const a=s.attributes;a&&Object.keys(a).forEach((i=>{const o=i.toLowerCase().includes(t),l=_(s.name,r,i);o&&n.push({span:e,section:"events",key:l,isKeyMatch:!0,matchIndex:0});const d=JSON.stringify(a[i]).toLowerCase().split(t).length-1;for(let t=0;t<d;t++)n.push({span:e,section:"events",key:l,isKeyMatch:!1,matchIndex:t})}))})),n})(e,t));F(n).forEach((n=>{n.key.toLowerCase().includes(t)&&s.push({span:e,section:r,key:n.key,isKeyMatch:!0,matchIndex:0});const a=n.value.toLowerCase().split(t).length-1;for(let t=0;t<a;t++)s.push({span:e,section:r,key:n.key,isKeyMatch:!1,matchIndex:t})}))})),s};function x(e,t,s){var n,r;const a=t.toLowerCase().trim(),i=Object.values(s.spanTypeDisplayState).every((e=>e));if(""===a&&i)return{filteredTreeNodes:[e],matches:[]};const o=null!==(n=e.children)&&void 0!==n?n:[],l=[],d=[];o.forEach((e=>{const{filteredTreeNodes:t,matches:n}=x(e,a,s);l.push(...t),d.push(...n)}));const c=(null!==(r=e.title)&&void 0!==r?r:"").toLowerCase(),u=v(e,a),p=u.length>0||c.includes(a),m=!e.type||s.spanTypeDisplayState[e.type],h=p&&m,g=l.length>0,f=B(e)>0;return h||s.showParents&&g||s.showExceptions&&f?{filteredTreeNodes:[{...e,children:l}],matches:u.concat(d)}:{filteredTreeNodes:l,matches:d}}function y(e,t){var s;if((0,r.isNil)(t)||(0,r.isNil)(e))return;if(e.key===t)return e;const n=null!==(s=e.children)&&void 0!==s?s:[];for(const r of n){const e=y(r,t);if(e)return e}}const b=(e,t,s,n,a,i)=>{var d,c,p,m,g,v,x,y;const b=f(null===(d=e.attributes)||void 0===d?void 0:d["mlflow.spanType"]),Y=f(null===(c=e.attributes)||void 0===c?void 0:c["mlflow.spanInputs"]),w=f(null===(p=e.attributes)||void 0===p?void 0:p["mlflow.spanOutputs"]),A=S(e),k=T(e),D=null!==(m=a[k])&&void 0!==m?m:[];var C;A||D.push(...null!==(C=a[""])&&void 0!==C?C:[]);const E=f(null===(g=e.attributes)||void 0===g?void 0:g["mlflow.chat.messages"]),N=f(null===(v=e.attributes)||void 0===v?void 0:v["mlflow.message.format"]),F=((e,t,s,n,a)=>{var i,o;if(Array.isArray(e)&&e.every(P))return(0,r.compact)(e.map(J));const d=null!==(i=W(t,n))&&void 0!==i?i:[],c=null!==(o=W(s,n))&&void 0!==o?o:[];if("pydantic_ai"===n&&c.length>0)return d.length>0?d.concat(c):c;if("voltagent"===n&&a&&a.length>0){const e=(0,l.Nw)(t,s,a);if(e&&e.length>0)return e}return 0!==d.length&&0!==c.length?d.concat(c):void 0})(E,Y,w,N,n),R=((e,t)=>{var s;return Array.isArray(e)&&e.every($)?e:Array.isArray(null===t||void 0===t?void 0:t.tools)&&null!==t&&void 0!==t&&null!==(s=t.tools)&&void 0!==s&&s.every($)?t.tools:void 0})(f(null===(x=e.attributes)||void 0===x?void 0:x["mlflow.chat.tools"]),Y),H=(0,r.mapValues)((0,r.omitBy)(e.attributes,((e,t)=>t.startsWith("mlflow."))),(e=>f(e))),L=e.events,_=(Number(M(e))-t)/1e3,O=(Number(null!==(y=I(e))&&void 0!==y?y:s)-t)/1e3;return{title:e.name,icon:(0,u.Y)(o.P,{type:h(b),hasException:B(e)>0,isRootSpan:!A}),type:b,key:k,start:_,end:O,children:n,inputs:Y,outputs:w,attributes:H,events:L,chatMessageFormat:N,chatMessages:F,chatTools:R,parentId:A,assessments:D,traceId:i}},Y=(e,t)=>{if(!e)return"";if(t&&e.length<16)try{return(e=>{const t=atob(e),s=t.length;let n="";for(let r=0;r<s;r++)n+=t.charCodeAt(r).toString(16).padStart(2,"0");return n})(e)}catch(s){return e}return e.startsWith("0x")?e.slice(2):e};function w(e){return!!e&&"trace_location"in e}function A(e){return"start_time_unix_nano"in e}function T(e){var t,s,n;return A(e)?Y(null!==(t=e.span_id)&&void 0!==t?t:"",!0):Y(null!==(s=null===(n=e.context)||void 0===n?void 0:n.span_id)&&void 0!==s?s:"",!1)}function S(e){var t,s;return A(e)?Y(null!==(t=e.parent_span_id)&&void 0!==t?t:"",!0):Y(null!==(s=e.parent_id)&&void 0!==s?s:"",!1)}function M(e){return A(e)?Number(e.start_time_unix_nano):Number(e.start_time)}function I(e){return A(e)?Number(e.end_time_unix_nano):Number(e.end_time)}function k(e){var t;return w(e.info)?e.info.trace_id:null!==(t=e.info.request_id)&&void 0!==t?t:""}function D(e){var t,s;if(!w(e.info))return null;const n=Number(null===(t=e.info)||void 0===t||null===(s=t.trace_metadata)||void 0===s?void 0:s["mlflow.trace.sizeBytes"]);return(0,r.isNil)(n)||isNaN(n)?null:n}function C(e){var t,s;const n=k(e),r=(null!==(t=null===(s=e.trace_data)||void 0===s?void 0:s.spans)&&void 0!==t?t:e.data.spans).map(Q),a={},l={};if(!r||0===r.length)return[];r.forEach((e=>{const t=T(e);a[t]=e,l[t]=[]})),r.forEach((e=>{var t;const s=T(e),n=S(e);null===(t=l[n])||void 0===t||t.push(s)}));const d=Math.min(...r.map((e=>M(e)))),c=Math.max(...r.map((e=>I(e)))),p=E(e.info);function m(e){var t,s,r;const g=a[e],f=l[e].map(m);if(A(g)||"parent_id"in g)return b(g,d,c,f,p,n);const v=null!==(t=g.span_type)&&void 0!==t?t:i.UG.UNKNOWN;return{title:g.name,icon:(0,u.Y)(o.P,{type:h(v)}),type:v,key:g.context.span_id,start:Number(g.start_time)-d,end:Number(null!==(s=g.end_time)&&void 0!==s?s:c)-d,children:f,inputs:g.inputs,outputs:g.outputs,attributes:g.attributes,events:g.events,parentId:null!==(r=g.parent_id)&&void 0!==r?r:g.parent_span_id,assessments:[],traceId:n}}const g=new Array;return r.forEach((e=>{const t=S(e);t&&a[t]||g.push(m(T(e)))})),g}const E=e=>{let t=[];var s;w(e)?t=null!==(s=e.assessments)&&void 0!==s?s:[]:t=N(e.tags);const n=(0,r.keyBy)(t,"assessment_id");Object.values(n).forEach((e=>{if(e.overrides){const t=n[e.overrides];e.overriddenAssessment=t}})),t=Object.values(n);const a=t.reduce(((e,t)=>{var s;const n=null!==(s=t.span_id)&&void 0!==s?s:"";return e[n]||(e[n]=[]),e[n].push(t),e}),{});return Object.keys(a).forEach((e=>{a[e].sort(((e,t)=>new Date(t.last_update_time).getTime()-new Date(e.last_update_time).getTime()))})),a},N=e=>{if(!e)return[];return(Array.isArray(e)?e:Object.entries(e).map((([e,t])=>({key:e,value:t})))).filter((({key:e})=>e.startsWith("mlflow.assessment."))).map((({value:e})=>JSON.parse(e)))};const F=e=>(0,r.isNil)(e)?[]:Array.isArray(e)||(0,r.isString)(e)||(0,r.isNumber)(e)||(0,r.isBoolean)(e)?[{key:"",value:JSON.stringify(e,null,2)}]:Object.entries(e).map((([e,t])=>({key:e,value:JSON.stringify(t,null,2)}))),R=({searchFilter:e,data:t,activeMatchBackgroundColor:s,inactiveMatchBackgroundColor:a,containsActiveMatch:i,activeMatch:o,scrollToActiveMatch:l})=>{const d=new RegExp(`(${(0,r.escapeRegExp)(e.trim())})`,"gi"),c=t.split(d),p=[];let m=0;for(let r=0;r<c.length;r++)if(c[r].toLowerCase().includes(e.toLowerCase().trim())){const e=i&&o.matchIndex===m,t=e?s:a,d=(0,u.Y)("span",{ref:e?l:null,css:(0,n.AH)({backgroundColor:t,scrollMarginTop:50},""),children:c[r]},r);m++,p.push(d)}else p.push(c[r]);return p},H=e=>(0,r.has)(e,"page_content"),L=e=>e.type===i.UG.RETRIEVER&&Array.isArray(e.outputs)&&e.outputs.length>0&&(0,r.every)(e.outputs,H),_=(e,t,s)=>`${e}-${t}-${s}`,O=e=>{var t;return(null!==(t=e.events)&&void 0!==t?t:[]).filter((e=>"exception"===e.name))},B=e=>O(e).length,z=e=>!(0,r.isNil)(e)&&(!(!(0,r.isNil)(e.type)&&!(0,r.isString)(e.type))&&(!(!(0,r.isNil)(e.description)&&!(0,r.isString)(e.description))&&!(!(0,r.isNil)(e.enum)&&!Array.isArray(e.enum)))),$=e=>{var t;if((0,r.isNil)(e)||"function"!==e.type||!(0,r.has)(e,"function.name"))return!1;const s=null===(t=e.function)||void 0===t?void 0:t.parameters;if(!(0,r.isNil)(s)){const e=s.required;if(!(0,r.isNil)(e)&&(!Array.isArray(e)||!e.every(r.isString)))return!1;const t=s.properties;if(!(0,r.isNil)(t)&&!Object.values(t).every(z))return!1}return!0},j=e=>{var t,s;return e&&(0,r.isString)(e.id)&&(0,r.isString)(null===(t=e.function)||void 0===t?void 0:t.arguments)&&(0,r.isString)(null===(s=e.function)||void 0===s?void 0:s.name)},V=e=>!(!(0,r.isNil)(e)&&!(0,r.isString)(e))||!!(0,r.isArray)(e)&&e.every((e=>(e=>{switch(e.type){case"text":case"input_text":case"output_text":return(0,r.isString)(e.text);case"image_url":const{image_url:t}=e;return!(0,r.isNil)(t)&&(0,r.isString)(t.url)&&((0,r.isNil)(t.detail)||["auto","low","high"].includes(t.detail));case"input_audio":const{input_audio:s}=e;return!(0,r.isNil)(s)&&(0,r.isString)(s.data)&&((0,r.isNil)(s.format)||["wav","mp3"].includes(s.format));default:return!1}})(e))),P=e=>{if(!e)return!1;if(e.tool_calls){if(!Array.isArray(e.tool_calls))return!1;if(!e.tool_calls.every(j))return!1}return(!e.parts||!(0,r.isNil)(e.content))&&("reasoning"===e.type||!!V(e.content)&&("user"===e.role||"assistant"===e.role||"system"===e.role||"tool"===e.role))},U=e=>Array.isArray(e)&&e.length>0&&e.every((e=>{return(0,r.has)(e,"message")&&(t=e.message,!!P(t)&&((0,r.isNil)(t.content)||(0,r.isString)(t.content)));var t})),K=e=>e&&U(e.choices),W=(e,t)=>{var s,n,a,i,o,c,u,p,m,h,g,f,v,x,y,b;try{if(Array.isArray(e)&&e.length>0&&e.every(P))return(0,r.compact)(e.map(J));switch(t){case"langchain":const t=null!==(s=(0,l.HD)(e))&&void 0!==s?s:(0,l.oI)(e);if(t)return t;break;case"llamaindex":const r=null!==(n=(0,l.Hy)(e))&&void 0!==n?n:(0,l.W3)(e);if(r)return r;break;case"openai":const Y=null!==(a=null!==(i=null!==(o=null!==(c=(0,l.a8)(e))&&void 0!==c?c:(0,l.bS)(e))&&void 0!==o?o:(0,l.n_)(e))&&void 0!==i?i:(0,l.AG)(e))&&void 0!==a?a:(0,d.x1)(e);if(Y)return Y;break;case"dspy":const w=null!==(u=(0,l.iU)(e))&&void 0!==u?u:(0,l.Pn)(e);if(w)return w;break;case"gemini":const A=null!==(p=(0,l.DE)(e))&&void 0!==p?p:(0,l.Sy)(e);if(A)return A;break;case"anthropic":const T=null!==(m=(0,l.KF)(e))&&void 0!==m?m:(0,l.pL)(e);if(T)return T;break;case"openai-agent":const S=null!==(h=(0,l.xW)(e))&&void 0!==h?h:(0,l.m$)(e);if(S)return S;break;case"autogen":const M=null!==(g=(0,l.nW)(e))&&void 0!==g?g:(0,l.u6)(e);if(M)return M;break;case"bedrock":const I=null!==(f=(0,l.Yv)(e))&&void 0!==f?f:(0,l.f1)(e);if(I)return I;break;case"vercel_ai":const k=null!==(v=(0,l.fJ)(e))&&void 0!==v?v:(0,l.QA)(e);if(k)return k;break;case"pydantic_ai":const D=null!==(x=(0,l.Ii)(e))&&void 0!==x?x:(0,l.TY)(e);if(D)return D;break;case"voltagent":const C=null!==(y=(0,l.o0)(e))&&void 0!==y?y:(0,l.LO)(e);if(C)return C;break;default:const E=null!==(b=(0,l.a8)(e))&&void 0!==b?b:(0,l.bS)(e);if(E)return E}return Array.isArray(e)&&e.length>0&&e.every(l.oi)?(0,r.compact)(e.map(l.pN)):null}catch(Y){return null}},G=e=>{var t;let s=null===(t=e.function)||void 0===t?void 0:t.arguments;try{s=JSON.stringify(JSON.parse(s),null,2)}catch(n){}return{id:e.id,function:{arguments:s,name:e.function.name}}},q=e=>{if((0,r.isNil)(e)||(0,r.isString)(e))return e;return e.map((e=>{var t;switch(e.type){case"text":case"input_text":case"output_text":return e.text;case"image_url":const s=null===e||void 0===e||null===(t=e.image_url)||void 0===t?void 0:t.url;return s?`![](${s})`:"[image]";case"input_audio":return"[audio]"}})).filter((e=>void 0!==e)).join("\n\n")},J=e=>{var t;return"reasoning"===e.type?null:{...e,content:q(e.content),tool_calls:null===(t=e.tool_calls)||void 0===t?void 0:t.map(G)}},X=e=>{if((0,r.isNil)(e))return"content";if(e.chatMessages)return"chat";return!(0,r.isNil)(e.inputs)||!(0,r.isNil)(e.outputs)?"content":"attributes"},Q=e=>{var t;const s=e=>Array.isArray(e)?e.reduce(((e,t)=>{return t.key&&t.value?{...e,[t.key]:(s=t.value,(0,r.isObject)(s)?"string_value"in s?s.string_value:"bool_value"in s?s.bool_value:"int_value"in s?s.int_value:"double_value"in s?s.double_value:s:s)}:e;var s}),{}):e;return{...e,...e.attributes&&{attributes:s(e.attributes)},...e.events&&{events:null===(t=e.events)||void 0===t?void 0:t.map((e=>({...e,attributes:s(e.attributes)})))}}},Z=e=>(0,a.useMemo)((()=>{if(!e)return[];return(0,c.VC)([e]).filter(c.fJ)}),[e]),ee=e=>{var t;return Boolean(e&&w(e)&&"UC_SCHEMA"===(null===(t=e.trace_location)||void 0===t?void 0:t.type))},te=e=>{var t,s,n,r;return"MLFLOW_EXPERIMENT"===e.type?null===(t=e.mlflow_experiment)||void 0===t?void 0:t.experiment_id:"INFERENCE_TABLE"===e.type?null===(s=e.inference_table)||void 0===s?void 0:s.full_table_name:"UC_SCHEMA"===e.type?`${null===(n=e.uc_schema)||void 0===n?void 0:n.catalog_name}.${null===(r=e.uc_schema)||void 0===r?void 0:r.schema_name}`:void 0},se=e=>{const t=te(e.trace_location);return t?`trace:/${t}/${e.trace_id}`:e.trace_id}},94664:function(e,t,s){s.d(t,{Dy:function(){return r},UG:function(){return n},cC:function(){return a}});let n=function(e){return e.LLM="LLM",e.CHAIN="CHAIN",e.AGENT="AGENT",e.TOOL="TOOL",e.FUNCTION="FUNCTION",e.CHAT_MODEL="CHAT_MODEL",e.RETRIEVER="RETRIEVER",e.PARSER="PARSER",e.EMBEDDING="EMBEDDING",e.RERANKER="RERANKER",e.MEMORY="MEMORY",e.UNKNOWN="UNKNOWN",e}({}),r=function(e){return e.MODELS="models",e.DOCUMENT="document",e.CONNECT="connect",e.SEARCH="search",e.SORT="sort",e.UNKNOWN="unknown",e.FUNCTION="function",e.CODE="code",e.NUMBERS="numbers",e.WRENCH="wrench",e.AGENT="agent",e.CHAIN="chain",e.USER="user",e.SYSTEM="system",e.SAVE="save",e}({}),a=function(e){return e.JSON="json",e.TEXT="text",e.MARKDOWN="markdown",e.PYTHON="python",e}({})},97407:function(e,t,s){s(59930),s(46709)}}]);
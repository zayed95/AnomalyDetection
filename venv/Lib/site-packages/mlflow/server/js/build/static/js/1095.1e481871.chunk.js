"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[1095],{110:function(e,t,n){n.d(t,{N_:function(){return a},Oz:function(){return l},g:function(){return s},zy:function(){return i}});var o=n(58024),r=n(27637);const s=o.g,i=o.zy,a=r.N_,l=e=>e},777:function(e,t,n){n.d(t,{S:function(){return f}});var o=n(68248),r=n(76118),s=n(27757),i=n(79081),a=n(27299),l=n(73408);var c={name:"1gyqtrv",styles:"width:min-content;max-width:100%"},u={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"};const g=({objectKey:e,value:t})=>{const{theme:n}=(0,s.u)(),g=(0,r.isString)(t)?t:JSON.stringify(t);return(0,l.Y)(i.T,{content:g,componentId:"shared.model-trace-explorer.expectation-value-preview-tooltip",children:(0,l.Y)(a.Tag,{color:"indigo",componentId:"shared.model-trace-explorer.expectation-array-item-tag",css:c,children:(0,l.FD)(s.T.Text,{css:u,children:[e&&(0,l.FD)(s.T.Text,{bold:!0,css:(0,o.AH)({marginRight:n.spacing.xs},""),children:[e,":"]}),g]})})})},f=({parsedValue:e,singleLine:t=!1})=>{const{theme:n}=(0,s.u)();return(0,r.isNil)(e)?null:Array.isArray(e)?t?(0,l.Y)(g,{value:e}):(0,l.Y)("div",{css:(0,o.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm},""),children:e.map(((e,t)=>(0,l.Y)(g,{value:e},t)))}):(0,r.isObject)(e)?t?(0,l.Y)(g,{value:e}):(0,l.Y)("div",{css:(0,o.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm},""),children:Object.entries(e).map((([e,t])=>(0,l.Y)(g,{objectKey:e,value:t},e)))}):(0,l.Y)(g,{value:e})}},4564:function(e,t,n){n.d(t,{V:function(){return a}});var o=n(68248),r=n(27757),s=n(79081),i=n(73408);const a=({source:e})=>{const{theme:t}=(0,r.u)();return(0,i.Y)(s.T,{componentId:"shared.model-trace-explorer.assessment-source-name",content:e.source_id,children:(0,i.Y)("span",{css:(0,o.AH)({flexShrink:1,overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap",marginLeft:t.spacing.sm,minWidth:t.spacing.md},""),children:(0,i.Y)(r.T.Text,{children:(0,i.Y)("span",{css:(0,o.AH)({color:t.colors.blue500},""),children:e.source_id})})})})}},9773:function(e,t,n){n.d(t,{oi:function(){return ne},KF:function(){return c},pL:function(){return u},nW:function(){return m},u6:function(){return y},Yv:function(){return S},f1:function(){return x},iU:function(){return R},Pn:function(){return W},DE:function(){return I},Sy:function(){return k},HD:function(){return D},oI:function(){return Y},Hy:function(){return F},W3:function(){return E},xW:function(){return O.xW},m$:function(){return O.m$},a8:function(){return O.a8},bS:function(){return O.bS},AG:function(){return O.AG},n_:function(){return O.n_},pN:function(){return se},Ii:function(){return ge},TY:function(){return fe},fJ:function(){return q},QA:function(){return G},o0:function(){return Se},LO:function(){return xe},Nw:function(){return Ae}});var o=n(76118),r=n(86125);const s=e=>{if((0,o.isNil)(e))return!1;if((0,o.has)(e,"type")){if("text"===e.type&&(0,o.has)(e,"text")&&(0,o.isString)(e.text))return!0;if("image"===e.type&&(0,o.has)(e,"source")&&(0,o.has)(e.source,"type")){if("base64"===e.source.type&&(0,o.has)(e.source,"media_type")&&(0,o.isString)(e.source.media_type)&&["image/jpeg","image/png","image/gif","image/webp"].includes(e.source.media_type)&&(0,o.has)(e.source,"data")&&(0,o.isString)(e.source.data))return!0;if("url"===e.source.type&&(0,o.has)(e.source,"url")&&(0,o.isString)(e.source.url))return!0}if("tool_use"===e.type&&(0,o.has)(e,"id")&&(0,o.has)(e,"name")&&(0,o.has)(e,"input"))return(0,o.isString)(e.id)&&(0,o.isString)(e.name)&&(0,o.isObject)(e.input);if("tool_result"===e.type&&(0,o.has)(e,"tool_use_id")&&(0,o.has)(e,"content"))return(0,o.isString)(e.tool_use_id)&&(0,o.isString)(e.content)}return!1},i=e=>{if(!(0,o.isObject)(e))return!1;const t=(0,o.has)(e,"role")&&(0,o.isString)(e.role)&&["user","assistant"].includes(e.role),n="content"in e&&((0,o.isString)(e.content)||(0,o.isArray)(e.content)&&e.content.every(s));return t&&n},a=e=>{switch(e.type){case"text":return{type:"text",text:e.text};case"image":switch(e.source.type){case"base64":return{type:"image_url",image_url:{url:`data:${e.source.media_type};base64,${e.source.data}`}};case"url":return{type:"image_url",image_url:{url:e.source.url}}}}throw new Error(`Unsupported content block type: ${e.type}`)},l=e=>{const t=[];if("string"===typeof e.content){const n=(0,r.ZI)({type:"message",content:e.content,role:e.role});n&&t.push(n)}else{const{messages:n,textParts:o,toolCalls:s}=(e=>{const t=[],n=[],o=[];for(const r of e)"text"===r.type||"image"===r.type?n.push(a(r)):"tool_use"===r.type?o.push({id:r.id,function:{name:r.name,arguments:JSON.stringify(r.input)}}):"tool_result"===r.type&&t.push({role:"tool",tool_call_id:r.tool_use_id,content:r.content});return{messages:t,textParts:n,toolCalls:o}})(e.content);if(t.push(...n),o.length>0||s.length>0){const n=(0,r.ZI)({type:"message",content:o.length>0?o:void 0,role:e.role,...s.length>0&&{tool_calls:s}});n&&t.push(n)}}return t},c=e=>{if(!(0,o.isObject)(e))return null;if("messages"in e&&(0,o.isArray)(e.messages)&&e.messages.every(i)){const t=[];for(const n of e.messages)t.push(...l(n));return t}return null},u=e=>(0,o.isObject)(e)&&(0,o.has)(e,"type")&&"message"===e.type&&i(e)?l(e):null,g=e=>(0,o.isObject)(e)&&(0,o.isString)((0,o.get)(e,"id"))&&(0,o.isString)((0,o.get)(e,"name"))&&(0,o.isString)((0,o.get)(e,"arguments")),f=e=>{if(!(0,o.isObject)(e))return!1;const t=(0,o.get)(e,"type");if(t){if("SystemMessage"===t)return(0,o.isString)((0,o.get)(e,"content"));if("UserMessage"===t)return(0,o.has)(e,"content")&&(0,o.has)(e,"source");if("AssistantMessage"===t)return(0,o.has)(e,"content")&&(0,o.has)(e,"source");if("FunctionMessage"===t)return(0,o.has)(e,"content")&&(0,o.has)(e,"source")}return!(!(0,o.has)(e,"source")||!["system","user","assistant","function"].includes((0,o.get)(e,"source")))&&(0,o.has)(e,"content")},p=e=>(0,o.isString)(e)?(0,r.ZI)({type:"message",content:e,role:"assistant"}):(0,o.isArray)(e)&&e.every(g)?{role:"assistant",tool_calls:e.map((e=>(0,r.CL)({id:e.id,function:{name:e.name,arguments:e.arguments}})))}:null,d=e=>{if("SystemMessage"===e.type)return(0,r.ZI)({type:"message",content:e.content,role:"system"});if("UserMessage"===e.type){if((0,o.isString)(e.content))return(0,r.ZI)({type:"message",content:e.content,role:"user"});if((0,o.isArray)(e.content)){const t=e.content.filter((e=>(0,o.isString)(e)||(0,o.isObject)(e)&&"text"===e.type)).map((e=>(0,o.isString)(e)?{type:"text",text:e}:e));if(t.length>0)return(0,r.ZI)({type:"message",content:t,role:"user"})}}if("AssistantMessage"===e.type)return p(e.content);if("FunctionMessage"===e.type)return(0,r.ZI)({type:"message",content:JSON.stringify(e.content),role:"user"});if("system"===e.source)return(0,r.ZI)({type:"message",content:e.content,role:"system"});if("user"===e.source){if((0,o.isString)(e.content))return(0,r.ZI)({type:"message",content:e.content,role:"user"});if((0,o.isArray)(e.content)){const t=e.content.filter((e=>(0,o.isString)(e))).map((e=>({type:"text",text:e})));if(t.length>0)return(0,r.ZI)({type:"message",content:t,role:"user"})}}return"assistant"===e.source?p(e.content):"function"===e.source?(0,r.ZI)({type:"message",content:JSON.stringify(e.content),role:"user"}):null},m=e=>{if((0,o.isNil)(e))return null;if((0,o.isArray)(e)&&e.length>0&&e.every(f))return(0,o.compact)(e.map(d));if((0,o.isObject)(e)&&"messages"in e){const t=e.messages;if((0,o.isArray)(t)&&t.length>0&&t.every(f))return(0,o.compact)(t.map(d))}return null},y=e=>{if((0,o.isNil)(e))return null;if((0,o.isArray)(e)&&e.length>0&&e.every(f))return(0,o.compact)(e.map(d));if((0,o.isObject)(e)&&"content"in e){const t=(0,r.ZI)({role:"assistant",content:e.content,type:"message"});return t?[t]:null}return null},h=e=>{if(e.text)return{type:"text",text:e.text};if(e.json)return{type:"text",text:JSON.stringify(e.json)};if(e.image){const t=e.image.source.bytes,n=e.image.format;let o;if("string"===typeof t)o=t;else{o=Buffer.from(t).toString("base64")}return{type:"image_url",image_url:{url:`data:${`image/${n}`};base64,${o}`}}}return null},b=e=>{let t=e.role;const n=[],o=[];let s;for(const l of e.content)if(l.toolUse){const e=l.toolUse,t="string"===typeof e.input?e.input:JSON.stringify(e.input);o.push((0,r.CL)({id:e.toolUseId,function:{name:e.name,arguments:t}}))}else if(l.toolResult){s=l.toolResult.toolUseId,t="tool";for(const e of l.toolResult.content){const t=h(e);t&&n.push(t)}}else{const e=h(l);e&&n.push(e)}let i="";n.length>0&&(i=n.map((e=>"text"===e.type?e.text:"image_url"===e.type?`[Image: ${e.image_url.url}]`:"")).filter((e=>e.length>0)).join(" "));const a={role:t,content:i};return o.length>0&&(a.tool_calls=o),s&&(a.tool_call_id=s),a},v=e=>{if(!(0,o.isObject)(e))return!1;const t=(0,o.has)(e,"role")&&(0,o.isString)(e.role)&&["user","assistant","system"].includes(e.role),n=(0,o.has)(e,"content")&&(0,o.isArray)(e.content);return t&&n},S=e=>{if((0,o.isNil)(e))return null;if((0,o.isObject)(e)&&"messages"in e){const t=e.messages;if((0,o.isArray)(t)&&t.length>0&&t.every(v))return(0,o.compact)(t.map(b))}return null},x=e=>{if((0,o.isNil)(e))return null;if((0,o.isObject)(e)&&"output"in e){const t=e.output;if((0,o.isObject)(t)&&"message"in t){const e=t.message;if(v(e))return[b(e)]}}return null},_=e=>(0,o.isObject)(e)&&"text"in e&&(0,o.isString)(e.text),A=e=>(0,o.isObject)(e)&&"role"in e&&(0,o.isString)(e.role)&&["user","model"].includes(e.role)&&(0,o.has)(e,"parts")&&Array.isArray(e.parts)&&e.parts.every(_),w=e=>(0,o.isObject)(e)&&"content"in e&&A(e.content),I=e=>{if(!(0,o.isObject)(e))return null;if("contents"in e){if((0,o.isString)(e.contents)){const t=(0,r.ZI)({type:"message",content:e.contents,role:"user"});return t&&[t]}if((0,o.isArray)(e.contents)&&e.contents.every(A))return(0,o.compact)(e.contents.map((e=>{const t="model"===e.role?"assistant":e.role;return(0,r.ZI)({type:"message",content:e.parts.map((e=>({type:"text",text:e.text}))),role:t})})))}return null},k=e=>(0,o.isObject)(e)&&"candidates"in e&&(0,o.isArray)(e.candidates)&&e.candidates.every(w)?(0,o.compact)(e.candidates.flatMap((e=>e.content)).map((e=>{const t="model"===e.role?"assistant":e.role;return(0,r.ZI)({type:"message",content:e.parts.map((e=>({type:"text",text:e.text}))),role:t})}))):null;var O=n(69660);const C=e=>{var t;let n,s;switch(e.type){case"user":case"human":n="user";break;case"assistant":case"ai":n="assistant";break;case"system":n="system";break;case"tool":n="tool";break;case"function":n="function";break;default:return null}if((0,o.isString)(e.content))s=e.content;else if(Array.isArray(e.content)){s=e.content.map((e=>{var t;return(0,o.isString)(e)?e:"text"===e.type&&e.text?e.text:"image_url"===e.type&&null!==(t=e.image_url)&&void 0!==t&&t.url?`![](${e.image_url.url})`:""})).filter(Boolean).join("\n\n")}else s=void 0;const i={content:s,role:n},a=e.tool_calls,l=null===(t=e.additional_kwargs)||void 0===t?void 0:t.tool_calls;return!(0,o.isNil)(a)&&Array.isArray(a)&&a.length>0&&a.every(M)?i.tool_calls=(0,o.compact)(a.map(N)):!(0,o.isNil)(l)&&Array.isArray(l)&&l.length>0&&l.every(r.h8)&&(i.tool_calls=l.map(r.CL)),(0,o.isNil)(e.tool_call_id)||(i.tool_call_id=e.tool_call_id),i},N=e=>({id:e.id,function:{arguments:JSON.stringify(e.args,null,2),name:e.name}}),j=e=>!!e&&(!!((0,o.isNil)(e.content)||(0,o.isString)(e.content)||Array.isArray(e.content))&&["human","user","assistant","ai","system","tool","function"].includes(e.type)),M=e=>e&&(0,o.isString)(e.name)&&(0,o.has)(e,"args")&&(0,o.isString)(e.id),T=e=>e&&j(e.message),D=e=>{if(Array.isArray(e)&&1===e.length&&Array.isArray(e[0])&&e[0].length>0&&e[0].every(j)){const t=e[0].map(C);return t.some((e=>null===e))?null:t}if(Array.isArray(null===e||void 0===e?void 0:e.messages)&&e.messages.length>0&&e.messages.every(j)){const t=e.messages.map(C);return t.some((e=>null===e))?null:t}if(Array.isArray(e)&&e.length>0&&e.every(j)){const t=e.map(C);return t.some((e=>null===e))?null:t}return null},z=e=>{const t=e.map((e=>C(e.message)));return t.some((e=>null===e))?null:t},Y=e=>(e=>!(!Array.isArray(e)||e.length<1)&&!(!Array.isArray(e[0])||e[0].length<1)&&e[0].every(T))(e)?z(e[0]):Array.isArray(null===e||void 0===e?void 0:e.generations)&&e.generations.length>0&&e.generations[0].every(T)?z(e.generations[0]):null,Z=e=>{const t=(0,o.get)(e,"text");return"text"===(0,o.get)(e,"block_type")&&(0,o.isString)(t)},L=e=>{const t=(0,o.get)(e,"blocks"),n=(0,o.get)(e,"role");return(0,o.isString)(n)&&["assistant","system","user"].includes(n)&&(0,o.isArray)(t)&&t.every(Z)},H=e=>(0,r.ZI)({role:e.role,content:e.blocks.map((e=>({type:"text",text:e.text})))}),E=e=>{if(!(e=>L((0,o.get)(e,"message")))(e))return null;const t=H(e.message);return t&&[t]},F=e=>(e=>{const t=(0,o.get)(e,"messages");return(0,o.isArray)(t)&&t.every(L)})(e)?(0,o.compact)(e.messages.map(H)):null,R=e=>{if((0,o.has)(e,"messages")&&(0,o.isArray)(e.messages)){return e.messages.map((e=>(0,r.ZI)({type:"message",content:(0,o.isString)(e.content)?B(e.content):e.content,role:e.role}))).filter(Boolean)}return null},W=e=>{if((0,o.isArray)(e)&&e.length>0&&e.every(o.isString)){const t=B(e.join("\n")),n=(0,r.ZI)({type:"message",content:t,role:"assistant"});return n&&[n]}return null},B=e=>e.replace(/\r\n/g,"\n").replace(/(^|[^\n])\n(?!\n)/g,((e,t)=>`${t}  \n`)),U=e=>{if(!(0,o.isObject)(e)||!(0,o.has)(e,"type"))return!1;const t=e;return!("text"!==t.type||!(0,o.has)(e,"text")||!(0,o.isString)(t.text))||("image"===t.type&&(0,o.has)(e,"image")?(0,o.isString)(t.image):!!$(e)||!("tool-result"!==t.type||!(0,o.has)(e,"output")))},$=e=>!!(0,o.isObject)(e)&&((0,o.has)(e,"toolCallId")&&(0,o.has)(e,"toolName")&&(0,o.has)(e,"input")),J=e=>{if(!(0,o.isObject)(e))return!1;const t=e;if(!((0,o.has)(e,"role")&&(0,o.isString)(t.role)&&["user","assistant","system","tool","function"].includes(t.role)))return!1;return(0,o.has)(e,"content")&&((0,o.isString)(t.content)||(0,o.isArray)(t.content)&&t.content.every(U))},V=e=>{switch(e.type){case"text":return{type:"text",text:e.text};case"image":return{type:"image_url",image_url:{url:e.image}};case"tool-call":return{type:"text",text:""};case"tool-result":return{type:"text",text:JSON.stringify(e.output)}}},P=e=>{if("string"===typeof e.content)return(0,r.ZI)({type:"message",content:e.content,role:e.role,...e.name&&{name:e.name}});{var t;const n=e.content.map(V),o=e.content.filter((e=>"tool-call"===e.type)).map(K),s=null===(t=e.content.find((e=>"tool-result"===e.type)))||void 0===t?void 0:t.toolCallId;return(0,r.ZI)({content:n,role:e.role,...e.name&&{name:e.name},...s&&{tool_call_id:s},...o&&o.length>0&&{tool_calls:o}})}},K=e=>({id:e.toolCallId,function:{name:e.toolName,arguments:JSON.stringify(e.input)}}),q=e=>{if(!(0,o.isObject)(e))return null;const t=e;return(0,o.has)(e,"messages")&&(0,o.isArray)(t.messages)&&t.messages.every(J)?(0,o.compact)(t.messages.map(P)):null},G=e=>{if(!(0,o.isObject)(e))return null;const t=e;return(0,o.has)(e,"text")&&(0,o.isString)(t.text)?(0,o.compact)([(0,r.ZI)({type:"message",content:t.text,role:"assistant"})]):(0,o.has)(e,"toolCalls")&&(0,o.isArray)(t.toolCalls)&&t.toolCalls.every($)?(0,o.compact)([(0,r.ZI)({type:"message",content:"",role:"assistant",tool_calls:(0,o.compact)(t.toolCalls.map(K))})]):null},Q=e=>(0,o.isObject)(e)&&"text"===(0,o.get)(e,"type")&&(0,o.isString)((0,o.get)(e,"content")),X=e=>{if(!(0,o.isObject)(e)||"tool_call"!==(0,o.get)(e,"type"))return!1;if(!(0,o.isString)((0,o.get)(e,"name")))return!1;const t=(0,o.get)(e,"id");return(0,o.isNil)(t)||(0,o.isString)(t)},ee=e=>{if(!(0,o.isObject)(e)||"tool_call_response"!==(0,o.get)(e,"type"))return!1;const t=(0,o.get)(e,"id");return!(!(0,o.isNil)(t)&&!(0,o.isString)(t))&&(0,o.has)(e,"response")},te=e=>Q(e)||X(e)||ee(e),ne=e=>{if(!(0,o.isObject)(e))return!1;const t=(0,o.get)(e,"role");return!(!(0,o.isString)(t)||!["system","user","assistant","tool"].includes(t))&&(!(!(0,o.has)(e,"parts")||!(0,o.isArray)(e.parts)||0===e.parts.length)&&e.parts.every(te))},oe=e=>{var t,n;const r=(0,o.get)(e,"arguments");let s="";try{s=JSON.stringify(null!==r&&void 0!==r?r:{})}catch{s=String(r)}return{id:String(null!==(t=null!==(n=(0,o.get)(e,"id"))&&void 0!==n?n:(0,o.get)(e,"name"))&&void 0!==t?t:""),function:{name:String((0,o.get)(e,"name")),arguments:s}}},re=e=>{var t;const n=String(null!==(t=(0,o.get)(e,"id"))&&void 0!==t?t:""),r=(0,o.get)(e,"response");return{role:"tool",tool_call_id:n,content:(0,o.isString)(r)?r:(()=>{try{return JSON.stringify(r)}catch{return String(r)}})()}},se=e=>{if(!ne(e))return null;const t=e.role,n=[],o=[];let s=null;for(const r of e.parts)Q(r)?n.push({type:"text",text:r.content}):X(r)?o.push(oe(r)):ee(r)&&(s=re(r));return s&&0===n.length&&0===o.length?s:(0,r.ZI)({type:"message",role:t,...e.name&&{name:e.name},...n.length>0&&{content:n},...o.length>0&&{tool_calls:o}})},ie=e=>(0,o.isObject)(e)&&(0,o.has)(e,"kind")&&"request"===e.kind&&(0,o.has)(e,"parts")&&(0,o.isArray)(e.parts),ae=e=>(0,o.isObject)(e)&&(0,o.has)(e,"kind")&&"response"===e.kind&&(0,o.has)(e,"parts")&&(0,o.isArray)(e.parts),le=e=>{return{id:e.tool_call_id,function:{name:e.tool_name,arguments:(t=e.args,(0,o.isNil)(t)?"{}":(0,o.isString)(t)?t:JSON.stringify(t,null,2))}};var t},ce=e=>{const t=[];for(const n of e.parts)switch(n.part_kind){case"system-prompt":{const e=(0,r.ZI)({role:"system",content:n.content});e&&t.push(e);break}case"user-prompt":{const e=(0,r.ZI)({role:"user",content:n.content});e&&t.push(e);break}case"tool-return":case"builtin-tool-return":{const e=(0,o.isString)(n.content)?n.content:JSON.stringify(n.content,null,2),s=(0,r.ZI)({role:"tool",content:e,tool_call_id:n.tool_call_id});s&&t.push(s);break}}return t},ue=e=>{const t=[],n=[],o=[];for(const r of e.parts)switch(r.part_kind){case"text":n.push(r.content);break;case"thinking":n.push(`[Thinking] ${r.content}`);break;case"tool-call":case"builtin-tool-call":o.push(le(r));break;case"file":n.push("[file]")}const s=n.length>0?n.join("\n\n"):void 0,i=(0,r.ZI)({role:"assistant",content:s,...o.length>0&&{tool_calls:o}});return i&&t.push(i),t},ge=e=>{if(!e)return null;if((0,o.isObject)(e)&&(0,o.has)(e,"message_history")){const t=e.message_history;if((0,o.isArray)(t)&&t.length>0){const e=[];for(const n of t)ie(n)?e.push(...ce(n)):ae(n)&&e.push(...ue(n));return e.length>0?e:null}}if((0,o.isArray)(e)&&e.length>0){const t=[];for(const n of e)ie(n)?t.push(...ce(n)):ae(n)&&t.push(...ue(n));return t.length>0?t:null}return ie(e)?ce(e):null},fe=e=>{if(!e)return null;if((0,o.isObject)(e)&&(0,o.has)(e,"_new_messages_serialized")){const t=e._new_messages_serialized;if((0,o.isArray)(t)&&t.length>0){const e=[];for(const n of t)ie(n)?e.push(...ce(n)):ae(n)&&e.push(...ue(n));return e.length>0?e:null}}if((0,o.isArray)(e)&&e.length>0){const t=[];for(const n of e)ie(n)?t.push(...ce(n)):ae(n)&&t.push(...ue(n));return t.length>0?t:null}return ae(e)?ue(e):null},pe=e=>{if(!(0,o.isObject)(e))return!1;const t=e;return"text"===t.type&&(0,o.isString)(t.text)},de=e=>{if(!(0,o.isObject)(e))return!1;const t=e;return"tool-call"===t.type&&(0,o.isString)(t.toolCallId)&&(0,o.isString)(t.toolName)},me=e=>{if(!(0,o.isObject)(e))return!1;const t=e;return"tool-result"===t.type&&(0,o.isString)(t.toolCallId)&&(0,o.isString)(t.toolName)},ye=e=>pe(e)||de(e)||me(e),he=e=>{if(!(0,o.isObject)(e))return!1;const t=e;return!!((0,o.has)(e,"role")&&(0,o.isString)(t.role)&&["system","user","assistant","tool"].includes(t.role))&&(!!(0,o.isString)(t.content)||!!(0,o.isArray)(t.content)&&t.content.every(ye))},be=e=>{const t=[];for(const n of e)pe(n)&&t.push(n.text);return t.join("\n\n")},ve=e=>{if((0,o.isString)(e.content))return(0,r.ZI)({role:e.role,content:e.content});const t=e.content;if("tool"===e.role){const e=(e=>{for(const t of e)if(me(t)){const e=t.output;return"json"===(null===e||void 0===e?void 0:e.type)&&null!==e&&void 0!==e&&e.value?JSON.stringify(e.value,null,2):JSON.stringify(e,null,2)}})(t),n=(e=>{for(const t of e)if(me(t))return t.toolCallId})(t);return(0,r.ZI)({role:"tool",content:e,...n&&{tool_call_id:n}})}if("assistant"===e.role){const e=be(t),n=(e=>{const t=[];for(const n of e)de(n)&&t.push({id:n.toolCallId,function:{name:n.toolName,arguments:JSON.stringify(n.input,null,2)}});return t})(t);return(0,r.ZI)({role:"assistant",content:e||void 0,...n.length>0&&{tool_calls:n}})}const n=be(t);return(0,r.ZI)({role:e.role,content:n})},Se=e=>{let t=null;if((0,o.isString)(e))try{const n=JSON.parse(e);(0,o.isArray)(n)&&(t=n)}catch{return null}else(0,o.isArray)(e)&&(t=e);return t&&0!==t.length&&t.every(he)?(0,o.compact)(t.map(ve)):null},xe=e=>{if((0,o.isString)(e)&&e.trim().length>0){const t=(0,r.ZI)({role:"assistant",content:e});return t?[t]:null}return null},_e=e=>{var t;return null===(t=e.attributes)||void 0===t?void 0:t["tool.call.id"]},Ae=(e,t,n)=>{const s=[],i=Se(e);if(!i||0===i.length)return null;s.push(...i);const a=n.filter((e=>{var t;return"tool"===(null===(t=e.attributes)||void 0===t?void 0:t["span.type"])}));if(a.length>0){const e=a.map((e=>{const t=_e(e),n=(e=>{var t;return null===(t=e.attributes)||void 0===t?void 0:t["tool.name"]})(e),r=e.inputs;return{id:t,function:{name:n,arguments:(0,o.isObject)(r)?JSON.stringify(r,null,2):String(null!==r&&void 0!==r?r:"")}}})),t=(0,r.ZI)({role:"assistant",content:void 0,tool_calls:e});t&&s.push(t);for(const n of a){const e=_e(n),t=n.outputs,i=(0,o.isObject)(t)?JSON.stringify(t,null,2):String(null!==t&&void 0!==t?t:""),a=(0,r.ZI)({role:"tool",content:i,tool_call_id:e});a&&s.push(a)}}if((0,o.isString)(t)&&t.trim().length>0){const e=(0,r.ZI)({role:"assistant",content:t});e&&s.push(e)}return s.length>0?s:null}},19112:function(e,t,n){n.d(t,{z7:function(){return A},VE:function(){return S}});var o=n(76386),r=n(91215),s=n(49693),i=n(94066),a=n(3491),l=n(20515),c=n(27962),u=n(54921);var g={'code[class*="language-"]':{fontFamily:'Consolas, Menlo, Monaco, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", "Nimbus Mono L", "Courier New", Courier, monospace',fontSize:"14px",lineHeight:"1.375",direction:"ltr",textAlign:"left",whiteSpace:"pre",wordSpacing:"normal",wordBreak:"normal",MozTabSize:"4",OTabSize:"4",tabSize:"4",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none",hyphens:"none",background:"#2a2734",color:"#5DFAFC"},'pre[class*="language-"]':{fontFamily:'Consolas, Menlo, Monaco, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", "Nimbus Mono L", "Courier New", Courier, monospace',fontSize:"14px",lineHeight:"1.375",direction:"ltr",textAlign:"left",whiteSpace:"pre",wordSpacing:"normal",wordBreak:"normal",MozTabSize:"4",OTabSize:"4",tabSize:"4",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none",hyphens:"none",background:"#2a2734",color:"#5DFAFC",padding:"1em",margin:".5em 0",overflow:"auto"},'pre > code[class*="language-"]':{fontSize:"1em"},'pre[class*="language-"]::-moz-selection':{textShadow:"none",background:"#6a51e6"},'pre[class*="language-"] ::-moz-selection':{textShadow:"none",background:"#6a51e6"},'code[class*="language-"]::-moz-selection':{textShadow:"none",background:"#6a51e6"},'code[class*="language-"] ::-moz-selection':{textShadow:"none",background:"#6a51e6"},'pre[class*="language-"]::selection':{textShadow:"none",background:"#6a51e6"},'pre[class*="language-"] ::selection':{textShadow:"none",background:"#6a51e6"},'code[class*="language-"]::selection':{textShadow:"none",background:"#6a51e6"},'code[class*="language-"] ::selection':{textShadow:"none",background:"#6a51e6"},':not(pre) > code[class*="language-"]':{padding:".1em",borderRadius:".3em"},comment:{color:"#6c6783"},prolog:{color:"#6c6783"},doctype:{color:"#6c6783"},cdata:{color:"#6c6783"},punctuation:{color:"#6c6783"},namespace:{Opacity:".7"},tag:{color:"#3AACE2"},operator:{color:"#3AACE2"},number:{color:"#3AACE2"},property:{color:"#5DFAFC"},function:{color:"#5DFAFC"},"tag-id":{color:"#eeebff"},selector:{color:"#eeebff"},"atrule-id":{color:"#eeebff"},"code.language-javascript":{color:"#c4b9fe"},"attr-name":{color:"#c4b9fe"},"code.language-css":{color:"#ffffff"},"code.language-scss":{color:"#ffffff"},boolean:{color:"#ffffff"},string:{color:"#ffffff"},entity:{color:"#ffffff",cursor:"help"},url:{color:"#ffffff"},".language-css .token.string":{color:"#ffffff"},".language-scss .token.string":{color:"#ffffff"},".style .token.string":{color:"#ffffff"},"attr-value":{color:"#ffffff"},keyword:{color:"#ffffff"},control:{color:"#ffffff"},directive:{color:"#ffffff"},unit:{color:"#ffffff"},statement:{color:"#ffffff"},regex:{color:"#ffffff"},atrule:{color:"#ffffff"},placeholder:{color:"#ffffff"},variable:{color:"#ffffff"},deleted:{textDecoration:"line-through"},inserted:{borderBottom:"1px dotted #eeebff",textDecoration:"none"},italic:{fontStyle:"italic"},important:{fontWeight:"bold",color:"#c4b9fe"},bold:{fontWeight:"bold"},"pre > code.highlight":{Outline:".4em solid #8a75f5",OutlineOffset:".4em"},".line-numbers.line-numbers .line-numbers-rows":{borderRightColor:"#2c2937"},".line-numbers .line-numbers-rows > span:before":{color:"#3c3949"},".line-highlight.line-highlight":{background:"linear-gradient(to right, rgba(224, 145, 66, 0.2) 70%, rgba(224, 145, 66, 0))"}};var f={'code[class*="language-"]':{textAlign:"left",whiteSpace:"pre",wordSpacing:"normal",wordBreak:"normal",wordWrap:"normal",color:"rgb(77, 77, 76)",background:"#fafafa",fontFamily:"Monaco, Menlo, Ubuntu Mono, Consolas, source-code-pro, monospace",fontSize:"12px",lineHeight:"1.5em",MozTabSize:"4",OTabSize:"4",tabSize:"4",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none",hyphens:"none"},'pre[class*="language-"]':{textAlign:"left",whiteSpace:"pre",wordSpacing:"normal",wordBreak:"normal",wordWrap:"normal",color:"rgb(77, 77, 76)",background:"#fafafa",fontFamily:"Monaco, Menlo, Ubuntu Mono, Consolas, source-code-pro, monospace",fontSize:"12px",lineHeight:"1.5em",MozTabSize:"4",OTabSize:"4",tabSize:"4",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none",hyphens:"none",overflow:"auto",position:"relative",margin:"0.5em 0",padding:"1.25em 1em"},'code[class*="language-"]::-moz-selection':{background:"#cceae7",color:"#263238"},'pre[class*="language-"]::-moz-selection':{background:"#cceae7",color:"#263238"},'code[class*="language-"] ::-moz-selection':{background:"#cceae7",color:"#263238"},'pre[class*="language-"] ::-moz-selection':{background:"#cceae7",color:"#263238"},'code[class*="language-"]::selection':{background:"#cceae7",color:"#263238"},'pre[class*="language-"]::selection':{background:"#cceae7",color:"#263238"},'code[class*="language-"] ::selection':{background:"#cceae7",color:"#263238"},'pre[class*="language-"] ::selection':{background:"#cceae7",color:"#263238"},':not(pre) > code[class*="language-"]':{whiteSpace:"normal",borderRadius:"0.2em",padding:"0.1em"},".language-css > code":{color:"#f5871f"},".language-sass > code":{color:"#f5871f"},".language-scss > code":{color:"#f5871f"},'[class*="language-"] .namespace':{Opacity:"0.7"},atrule:{color:"#7c4dff"},"attr-name":{color:"#39adb5"},"attr-value":{color:"#f6a434"},attribute:{color:"#f6a434"},boolean:{color:"#7c4dff"},builtin:{color:"#39adb5"},cdata:{color:"#39adb5"},char:{color:"#39adb5"},class:{color:"#39adb5"},"class-name":{color:"#6182b8"},comment:{color:"#8e908c"},constant:{color:"#7c4dff"},deleted:{color:"#e53935"},doctype:{color:"#aabfc9"},entity:{color:"#e53935"},function:{color:"#4271ae"},hexcode:{color:"#f5871f"},id:{color:"#7c4dff",fontWeight:"bold"},important:{color:"#7c4dff",fontWeight:"bold"},inserted:{color:"#39adb5"},keyword:{color:"#8959a8"},number:{color:"#f5871f"},operator:{color:"#3e999f"},prolog:{color:"#aabfc9"},property:{color:"#39adb5"},"pseudo-class":{color:"#f6a434"},"pseudo-element":{color:"#f6a434"},punctuation:{color:"rgb(77, 77, 76)"},regex:{color:"#6182b8"},selector:{color:"#e53935"},string:{color:"#3ba85f"},symbol:{color:"#7c4dff"},tag:{color:"#e53935"},unit:{color:"#f5871f"},url:{color:"#e53935"},variable:{color:"#c72d4c"}},p=n(76118),d=n(73408),m=(n(46709),n(16333)),y=n(79081),h=n(27757);var b={name:"1739oy8",styles:"z-index:1"};function v({tooltipMessage:e,...t}){const n=b;return(0,d.Y)(y.T,{content:e,componentId:"codegen_web-shared_src_snippet_actions_snippetactionbutton.tsx_26",children:(0,d.Y)(h.B,{componentId:"codegen_web-shared_src_snippet_actions_snippetactionbutton.tsx_33",...t,css:n})})}function S({copyText:e,onClick:t,...n}){const{actionIcon:o,tooltipMessage:r,copy:s}=(0,m.Ld)(e);return(0,d.Y)(v,{tooltipMessage:r,icon:o,onClick:e=>{s(),null===t||void 0===t||t(e)},...n})}o.A.registerLanguage("sql",u.A),o.A.registerLanguage("java",s.A),o.A.registerLanguage("python",l.A),o.A.registerLanguage("go",r.A),o.A.registerLanguage("javascript",i.A),o.A.registerLanguage("yaml",c.A),o.A.registerLanguage("json",a.A);const x="24px",_={light:f,duotoneDark:g};function A({theme:e="light",language:t,actions:n,style:r,children:s,showLineNumbers:i,lineNumberStyle:a,wrapLongLines:l,wrapLines:c,lineProps:u,PreTag:g}){const f={border:"none",borderRadius:0,margin:0,padding:x,...r};return(0,d.Y)(o.A,{showLineNumbers:i,lineNumberStyle:a,language:t,style:_[e],customStyle:f,codeTagProps:{style:(0,p.pick)(r,"backgroundColor")},lineProps:u,wrapLongLines:l,wrapLines:c,PreTag:g,children:s})}},27094:function(e,t,n){n.d(t,{k:function(){return i}});var o=n(66916),r=n(73408);var s={name:"t152af",styles:"margin-top:8px;color:red"};const i=({value:e,valueError:t,setValue:n,setValueError:i,isSubmitting:a})=>(0,r.FD)("div",{children:[(0,r.Y)(o.I,{"data-testid":"assessment-value-string-input",componentId:"shared.model-trace-explorer.assessment-value-string-input",value:String(e),onKeyDown:e=>e.stopPropagation(),onChange:e=>{n(e.target.value),i(null)},disabled:a,allowClear:!0}),t&&(0,r.Y)("div",{css:s,children:t})]})},27925:function(e,t,n){n.d(t,{w:function(){return r}});var o=n(46709);function r({ref:e,debounceTimeMs:t}){const n=(0,o.useRef)({width:-1,height:-1}),r=(0,o.useRef)(),[s,i]=(0,o.useState)(null),a=(0,o.useCallback)((e=>{if(0===e.length)return;const o=e[0].contentRect;if(-1===n.current.width)return n.current={width:o.width,height:o.height},void i(n.current);if(o.width!==n.current.width||o.height!==n.current.height){if(n.current.width=o.width,n.current.height=o.height,!t)return void i({...n.current});clearTimeout(r.current),r.current=setTimeout((()=>{i({...n.current})}),t)}}),[t]),l=(0,o.useRef)();return l.current||(l.current=new ResizeObserver(a)),(0,o.useEffect)((()=>{const t="function"===typeof e?e():e.current;if(t){const e=l.current;return e.observe(t),()=>e.unobserve(t)}})),s}},33120:function(e,t,n){n.d(t,{ff:function(){return s},we:function(){return i}});var o=n(36476);const r=fetch;const s=async(e,t="GET",n,s)=>{const i={method:t,signal:s,headers:{...n?{"Content-Type":"application/json"}:{},...l(document.cookie)}};n&&(i.body=function(e){if(void 0!==e)return"string"===typeof e||e instanceof FormData||e instanceof Blob?e:JSON.stringify(e)}(n));const a=await r(e,i);if(!a.ok){const e=(0,o.a$)(a);if(e){try{const t=(await a.json()).message;e.message=null!==t&&void 0!==t?t:e.message}catch{}throw e}}return a.json()},i=e=>e;const a=e=>{const t="mlflow-request-header-",n=function(e=document.cookie){return e.split(";").reduce(((e,t)=>{const[n,o]=t.trim().split("=");return e[n]=decodeURIComponent(o||""),e}),{})}(e);return n&&0!==Object.keys(n).length?Object.keys(n).filter((e=>e.startsWith(t))).reduce(((e,t)=>({...e,[t.substring(22)]:n[t]})),{}):{}},l=e=>({...a(e)})},33145:function(e,t,n){n.d(t,{R:function(){return s},e:function(){return r}});var o=n(27299);const r=e=>"feedback"in e&&e.feedback?e.feedback.value:"expectation"in e?e.expectation&&"value"in e.expectation?e.expectation.value:e.expectation.serialized_value.value:void 0,s=e=>{switch(e.source_type){case"HUMAN":return o.UserIcon;case"LLM_JUDGE":return o.SparkleIcon;default:return o.CodeIcon}}},37750:function(e,t,n){n(46709),n(44072)},38815:function(e,t,n){n.d(t,{L:function(){return c}});var o=n(46709),r=n(72801),s=n(79081),i=n(27299),a=n(42747),l=n(73408);function c(e,t,n){const c=(0,a.tz)(),u=t||c.formatMessage({id:"hBAhI8",defaultMessage:"Copy"}),g=c.formatMessage({id:"g4hHzO",defaultMessage:"Copied"}),f=(0,r.useClipboard)(),p=(0,o.useRef)(),[d,m]=(0,o.useState)(!1),[y,h]=(0,o.useState)(!1);(0,o.useEffect)((()=>()=>{window.clearTimeout(p.current)}),[]);return{actionIcon:d?(0,l.Y)(s.C,{}):(0,l.Y)(i.CopyIcon,{}),tooltipMessage:d?g:u,copy:()=>{f.copy(e),window.clearTimeout(p.current),m(!0),null===n||void 0===n||n(),p.current=window.setTimeout((()=>{m(!1)}),3e3)},copied:d,ariaLabel:u,tooltipOpen:y||d,handleTooltipOpenChange:h}}},41151:function(e,t,n){n.d(t,{M:function(){return s}});var o=n(46709);const r=o.createContext({sqlWarehouseId:void 0,modelTraceInfo:void 0,invalidateTraceQuery:void 0}),s=()=>o.useContext(r)},44666:function(e,t,n){n.d(t,{w:function(){return o}});const o=()=>"User"},51847:function(e,t,n){n.d(t,{P:function(){return c}});var o=n(68248),r=n(27757),s=n(27299),i=n(66916),a=n(94664),l=n(73408);const c=({type:e=a.Dy.CONNECT,isInTooltip:t=!1,hasException:n=!1,isRootSpan:c=!1})=>{const{theme:u}=(0,r.u)();let g;c?g="ai":n&&(g="danger");const f={[a.Dy.MODELS]:(0,l.Y)(s.ModelsIcon,{color:g}),[a.Dy.DOCUMENT]:(0,l.Y)(s.FileDocumentIcon,{color:g}),[a.Dy.CONNECT]:(0,l.Y)(s.ConnectIcon,{color:g}),[a.Dy.CODE]:(0,l.Y)(s.CodeIcon,{color:g}),[a.Dy.FUNCTION]:(0,l.Y)(s.FunctionIcon,{color:g}),[a.Dy.NUMBERS]:(0,l.Y)(s.NumbersIcon,{color:g}),[a.Dy.SEARCH]:(0,l.Y)(i.S,{color:g}),[a.Dy.SORT]:(0,l.Y)(s.SortUnsortedIcon,{color:g}),[a.Dy.UNKNOWN]:(0,l.Y)(s.QuestionMarkIcon,{color:g}),[a.Dy.WRENCH]:(0,l.Y)(s.WrenchIcon,{color:g}),[a.Dy.AGENT]:(0,l.Y)(s.UserSparkleIcon,{color:g}),[a.Dy.CHAIN]:(0,l.Y)(s.ChainIcon,{color:g}),[a.Dy.USER]:(0,l.Y)(s.UserIcon,{color:g}),[a.Dy.SYSTEM]:(0,l.Y)(s.GearIcon,{color:g}),[a.Dy.SAVE]:(0,l.Y)(s.SaveIcon,{color:g})};let p=u.colors.actionDefaultIconDefault,d=u.colors.actionPrimaryIcon,m=u.colors.backgroundSecondary;switch(e){case a.Dy.SEARCH:p=u.colors.textValidationSuccess,d=u.colors.green500,m=u.isDarkMode?u.colors.green800:u.colors.green100;break;case a.Dy.MODELS:p=u.isDarkMode?u.colors.blue500:u.colors.turquoise,d=u.isDarkMode?u.colors.turquoise:u.colors.blue500,m=u.isDarkMode?u.colors.blue800:u.colors.blue100;break;case a.Dy.WRENCH:p=u.isDarkMode?u.colors.red500:u.colors.red700,d=u.isDarkMode?u.colors.red700:u.colors.red500,m=u.isDarkMode?u.colors.red800:u.colors.red100}return(0,l.FD)("div",{css:(0,o.AH)({position:"relative",width:u.general.iconSize,height:u.general.iconSize,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:u.borders.borderRadiusSm,background:t?u.colors.tooltipBackgroundTooltip:m,color:t?d:p,svg:{width:u.general.iconFontSize,height:u.general.iconFontSize},flexShrink:0},""),children:[n&&(0,l.Y)("div",{css:(0,o.AH)({position:"absolute",top:-u.spacing.xs,right:-u.spacing.xs,height:u.spacing.sm,width:u.spacing.sm,borderRadius:u.borders.borderRadiusSm,backgroundColor:u.colors.actionDangerPrimaryBackgroundDefault,zIndex:5},"")}),f[e]]})}},52033:function(e,t,n){n.d(t,{B:function(){return i}});var o=n(27299),r=n(73408);var s={name:"t152af",styles:"margin-top:8px;color:red"};const i=({value:e,valueError:t,setValue:n,setValueError:i,isSubmitting:a})=>(0,r.FD)("div",{children:[(0,r.FD)(o.SegmentedControlGroup,{"data-testid":"assessment-value-boolean-input",componentId:"shared.model-trace-explorer.assessment-value-boolean-input",name:"shared.model-trace-explorer.assessment-value-boolean-input",value:e,disabled:a,onChange:e=>{n(e.target.value),i(null)},children:[(0,r.Y)(o.SegmentedControlButton,{value:!0,children:"True"}),(0,r.Y)(o.SegmentedControlButton,{value:!1,children:"False"})]}),t&&(0,r.Y)("div",{css:s,children:t})]})},52489:function(e,t,n){n.d(t,{e:function(){return r}});var o=n(110);const r=(e,t)=>(0,o.Oz)(`/experiments/${e}/chat-sessions/${t}`)},59542:function(e,t,n){n.d(t,{B:function(){return o}});const o=({queryClient:e})=>{e.invalidateQueries({queryKey:["searchMlflowTraces"]})}},65854:function(e,t,n){n.d(t,{w:function(){return o}});const o=300},69291:function(e,t,n){n.d(t,{p:function(){return i}});var o=n(110),r=n(55113);const s=e=>(0,r.tW)((0,o.Oz)("/experiments/:experimentId"),{experimentId:e}),i=e=>`${s(e)}/traces`},69660:function(e,t,n){n.d(t,{AG:function(){return u},a8:function(){return s},bS:function(){return i},m$:function(){return h},n_:function(){return f},x1:function(){return b},xW:function(){return y}});var o=n(76118),r=n(86125);const s=e=>{var t,n,s;if(!e)return null;const i=null!==(t=null!==(n=e.messages)&&void 0!==n?n:e.input)&&void 0!==t?t:null===(s=e.request)||void 0===s?void 0:s.input;return Array.isArray(i)&&0!==i.length&&i.every(r.I$)?(0,o.compact)(i.map(r.ZI)):null},i=e=>(0,r.x0)(e)?e.map((e=>{var t;return{...e.message,tool_calls:null===(t=e.message.tool_calls)||void 0===t?void 0:t.map(r.CL)}})):(0,r.in)(e)?e.choices.map((e=>{var t;return{...e.message,tool_calls:null===(t=e.message.tool_calls)||void 0===t?void 0:t.map(r.CL)}})):null,a=e=>!!((0,o.has)(e,"role")&&(0,o.has)(e,"content")&&["user","assistant","system","developer"].includes(e.role))&&((0,o.isString)(e.content)||(0,o.isArray)(e.content)&&e.content.every((e=>(0,o.has)(e,"type")&&["input_text","input_image","input_file"].includes(e.type)))),l=e=>{if(!(0,o.isObject)(e))return!1;if("message"===(0,o.get)(e,"type"))return(0,r.I$)(e);if("function_call"===(0,o.get)(e,"type"))return(0,o.isString)((0,o.get)(e,"call_id"))&&(0,o.isString)((0,o.get)(e,"name"))&&(0,o.isString)((0,o.get)(e,"arguments"));if("function_call_output"===(0,o.get)(e,"type"))return(0,o.isString)((0,o.get)(e,"call_id"))&&(0,o.isString)((0,o.get)(e,"output"));if("image_generation_call"===(0,o.get)(e,"type")){const t=(0,o.get)(e,"output_format");return(0,o.isString)((0,o.get)(e,"result"))&&(0,o.isString)(t)&&["png","jpeg","webp"].includes(t)}return"reasoning"===(0,o.get)(e,"type")&&((0,o.has)(e,"id")&&(0,o.isArray)((0,o.get)(e,"summary")))},c=e=>{if((0,o.isString)(e.content)){const t=(0,r.ZI)({type:"message",content:e.content,role:e.role});return t&&[t]}return e.content.map((t=>((e,t)=>{const n=(0,o.get)(e,"text");if("input_text"===(0,o.get)(e,"type")&&(0,o.isString)(n))return(0,r.ZI)({type:"message",content:[{type:"text",text:n}],role:t});const s=(0,o.get)(e,"image_url");return"input_image"===(0,o.get)(e,"type")&&(0,o.isString)(s)?(0,r.ZI)({type:"message",content:[{type:"image_url",image_url:{url:s}}],role:t}):null})(t,e.role))).filter((e=>null!==e))},u=e=>{var t,n;const s=null!==(t=null!==(n=(0,o.get)(e,"input"))&&void 0!==n?n:(0,o.get)(e,"request.input"))&&void 0!==t?t:e;if((0,o.isString)(s)){const e=(0,r.ZI)({type:"message",content:s,role:"user"});return e&&[e]}return(0,o.isArray)(s)&&s.every(a)?(0,o.compact)(s.flatMap(c)):null},g=e=>"message"===e.type?(0,r.ZI)(e):"function_call"===e.type?{role:"assistant",tool_calls:[(0,r.CL)({id:e.call_id,function:{arguments:e.arguments,name:e.name}})]}:"function_call_output"===e.type?{role:"tool",tool_call_id:e.call_id,content:e.output}:"image_generation_call"===e.type?(0,r.ZI)({type:"message",content:[{type:"image_url",image_url:{url:`data:image/${e.output_format};base64,${e.result}`}}],role:"tool"}):(e.type,null),f=e=>{var t;if((0,o.isNil)(e))return null;const n=null!==(t=(0,o.get)(e,"output"))&&void 0!==t?t:e;return(0,o.isArray)(n)&&n.length>0&&n.every(l)?(0,o.compact)(n.map(g).filter(Boolean)):(0,o.isArray)(n)&&n.length>0&&n.every((e=>"response.output_item.done"===e.type&&l(e.item)))?(0,o.compact)(n.map((e=>g(e.item)))):null},p=e=>!!(0,o.isObject)(e)&&(!!((0,o.has)(e,"role")&&(0,o.has)(e,"content")&&["user","assistant","system","tool"].includes(e.role))||("function_call"===(0,o.get)(e,"type")?(0,o.isString)((0,o.get)(e,"call_id"))&&(0,o.isString)((0,o.get)(e,"name"))&&(0,o.isString)((0,o.get)(e,"arguments")):"function_call_output"===(0,o.get)(e,"type")&&((0,o.isString)((0,o.get)(e,"call_id"))&&(0,o.isString)((0,o.get)(e,"output"))))),d=e=>!!(0,o.isObject)(e)&&("response.output_item.done"===(0,o.get)(e,"type")&&l((0,o.get)(e,"item"))),m=e=>{if((0,o.has)(e,"role")&&(0,o.has)(e,"content")){if((0,o.isArray)(e.content)){const t=e.content.filter((e=>"output_text"===e.type&&(0,o.isString)(e.text))).map((e=>e.text)).join(" ");if(t)return(0,r.ZI)({...e,content:t})}return(0,r.ZI)(e)}if("function_call"===(0,o.get)(e,"type")){const t=(0,o.get)(e,"call_id"),n=(0,o.get)(e,"arguments"),s=(0,o.get)(e,"name");if((0,o.isString)(t)&&(0,o.isString)(n)&&(0,o.isString)(s))return{role:"assistant",tool_calls:[(0,r.CL)({id:t,function:{arguments:n,name:s}})]}}if("function_call_output"===(0,o.get)(e,"type")){const t=(0,o.get)(e,"call_id"),n=(0,o.get)(e,"output");if((0,o.isString)(t)&&(0,o.isString)(n))return{role:"tool",tool_call_id:t,content:n}}return null},y=e=>(0,o.isNil)(e)?null:(0,o.isArray)(e)&&e.length>0&&e.every(p)?(0,o.compact)(e.map(m)):null,h=e=>(0,o.isNil)(e)?null:(0,o.isArray)(e)&&e.length>0&&e.every(p)?(0,o.compact)(e.map(m)):null,b=e=>(0,o.isNil)(e)?null:(0,o.isArray)(e)&&e.length>0&&e.every((e=>(e=>!!(0,o.isObject)(e)&&"response.output_text.delta"===(0,o.get)(e,"type")&&(0,o.isString)((0,o.get)(e,"delta")))(e)||d(e)))&&e.some((e=>d(e)))?(0,o.compact)(e.filter(d).map((e=>g(e.item)))):null},72143:function(e,t,n){n.d(t,{f:function(){return i}});var o=n(66916),r=n(27299),s=n(73408);const i=({value:e,valueError:t,setValue:n,setValueError:i,isSubmitting:a})=>(0,s.FD)("div",{children:[(0,s.Y)(o.I.TextArea,{"data-testid":"assessment-value-json-input",componentId:"shared.model-trace-explorer.assessment-edit-value-string-input",value:String(e),autoSize:{minRows:1,maxRows:5},onKeyDown:e=>e.stopPropagation(),onChange:e=>{n(e.target.value),i(null)},validationState:t?"error":void 0,disabled:a}),t&&(0,s.Y)(r.FormUI.Message,{id:"shared.model-trace-explorer.assessment-edit-value-json-error",message:t,type:"error"})]})},73880:function(e,t,n){n.d(t,{t:function(){return c}});var o=n(68248),r=n(79081),s=n(27299),i=n(27757),a=n(73408);const l=e=>e?{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}:{whiteSpace:"nowrap"},c=({itemKey:e,itemValue:t,charLimit:n=18,maxWidth:c=150,className:u})=>{const{shouldTruncateKey:g,shouldTruncateValue:f}=function(e,t,n){const o=e.length+t.length,r=e.length>t.length,s=r?t.length:e.length;return o<=n?{shouldTruncateKey:!1,shouldTruncateValue:!1}:s>n/2?{shouldTruncateKey:!0,shouldTruncateValue:!0}:{shouldTruncateKey:r,shouldTruncateValue:!r}}(e,t,n);return(0,a.Y)(r.T,{componentId:"shared.model-trace-explorer.key-value-tag.hover-tooltip",content:`${e}: ${t}`,children:(0,a.Y)(s.Tag,{componentId:"shared.model-trace-explorer.key-value-tag",className:u,children:(0,a.FD)("span",{css:(0,o.AH)({maxWidth:c,display:"inline-flex"},""),children:[(0,a.Y)(i.T.Text,{bold:!0,css:l(g),size:"sm",children:e}),":\xa0",(0,a.Y)(i.T.Text,{css:l(f),size:"sm",children:t})]})})})}},76127:function(e,t,n){n.d(t,{X:function(){return i}});var o=n(68248),r=n(27757),s=n(73408);function i({count:e}){const{theme:t}=(0,r.u)();return(0,s.Y)("div",{css:(0,o.AH)({display:"flex",alignItems:"center",justifyContent:"center",borderRadius:t.typography.fontSizeBase,height:t.typography.fontSizeBase,backgroundColor:t.colors.actionDangerPrimaryBackgroundDefault,padding:t.spacing.xs,marginLeft:t.spacing.xs,boxSizing:"border-box"},""),children:(0,s.Y)("span",{css:(0,o.AH)({color:t.colors.actionPrimaryTextDefault,fontSize:11},""),children:e})})}},89634:function(e,t,n){n.d(t,{O:function(){return i}});var o=n(66916),r=n(73408);var s={name:"t152af",styles:"margin-top:8px;color:red"};const i=({value:e,valueError:t,setValue:n,setValueError:i,isSubmitting:a})=>(0,r.FD)("div",{children:[(0,r.Y)(o.I,{"data-testid":"assessment-value-number-input",componentId:"shared.model-trace-explorer.assessment-value-number-input",value:String(e),onKeyDown:e=>e.stopPropagation(),onChange:e=>{n(e.target.value?Number(e.target.value):""),i(null)},type:"number",disabled:a,allowClear:!0}),t&&(0,r.Y)("div",{css:s,children:t})]})}}]);